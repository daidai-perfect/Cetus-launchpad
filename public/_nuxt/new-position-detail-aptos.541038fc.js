import{_ as Xo}from"./back.42a1ef77.js";import{_ as Yo,l as zo,a as Go,b as Jo,c as Qo}from"./icon-arrow_2x.cc61362d.js";import{a as Ve,u as Ye,b as xe,c as Ko}from"./index.4a60ce8c.js";import{c as ve,g as Zo,n as Vo,d as ge,a as J,o as ho,b as Me,i as $e,p as wo}from"./common.26bee659.js";import{a as ze,r as T,s as Co,m as b,A as ye,b as to,e as Ge,o as g,f as S,h as o,i as le,y as co,p as so,k as lo,q as So,I as Pe,M as $o,L as mo,C as bo,u as z,x as E,j as me,G as de,w as qe,P as Po,z as ko,a1 as xo,a2 as Xe,a3 as en,a6 as _o,N as yo,F as Ze,E as oo,B as ro,S as on,c as Be,a7 as nn,a8 as tn,D as To,Y as an,O as sn}from"./entry.f915a1e9.js";import{_ as vo}from"./token-warning.3e9a238d.js";import{_ as No}from"./status-block.6579039d.js";import{s as ao,m as ln,l as rn,b as un,a as dn}from"./transform.c672907f.js";import"./decimal.a2826370.js";import{D as p}from"./decimal.765d8738.js";/* empty css              */import{i as no}from"./import-icon.de3e6c66.js";import"./index.cce2acd5.js";import{u as uo,b as Oe,e as Ro,f as Oo,T as Io,C as cn}from"./index.bdee7b42.js";import{_ as fo}from"./assets-card.b00a8c39.js";import{_ as mn}from"./coin-lock.8c260593.js";import{_ as vn}from"./new-add-or-create.932ef7d9.js";import{_ as fn}from"./icon-Add-Liquidity_2x.4f0e88dc.js";import{_ as pn}from"./icon-Add-Liquidity_2x.5b1f94db.js";/* empty css              */import{u as qo}from"./notifi.b634b730.js";import{_ as hn}from"./apr-tips.746b6204.js";import{u as Bo}from"./farms.d72e934b.js";/* empty css              *//* empty css              */import"./swap-setting.4f36659c.js";/* empty css              */import"./icon-error_2x.157486c5.js";import"./useDebounceFunction.ab8b3dbd.js";import"./img-lock_2x.a28135f4.js";import"./img-lock_2x.5c879086.js";import"./deposit-ratio.3f36d070.js";import"./useWhale.0504516d.js";import"./icon_fee_2x.723b41fa.js";import"./icon_rewards_2x.1d466672.js";const bn=ze({props:{poolInfo:{type:Object,default:()=>({})}},setup(e,m){const r=T(!1),c=T(null),V=T(0),$=T(20),B=Ve(),v=Ye(),n=T(!1);Co(()=>{clearInterval(c.value)});const d=()=>{c.value=setInterval(()=>{var Q;n.value||V.value<$.value&&(V.value+=1,V.value===$.value&&((Q=e==null?void 0:e.poolInfo)!=null&&Q.poolAddress&&B.updateCurrentPools(e.poolInfo.poolAddress,v.chainName),V.value=0))},1e3)},k=b(()=>v.slippage),l=()=>{m.emit("clearAll")},C=T(!1),F=()=>{V.value=0,C.value=!0,m.emit("clickRefresh"),setTimeout(()=>{C.value=!1},1e3)};ye(()=>e.poolInfo,Q=>{Q&&!c.value&&d()},{immediate:!0});const re=to(),se=b(()=>v.chainName);return{clickRefresh:F,isShowSwapSetting:r,countdown:V,autoRefreshTime:$,slippage:k,clearAll:l,checkNullObj:ve,router:re,loading:n,chainName:se,refresh:C}}});const kn=e=>(so("data-v-ca768f9b"),e=e(),lo(),e),gn={class:"new-position-title"},wn={class:"left"},_n={class:"right"},yn=kn(()=>o("use",{"xlink:href":"#icon-icon-refresh"},null,-1)),In=[yn];function An(e,m,r,c,V,$){const B=Xo,v=Yo;return g(),S("div",gn,[o("div",wn,[le(B)]),o("div",_n,[le(v),(g(),S("svg",{"aria-hidden":"true",class:co(e.refresh?"refresh refresh-icon ":"refresh-icon"),onClick:m[0]||(m[0]=(...n)=>e.clickRefresh&&e.clickRefresh(...n))},In,2))])])}const Lo=Ge(bn,[["render",An],["__scopeId","data-v-ca768f9b"]]);function Ao(e,m,r){const c=new p(10).pow(m-r);return new p(1.0001).pow(e).mul(c)}const Cn=ze({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""}},setup(e,m){const r=T(1),c=T(""),V=T(""),$=b(()=>{var t,y,u;return l.sqrtPriceX64ToPrice((t=e.poolInfo)==null?void 0:t.current_sqrt_price,(y=e.poolInfo)==null?void 0:y.coinA.decimals,(u=e.poolInfo)==null?void 0:u.coinB.decimals).toString()}),B=b(()=>{let t=0;return e.direction?t=(Number(e.minPrice)/Number($.value)-1)*100:t=(Number(e.minPrice)/Number(1/Number($.value))-1)*100,t=t>0&&t<.1?.1:t,t=t<0&&t>-.1?-.1:t,t}),v=b(()=>{let t=0;return e.direction?t=(Number(e.maxPrice)/Number($.value)-1)*100:t=(Number(e.maxPrice)/Number(1/Number($.value))-1)*100,t=t>0&&t<.1?.1:t,t=t<0&&t>-.1?-.1:t,t}),n=Ye(),d=b(()=>n),k=b(()=>d.value.chainName?xe(d.value.chainName):{}),{TickMath:l,getNearestTickByTick:C}=k.value,F=()=>{const t=r.value/2;r.value=t,Q(e.poolInfo,t)},re=()=>{const t=r.value*2;r.value=t,Q(e.poolInfo,t)},se=(t=[])=>{let y=6;const u=Math.abs(Number(t[0])-Number(t[t.length-1]));return u>=6?y=0:u>=1?y=1:u>=.1?y=2:u>=.01?y=3:u>=.001?y=4:u>=1e-4?y=5:u>=1e-5?y=6:u>=1e-6?y=7:u>=1e-7&&(y=8),y},Q=(t,y=1)=>{if(console.log("ðŸš€ðŸš€ðŸš€ ~ file: new-position-chart.vue:189 ~ dataProcessing ~ zooms:",y),t&&t.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const u=Number(e.poolInfo.current_tick_index);let h=u+100*y,i=u-100*y,oe,K;if(e.maxPrice==="âˆž")K=k.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?K=l.priceToTickIndex(new p(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):K=l.priceToTickIndex(new p(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{K=443636}if(e.minPrice==="0")oe=k.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?oe=l.priceToTickIndex(new p(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):oe=l.priceToTickIndex(new p(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{oe=-443636}let ne=0;if(e.currentPriceTab!=="full range"){if(u>=oe&&u<=K){const L=u-oe,ke=K-u;ne=Math.max(Math.abs(L),Math.abs(ke))}else u<oe?ne=Math.abs(K-u):ne=Math.abs(u-oe);h=u+ne+20*y,i=u-ne-20*y}else{const L=(Math.abs(u)>5e3,2e4);h=u+L*y,i=u-L*y}i<-443636&&(i=-443636),h>443636&&(h=443636);const W=new p(t.liquidity).div(Math.pow(10,8)).toString(),_=e.tickList,O=[],P=[];let H={};for(let L=0;L<_.length;L++){if(H=_[L],H.index<=u&&H.index>=i){if(O.length<1&&L!==0){const ke=_[L-1];O.unshift({...ke,index:i})}O.unshift(H)}else if(H.index>u&&H.index<=h&&(P.push(H),O.length<1&&L!==0)){const ke=_[L-1];O.push({...ke,index:i})}if(H.index>h){const ke=_[L];if(P.push({...ke,index:h}),O.length<1&&L!==0){const Ie=_[L-1];O.push({...Ie,index:i})}break}}let x="0";for(let L=O.length-1;L>=0;L--)x=new p(x).plus(new p(O[L].liquidityNet.toString()).div(Math.pow(10,8))).toString(),O[L].liquityAmount=x;let G=W;for(let L=0;L<P.length;L++)G=new p(G).plus(new p(P[L].liquidityNet.toString()).div(Math.pow(10,8))).toString(),P[L].liquityAmount=G;let te=[];const Z=_&&_.length>0?{index:u,liquityAmount:Number(W)}:{index:u,liquityAmount:0};(O.length>0||P.length>0)&&(te=[...O.reverse(),Z,...P],e.direction||(te=te.reverse()));const be=[];_.forEach(L=>{be.push({...L,liquidityGross:L.liquidityGross.toString(),liquidityNet:L.liquidityNet.toString()})}),console.log("ðŸš€ðŸš€ðŸš€ ~ file: new-position-chart.vue:384 ~ dataProcessing ~ tickMin, tickMax, minPriceTick, maxPriceTick:",i,h,oe,K,u),w(te,i,h,oe,K,u)}};let f=T(!0);So(()=>{document.body.clientWidth<750?f.value=!1:f.value=!0,window.onresize=()=>{document.body.clientWidth<750?f.value=!1:f.value=!0,Q(e.poolInfo,r.value)}});const w=(t,y,u,h,i,oe)=>{let K,ne;e.direction?(K=e.before7dContractPriceLowest?l.priceToTickIndex(new p(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",ne=e.before7dContractPriceHighest?l.priceToTickIndex(new p(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(K=e.before7dContractPriceLowest?l.priceToTickIndex(new p(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",ne=e.before7dContractPriceHighest?l.priceToTickIndex(new p(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const W={top:30,right:35,bottom:20,left:55};let _,O;f.value,_=340-W.left-W.right,O=205-W.top-W.bottom;const P=u-y,H=parseInt(String(P/4));let x=[y+H/4,y+H,y+2*H,u-H,u-H/4];const G=y,te=u,Z=_/(te-G);e.currentPriceTab==="full range"&&(x=[y,y+2*H,u]);const be=x.map(N=>e.direction?Ao(N,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new p(1).div(Ao(N,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString());se(be),ao("#chart").selectAll("*").remove();const L=ao("#chart").attr("width",_+W.left+W.right).attr("height",O+W.top+W.bottom).append("g").attr("transform",`translate(${W.left},${W.right})`),ke=ln(t,function(N){return Number(Math.abs(N.liquityAmount))})||0,Ie=rn().range([0,O]).domain([ke,0]);un().rangeRound([0,_]).padding(.1);const Ue=L.append("g").attr("id","barsBox").selectAll("rect").data(t).enter().append("rect");d.value.theme=="default"?Ue.attr("x",function(N,M){return M===0?0:e.direction?Math.abs(N.index-G)*Z:Math.abs(te-N.index)*Z}).attr("y",function(N,M){return e.direction?M===t.length-1?0:Ie(N.liquityAmount):M===t.length-1?0:Ie(t[M+1].liquityAmount)}).attr("width",function(N,M){return M===0&&t.length===1&&N.liquityAmount>0?_:(e.direction,M!==t.length-1?Math.abs(t[M+1].index-N.index)*Z:0)}).attr("height",function(N,M){return M===0&&t.length===1&&N.liquityAmount>0?O:e.direction?M===t.length-1?0:O-Ie(N.liquityAmount):M===t.length-1?0:O-Ie(t[M+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):Ue.attr("x",function(N,M){return M===0?0:e.direction?Math.abs(N.index-G)*Z:Math.abs(te-N.index)*Z}).attr("y",function(N,M){return e.direction?M===t.length-1?0:Ie(Math.abs(N.liquityAmount)):M===t.length-1?0:Ie(Math.abs(t[M+1].liquityAmount))}).attr("width",function(N,M){return M===0&&t.length===1&&N.liquityAmount>0?_:(e.direction,M!==t.length-1?Math.abs(t[M+1].index-N.index)*Z:0)}).attr("height",function(N,M){if(M===0&&t.length===1&&N.liquityAmount>0)return O;if(e.direction)return M===t.length-1?0:Number(N.liquityAmount)?O-Ie(Math.abs(N.liquityAmount)):0;{if(M===t.length-1)return 0;const ce=O-Ie(Math.abs(t[M+1].liquityAmount));return Number(t[M+1].liquityAmount)?ce:0}}).attr("fill","#407497").attr("class","bars").attr("stroke-width",1).attr("stroke","#407497");const Se=L.append("g");Se.append("line").attr("x1",0).attr("y1",155).attr("x2",_).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D"),Se.append("g");let a=0;e.direction?a=Math.abs(oe-G)*Z:a=Math.abs(oe-te)*Z,(d.value.theme=="default"?L.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):L.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+a+", 0)"),ao("#triangle").attr("width",8).attr("height",4);let I=[[0,0],[4,4],[8,0]],U=zo().x(function(N){return N[0]}).y(function(N){return N[1]}).curve(Go);const j=a-4;L.append("path").attr("d",U(I)).style("fill",d.value.theme=="default"?"#68FFD8":"#76C8FF").attr("transform","translate("+j+", 0)");let D,X,ee,ue;e.direction?(D=h<G?-100:parseInt(String(Math.abs(h-G)*Z)),X=i<G?-100:parseInt(String(Math.abs(i-G)*Z)),ee=K<G?-100:Math.abs(K-G)*Z,ue=ne<G?-100:Math.abs(ne-G)*Z):(X=h<G?-100:Math.abs(te-h)*Z,D=i<G?-100:Math.abs(te-i)*Z,ue=K<G?-100:Math.abs(te-K)*Z,ee=ne<G?-100:Math.abs(te-ne)*Z),e.minPrice==="0"&&(D=0),e.maxPrice==="âˆž"&&(X=_),f.value?c.value=_-D+60+"px":c.value=_-D+52+"px",V.value=X+74+"px",K&&ee<_&&L.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+ee+", 0)"),ne&&ue<_&&L.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+ue+", 0)");const fe=dn().extent([[0,0],[_,O]]).handleSize(30).on("end",we);L.append("g").attr("class","brush").call(fe).call(fe.move,[D,X]);function we(N){if(!N.sourceEvent||!N.selection)return;f.value?c.value=_-N.selection[0]+60+"px":c.value=_-N.selection[0]+52+"px",V.value=N.selection[1]+74+"px";let M,ce,pe=0,A=0;e.direction?(pe=C(parseInt(String(N.selection[0]/Z+G)),Number(e.poolInfo.tickSpacing)),M=l.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),A=C(parseInt(String(N.selection[1]/Z+G)),Number(e.poolInfo.tickSpacing)),ce=l.tickIndexToPrice(A,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()):(A=C(te-N.selection[0]/Z,Number(e.poolInfo.tickSpacing)),M=1/l.tickIndexToPrice(A,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),pe=C(te-N.selection[1]/Z,Number(e.poolInfo.tickSpacing)),ce=1/l.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),m.emit("onChangeMinPrice",String(ge(String(M),6))),m.emit("onChangeMaxPrice",String(ge(String(ce),6)))}d.value.theme=="default"?ao(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):ao(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","rgba(255,255,255,0.7)")};T(""),ye(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.tickList],([t,y,u,h,i])=>{t&&y&&u&&h&&i&&i.length>0&&Q(t,r.value)},{immediate:!0});const q=T(!0);return ye(()=>e.chartLoading,(t,y)=>{t!==y&&(q.value=t)},{immediate:!0,deep:!0}),{store:d,loading:q,zoomOut:F,zoomIn:re,rangeSizeLower:B,rangeSizeUpper:v,rangeSizeLowerPosition:c,rangeSizeUpperPosition:V,decimalFormat:Zo,numberformat:Vo}}});const Sn=e=>(so("data-v-992b1bf2"),e=e(),lo(),e),$n={class:"chart-box"},Pn={class:"chart"},Tn=Sn(()=>o("svg",{id:"chart"},null,-1)),Nn=[Tn];function Rn(e,m,r,c,V,$){return g(),S("div",$n,[Pe(o("div",Pn,Nn,512),[[$o,!e.loading]])])}const Uo=Ge(Cn,[["render",Rn],["__scopeId","data-v-992b1bf2"]]),On=ze({components:{StatusBlock:No,NewPositionChart:Uo,TokenWarning:vo},setup(e){const m=T(),r=T(),c=b(()=>{var u,h;return(h=(u=l.value)==null?void 0:u.poolInfo)==null?void 0:h.needReverse}),V=Ye(),$=b(()=>V),B=b(()=>$.value.currentExplorer),v=b(()=>$.value.theme),n=b(()=>$.value.chainName),d=Ve(),k=b(()=>d),l=T({}),C=mo();ye(()=>[k.value.currentPositionInfo,n.value],([u,h])=>{var i;(h=="Aptos"&&u||h=="Sui"&&u&&(u==null?void 0:u.nftHash)==((i=C==null?void 0:C.query)==null?void 0:i.pos))&&(l.value=u,m.value=l.value.token_a,r.value=l.value.token_b)},{immediate:!0});const F=u=>{var h;return(u==null?void 0:u.logoURI)||(u==null?void 0:u.logo_url)||((h=k.value.tokensObj[u==null?void 0:u.address])==null?void 0:h.logo_url)||(v.value==="default"?no("/image/coins/unknown.png"):no("/image/coins/sui-unknown.png"))},re=b(()=>n.value?xe(n.value):{}),se=T([]),Q=async u=>{const{list:h}=await re.value.getTicks(u),i=h?re.value.getTickDataFromUrlData(h):[];se.value=i};ye(()=>[l.value,k.value.poolsObj],([u,h])=>{u&&!ve(u)&&u.poolInfo&&h&&!ve(h)&&Q(h[u.poolAddress])},{immediate:!0});const f=T(!0),w=(u,h)=>u!=="0"&&h!=="âˆž"?Me(1/(1-Number((u/h)**.25)),2)+"x":"1x",q=b(()=>l.value.minPrice&&l.value.maxPrice?w(l.value.minPrice,l.value.maxPrice):"--"),t=b(()=>l.value.maxPrice!=="âˆž"?new p(1).div(new p(l.value.maxPrice)).toString():"âˆž"),y=b(()=>l.value.minPrice>0?new p(1).div(new p(l.value.minPrice)).toString():"0");return{needReverse:c,getCoinIcon:F,theme:v,indexStore:V,direct:f,addCommom:J,decimalUi:ge,tickList:se,positionInfo:l,fromCoin:m,toCoin:r,getExplorerUrl:ho,lever:q,currentExplorer:B,minPriceResever:t,maxPriceResever:y}}}),qn=""+globalThis.__publicAssetsURL("image/aptos-price.png"),Bn=""+globalThis.__publicAssetsURL("image/icon-arrow@2x.png");const Je=e=>(so("data-v-bcbcfa2a"),e=e(),lo(),e),Ln={class:"new-position-info"},Un={class:"pool-info"},Mn={class:"left"},jn={class:"coin-a"},Dn={alt:""},En={class:"coin-b"},Fn={alt:""},Wn={class:"position-name"},Hn=["href"],Xn=Je(()=>o("use",{"xlink:href":"#icon-icon_copy1"},null,-1)),Yn=[Xn],zn={key:0,class:"pool-fee"},Gn=Je(()=>o("span",null,"Fee tier",-1)),Jn={class:"right"},Qn={class:"h5-pool-info"},Kn={class:"coin-info"},Zn={class:"coin-a"},Vn={alt:""},xn={class:"coin-b"},et={alt:""},ot={class:"position-name"},nt=["href"],tt=Je(()=>o("use",{"xlink:href":"#icon-icon_copy1"},null,-1)),it=[tt],at={key:0,class:"pool-fee"},st={class:"price-info"},lt={class:"price-and-chart"},rt={class:"left"},ut={class:"current-price"},dt=Je(()=>o("span",null,"Current Price",-1)),ct={class:"coin-rate"},mt=Je(()=>o("div",null,[o("svg",{class:"icon icon-up","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_up1"})])],-1)),vt=Je(()=>o("div",null,[o("svg",{class:"icon icon-down","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_down1"})])],-1)),ft=[mt,vt],pt={key:0},ht={key:1},bt={key:0,class:"position-range"},kt=Je(()=>o("div",{class:"position-range-title"},"Position Range",-1)),gt={key:0},wt={key:1},_t={key:2,src:qn,alt:""},yt={key:3,src:Jo,alt:""},It={key:4},At={key:5},Ct={key:1,class:"position-range position-range-warp"},St={key:0,class:"position-range-title"},$t={key:1,class:"position-range-title"},Pt={key:2},Tt={key:3},Nt={class:"price-img"},Rt={key:0,src:Bn,alt:""},Ot={key:1,src:Qo,alt:""},qt={key:4},Bt={key:5},Lt={class:"lever"},Ut={class:"lever-title"},Mt=Je(()=>o("div",null,[o("span",null," Leverage "),o("svg",{"aria-hidden":"true",class:"icon"},[o("use",{"xlink:href":"#icon-icon-tips1"})])],-1)),jt={class:"lever-text"},Dt={class:"right"},Et=Je(()=>o("div",{class:"chat-mask"},null,-1));function Ft(e,m,r,c,V,$){var l,C,F,re,se,Q,f,w,q,t,y,u,h,i,oe,K,ne,W,_,O,P,H,x,G,te,Z,be,L,ke,Ie;const B=vo,v=No,n=Po,d=Uo,k=bo("image");return g(),S("div",Ln,[o("div",Un,[o("div",Mn,[o("div",jn,[Pe(o("img",Dn,null,512),[[k,e.needReverse?e.getCoinIcon(e.positionInfo.token_b):e.getCoinIcon(e.positionInfo.token_a)]]),le(B,{address:e.needReverse?(re=(F=e.positionInfo)==null?void 0:F.token_b)==null?void 0:re.address:(C=(l=e.positionInfo)==null?void 0:l.token_a)==null?void 0:C.address,"style-params":{width:"12px",height:"12px",left:"18px",bottom:"4px"}},null,8,["address"])]),o("div",En,[Pe(o("img",Fn,null,512),[[k,e.needReverse?e.getCoinIcon(e.positionInfo.token_a):e.getCoinIcon(e.positionInfo.token_b)]]),le(B,{address:e.needReverse?(w=(f=e.positionInfo)==null?void 0:f.token_a)==null?void 0:w.address:(Q=(se=e.positionInfo)==null?void 0:se.token_b)==null?void 0:Q.address,"style-params":{width:"12px",height:"12px",left:"18px",bottom:"4px"}},null,8,["address"])]),o("div",Wn,[o("a",{href:("getExplorerUrl"in e?e.getExplorerUrl:z(ho))(e.currentExplorer,"nftAddress",e.positionInfo.nftHash||e.positionInfo.id),target:"_blank"},E((t=(q=e.positionInfo)==null?void 0:q.name)==null?void 0:t.split("|")[1]),9,Hn)]),(g(),S("svg",{class:"copy-icon","aria-hidden":"true",onClick:m[0]||(m[0]=Le=>e.indexStore.copy(e.positionInfo.nftHash||e.positionInfo.id))},Yn)),e.positionInfo.fee?(g(),S("div",zn,[Gn,me(" "+E(e.positionInfo.fee*100)+"% ",1)])):de("",!0)]),o("div",Jn,[le(v,{"current-status":(y=e.positionInfo)==null?void 0:y.currentStatus},null,8,["current-status"])])]),o("div",Qn,[o("div",null,[o("div",Kn,[o("div",Zn,[Pe(o("img",Vn,null,512),[[k,e.needReverse?e.getCoinIcon(e.positionInfo.token_b):e.getCoinIcon(e.positionInfo.token_a)]]),le(B,{address:e.needReverse?(oe=(i=e.positionInfo)==null?void 0:i.token_b)==null?void 0:oe.address:(h=(u=e.positionInfo)==null?void 0:u.token_a)==null?void 0:h.address,"style-params":{width:"12px",height:"12px",left:"18px",bottom:"4px"}},null,8,["address"])]),o("div",xn,[Pe(o("img",et,null,512),[[k,e.needReverse?e.getCoinIcon(e.positionInfo.token_a):e.getCoinIcon(e.positionInfo.token_b)]]),le(B,{address:e.needReverse?(_=(W=e.positionInfo)==null?void 0:W.token_a)==null?void 0:_.address:(ne=(K=e.positionInfo)==null?void 0:K.token_b)==null?void 0:ne.address,"style-params":{width:"12px",height:"12px",left:"18px",bottom:"4px"}},null,8,["address"])])]),o("div",ot,[o("div",null,[o("a",{href:("getExplorerUrl"in e?e.getExplorerUrl:z(ho))(e.currentExplorer,"nftAddress",e.positionInfo.nftHash||e.positionInfo.id),target:"_blank"},E((P=(O=e.positionInfo)==null?void 0:O.name)==null?void 0:P.split("|")[1]),9,nt),(g(),S("svg",{class:"copy-icon","aria-hidden":"true",onClick:m[1]||(m[1]=Le=>e.indexStore.copy(e.positionInfo.nftHash||e.positionInfo.id))},it))]),e.positionInfo.fee?(g(),S("div",at,E(e.positionInfo.fee*100)+"% ",1)):de("",!0)])]),le(v,{"current-status":(H=e.positionInfo)==null?void 0:H.currentStatus},null,8,["current-status"])]),o("div",st,[o("div",lt,[o("div",rt,[o("div",ut,[o("div",null,[dt,o("div",ct,[o("div",{onClick:m[2]||(m[2]=Le=>e.direct=!e.direct)},ft)])]),(e.needReverse?!e.direct:e.direct)?(g(),S("div",pt,[me(E(("addCommom"in e?e.addCommom:z(J))(("decimalUi"in e?e.decimalUi:z(ge))(e.positionInfo.currentPrice,6)))+" Â  ",1),o("span",null,E((x=e.toCoin)==null?void 0:x.symbol)+" per "+E((G=e.fromCoin)==null?void 0:G.symbol),1)])):(g(),S("div",ht,[me(E(("addCommom"in e?e.addCommom:z(J))(("decimalUi"in e?e.decimalUi:z(ge))(e.positionInfo.currentPriceReverse,6)))+" Â  ",1),o("span",null,E((te=e.fromCoin)==null?void 0:te.symbol)+" per "+E((Z=e.toCoin)==null?void 0:Z.symbol),1)]))]),e.positionInfo.minPrice&&e.positionInfo.minPrice.length<9&&e.positionInfo.maxPrice&&e.positionInfo.maxPrice.length?(g(),S("div",bt,[kt,o("div",null,[(e.needReverse?!e.direct:e.direct)?(g(),S("div",gt,[me(E(("addCommom"in e?e.addCommom:z(J))(("decimalUi"in e?e.decimalUi:z(ge))(e.positionInfo.minPrice,6)))+" ",1),o("span",null,E(e.positionInfo&&e.positionInfo.token_b&&e.positionInfo.token_b.symbol),1)])):(g(),S("div",wt,[me(E(((be=e.positionInfo)==null?void 0:be.minPrice)!=="0"?("addCommom"in e?e.addCommom:z(J))(("decimalUi"in e?e.decimalUi:z(ge))(1/e.positionInfo.minPrice,6)):0)+" ",1),o("span",null,E(e.positionInfo&&e.positionInfo.token_a&&e.positionInfo.token_a.symbol),1)])),e.theme=="default"?(g(),S("img",_t)):(g(),S("img",yt)),(e.needReverse?!e.direct:e.direct)?(g(),S("div",It,[me(E(((L=e.positionInfo)==null?void 0:L.maxPrice)!=="âˆž"?("addCommom"in e?e.addCommom:z(J))(("decimalUi"in e?e.decimalUi:z(ge))(e.positionInfo.maxPrice,6)):"âˆž")+" ",1),o("span",null,E(e.positionInfo&&e.positionInfo.token_b&&e.positionInfo.token_b.symbol),1)])):(g(),S("div",At,[me(E(((ke=e.positionInfo)==null?void 0:ke.maxPrice)!=="âˆž"?("addCommom"in e?e.addCommom:z(J))(("decimalUi"in e?e.decimalUi:z(ge))(1/e.positionInfo.maxPrice,6)):"âˆž")+" ",1),o("span",null,E(e.positionInfo&&e.positionInfo.token_a&&e.positionInfo.token_a.symbol),1)]))])])):(g(),S("div",Ct,[(e.needReverse?!e.direct:e.direct)?(g(),S("span",St," Position Range ")):(g(),S("span",$t," Position Range ")),(e.needReverse?!e.direct:e.direct)?(g(),S("div",Pt,[me(E(("addCommom"in e?e.addCommom:z(J))(("decimalUi"in e?e.decimalUi:z(ge))(e.positionInfo.minPrice,6)))+" ",1),o("span",null,E(e.positionInfo&&e.positionInfo.token_b&&e.positionInfo.token_b.symbol),1)])):(g(),S("div",Tt,[me(E(e.positionInfo.maxPrice!=="âˆž"?("addCommom"in e?e.addCommom:z(J))(("decimalUi"in e?e.decimalUi:z(ge))(e.positionInfo.maxPriceResever,6)):"âˆž")+" ",1),o("span",null,E(e.positionInfo&&e.positionInfo.token_a&&e.positionInfo.token_a.symbol),1)])),o("div",Nt,[e.theme=="default"?(g(),S("img",Rt)):(g(),S("img",Ot))]),(e.needReverse?!e.direct:e.direct)?(g(),S("div",qt,[me(E(e.positionInfo.maxPrice!=="âˆž"?("addCommom"in e?e.addCommom:z(J))(("decimalUi"in e?e.decimalUi:z(ge))(e.positionInfo.maxPrice,6)):"âˆž")+" ",1),o("span",null,E(e.positionInfo&&e.positionInfo.token_b&&e.positionInfo.token_b.symbol),1)])):(g(),S("div",Bt,[me(E(((Ie=e.positionInfo)==null?void 0:Ie.minPrice)!=="0"?("addCommom"in e?e.addCommom:z(J))(("decimalUi"in e?e.decimalUi:z(ge))(e.positionInfo.minPriceResever,6)):0)+" ",1),o("span",null,E(e.positionInfo&&e.positionInfo.token_a&&e.positionInfo.token_a.symbol),1),me(" Â  ")]))])),o("div",Lt,[o("div",Ut,[le(n,{"overlay-class-name":"lever-tooltip"},{title:qe(()=>[me("This parameter indicates the concentration rate of your liquidity relative to a full range position.")]),default:qe(()=>[Mt]),_:1})]),o("div",jt,E(e.lever),1)])]),o("div",Dt,[le(d,{"pool-info":e.positionInfo.poolInfo,"tick-list":e.tickList,"min-price":e.needReverse?e.minPriceResever:e.positionInfo.minPrice,"max-price":e.needReverse?e.maxPriceResever:e.positionInfo.maxPrice,direction:!e.needReverse,"current-price-tab":"custom","chart-loading":!1},null,8,["pool-info","tick-list","min-price","max-price","direction"]),Et])])])])}const Mo=Ge(On,[["render",Ft],["__scopeId","data-v-bcbcfa2a"]]),Wt=ze({components:{TokenWarning:vo},setup(e,m){const{t:r}=ko(),{$notify:c}=xo(),V=Ye(),$=b(()=>V),B=Ve(),v=b(()=>B),n=T({}),d=T({}),k=T({}),l=b(()=>$.value.chainName),C=b(()=>l.value?xe(l.value):{}),F=mo(),re=T(!1),se=async(a=null)=>{var U,j;const s=a||n.value,I=v.value.addressLpTokens[s.poolAddress];if(I){const D=await C.value.getTickDataByIndex(I.ticks_handle||((U=s==null?void 0:s.poolInfo)==null?void 0:U.ticks_handle),Number(s.tick_lower_index)),X=await C.value.getTickDataByIndex(I.ticks_handle||((j=s==null?void 0:s.poolInfo)==null?void 0:j.ticks_handle),Number(s.tick_upper_index));let ee={};l.value==="Aptos"?ee=await C.value.getPosRewardersAmount({poolAddress:h.currentRoute.value.query.address,positionName:h.currentRoute.value.query.token,tickLowerData:D,tickUpperData:X}):ee=await C.value.fetchPosRewardersAmount({poolAddress:s.poolAddress,positionId:s.pos_object_id||s.clmm_position_id,coinTypeA:s.coin_type_a||s.coinTypeA,coinTypeB:s.coin_type_b||s.coinTypeB,rewarderInfo:s.poolInfo.rewarder_infos});const ue=[];let fe=new p(0);ee.forEach((we,N)=>{var A,Y;const M=(A=v.value.tokensObj[we.coin_address])==null?void 0:A.decimals,ce=we.amount_owed.toString();let pe=new p(ce).div(Math.pow(10,M)).toString();if(l.value=="Aptos"&&Number(pe)>999999999&&(pe="0"),s.poolInfo[`rewarder_display${N+1}`]||Number(pe)>0){const R=v.value.tokensObj[we.coin_address],ae=((Y=v.value.RATES[we.coin_address])==null?void 0:Y.price)||0,ie=new p(pe).mul(ae).toString();fe=new p(fe).plus(ie),ue.push({...we,...R,amount:Number(pe)>0?pe:0,amountUSD:Number(ie)>0?$e(ie,2):0,amountUSDText:ie})}}),i.value=ue}};ye(()=>[v.value.currentPositionInfo,l.value],([a,s])=>{var I;s=="Aptos"&&a?(n.value=a,d.value=a==null?void 0:a.token_a,k.value=a==null?void 0:a.token_b):s=="Sui"&&a&&(a==null?void 0:a.nftHash)==((I=F==null?void 0:F.query)==null?void 0:I.pos)&&(n.value=a,d.value=a==null?void 0:a.token_a,k.value=a==null?void 0:a.token_b,re.value=!1)},{immediate:!0}),ye(()=>[n.value,v.value.addressLpTokens],([a,s])=>{!ve(a)&&!ve(s)&&se(a)},{immediate:!0});const Q=b(()=>{var a,s,I,U,j,D,X,ee;if(n.value&&!ve(n.value)&&v.value.RATES){const ue=n.value.amountA*((s=v.value.RATES[(a=n.value)==null?void 0:a.token_a.address])==null?void 0:s.price),fe=n.value.amountB*((U=v.value.RATES[(I=n.value)==null?void 0:I.token_b.address])==null?void 0:U.price);if((D=v.value.RATES[(j=n.value)==null?void 0:j.token_a.address])!=null&&D.price&&((ee=v.value.RATES[(X=n.value)==null?void 0:X.token_b.address])!=null&&ee.price)){const we=Number(ue+fe);return we>0&&we<.01?"<0.01":J(Me(ue+fe,2),2)}else return" --"}else return" --"}),f=b(()=>{var a,s;return(s=(a=n.value)==null?void 0:a.poolInfo)==null?void 0:s.needReverse}),w=b(()=>v.value.RATES),q=b(()=>{var a,s;if(w.value&&d.value&&k.value&&!ve(w.value)&&!ve(d.value)&&!ve(k.value)){const I=[],U=Number(n.value.feeOwedA)||0,j=Number(n.value.feeOwedB)||0,D=new p(U).mul(((a=w.value[d.value.address])==null?void 0:a.price)||0),X=new p(j).mul(((s=w.value[k.value.address])==null?void 0:s.price)||0);return I.push({amount:U,amountUSD:D.toString()},{amount:j,amountUSD:X.toString()}),I}return[]}),t=b(()=>{var s,I;let a=new p(0);return(s=q==null?void 0:q.value)==null||s.forEach(U=>{a=a.add(new p(U.amount))}),l.value=="Sui"&&((I=i==null?void 0:i.value)==null||I.forEach(U=>{console.log("ðŸš€ðŸš€ðŸš€ ~ file: new-position-liquidity.vue:622 ~ canClaimYield ~ ele:",U),a=a.add(new p(U.amount))})),a.toNumber()}),y=b(()=>{var s,I;let a=new p(0);return(s=q==null?void 0:q.value)==null||s.forEach(U=>{a=a.add(new p(U.amountUSD))}),l.value=="Sui"&&((I=i==null?void 0:i.value)==null||I.forEach(U=>{a=a.add(new p(U.amountUSDText))})),a.toNumber()}),u=b(()=>{var s;let a=new p(0);return(s=i.value)==null||s.forEach(I=>{a=a.add(new p(I.amountUSDText))}),a.toNumber()}),h=to(),i=T([]),{setIsShowSuccess:oe,setIsShowRejected:K,setIsShowWaiting:ne,setTransactionDesc:W,setTransactionTxid:_}=V,O=uo(),P=b(()=>O),H=async()=>{re.value=!0;let a={coinTypeA:n.value.poolInfo.coinTypeA,coinTypeB:n.value.poolInfo.coinTypeB,coinTypeC:"",coinTypeD:"",coinTypeE:"",pool_address:n.value.poolAddress,pos_index:n.value.index,rewarder_nums:i.value.length,collect_fee:!0};a.coinTypeC=i.value[0]?i.value[0].coin_address:"",a.coinTypeD=i.value[1]?i.value[1].coin_address:"",a.coinTypeE=i.value[2]?i.value[2].coin_address:"",ne(!0),W();try{let s;if(l.value==="Aptos"){const I=await C.value.getCollectRewarderTransactionPayload(a);s=await P.value.currentWallet.signAndSubmitTransaction(I)}else{a.pos_index=n.value.pos_object_id;const I=await C.value.getCollectRewarderTransactionPayload(a,n.value),U=await C.value.signAndExecuteTransactionBlock(P.value.currentWallet,I.txb,I.payloadParams);s=C.value.handleTx(U)}if(s&&s.hash){_(s.hash),ne(!1),oe(!0);const I={title:"Claim",desc:"",hash:s.hash,tit:"Rewards Claimed",icon:"icon-icon-Removed"};l.value!=="Aptos"&&(I.res=s.res),C.value.showTransitionPending(I),await C.value.watchTransaction(I)&&(m.emit("getDetails"),setTimeout(()=>{C.value.getAccount(P.value.address)},3e3))}else console.log("0310###toClaimRewards###else###"),ne(!1),K(!0),re.value=!1}catch(s){ne(!1),K(!0),re.value=!1,console.log(s,"error===>")}},x=T(!1),G=async()=>{x.value=!0;const a=i.value;let s={coinTypeA:n.value.poolInfo.coinTypeA,coinTypeB:n.value.poolInfo.coinTypeB,coinTypeC:"",coinTypeD:"",coinTypeE:"",pool_address:n.value.poolAddress,pos_index:n.value.index,rewarder_nums:a.length};s.coinTypeC=a[0]?a[0].coin_address:"",s.coinTypeD=a[1]?a[1].coin_address:"",s.coinTypeE=a[2]?a[2].coin_address:"";try{let I;if(l.value==="Aptos"){const U=await C.value.getCollectRewarderTransactionPayload(s);I=await P.value.currentWallet.signAndSubmitTransaction(U)}else{s.pos_index=n.value.pos_object_id;const U=await C.value.getCollectRewarderTransactionPayload(s),j=await C.value.signAndExecuteTransactionBlock(P.value.currentWallet,U.txb,U.payloadParams);I=C.value.handleTx(j)}if(I&&I.hash){_(I.hash),ne(!1),oe(!0);const U=a[0].amount+a[0].symbol,j=s.coinTypeD?" and "+a[1].amount+a[1].symbol:"",D=s.coinTypeE?" and "+a[2].amount+a[2].symbol:"",X={title:"Claim",desc:"",hash:I.hash,tit:"Rewards Claimed",icon:"icon-icon-Removed",tokenInfo:{tokena:a[0].address,numa:`+ ${Number(a[0].amount)}`,logoa:v.value.tokensObj&&a[0]&&a[0].address&&v.value.tokensObj[a[0].address]&&v.value.tokensObj[a[0].address].logoURI,tokenb:a[1]&&a[1].address,numb:s.coinTypeD?`+ ${Number(a[1].amount)}`:"",logob:s.coinTypeD?v.value.tokensObj&&a[1]&&a[1].address&&v.value.tokensObj[a[1].address]&&v.value.tokensObj[a[1].address].logoURI:"",tokenc:a[2]&&a[2].address,numc:s.coinTypeE?`+ ${Number(a[2].amount)}`:"",logoc:s.coinTypeE?v.value.tokensObj&&a[2]&&a[2].address&&v.value.tokensObj[a[2].address]&&v.value.tokensObj[a[2].address].logoURI:""},text:U+j+D};l.value!=="Aptos"&&(X.res=I.res),C.value.showTransitionPending(X),await C.value.watchTransaction(X)&&setTimeout(()=>{m.emit("getDetails"),C.value.getAccount(P.value.address)},3e3)}else console.log("0310###toClaimRewards###else###"),ne(!1),K(!0);x.value=!1}catch(I){console.log("0310###collectRewarderParams Error###",I),x.value=!1,ne(!1),K(!0)}},te=b(()=>v.value.positionDetailCurrentTab),Z=b(()=>{var I,U,j,D,X,ee;const a=ge(f.value?(U=n.value)==null?void 0:U.amountB:(I=n.value)==null?void 0:I.amountA,f.value?(ee=(X=n.value)==null?void 0:X.token_b)==null?void 0:ee.decimals:(D=(j=n.value)==null?void 0:j.token_a)==null?void 0:D.decimals),s=f.value?v.value.positionActionAmount.toCoinAmount||0:v.value.positionActionAmount.fromCoinAmount||0;if(te.value=="increase")return s?new p(a).add(new p(s)).toString():"";if(s){const ue=new p(a).minus(new p(s)).toString();return ue<0?"0":String(ue)}else return""}),be=b(()=>{var I,U,j,D,X,ee;const a=ge(f.value?(U=n.value)==null?void 0:U.amountA:(I=n.value)==null?void 0:I.amountB,f.value?(ee=(X=n.value)==null?void 0:X.token_a)==null?void 0:ee.decimals:(D=(j=n.value)==null?void 0:j.token_b)==null?void 0:D.decimals),s=f.value?v.value.positionActionAmount.fromCoinAmount||0:v.value.positionActionAmount.toCoinAmount||0;if(te.value=="increase")return s?new p(a).add(new p(s)).toString():"";if(s){const ue=new p(a).minus(new p(s)).toString();return ue<0?"0":String(ue)}else return""}),L=b(()=>f.value?v.value.positionActionAmount.toCoinAmount:v.value.positionActionAmount.fromCoinAmount),ke=b(()=>f.value?v.value.positionActionAmount.fromCoinAmount:v.value.positionActionAmount.toCoinAmount),Ie=a=>{var s;return(a==null?void 0:a.logoURI)||(a==null?void 0:a.logo_url)||((s=v.value.tokensObj[a==null?void 0:a.address])==null?void 0:s.logo_url)||($.value.theme==="default"?no("/image/coins/unknown.png"):no("/image/coins/sui-unknown.png"))},Le=b(()=>{var D,X,ee,ue,fe,we,N,M,ce,pe,A,Y;const{fromCoinAmount:a,toCoinAmount:s}=v.value.positionActionAmount,I=v.value.positionDetailCurrentTab,U=ge(f.value?(X=n.value)==null?void 0:X.amountB:(D=n.value)==null?void 0:D.amountA,f.value?(we=(fe=n.value)==null?void 0:fe.token_b)==null?void 0:we.decimals:(ue=(ee=n.value)==null?void 0:ee.token_a)==null?void 0:ue.decimals),j=ge(f.value?(M=n.value)==null?void 0:M.amountA:(N=n.value)==null?void 0:N.amountB,f.value?(Y=(A=n.value)==null?void 0:A.token_a)==null?void 0:Y.decimals:(pe=(ce=n.value)==null?void 0:ce.token_b)==null?void 0:pe.decimals);return l.value=="Sui"||I=="remove"&&l.value=="Aptos"&&a==U&&s==j}),Ue=async()=>{re.value=!0;const a=J(n.value.feeOwedA,n.value.token_a.decimals)==0?"":`${$e(n.value.feeOwedA,n.value.token_a.decimals)} ${n.value.token_a.symbol}`,s=J(n.value.feeOwedB,n.value.token_b.decimals)==0?"":`${$e(n.value.feeOwedB,n.value.token_b.decimals)} ${n.value.token_b.symbol}`;W(r("newAdd.claimWaitingText",{from:f.value?s:a,and:J(n.value.feeOwedA,n.value.token_a.decimals)==0||J(n.value.feeOwedB,n.value.token_b.decimals)==0?"":"and",to:f.value?a:s})),ne(!0);let I;const U={pool:n.value.poolInfo,position:n.value};try{const j=await C.value.getCollectFeeTransactionPayload(U);if(l.value==="Aptos")I=await P.value.currentWallet.signAndSubmitTransaction(j);else{const D=await C.value.signAndExecuteTransactionBlock(P.value.currentWallet,j);I=C.value.handleTx(D)}if(I){_(I.hash),ne(!1),oe(!0);const D={title:"Claim",desc:"",hash:I.hash,tit:"Fees Claimed",icon:"icon-icon-Removed",tokenInfo:{tokena:`${n.value.token_a.address}`,numa:J(n.value.feeOwedA,n.value.token_a.decimals)==0?"":`${$e(n.value.feeOwedA,n.value.token_a.decimals)}`,logoa:J(n.value.feeOwedA,n.value.token_a.decimals)==0?"":v.value.tokensObj&&n.value&&n.value.token_a.address&&v.value.tokensObj[n.value.token_a.address]&&v.value.tokensObj[n.value.token_a.address].logoURI,tokenb:`${n.value.token_b.address}`,numb:J(n.value.feeOwedB,n.value.token_b.decimals)==0?"":`${$e(n.value.feeOwedB,n.value.token_b.decimals)}`,logob:J(n.value.feeOwedB,n.value.token_b.decimals)==0?"":v.value.tokensObj&&n.value&&n.value.token_b.address&&v.value.tokensObj[n.value.token_b.address]&&v.value.tokensObj[n.value.token_b.address].logoURI},text:`Claim ${J(n.value.feeOwedA,n.value.token_a.decimals)==0?"":`${$e(n.value.feeOwedA,n.value.token_a.decimals)} ${n.value.token_a.symbol}`}  
              ${J(n.value.feeOwedA,n.value.token_a.decimals)==0||J(n.value.feeOwedB,n.value.token_b.decimals)==0?"":"and"} ${J(n.value.feeOwedB,n.value.token_b.decimals)==0?"":`${$e(n.value.feeOwedB,n.value.token_b.decimals)} ${n.value.token_b.symbol}`}

            `};l.value!=="Aptos"&&(D.res=I.res),C.value.showTransitionPending(D);const X=await C.value.watchTransaction(D);console.log("0310##toClaim###transitionStatus####",X),X&&setTimeout(()=>{m.emit("getDetails")},1e3)}else ne(!1),K(!0),c.error({icon:Xe("svg",{class:{icon:!0},"aria-hidden":!0},[Xe("use",{"xlink:href":"#icon-a-icon-Shutdown"})]),duration:4.5,message:Xe("div",{class:"notification-title"},[Xe("span",{innerHTML:_o.global.t("newAdd.claimFailed")},null)]),description:r("newAdd.somethingWrong"),class:"ant-notification-copy ant-notification-error"});re.value=!1,console.log("claim####test###",I)}catch(j){console.log("claim###error####",j),re.value=!1,ne(!1),K(!0),c.error({icon:Xe("svg",{class:{icon:!0},"aria-hidden":!0},[Xe("use",{"xlink:href":"#icon-a-icon-Shutdown"})]),message:Xe("div",{class:"notification-title"},[Xe("span",{innerHTML:_o.global.t("newAdd.claimFailed")},null)]),duration:4.5,description:r("newAdd.somethingWrong"),class:"ant-notification-copy ant-notification-error"})}},Se=Xe(en,{style:{fontSize:"12px",color:"#fff",paddingBottom:"3px"},spin:!0});return{amountUSD:Q,needReverse:f,decimalUi:ge,pendingFees:q,positionInfo:n,pendingRewarderArr:i,pendingYieldAmount:y,toClaim:Ue,claimAll:H,fromCoin:d,toCoin:k,showNum:$e,claimLoading:re,addCommom:J,afterBase:Z,afterQuote:be,fromCoinAmount:L,toCoinAmount:ke,checkNullObj:ve,getCoinIcon:Ie,chainName:l,isShowAfterAmount:Le,pendingRewarderAmount:u,toClaimRewards:G,rewarderLoading:x,indicator:Se,canClaimYield:t}}});const Ht={class:"liquidity-card"},Xt={class:"liquidity-title"},Yt={class:"liquidity-usd"},zt=o("span",null,"Liquidity",-1),Gt={class:"liquidity-ratio"},Jt={class:"coin-ratio"},Qt={class:"coin-a-ratio"},Kt={class:"coin-b-ratio"},Zt={class:"ratio-progress"},Vt={class:"base-quote-num"},xt={class:"base-coin-num"},ei=o("span",null,"Base",-1),oi={alt:""},ni={key:0,class:"after"},ti={class:"quote-coin-num"},ii=o("span",null,"Quote",-1),ai={alt:""},si={key:0,class:"after"},li={class:"pending-yield"},ri={class:"left"},ui={class:"pending-yield-title"},di={key:0,class:"after"},ci={class:"right"},mi={class:"fees-rewards"},vi={class:"fees-rewards-item"},fi=o("span",null,"Fees",-1),pi={key:0,class:"after"},hi=o("span",null,"Fees",-1),bi={key:0,class:"after"},ki=o("span",null,"Mining Rewards",-1),gi={style:{"margin-top":"5px"}},wi={alt:""},_i=o("span",null,"Mining Rewards",-1),yi={alt:""},Ii={key:0,class:"after"},Ai={key:0,class:"pending-yield"},Ci={class:"left"},Si=o("div",{class:"pending-yield-title"},"Pending rewards",-1),$i={key:0,class:"after"},Pi={class:"right"},Ti={key:1,class:"fees-rewards"},Ni={class:"fees-rewards-item"},Ri=o("span",null,"Mining Rewards",-1),Oi={alt:""},qi={key:0,class:"after"};function Bi(e,m,r,c,V,$){var k,l,C,F,re,se,Q,f,w,q,t,y,u,h,i,oe,K,ne,W,_,O,P,H,x,G,te,Z,be,L,ke,Ie,Le,Ue,Se,a,s,I,U,j,D,X,ee,ue,fe,we,N,M,ce,pe,A,Y,R,ae,ie,_e,Te,Ce,Ne,De,Ee,Qe,Re,je,Fe,We,Ke,Ae;const B=vo,v=ro,n=on,d=bo("image");return g(),S("div",Ht,[o("div",Xt,[o("div",Yt,[zt,o("div",null,"$"+E(e.amountUSD),1)]),o("div",Gt,[o("div",Jt,[o("div",Qt,[o("span",null,E(e.needReverse?(l=e.toCoin)==null?void 0:l.symbol:(k=e.fromCoin)==null?void 0:k.symbol),1),me(" "+E(e.needReverse?(F=e.positionInfo)==null?void 0:F.toPercent:(C=e.positionInfo)==null?void 0:C.fromPercent)+"% ",1)]),o("div",Kt,[o("span",null,E(e.needReverse?(se=e.fromCoin)==null?void 0:se.symbol:(re=e.toCoin)==null?void 0:re.symbol),1),me(" "+E(e.needReverse?(f=e.positionInfo)==null?void 0:f.fromPercent:(Q=e.positionInfo)==null?void 0:Q.toPercent)+"% ",1)])]),o("div",Zt,[o("div",{class:"from-percent",style:yo({width:e.needReverse?((q=e.positionInfo)==null?void 0:q.toPercent)+"%":((w=e.positionInfo)==null?void 0:w.fromPercent)+"%"})},null,4),o("div",{class:"to-percent",style:yo({width:e.needReverse?((y=e.positionInfo)==null?void 0:y.fromPercent)+"%":((t=e.positionInfo)==null?void 0:t.toPercent)+"%"})},null,4)])])]),o("div",Vt,[o("div",xt,[ei,o("div",null,[Pe(o("img",oi,null,512),[[d,(e.needReverse?(h=e.toCoin)==null?void 0:h.logo_url:(u=e.fromCoin)==null?void 0:u.logo_url)||e.getCoinIcon(e.needReverse?(oe=e.positionInfo)==null?void 0:oe.token_b:(i=e.positionInfo)==null?void 0:i.token_a)]]),le(B,{address:e.needReverse?(_=(W=e.positionInfo)==null?void 0:W.token_b)==null?void 0:_.address:(ne=(K=e.positionInfo)==null?void 0:K.token_a)==null?void 0:ne.address,"style-params":{width:"10px",height:"10px",left:"15px",bottom:"8px"}},null,8,["address"]),o("span",null,E(("addCommom"in e?e.addCommom:z(J))(("decimalUi"in e?e.decimalUi:z(ge))(e.needReverse?(P=e.positionInfo)==null?void 0:P.amountB:(O=e.positionInfo)==null?void 0:O.amountA,e.needReverse?(te=(G=e.positionInfo)==null?void 0:G.token_b)==null?void 0:te.decimals:(x=(H=e.positionInfo)==null?void 0:H.token_a)==null?void 0:x.decimals))),1)]),e.afterBase&&!("checkNullObj"in e?e.checkNullObj:z(ve))(e.positionInfo)?(g(),S("div",ni,E(("addCommom"in e?e.addCommom:z(J))(e.afterBase))+" after ",1)):de("",!0)]),o("div",ti,[ii,o("div",null,[Pe(o("img",ai,null,512),[[d,(e.needReverse?(be=e.fromCoin)==null?void 0:be.logo_url:(Z=e.toCoin)==null?void 0:Z.logo_url)||e.getCoinIcon(e.needReverse?(ke=e.positionInfo)==null?void 0:ke.token_a:(L=e.positionInfo)==null?void 0:L.token_b)]]),le(B,{address:e.needReverse?(Se=(Ue=e.positionInfo)==null?void 0:Ue.token_a)==null?void 0:Se.address:(Le=(Ie=e.positionInfo)==null?void 0:Ie.token_b)==null?void 0:Le.address,"style-params":{width:"10px",height:"10px",left:"15px",bottom:"8px"}},null,8,["address"]),o("span",null,E(("addCommom"in e?e.addCommom:z(J))(("decimalUi"in e?e.decimalUi:z(ge))(e.needReverse?(s=e.positionInfo)==null?void 0:s.amountA:(a=e.positionInfo)==null?void 0:a.amountB,e.needReverse?(D=(j=e.positionInfo)==null?void 0:j.token_a)==null?void 0:D.decimals:(U=(I=e.positionInfo)==null?void 0:I.token_b)==null?void 0:U.decimals))),1)]),e.afterQuote&&!("checkNullObj"in e?e.checkNullObj:z(ve))(e.positionInfo)?(g(),S("div",si,E(("addCommom"in e?e.addCommom:z(J))(e.afterQuote))+" after ",1)):de("",!0)])]),o("div",li,[o("div",ri,[o("div",ui,E(e.chainName=="Sui"?"Pending Yield":"Pending fees"),1),o("div",null,[me(" $"+E(e.pendingYieldAmount>0&&e.pendingYieldAmount<.01?"<0.01":("addCommom"in e?e.addCommom:z(J))(e.pendingYieldAmount,2))+" ",1),e.pendingYieldAmount>0?(g(),S("span",di,"$0 after")):de("",!0)])]),o("div",ci,[le(v,{class:"claim-all",loading:e.claimLoading,disabled:e.claimLoading||e.canClaimYield==0,onClick:m[0]||(m[0]=he=>e.chainName=="Sui"?e.claimAll():e.toClaim())},{default:qe(()=>[me("Claim")]),_:1},8,["loading","disabled"])])]),o("div",mi,[o("div",vi,[o("div",null,[fi,o("div",null,[Pe(o("img",null,null,512),[[d,(e.needReverse?(ee=e.toCoin)==null?void 0:ee.logo_url:(X=e.fromCoin)==null?void 0:X.logo_url)||e.getCoinIcon(e.needReverse?(fe=e.positionInfo)==null?void 0:fe.token_b:(ue=e.positionInfo)==null?void 0:ue.token_a)]]),le(B,{address:e.needReverse?(ce=(M=e.positionInfo)==null?void 0:M.token_b)==null?void 0:ce.address:(N=(we=e.positionInfo)==null?void 0:we.token_a)==null?void 0:N.address,"style-params":{width:"10px",height:"10px",left:"15px",bottom:"8px"}},null,8,["address"]),o("span",null,E(e.needReverse?("showNum"in e?e.showNum:z($e))(e.positionInfo.feeOwedB,(R=(Y=e.positionInfo)==null?void 0:Y.token_b)==null?void 0:R.decimals):("showNum"in e?e.showNum:z($e))(e.positionInfo.feeOwedA,(A=(pe=e.positionInfo)==null?void 0:pe.token_a)==null?void 0:A.decimals)),1)]),(e.fromCoinAmount||e.toCoinAmount)&&!("checkNullObj"in e?e.checkNullObj:z(ve))(e.positionInfo)&&e.isShowAfterAmount?(g(),S("div",pi," 0 after ")):de("",!0)]),o("div",null,[hi,o("div",null,[Pe(o("img",null,null,512),[[d,(e.needReverse?(ie=e.fromCoin)==null?void 0:ie.logo_url:(ae=e.toCoin)==null?void 0:ae.logo_url)||e.getCoinIcon(e.needReverse?(Te=e.positionInfo)==null?void 0:Te.token_a:(_e=e.positionInfo)==null?void 0:_e.token_b)]]),le(B,{address:e.needReverse?(Ee=(De=e.positionInfo)==null?void 0:De.token_a)==null?void 0:Ee.address:(Ne=(Ce=e.positionInfo)==null?void 0:Ce.token_b)==null?void 0:Ne.address,"style-params":{width:"10px",height:"10px",left:"15px",bottom:"8px"}},null,8,["address"]),o("span",null,E(e.needReverse?("showNum"in e?e.showNum:z($e))(e.positionInfo.feeOwedA,(Fe=(je=e.positionInfo)==null?void 0:je.token_a)==null?void 0:Fe.decimals):("showNum"in e?e.showNum:z($e))(e.positionInfo.feeOwedB,(Re=(Qe=e.positionInfo)==null?void 0:Qe.token_b)==null?void 0:Re.decimals)),1)]),(e.fromCoinAmount||e.toCoinAmount)&&!("checkNullObj"in e?e.checkNullObj:z(ve))(e.positionInfo)&&e.isShowAfterAmount?(g(),S("div",bi," 0 after ")):de("",!0)]),e.chainName=="Sui"?(g(),S(Ze,{key:0},[e.pendingRewarderArr.length==0&&((Ae=(Ke=(We=e.positionInfo)==null?void 0:We.poolInfo)==null?void 0:Ke.rewarderInfo)==null?void 0:Ae.length)>0?(g(!0),S(Ze,{key:0},oo(e.positionInfo.poolInfo.rewarderInfo,he=>(g(),S("div",{key:he.coinAddress},[ki,o("div",gi,[Pe(o("img",wi,null,512),[[d,e.getCoinIcon({address:he.coinAddress})]]),le(B,{address:he.coinAddress,"style-params":{width:"10px",height:"10px",left:"15px",bottom:"8px"}},null,8,["address"]),le(n,{class:"upgrade-text-skeleton",loading:!0,active:"",paragraph:!1})])]))),128)):de("",!0),(g(!0),S(Ze,null,oo(e.pendingRewarderArr,he=>(g(),S("div",{key:he},[_i,o("div",null,[Pe(o("img",yi,null,512),[[d,he.logo_url]]),le(B,{address:he.address,"style-params":{width:"10px",height:"10px",left:"15px",bottom:"8px"}},null,8,["address"]),o("span",null,E(he.amount>0?("showNum"in e?e.showNum:z($e))(he.amount,he.decimals):0),1)]),(e.fromCoinAmount||e.toCoinAmount)&&!("checkNullObj"in e?e.checkNullObj:z(ve))(e.positionInfo)&&e.isShowAfterAmount?(g(),S("div",Ii," 0 after ")):de("",!0)]))),128))],64)):de("",!0)])]),e.chainName=="Aptos"&&e.pendingRewarderAmount>0?(g(),S("div",Ai,[o("div",Ci,[Si,o("div",null,[me(" $"+E(e.pendingRewarderAmount>0&&e.pendingRewarderAmount<.01?"<0.01":("addCommom"in e?e.addCommom:z(J))(e.pendingRewarderAmount,2))+" ",1),e.pendingRewarderAmount>0?(g(),S("span",$i,"$0 after")):de("",!0)])]),o("div",Pi,[le(v,{class:"claim-all",loading:e.rewarderLoading,disabled:e.rewarderLoading||e.pendingRewarderAmount==0,onClick:e.toClaimRewards},{default:qe(()=>[me("Claim")]),_:1},8,["loading","disabled","onClick"])])])):de("",!0),e.chainName=="Aptos"&&e.pendingRewarderAmount>0?(g(),S("div",Ti,[o("div",Ni,[(g(!0),S(Ze,null,oo(e.pendingRewarderArr,he=>(g(),S("div",{key:he},[Ri,o("div",null,[Pe(o("img",Oi,null,512),[[d,he.logo_url]]),le(B,{address:he.address,"style-params":{width:"10px",height:"10px",left:"15px",bottom:"8px"}},null,8,["address"]),o("span",null,E(he.amount),1)]),(e.fromCoinAmount||e.toCoinAmount)&&!("checkNullObj"in e?e.checkNullObj:z(ve))(e.positionInfo)&&e.isShowAfterAmount?(g(),S("div",qi," 0 after ")):de("",!0)]))),128))])])):de("",!0)])}const jo=Ge(Wt,[["render",Bi]]),Li=ze({components:{AssetsCard:fo},setup(e,m){const r=T(""),c=T(""),V=Ye(),$=b(()=>V),B=b(()=>$.value.theme),v=Ve(),n=b(()=>v),d=T(!1),k=T(!1),l=T(!0),C=b(()=>$.value.chainName),F=b(()=>C.value?xe(C.value):{}),re=uo(),se=b(()=>re),Q=b(()=>$.value.slippage),f=T(),w=T(),q=b(()=>se.value.assets&&f.value&&se.value.assets[f.value.address]?wo(se.value.assets[f.value.address].balance,f.value.decimals):0),t=b(()=>se.value.assets&&w.value&&se.value.assets[w.value.address]?wo(se.value.assets[w.value.address].balance,w.value.decimals):0),y=s=>{s==="fromCoin"?(l.value=!0,C.value==="Aptos"?r.value=q.value>0?f.value.symbol=="APT"?new p(Number(q.value)).sub(new p(.1)).lt(new p(0))?"0":new p(Number(q.value)).sub(new p(.1)).toString():String(q.value):"":r.value=q.value>0?f.value.symbol=="SUI"?new p(Number(q.value)).sub(new p(.05)).lt(new p(0))?"0":new p(Number(q.value)).sub(new p(.05)).toString():String(q.value):""):(l.value=!1,C.value==="Aptos"?c.value=t.value>0?w.value.symbol=="APT"?new p(Number(t.value)).sub(new p(.1)).lt(new p(0))?"0":new p(Number(t.value)).sub(new p(.1)).toString():String(t.value):"":c.value=t.value>0?w.value.symbol=="SUI"?new p(Number(t.value)).sub(new p(.05)).lt(new p(0))?"0":new p(Number(t.value)).sub(new p(.05)).toString():String(t.value):"")},u=s=>{s==="fromCoin"?(l.value=!0,r.value=Me(new p(Number(q.value)).div(2).toString(),f.value.decimals).toString()):(l.value=!1,c.value=Me(new p(Number(t.value)).div(2).toString(),w.value.decimals).toString())},h=T({}),i=T(!0),oe=T({}),K=T(),ne=T(),W=()=>{var M;if(!h.value||!r.value&&!c.value)return;const{TickMath:s,TickUtil:I}=F.value;let U=h.value.minPrice,j=h.value.maxPrice.indexOf("+")>0?"âˆž":h.value.maxPrice,D=Number(h.value.tick_lower_index),X=Number(h.value.tick_upper_index);const ee=Number(h.value.current_tick_index);let ue,fe,we=Number(U).toString(),N=h.value.maxPrice.indexOf("+")>0||h.value.maxPrice==="âˆž"?"âˆž":Number(j);if(we=="0"&&N=="âˆž"?(D=Number(h.value.tick_lower_index),X=Number(h.value.tick_upper_index)):(ue=s.priceToSqrtPriceX64(new p(U),f.value.decimals,w.value.decimals),fe=s.priceToSqrtPriceX64(new p(j),f.value.decimals,w.value.decimals)),K.value=D,ne.value=X,j!=="âˆž"&&D>=X){d.value=!0,r.value="",k.value=!0,c.value="";return}if(j=="âˆž"||ee>=D&&ee<X){d.value=!1,k.value=!1;let ce;if(r.value||c.value){if(l.value){const ie=new p(r.value).mul(Math.pow(10,f.value.decimals)).toString();ce=new Oe(ie)}else{const ie=new p(c.value).mul(Math.pow(10,w.value.decimals)).toString();ce=new Oe(ie)}const{liquidityAmount:pe,tokenMaxA:A,tokenMaxB:Y,tokenMaxAOrigin:R,tokenMaxBOrigin:ae}=F.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:f.value,tokenB:w.value,lowerTick:D,upperTick:X,coinAmount:ce,iscoinA:i.value?l.value:!l.value,roundUp:!0,slippage:Number(Q.value)/100,curSqrtPrice:new Oe(h.value.current_sqrt_price)});oe.value={liquidityAmount:pe,tokenMaxA:A,tokenMaxB:Y,tokenMaxAOrigin:R,tokenMaxBOrigin:ae},i.value?l.value?c.value=Number(Y)>0?Y:"":r.value=Number(A)>0?A:"":l.value?c.value=A:r.value=Y}}else if(ee>=X){if(r.value="",d.value=!0,k.value=!1,r.value||c.value){let ce;const pe=new p(c.value).mul(Math.pow(10,(M=w.value)==null?void 0:M.decimals)).toString();ce=new Oe(pe),oe.value={liquidityAmount:Ro(ue,fe,ce),tokenMaxA:0,tokenMaxB:c.value}}}else if(ee<D){if(d.value=!1,k.value=!0,c.value="",r.value||c.value){let ce;const pe=new p(r.value).mul(Math.pow(10,f.value.decimals)).toString();ce=new Oe(pe),oe.value={liquidityAmount:Oo(ue,fe,ce),tokenMaxA:r.value,tokenMaxB:0}}}else d.value=!0,r.value="",k.value=!0,c.value="";v.setPositionActionAmount({fromCoinAmount:r,toCoinAmount:c})};ye(()=>n.value.currentPositionInfo,s=>{if(s&&!ve(s)){h.value=s,f.value=h.value.token_a,w.value=h.value.token_b;let I=Number(h.value.tick_lower_index),U=Number(h.value.tick_upper_index);const j=Number(h.value.current_tick_index);(s.maxPrice.indexOf("+")>0||s.maxPrice==="âˆž"?"âˆž":s.maxPrice)=="âˆž"||j>=I&&j<U?(d.value=!1,k.value=!1):j>=U?(r.value="",d.value=!0,k.value=!1):j<I?(d.value=!1,k.value=!0,c.value=""):(d.value=!0,r.value="",k.value=!0,c.value=""),W()}},{immediate:!0}),ye(r,(s,I)=>{s&&W(),s==""&&(c.value="")}),ye(c,(s,I)=>{s&&W(),s==""&&(r.value="")});const _=b(()=>{var s,I;return(I=(s=h.value)==null?void 0:s.poolInfo)==null?void 0:I.needReverse}),O=b(()=>n.value.RATES),P=b(()=>{var X,ee,ue,fe;const s=((ee=O.value[(X=f.value)==null?void 0:X.address])==null?void 0:ee.price)||0,I=((fe=O.value[(ue=w.value)==null?void 0:ue.address])==null?void 0:fe.price)||0,U=new p(s).mul(new p(r.value||0)),j=new p(I).mul(new p(c.value||0)),D=U.add(j);return D.toNumber()?D.toNumber()>0&&D.toNumber()>.01?J(D.toString(),2):"<0.01":"--"}),H=T(!1),{t:x,locale:G}=ko(),te=b(()=>{const s=Number(r.value)>Number(q.value),I=Number(c.value)>Number(t.value);return!r.value&&!c.value?x("button.enterAmount"):s?x("button.insufficientBalance",{name:f.value.symbol}):I?x("button.insufficientBalance",{name:w.value.symbol}):x("newAdd.addMore")}),Z=b(()=>{const s=Number(r.value)>Number(q.value),I=Number(c.value)>Number(t.value);return!!(!r.value&&!c.value||s||I)}),{setIsShowSuccess:be,setIsShowRejected:L,setIsShowWaiting:ke,setTransactionDesc:Ie,setTransactionTxid:Le,setPositiomNum:Ue}=V,Se=T(!1);return{theme:B,showFromCoinLock:d,showToCoinLock:k,toCoinAmount:c,fromCoinAmount:r,fromCoinBlance:q,toCoinBlance:t,fromCoin:f,toCoin:w,maxBtnSelect:y,halfBtnSelect:u,fixedFromCoin:l,needReverse:_,totalAmount:P,wallet:se,addLiquidityBtnText:te,isShowLiquidityModal:H,indexStore:V,positionInfo:h,actionLoading:Se,toAdd:async()=>{var X,ee,ue,fe,we,N,M,ce,pe,A,Y,R;H.value=!1,Se.value=!0,Le("");const s=d.value?"":`${r.value} ${(X=f.value)==null?void 0:X.symbol}`,I=k.value?"":`${c.value} ${(ee=w.value)==null?void 0:ee.symbol}`;Ie(x("tips.increaseLiquiditySuccess",{from:_.value?I:s,and:!d.value&&!k.value?"and":"",to:_.value?s:I})),ke(!0);const U=l.value,j=h.value.poolInfo.rewarder_infos;let D={};D.coinTypeC=j[0]?j[0].coinAddress:"",D.coinTypeD=j[1]?j[1].coinAddress:"",D.coinTypeE=j[2]?j[2].coinAddress:"";try{const ae=await F.value.getAddLiquidityTransactionPayload({pool:{poolAddress:h.value.poolAddress,token_a:h.value.token_a,token_b:h.value.token_b},amount:U?oe.value.tokenMaxA:oe.value.tokenMaxB,fix_amount_a:U,tick_lower:K.value,tick_upper:ne.value,index:C.value==="Aptos"?h.value.index:h.value.pos_object_id,slippage:Number(Q.value)/100,roundUp:!0,collect_fee:!0,...D,curSqrtPrice:new Oe(h==null?void 0:h.value.poolInfo.current_sqrt_price),positionInfo:h});let ie;if(C.value==="Aptos")ie=await se.value.currentWallet.signAndSubmitTransaction(ae);else{const _e=await F.value.signAndExecuteTransactionBlock(se.value.currentWallet,ae==null?void 0:ae.txb,ae==null?void 0:ae.payloadParams);ie=F.value.handleTx(_e)}if(console.log("toAdd###tx###",ie),ie&&ie.hash){Le(ie.hash),ke(!1),be(!0);const _e={title:"Supplied",desc:x("tips.addLiquiditySuccessText",{from:d.value?"":`${_.value?c.value:r.value} ${_.value?(fe=w==null?void 0:w.value)==null?void 0:fe.symbol:(ue=f.value)==null?void 0:ue.symbol}`,and:!d.value&&!k.value?"and":"",to:k.value?"":`${_.value?r.value:c.value} ${_.value?(N=f==null?void 0:f.value)==null?void 0:N.symbol:(we=w.value)==null?void 0:we.symbol}`}),hash:ie.hash,tit:"Liquidity Increased",icon:"icon-icon-Increased",tokenInfo:{tokena:_.value?`${(ce=w.value)==null?void 0:ce.address}`:`${(M=f.value)==null?void 0:M.address}`,numa:_.value?`- ${c.value}`:`- ${r.value}`,logoa:_.value?n.value.tokensObj&&w.value&&w.value.address&&n.value.tokensObj[w.value.address]&&n.value.tokensObj[w.value.address].logoURI:n.value.tokensObj&&f.value&&f.value.address&&n.value.tokensObj[f.value.address]&&n.value.tokensObj[f.value.address].logoURI,tokenb:_.value?`${(A=f.value)==null?void 0:A.address}`:`${(pe=w.value)==null?void 0:pe.address}`,numb:_.value?`- ${r.value}`:`- ${c.value}`,logob:_.value?n.value.tokensObj&&f.value&&f.value.address&&n.value.tokensObj[f.value.address]&&n.value.tokensObj[f.value.address].logoURI:n.value.tokensObj&&w.value&&w.value.address&&n.value.tokensObj[w.value.address]&&n.value.tokensObj[w.value.address].logoURI},text:`Deopsit ${d.value?"":`${r.value} ${(Y=f.value)==null?void 0:Y.symbol}`} ${!d.value&&!k.value?"and":""} ${k.value?"":`${c.value} ${(R=w.value)==null?void 0:R.symbol}`}`};C.value!=="Aptos"&&(_e.res=ie.res),F.value.showTransitionPending(_e),await F.value.watchTransaction(_e)&&setTimeout(()=>{m.emit("getDetails"),F.value.getAccount(se.value.address)},1e3),Ue()}else ke(!1),L(!0);r.value="",c.value="",Se.value=!1}catch(ae){r.value="",c.value="",console.log("addError###",ae),Se.value=!1,ke(!1),L(!0)}},addLiquidityBtnDisabled:Z,poolStore:v}}});const Ui={class:"new-position-asset"},Mi={class:"add-or-remove"},ji={class:"liquidity-action-tab"},Di=o("div",{class:"increase tab-active"}," Increase ",-1),Ei={class:"card-item"},Fi={class:"card-item"},Wi={key:0,class:"add",src:fn},Hi={key:1,class:"add",src:pn},Xi={class:"total-amount"},Yi=o("span",null,"Total Amount",-1);function zi(e,m,r,c,V,$){var k;const B=fo,v=mn,n=ro,d=vn;return g(),S("div",Ui,[o("div",Mi,[o("div",ji,[Di,o("div",{class:"remove",onClick:m[0]||(m[0]=l=>e.poolStore.setPositionDetailCurrentTab("remove"))}," Remove ")]),o("div",{class:co(e.needReverse?"card-container reverse":"card-container")},[o("div",Ei,[le(B,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":m[1]||(m[1]=l=>e.fromCoinAmount=l),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:m[2]||(m[2]=l=>e.maxBtnSelect("fromCoin")),onOnHalf:m[3]||(m[3]=l=>e.halfBtnSelect("fromCoin")),onOnInput:m[4]||(m[4]=l=>{e.fromCoinAmount=l}),onOnFocus:m[5]||(m[5]=()=>{e.fixedFromCoin=!0})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock?(g(),Be(v,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin},null,8,["from-coin","to-coin"])):de("",!0)]),o("div",Fi,[le(B,{modelValue:e.toCoinAmount,"onUpdate:modelValue":m[6]||(m[6]=l=>e.toCoinAmount=l),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:m[7]||(m[7]=l=>e.maxBtnSelect("toCoin")),onOnHalf:m[8]||(m[8]=l=>e.halfBtnSelect("toCoin")),onOnInput:m[9]||(m[9]=l=>{e.toCoinAmount=l}),onOnFocus:m[10]||(m[10]=()=>{e.fixedFromCoin=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock?(g(),Be(v,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin},null,8,["from-coin","to-coin"])):de("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(g(),S("img",Wi)):de("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(g(),S("img",Hi)):de("",!0)],2),o("div",Xi,[Yi,o("span",null,"$"+E(e.totalAmount),1)])]),e.wallet.connected?(g(),Be(n,{key:0,class:"big-btn liquidity-btn",disabled:e.addLiquidityBtnDisabled,loading:e.actionLoading,onClick:m[11]||(m[11]=l=>e.isShowLiquidityModal=!0)},{default:qe(()=>[o("span",null,E(e.addLiquidityBtnText),1)]),_:1},8,["disabled","loading"])):(g(),Be(n,{key:1,class:"big-btn",onClick:m[12]||(m[12]=l=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:qe(()=>[o("span",null,E(e.$t("button.connectWallet")),1)]),_:1})),e.isShowLiquidityModal?(g(),Be(d,{key:2,title:e.$t("button.increase"),"is-increase":!0,"from-coin":e.needReverse?e.toCoin:e.fromCoin,"to-coin":e.needReverse?e.fromCoin:e.toCoin,"from-coin-amount":e.needReverse?e.toCoinAmount:e.fromCoinAmount,"to-coin-amount":e.needReverse?e.fromCoinAmount:e.toCoinAmount,"min-price":e.positionInfo.minPrice,"max-price":e.positionInfo.maxPrice,"current-price":e.positionInfo.currentPrice,"current-price-reverse":1/e.positionInfo.currentPrice,"pool-info":(k=e.positionInfo)==null?void 0:k.poolInfo,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"position-total-amount":e.positionInfo.totalAmountUSD,"fixed-from-coin":!0,"tick-lower":e.positionInfo.tick_lower_index,"tick-upper":e.positionInfo.tick_upper_index,"current-price-tab":"custom",onToAdd:e.toAdd,onOnClose:m[13]||(m[13]=l=>e.isShowLiquidityModal=!1)},null,8,["title","from-coin","to-coin","from-coin-amount","to-coin-amount","min-price","max-price","current-price","current-price-reverse","pool-info","show-from-coin-lock","show-to-coin-lock","position-total-amount","tick-lower","tick-upper","onToAdd"])):de("",!0)])}const Do=Ge(Li,[["render",zi]]),Gi=ze({components:{AssetsCard:fo},setup(e,m){const r=T(""),c=T(""),V=Ye(),$=b(()=>V),B=b(()=>$.value.theme),v=Ve(),n=b(()=>v),d=T(!1),k=T(!1),l=T(!0),C=b(()=>$.value.chainName),F=b(()=>C.value?xe(C.value):{}),re=uo(),se=b(()=>re),Q=b(()=>$.value.slippage),f=T(),w=T(),q=b(()=>{var A,Y;return(Y=(A=i.value)==null?void 0:A.poolInfo)==null?void 0:Y.needReverse}),t=b(()=>{var A;return ge(i==null?void 0:i.value.amountA,(A=i==null?void 0:i.value.token_a)==null?void 0:A.decimals)}),y=b(()=>{var A;return ge(i==null?void 0:i.value.amountB,(A=i==null?void 0:i.value.token_b)==null?void 0:A.decimals)}),u=A=>{A==="fromCoin"?(l.value=!0,_.value||(C.value==="Aptos"||console.log(t.value,"213===>"),r.value=String(t.value))):(l.value=!1,_.value||(C.value,c.value=String(y.value))),P.value=100,x({value:1})},h=A=>{A==="fromCoin"?(l.value=!0,r.value=Me(new p(Number(t.value)).div(2).toString(),f.value.decimals).toString()):(l.value=!1,c.value=Me(new p(Number(y.value)).div(2).toString(),w.value.decimals).toString()),_.value=!1},i=T({}),oe=T(!0),K=T({}),ne=T(),W=T(),_=T(!0),O=()=>{var Qe;if(_.value||!i.value||!r.value&&!c.value||Number(r.value)>Number(t.value)||Number(c.value)>Number(y.value))return;if(r.value==t.value&&c.value==y.value){P.value=100,x({value:1}),_.value=!0;return}const{TickMath:A,TickUtil:Y}=F.value;let R=i.value.minPrice,ae=i.value.maxPrice.indexOf("+")>0?"âˆž":i.value.maxPrice,ie=Number(i.value.tick_lower_index),_e=Number(i.value.tick_upper_index);const Te=Number(i.value.current_tick_index);let Ce,Ne,De=Number(R).toString(),Ee=i.value.maxPrice.indexOf("+")>0||i.value.maxPrice==="âˆž"?"âˆž":Number(ae);if(De=="0"&&Ee=="âˆž"?(ie=Number(i.value.tick_lower_index),_e=Number(i.value.tick_upper_index)):(Ce=A.priceToSqrtPriceX64(new p(R),f.value.decimals,w.value.decimals),Ne=A.priceToSqrtPriceX64(new p(ae),f.value.decimals,w.value.decimals)),ne.value=ie,W.value=_e,ae!=="âˆž"&&ie>=_e){d.value=!0,r.value="",k.value=!0,c.value="";return}if(ae=="âˆž"||Te>=ie&&Te<_e){d.value=!1,k.value=!1;let Re;if(r.value||c.value){if(l.value){const he=new p(r.value).mul(Math.pow(10,f.value.decimals)).toString();Re=new Oe(he)}else{const he=new p(c.value).mul(Math.pow(10,w.value.decimals)).toString();Re=new Oe(he)}const{liquidityAmount:je,tokenMaxA:Fe,tokenMaxB:We,tokenMaxAOrigin:Ke,tokenMaxBOrigin:Ae}=F.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:f.value,tokenB:w.value,lowerTick:ie,upperTick:_e,coinAmount:Re,iscoinA:oe.value?l.value:!l.value,roundUp:C.value!="Sui",slippage:Number(Q.value)/100,curSqrtPrice:new Oe(i.value.current_sqrt_price)});K.value={liquidityAmount:je,tokenMaxA:Fe,tokenMaxB:We,tokenMaxAOrigin:Ke,tokenMaxBOrigin:Ae},oe.value?l.value?c.value=Number(We)>0?We:"":r.value=Number(Fe)>0?Fe:"":l.value?c.value=Fe:r.value=We}}else if(Te>=_e){if(r.value="",d.value=!0,k.value=!1,r.value||c.value){let Re;const je=new p(c.value).mul(Math.pow(10,(Qe=w.value)==null?void 0:Qe.decimals)).toString();Re=new Oe(je),K.value={liquidityAmount:Ro(Ce,Ne,Re),tokenMaxA:0,tokenMaxB:c.value}}}else if(Te<ie){if(d.value=!1,k.value=!0,c.value="",r.value||c.value){let Re;const je=new p(r.value).mul(Math.pow(10,f.value.decimals)).toString();Re=new Oe(je),K.value={liquidityAmount:Oo(Ce,Ne,Re),tokenMaxA:r.value,tokenMaxB:0}}}else d.value=!0,k.value=!0;_.value=!1,P.value=new p(K.value.liquidityAmount.toString()).div(i.value.liquidity).mul(100).toNumber().toFixed(2),H.value=K.value.liquidityAmount,v.setPositionActionAmount({fromCoinAmount:r,toCoinAmount:c})},P=T(0),H=T("0"),x=A=>{if(console.log("setPercent isSlider.value: ",_.value),!_.value)return;_.value=!0;const Y=i.value.token_a.decimals,R=i.value.token_b.decimals,ae=i.value.tick_lower_index,ie=i.value.tick_upper_index,_e=Io.tickIndexToSqrtPriceX64(ae),Te=Io.tickIndexToSqrtPriceX64(ie);let Ce="";A.value!==1?Ce=new p(i.value.liquidity).mul(A.value).toString():Ce=i.value.liquidity,Ce=Me(Ce,0)||"0",H.value=Ce;const Ne=cn.getCoinAmountFromLiquidity(new Oe(Ce),new Oe(i.value.current_sqrt_price),_e,Te,C.value!="Sui"),De=new p(Ne.coinA.toString()).div(Math.pow(10,Y)).toString(),Ee=new p(Ne.coinB.toString()).div(Math.pow(10,R)).toString();r.value=Number(De)>0?De:"",c.value=Number(Ee)>0?Ee:"",v.setPositionActionAmount({fromCoinAmount:r,toCoinAmount:c})};ye(()=>n.value.currentPositionInfo,A=>{if(A&&!ve(A)){i.value=A,f.value=i.value.token_a,w.value=i.value.token_b,x({value:P.value/100});let Y=Number(i.value.tick_lower_index),R=Number(i.value.tick_upper_index);const ae=Number(i.value.current_tick_index);(A.maxPrice.indexOf("+")>0||A.maxPrice==="âˆž"?"âˆž":A.maxPrice)=="âˆž"||ae>=Y&&ae<R?(d.value=!1,k.value=!1):ae>=R?(r.value="",d.value=!0,k.value=!1):ae<Y?(d.value=!1,k.value=!0,c.value=""):(d.value=!0,r.value="",k.value=!0,c.value=""),O()}},{immediate:!0}),ye(r,(A,Y)=>{A&&O(),A==""&&(c.value="",P.value=0)}),ye(c,(A,Y)=>{A&&O(),A==""&&(r.value="",P.value=0)});const G=b(()=>n.value.RATES),te=b(()=>{var _e,Te,Ce,Ne;const A=((Te=G.value[(_e=f.value)==null?void 0:_e.address])==null?void 0:Te.price)||0,Y=((Ne=G.value[(Ce=w.value)==null?void 0:Ce.address])==null?void 0:Ne.price)||0,R=new p(A).mul(new p(r.value||0)),ae=new p(Y).mul(new p(c.value||0)),ie=R.add(ae);return J(ie.toString(),2)}),Z=T(!1),{t:be,locale:L}=ko(),ke=b(()=>{const A=Number(r.value)>Number(t.value),Y=Number(c.value)>Number(y.value);return!r.value&&!c.value?be("button.enterAmount"):A||Y?"Invalid Amount":be("button.remove")}),Ie=b(()=>{const A=Number(r.value)>Number(t.value),Y=Number(c.value)>Number(y.value);return!!(!r.value&&!c.value||A||Y)}),{setIsShowSuccess:Le,setIsShowRejected:Ue,setIsShowWaiting:Se,setTransactionDesc:a,setTransactionTxid:s,setPositiomNum:I,setTransactionDescText:U}=V,j=T(!1);ye(P,nn((A,Y)=>{A!==Y&&(Number(A)>100?P.value=100:A&&i.value?(P.value=A,x({value:P.value/100})):(r.value="",c.value=""))},300)),ye(Q,A=>{A&&i.value&&x({value:P.value/100})});const D=[{name:"25%",value:25},{name:"50%",value:50},{name:"75%",value:75},{name:"MAX",value:100}],X=qo(),ee=b(()=>X),ue=b(()=>ee.value.status),fe=T(!1),we=A=>{A.sources.forEach(R=>{const{pool_address:ae,position_index:ie}=JSON.parse(R.blockchainAddress);ae==i.value.poolAddress&&Number(ie)==Number(i.value.index)&&(fe.value=!0)})},N=async()=>{await X.getSources();let A;ee.value.allSources.forEach(Y=>{const{pool_address:R,position_index:ae}=JSON.parse(Y.blockchainAddress);R==i.value.poolAddress&&ae==i.value.index&&(A=Y.id)}),X.deleteSource(A)};ye(()=>[ee.value.sourceGroups,i.value],([A,Y])=>{A&&A.sources&&A.sources.length>0&&Y&&!ve(Y)&&we(A)},{immediate:!0,deep:!0});const M=to(),ce=mo();return{theme:B,showFromCoinLock:d,showToCoinLock:k,toCoinAmount:c,fromCoinAmount:r,fromCoinBlance:t,toCoinBlance:y,fromCoin:f,toCoin:w,maxBtnSelect:u,halfBtnSelect:h,fixedFromCoin:l,needReverse:q,totalAmount:te,wallet:se,addLiquidityBtnText:ke,isShowLiquidityModal:Z,indexStore:V,positionInfo:i,actionLoading:j,addLiquidityBtnDisabled:Ie,sliderVal:P,ratioArr:D,setPercent:x,poolStore:v,isSlider:_,toRemove:async()=>{var ie,_e,Te,Ce,Ne,De,Ee,Qe,Re,je,Fe,We,Ke;j.value=!0,s("");const A=J(r.value,f.value.decimals)==0?"":`${ge(r.value,f.value.decimals)} ${f.value.symbol}`,Y=J(c.value,w.value.decimals)==0?"":`${ge(c.value,w.value.decimals)} ${w.value.symbol}`;a(be("tips.removeLiquidiyText",{from:q.value?Y:A,and:J(r.value,f.value.decimals)==0||J(c.value,w.value.decimals)==0?"":"and",to:q.value?A:Y})),Se(!0);const R=i.value.poolInfo.rewarder_infos,ae=R&&R.length>0&&C.value=="Sui"||R&&R.length>0&&P.value==100?be("modal.removeLiquidityText1"):be("modal.removeLiquidityText2");U(ae);try{let Ae={};Ae={pool:{...i.value.poolInfo,coinA:i.value.token_a,coinB:i.value.token_b},coinTypeA:i.value.poolInfo.coinTypeA,coinTypeB:i.value.poolInfo.coinTypeB,position:i.value,delta_liquidity:P.value==100?new Oe(i.value.liquidity):new Oe(Me(H.value,0)),slippage:Number(Q.value),rewards_num:R.length,positionInfo:i.value},Ae.coinTypeC=R[0]?R[0].coinAddress:"",Ae.coinTypeD=R[1]?R[1].coinAddress:"",Ae.coinTypeE=R[2]?R[2].coinAddress:"";const he=await F.value.getRemoveLiquidityTransactionPayload(Ae);let He;if(C.value==="Aptos")He=await se.value.currentWallet.signAndSubmitTransaction(he);else{const io=await F.value.signAndExecuteTransactionBlock(se.value.currentWallet,he.txb,he==null?void 0:he.payloadParams);He=F.value.handleTx(io),console.log("0331###remove###tx####",He)}if(He&&He.hash){s(He.hash),Se(!1),Le(!0);const io={title:be("common.removeLiquidity"),desc:"",hash:He.hash,descTransactions:`Remove ${r.value} ${(ie=f.value)==null?void 0:ie.symbol} and ${c.value} ${(_e=w.value)==null?void 0:_e.symbol} 
             from the pool`,sender:se.value.address,chainName:C.value,tit:"Liquidity Removed",icon:"icon-icon-Removed",tokenInfo:{tokena:q.value?`${(Ce=w.value)==null?void 0:Ce.address}`:`${(Te=f.value)==null?void 0:Te.address}`,numa:q.value?`+ ${c.value}`:`+ ${r.value}`,logoa:q.value?n.value.tokensObj&&w.value&&w.value.address&&n.value.tokensObj[w.value.address]&&n.value.tokensObj[w.value.address].logoURI:n.value.tokensObj&&f.value&&f.value.address&&n.value.tokensObj[f.value.address]&&n.value.tokensObj[f.value.address].logoURI,tokenb:q.value?`${(Ne=f.value)==null?void 0:Ne.address}`:`${(De=w.value)==null?void 0:De.address}`,numb:q.value?`+ ${r.value}`:`+ ${c.value}`,logob:q.value?n.value.tokensObj&&f.value&&f.value.address&&n.value.tokensObj[f.value.address]&&n.value.tokensObj[f.value.address].logoURI:n.value.tokensObj&&w.value&&w.value.address&&n.value.tokensObj[w.value.address]&&n.value.tokensObj[w.value.address].logoURI},text:`Withdraw ${r.value} ${(Ee=f.value)==null?void 0:Ee.symbol} and ${c.value} ${(Qe=w.value)==null?void 0:Qe.symbol}`};C.value!=="Aptos"&&(io.res=He.res),F.value.showTransitionPending(io);const go=await F.value.watchTransaction(io);if(R.value&&R.value.length>0&&(Number((Re=R[0])==null?void 0:Re.amount)!==0||Ae.coinTypeD&&Number((je=R[1])==null?void 0:je.amount)!==0||Ae.coinTypeE&&Number((Fe=R[2])==null?void 0:Fe.amount)!==0)){const po={title:be("common.removeLiquidity"),desc:"",hash:He.hash,tit:"Rewards Claimed",icon:"icon-icon-Removed",tokenInfo:{tokena:R[0].symbol,numa:`+ ${Number(R[0].amount)}`,logoa:n.value.tokensObj&&R[0]&&R[0].address&&n.value.tokensObj[R[0].address]&&n.value.tokensObj[R[0].address].logoURI,tokenb:Ae.coinTypeD?R[1].symbol:"",numb:Ae.coinTypeD?`+ ${Number(R[1].amount)}`:"",logob:Ae.coinTypeD?n.value.tokensObj&&R[1]&&R[1].address&&n.value.tokensObj[R[1].address]&&n.value.tokensObj[R[1].address].logoURI:"",tokenc:Ae.coinTypeE?R[2].symbol:"",numc:Ae.coinTypeE?`+ ${Number(R[2].amount)}`:"",logoc:Ae.coinTypeE?n.value.tokensObj&&R[2]&&R[2].address&&n.value.tokensObj[R[2].address]&&n.value.tokensObj[R[2].address].logoURI:""},text:`Withdraw ${r.value} ${(We=f.value)==null?void 0:We.symbol} and ${c.value} ${(Ke=w.value)==null?void 0:Ke.symbol}`},Ho=await F.value.setTransations(po)}if($e(i.value.feeOwedA,i.value.token_a.decimals)!==0||$e(i.value.feeOwedB,i.value.token_b.decimals)!==0){const po={title:"Claim",desc:"",hash:He.hash,chainName:C.value,tit:"Fees Claimed",icon:"icon-icon-Removed",tokenInfo:{tokena:`${i.value.token_a.symbol}`,numa:J(i.value.feeOwedA,i.value.token_a.decimals)==0?"":`+ ${$e(i.value.feeOwedA,i.value.token_a.decimals)}`,logoa:J(i.value.feeOwedA,i.value.token_a.decimals)==0?"":n.value.tokensObj&&i.value&&i.value.token_a.address&&n.value.tokensObj[i.value.token_a.address]&&n.value.tokensObj[i.value.token_a.address].logoURI,tokenb:`${i.value.token_b.symbol}`,numb:J(i.value.feeOwedB,i.value.token_b.decimals)==0?"":`+ ${$e(i.value.feeOwedB,i.value.token_b.decimals)}`,logob:J(i.value.feeOwedB,i.value.token_b.decimals)==0?"":n.value.tokensObj&&i.value&&i.value.token_b.address&&n.value.tokensObj[i.value.token_b.address]&&n.value.tokensObj[i.value.token_b.address].logoURI}},Ho=await F.value.setTransations(po)}go&&Number(P.value)==100&&ue.value=="authenticated"&&fe.value&&(await X.subscribePosition({pool_address:i.value.poolAddress,position_index:i.value.index},i.value.nftHash,!1),N()),go&&(r.value="",c.value="",setTimeout(()=>{Number(P.value)!==100&&m.emit("getDetails")},3e3),setTimeout(()=>{Number(P.value)!==100&&m.emit("getDetails")},6e3),Number(P.value)==100&&ce.name=="new-position-detail"&&(C.value==="Aptos"?M.push("/position"):M.push("/pool/position")),P.value=0)}else Se(!1),Ue(!0);j.value=!1}catch(Ae){console.log("Remove error",Ae),j.value=!1,Se(!1),Ue(!0)}},sFixD:Me}}});const Ji={class:"new-position-asset"},Qi={class:"add-or-remove"},Ki={class:"liquidity-action-tab"},Zi=o("div",{class:"remove tab-active"},"Remove",-1),Vi={class:"card-item"},xi={key:0,class:"assets-card-mask"},ea={class:"card-item"},oa={key:0,class:"assets-card-mask"},na={class:"remove-ratio"},ta=o("div",{class:"remove-ratio-title"},"Amount",-1),ia={class:"remove-ratio-select"},aa={key:0,class:"ratio"},sa={key:1,class:"ratio"},la={class:"ratio-list"},ra=["onClick"];function ua(e,m,r,c,V,$){const B=fo,v=tn,n=ro;return g(),S("div",Ji,[o("div",Qi,[o("div",Ki,[o("div",{class:"increase",onClick:m[0]||(m[0]=d=>e.poolStore.setPositionDetailCurrentTab("increase"))}," Increase "),Zi]),o("div",{class:co(e.needReverse?"card-container reverse":"card-container")},[o("div",Vi,[le(B,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":m[1]||(m[1]=d=>e.fromCoinAmount=d),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,havehalf:!1,"amount-leabl":"Available",onOnMax:m[2]||(m[2]=d=>e.maxBtnSelect("fromCoin")),onOnHalf:m[3]||(m[3]=d=>e.halfBtnSelect("fromCoin")),onOnInput:m[4]||(m[4]=d=>{e.fromCoinAmount=d,e.fixedFromCoin=!0,e.isSlider=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.fromCoinBlance==0?(g(),S("div",xi)):de("",!0)]),o("div",ea,[le(B,{modelValue:e.toCoinAmount,"onUpdate:modelValue":m[5]||(m[5]=d=>e.toCoinAmount=d),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,havehalf:!1,"amount-leabl":"Available",onOnMax:m[6]||(m[6]=d=>e.maxBtnSelect("toCoin")),onOnHalf:m[7]||(m[7]=d=>e.halfBtnSelect("toCoin")),onOnInput:m[8]||(m[8]=d=>{e.toCoinAmount=d,e.fixedFromCoin=!1,e.isSlider=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.toCoinBlance==0?(g(),S("div",oa)):de("",!0)])],2),o("div",na,[ta,o("div",ia,[Number(e.fromCoinBlance)>=Number(e.fromCoinAmount)&&Number(e.toCoinBlance)>=Number(e.toCoinAmount)?(g(),S("div",aa,E(e.sliderVal>0&&Number(("sFixD"in e?e.sFixD:z(Me))(e.sliderVal,2))<.01?"<0.01":("sFixD"in e?e.sFixD:z(Me))(e.sliderVal,2))+"% ",1)):(g(),S("div",sa," -- ")),o("div",la,[(g(!0),S(Ze,null,oo(e.ratioArr,(d,k)=>(g(),S("div",{key:k,class:co(["ratio-item",e.sliderVal==d.value?"ratio-item-active":""]),onClick:()=>{e.isSlider=!0,e.sliderVal=d.value}},E(d.name),11,ra))),128))])]),le(v,{value:e.sliderVal,"onUpdate:value":m[9]||(m[9]=d=>e.sliderVal=d)},null,8,["value"])])]),e.wallet.connected?(g(),Be(n,{key:0,class:"big-btn liquidity-btn",loading:e.actionLoading,disabled:e.addLiquidityBtnDisabled,onClick:e.toRemove},{default:qe(()=>[o("span",null,E(e.addLiquidityBtnText),1)]),_:1},8,["loading","disabled","onClick"])):(g(),Be(n,{key:1,class:"big-btn",onClick:m[10]||(m[10]=d=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:qe(()=>[o("span",null,E(e.$t("button.connectWallet")),1)]),_:1}))])}const Eo=Ge(Gi,[["render",ua]]),da=ze({setup(){const e=Ve(),m=b(()=>e),r=Bo(),c=b(()=>r),V=to(),$=b(()=>m.value.currentPositionInfo),B=T(),v=W=>{var _;return((_=m.value.tokensObj[W])==null?void 0:_.logo_url)||no("/image/coins/sui-unknown.png")},n=Ko("Sui"),d=T(),k=async W=>{d.value=0;try{const _=await n.calculateFarmingRewards([{pool_id:W.pool_id,position_nft_id:W.id}]),O=[];let P=new p(0);_[W.id].forEach((H,x)=>{var Z;const G=(Z=m.value.tokensObj[H.rewarder_type])==null?void 0:Z.decimals;let te=new p(H.rewarder_amount).div(Math.pow(10,G)).toString();Number(te)>0&&C.value.rewarders[x]&&(P=P.add(te),O.push({...H,rewarderAmount:te,rewarderAmountPer:te}))}),d.value=P,B.value=O}catch(_){console.log(_,"getRewarder")}},l=b(()=>c.value.farmsPoolObj),C=b(()=>l.value[$.value.poolAddress]);ye(()=>[$.value,l.value,C.value],([W,_,O])=>{var P;!ve(W)&&W.positionSource=="farming"&&!ve(O)?k(W):!ve(_)&&!ve(W)&&(B.value=(P=_[W.poolAddress])==null?void 0:P.rewarders)},{immediate:!0});const F=uo(),re=b(()=>F),se=Ye(),Q=xe("Sui"),{setIsShowSuccess:f,setIsShowRejected:w,setIsShowWaiting:q,setTransactionDesc:t,setTransactionTxid:y}=se,u=T(!1),h=async()=>{u.value=!0,y(""),t("Claim rewards"),q(!0);const W={pool_id:$.value.pool_id,position_nft_id:$.value.id};try{const _=await n.harvestFarms(W),O=await Q.signAndExecuteTransactionBlock(re.value.currentWallet,_.txb,_.payloadParams);console.log("0221###sui swap res###",O);let P=Q.handleTx(O);if(P&&P.hash){y(P.hash),q(!1),f(!0);let H={title:"Claim",res:P.res,hash:P.hash};Q.showTransitionPending(H),await Q.watchTransaction(H)&&setTimeout(()=>{k($.value),Q.getAccount(re.value.address)},2e3)}else q(!1),w(!0);u.value=!1}catch(_){console.log("farmsDeposit error",_),q(!1),w(!0),u.value=!1}},i=async()=>{u.value=!0,y(""),t(`Unstake ${$.value.name}`),q(!0);const W=$.value.pool_id,_=$.value.id;try{const O=await n.farmsWithdraw(W,_),P=await Q.signAndExecuteTransactionBlock(re.value.currentWallet,O.txb,O.payloadParams);console.log("0221###sui swap res###",P);let H=Q.handleTx(P);if(H&&H.hash){y(H.hash),q(!1),f(!0);let x={res:H.res,title:"Unstake",hash:H.hash};Q.showTransitionPending(x),await Q.watchTransaction(x)&&setTimeout(()=>{V.replace(`/new-position-detail?token=${$.value.tokenName}&address=${$.value.clmm_pool_id}&pos=${$.value.clmm_position_id}`),m.value.setCurrentPositionInfo($.value.clmm_pool_id,"",$.value.tokenName,"Sui",$.value.clmm_position_id),d.value=0,u.value=!1},2e3)}else q(!1),w(!0)}catch(O){console.log("farmsDeposit error",O),q(!1),w(!0),u.value=!1}},oe=async()=>{u.value=!0,y(""),t(`Stake ${$.value.name}`),q(!0);const W={clmm_pool_id:$.value.poolAddress,clmm_position_id:$.value.pos_object_id,coinTypeA:$.value.coin_type_a,coinTypeB:$.value.coin_type_b},_=l.value[$.value.poolAddress].id;try{const O=await n.farmsDeposit(W,_),P=await Q.signAndExecuteTransactionBlock(re.value.currentWallet,O.txb,O.payloadParams);console.log("0221###sui swap res###",P);let H=Q.handleTx(P);if(H&&H.hash){y(H.hash),q(!1),f(!0);let x={res:H.res,title:"Staked",hash:H.hash};Q.showTransitionPending(x);const G=await Q.watchTransaction(x,!0);let te;G!=null&&G.status&&setTimeout(async()=>{var Z,be;(be=(Z=G==null?void 0:G.res)==null?void 0:Z.events)==null||be.forEach(L=>{L.type.indexOf("::pool::DepositEvent")>-1&&(te=L.parsedJson.wrapped_position_id)}),V.replace(`/new-position-detail?position_nft_id=${te}&positionSource=farming`),await m.value.setCurrentPositionInfo("","","","Sui",te,"farming"),u.value=!1},2e3)}else q(!1),w(!0)}catch(O){console.log("farmsDeposit error",O),q(!1),w(!0),u.value=!1}},K=b(()=>se),ne=b(()=>K.value.addressLpTokens);return{getCoinIcon:v,rewardList:B,sFixD:Me,addCommom:J,claim:h,unStake:i,loading:u,totalRewardAmount:d,currentPositionInfo:$,stake:oe,farmsPoolObj:l,addressLpTokens:ne,farmsPoolInfo:C}}});const eo=e=>(so("data-v-b105cc87"),e=e(),lo(),e),ca={key:0,class:"farms-position-detail"},ma={class:"farms-top"},va=eo(()=>o("div",{class:"left"},[o("div",{class:"title"},"Farming"),o("div",{class:"desc"},"Stake Position to Earn")],-1)),fa={class:"right"},pa={class:"apr"},ha={class:"apr-tips-box"},ba=eo(()=>o("span",null,"View",-1)),ka=eo(()=>o("svg",{class:"arrow-icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-icon_arrow"})],-1)),ga=[ba,ka],wa={class:"farms-bottom"},_a=eo(()=>o("div",{class:"title"},"Farming Rewards",-1)),ya={key:0,class:"reward-list"},Ia={key:0,class:"rewards-item-bg"},Aa={class:"rewards-item-box"},Ca={alt:""},Sa={key:1},$a={class:"rewards-item-bg"},Pa={class:"rewards-item-box"},Ta={alt:""},Na=eo(()=>o("span",null,"0",-1)),Ra={key:1,class:"reward-list"},Oa={key:0,class:"rewards-item-bg"},qa={class:"rewards-item-box"},Ba={alt:""},La=eo(()=>o("span",null,"0",-1)),Ua={key:1},Ma={class:"rewards-item-bg"},ja={class:"rewards-item-box"},Da={alt:""},Ea=eo(()=>o("span",null,"0",-1)),Fa={class:"actions-box"};function Wa(e,m,r,c,V,$){var k,l,C;const B=hn,v=ro,n=Po,d=bo("image");return e.farmsPoolObj&&e.farmsPoolObj[e.currentPositionInfo.poolAddress]&&e.farmsPoolObj[e.currentPositionInfo.poolAddress].status=="Live"||e.currentPositionInfo.positionSource=="farming"?(g(),S("div",ca,[o("div",ma,[va,o("div",fa,[o("div",pa,[me(" APRÂ  "),o("span",null,[me(E(("addCommom"in e?e.addCommom:z(J))(((k=e.farmsPoolInfo)==null?void 0:k.total_apr)*100,2))+"%Â  ",1),o("div",ha,[le(B,{"l-item":e.farmsPoolInfo,"rewarder-info":(C=(l=e.farmsPoolInfo)==null?void 0:l.rewarder)==null?void 0:C.rewardList},null,8,["l-item","rewarder-info"])])])]),o("div",{class:"view",onClick:m[0]||(m[0]=F=>e.$router.push("/farms"))},ga)])]),o("div",wa,[_a,e.rewardList&&e.rewardList.length>0?(g(),S("div",ya,[(g(!0),S(Ze,null,oo(e.rewardList,F=>(g(),S("div",{key:F,class:"rewards-item"},[e.currentPositionInfo.positionSource=="farming"?(g(),S("div",Ia,[o("div",Aa,[Pe(o("img",Ca,null,512),[[d,e.getCoinIcon(F.rewarder_type)]]),o("span",null,E(("addCommom"in e?e.addCommom:z(J))(F.rewarderAmount||0)),1)])])):(g(),S("div",Sa,[o("div",$a,[o("div",Pa,[Pe(o("img",Ta,null,512),[[d,e.getCoinIcon(F.reward_coin)]]),Na])])]))]))),128))])):(g(),S("div",Ra,[(g(!0),S(Ze,null,oo(e.currentPositionInfo.rewards,F=>(g(),S("div",{key:F,class:"rewards-item"},[e.currentPositionInfo.positionSource=="farming"?(g(),S("div",Oa,[o("div",qa,[Pe(o("img",Ba,null,512),[[d,e.getCoinIcon(F.rewarder_type)]]),La])])):(g(),S("div",Ua,[o("div",Ma,[o("div",ja,[Pe(o("img",Da,null,512),[[d,e.getCoinIcon(F.reward_coin)]]),Ea])])]))]))),128))])),o("div",Fa,[e.currentPositionInfo&&e.currentPositionInfo.positionSource=="farming"?(g(),Be(v,{key:0,class:"unstake-btn",loading:e.loading,onClick:e.unStake},{default:qe(()=>[me("Unstake")]),_:1},8,["loading","onClick"])):de("",!0),e.currentPositionInfo&&e.currentPositionInfo.positionSource=="clmm"&&e.currentPositionInfo.currentStatus!=="Active"?(g(),Be(n,{key:1},{title:qe(()=>[me("Farming rewards are only available for active positions.")]),default:qe(()=>[le(v,{class:"unstake-btn",loading:e.loading,disabled:!0,onClick:e.stake},{default:qe(()=>[me("Stake")]),_:1},8,["loading","onClick"])]),_:1})):e.currentPositionInfo&&e.currentPositionInfo.positionSource=="clmm"?(g(),Be(v,{key:2,class:"unstake-btn",loading:e.loading,onClick:e.stake},{default:qe(()=>[me("Stake")]),_:1},8,["loading","onClick"])):de("",!0),le(v,{class:"unstake-btn btn-margin",loading:e.loading,disabled:e.totalRewardAmount==0||e.currentPositionInfo&&e.currentPositionInfo.positionSource!=="farming",onClick:To(e.claim,["stop"])},{default:qe(()=>[me("â†‘ Claim")]),_:1},8,["loading","disabled","onClick"])])])])):de("",!0)}const Fo=Ge(da,[["render",Wa],["__scopeId","data-v-b105cc87"]]),Ha=ze({props:{positionInfo:{type:Object,default:()=>({})}},setup(e){const m=qo(),r=b(()=>m),c=b(()=>r.value.status),V=Ye(),$=T(!1);ye(()=>c.value,d=>{d=="authenticated",$.value=!1},{immediate:!0});const B=T(!1),v=async()=>{B.value=!B.value;const d={pool_address:e.positionInfo.poolAddress||e.positionInfo.clmm_pool_id,position_index:e.positionInfo.index||e.positionInfo.name.split("-")[1]},k=e.positionInfo.clmm_position_id||e.positionInfo.nftHash;try{await m.subscribePosition(d,k,B.value)}catch{B.value=!B.value}},n=d=>{const k=d.sources;console.log("ðŸš€ðŸš€ðŸš€ ~ file: new-position-notifi.vue:172 ~ getPositionNotifiStatus ~ sources:",k),B.value=k.some(l=>JSON.parse(l.blockchainAddress).pool_address==e.positionInfo.poolAddress&&Number(JSON.parse(l.blockchainAddress).position_index)==(Number(e.positionInfo.index)||Number(e.positionInfo.name.split("-")[1])))};return to(),ye(()=>[r.value.sourceGroups,e.positionInfo],([d,k])=>{B.value=!1,d&&d.length>0&&d[0]&&k&&!ve(k)&&(console.log("ðŸš€ðŸš€ðŸš€ ~ file: new-position-notifi.vue:206 ~ setup ~ getPositionNotifiStatus:"),n(d[0]))},{immediate:!0,deep:!0}),{importIcon:no,isShowSetUp:$,changeSwitch:v,checked:B,notifiStatus:c,store:V}}});const Xa=e=>(so("data-v-1a37a36d"),e=e(),lo(),e),Ya={class:"range-alerts"},za={class:"range-alerts-top"},Ga={class:"title"},Ja=Xa(()=>o("div",{class:"title-all"},[o("span",{class:"Range"},"Range Alerts")],-1)),Qa={key:1,class:"h5-switch-box"},Ka={class:"range-alerts-bottom"},Za={key:0,class:"pc-switch-box"};function Va(e,m,r,c,V,$){const B=ro,v=an;return g(),S("div",Ya,[o("div",za,[o("div",Ga,[Ja,e.isShowSetUp||e.notifiStatus!=="authenticated"?(g(),Be(B,{key:0,class:"range-alerts-button",onClick:m[0]||(m[0]=To(n=>e.store.setIsShowNotifi(!0),["stop"]))},{default:qe(()=>[me(" Set up ")]),_:1})):de("",!0),!e.isShowSetUp&&e.notifiStatus=="authenticated"?(g(),S("div",Qa,[le(v,{class:"range-alerts-switch",checked:e.checked,disabled:e.notifiStatus!=="authenticated",onChange:e.changeSwitch},null,8,["checked","disabled","onChange"])])):de("",!0)])]),o("div",Ka,[me(" Receive alerts via Telegram, SMS, or email when this position goes out of range. "),!e.isShowSetUp&&e.notifiStatus=="authenticated"?(g(),S("div",Za,[le(v,{class:"range-alerts-switch",checked:e.checked,disabled:e.notifiStatus!=="authenticated",onChange:e.changeSwitch},null,8,["checked","disabled","onChange"])])):de("",!0)])])}const Wo=Ge(Ha,[["render",Va],["__scopeId","data-v-1a37a36d"]]),xa=ze({components:{NewPositionTitle:Lo,NewPositionInfo:Mo,NewPositionLiquidity:jo,NewPositionAssetAdd:Do,NewPositionAssetRemove:Eo,NewPositionNotifi:Wo,FarmsPositionDetail:Fo},setup(){const e=T(),m=T(),r=T(),c=Ye(),V=b(()=>c),$=b(()=>V.value.chainName),B=Ve(),v=b(()=>B),n=Bo(),d=b(()=>n),k=to();So(()=>{e.value={},B.setPositionActionAmount({fromCoinAmount:"",toCoinAmount:""}),v.value.setCurrentPositionLoading(!0)});const l=async()=>{v.value.setCurrentPositionLoading(!0);const t=k.currentRoute.value.query.token||"",y=k.currentRoute.value.query.collect||"",u=k.currentRoute.value.query.address||"",h=k.currentRoute.value.query.pos||"",i=k.currentRoute.value.query.id||"",oe=k.currentRoute.value.query.positionSource||"",K=k.currentRoute.value.query.position_nft_id||"";$.value==="Aptos"?t&&y&&u&&v.value.setCurrentPositionInfo(u,y,t,$.value):t&&u&&h?v.value.setCurrentPositionInfo(u,y,t,$.value,h):i&&!oe?v.value.setCurrentPositionInfo("","","",$.value,i):v.value.setCurrentPositionInfo("","","",$.value,K,oe)};ye(()=>v.value.poolConfigObj,t=>{t&&!ve(t)&&l()},{immediate:!0});const C=b(()=>v.value.currentPositionLoading),F=b(()=>{var y,u,h;const t=((h=(u=(y=k==null?void 0:k.currentRoute)==null?void 0:y.value)==null?void 0:u.query)==null?void 0:h.address)||"";return t&&v.value.addressLpTokens&&!ve(v.value.addressLpTokens)&&v.value.addressLpTokens[t]?v.value.addressLpTokens[t]:null});ye(()=>F.value,(t,y)=>{t&&!ve(t)&&(e.value=t),t&&!ve(t)&&t.current_sqrt_price!==(y==null?void 0:y.current_sqrt_price)&&l()},{immediate:!0});const re=mo();ye(()=>[v.value.currentPositionInfo,$.value],([t,y])=>{var u;(y=="Aptos"&&t||y=="Sui"&&t&&(t==null?void 0:t.nftHash)==((u=re==null?void 0:re.query)==null?void 0:u.pos))&&(e.value=t,m.value=e.value.token_a,r.value=e.value.token_b)},{immediate:!0});const se=b(()=>v.value.positionDetailCurrentTab),Q=uo(),f=b(()=>Q);b(()=>V.value.theme);const w=b(()=>$.value?xe($.value):{}),q=()=>{l(),f.value.address&&w.value.getAccount(f.value.address)};return ye(()=>e.value,t=>{var y,u,h,i;((t==null?void 0:t.positionSource)==="farming"||(y=t==null?void 0:t.poolInfo)!=null&&y.stable_farming)&&!((h=(u=d==null?void 0:d.value)==null?void 0:u.farmsPoolObj)!=null&&h[t==null?void 0:t.poolAddress])&&!((i=d==null?void 0:d.value)!=null&&i.farmsPoolListLoading)&&d.value.getFarmsPoolList(!1)},{deep:!0}),Co(()=>{B.clearCurrentPositionInfo()}),{positionInfo:e,fromCoin:m,toCoin:r,getDetails:l,currentPositionLoading:C,positionDetailCurrentTab:se,clickRefresh:q,chainName:$}}});const es={class:"new-position-detail"},os={class:"new-position-content"},ns={class:"left"},ts={class:"right"},is={class:"loading-global"};function as(e,m,r,c,V,$){const B=Lo,v=Mo,n=jo,d=Do,k=Eo,l=Fo,C=Wo,F=sn;return g(),S("div",es,[le(B,{onClickRefresh:e.clickRefresh},null,8,["onClickRefresh"]),o("div",os,[o("div",ns,[le(v),le(n,{class:"pc-module",onGetDetails:e.getDetails},null,8,["onGetDetails"])]),o("div",ts,[e.positionDetailCurrentTab=="increase"?(g(),Be(d,{key:0,onGetDetails:e.getDetails},null,8,["onGetDetails"])):(g(),Be(k,{key:1,onGetDetails:e.getDetails},null,8,["onGetDetails"])),le(n,{class:"h5-module",onGetDetails:e.getDetails},null,8,["onGetDetails"]),e.chainName=="Sui"?(g(),Be(l,{key:2})):de("",!0),e.positionInfo&&e.positionInfo.minPrice!=="0"&&e.positionInfo.maxPrice!=="âˆž"&&e.chainName=="Sui"?(g(),Be(C,{key:3,"position-info":e.positionInfo},null,8,["position-info"])):de("",!0)])]),Pe(o("div",is,[le(F)],512),[[$o,e.currentPositionLoading]])])}const Fs=Ge(xa,[["render",as],["__scopeId","data-v-a79de095"]]);export{Fs as default};
