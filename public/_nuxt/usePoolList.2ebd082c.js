import{a as D,u as J,P as t}from"./useToken.16161822.js";import{u as j,f as S}from"./fetchFun.9795cfdd.js";import{u as E}from"./pool.17ac4ff1.js";import{f as I,Q as N}from"./index.dbdd6761.js";import{c as O,m as x}from"./index.75f6af80.js";import"./decimal.a2826370.js";import{D as $}from"./decimal.765d8738.js";function H(){const{setLocalForage:b,getLocalForage:F}=D();j(),J();const{poolList:i,setPoolList:k,setPoolListLoading:B}=E(),v=async()=>{const o=await S("/data/pools_info.json");console.log("ðŸš€ ~ file: usePoolList.ts:10 ~ getPoolListFromLocalJSON ~ res:",o);const e=o==null?void 0:o.lp_list;if(e){const s=[];for(let r=0;r<(e==null?void 0:e.length);r++){const n=e[r];if(!e[r].object.is_pause&&!e[r].is_closed){const c=await _(n);s.push(c)}}return console.log("ðŸš€ ~ file: usePoolList.ts:61 ~ getPoolListFromLocalJSON ~ result:",s),s}},_=async o=>{var c,f,p;const e=(o==null?void 0:o.is_forward)===!1,s=(o==null?void 0:o.is_display_rewarder)&&((o==null?void 0:o.rewarder_display1)||(o==null?void 0:o.rewarder_display2)||(o==null?void 0:o.rewarder_display3)),r=[];if(s){const u=(p=(f=(c=o==null?void 0:o.object)==null?void 0:c.rewarder_manager)==null?void 0:f.fields)==null?void 0:p.rewarders;u==null||u.forEach((l,T)=>{var L,P,h,w,y,m;const g=I((L=l==null?void 0:l.fields)==null?void 0:L.emissions_per_second).mul($.pow(2,-64));o!=null&&o[`rewarder_display${T+1}`]&&g.gt(0)&&r.push({coinType:x((w=(h=(P=l==null?void 0:l.fields)==null?void 0:P.reward_coin)==null?void 0:h.fields)==null?void 0:w.name).source_address,emissionsEveryDay:N(g.mul(60*60*24).toString(),0),emissions_per_second:(y=l==null?void 0:l.fields)==null?void 0:y.emissions_per_second,growth_global:(m=l==null?void 0:l.fields)==null?void 0:m.growth_global})})}return{...o,poolAddress:o==null?void 0:o.address,tokenAAddress:o==null?void 0:o.coin_a_address,tokenBAddress:o==null?void 0:o.coin_b_address,displayTokenAAddress:e?o==null?void 0:o.coin_b_address:o==null?void 0:o.coin_a_address,displayTokenBAddress:e?o==null?void 0:o.coin_a_address:o==null?void 0:o.coin_b_address,isReverse:e,tickSpacing:Number(o==null?void 0:o.tick_spacing),isClosed:o==null?void 0:o.is_closed,haveMining:s&&(r==null?void 0:r.length)>0,miningRewardList:r}},A=async o=>{console.log("ðŸš€ ~ fetchPoolList ~ poolList:",i);try{if(!o&&i&&(i==null?void 0:i.length)>0)return i;const e=await S(`${O.Sui.api}/v2/sui/pools_info/v3`);console.log("ðŸš€ ~ file: usePoolList.ts:10 ~ fetchPoolList ~ res:",e);const s=e==null?void 0:e.lp_list;if(s){const r=[];for(let n=0;n<(s==null?void 0:s.length);n++){const c=s[n];if(!s[n].object.is_pause&&!s[n].is_closed){const f=await _(c);r.push(f)}}return console.log("ðŸš€ ~ file: usePoolList.ts:61 ~ result ~ result:",r),r}}catch(e){if(console.error("ðŸš€ ~ file: usePoolList.ts:130 ~ fetchPoolList ~ error:",e),console.log("ðŸš€ ~ file: usePoolList.ts:130 ~ fetchPoolList ~ poolList:",i),(i==null?void 0:i.length)>0)return i;try{const s=await F(t);if(console.log("ðŸš€ ~ file: usePoolList.ts:148 ~ fetchPoolList ~ list:",s),(s==null?void 0:s.length)>0)return s;throw new Error(`LocalForage have not ${t} data`)}catch{try{const s=await v();return console.log("ðŸš€ ~ file: usePoolList.ts:201 ~ fetchPoolList ~ poolListFromLocalJson:",s),s||[]}catch{return[]}}}};return{getPoolList:async()=>{const o=await A();console.log("ðŸš€ ~ getPoolList ~ pools:",o),o&&(k(o),b(t,o))}}}export{H as u};
