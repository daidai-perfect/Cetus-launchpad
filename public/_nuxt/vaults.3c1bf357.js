import{a as v,m as k,D as w,o as S,f as b,h as y,i as P,w as x,B,j}from"./entry.969cd3b1.js";import{u as q,f as E}from"./fetchFun.3536bfb9.js";import{g as h,c as T,s as m,A,O as C}from"./index.694cb687.js";import{u as F}from"./autoPool.f0ac04cc.js";import{u as N}from"./pool.ce255c47.js";import"./decimal.0bdeb344.js";function O(){const{peripherySdk:L}=q(),{setApyObj:d,setAutoPoolList:i}=F(),n=async()=>{try{const s=await E(`${h.Sui.api}/v2/sui/auto_pools`);if(console.log("ðŸš€ ~ file: useVaultList.ts:11 ~ fetchAutoPoolsApi ~ res:",s),s!=null&&s.pools){const t=Object.fromEntries(s==null?void 0:s.pools.map(e=>[e==null?void 0:e.object_id,{...e,apr:e.apr.replace("%","")>0&&e.apr.replace("%","")<.01?"<0.01%":m(e.apr.replace("%",""),2)+"%",resultApr:e.apr.replace("%","")}]))||{};return d(t),t}return{}}catch(s){return console.error("ðŸš€ ~ file: useVaultList.ts:14 ~ fetchAutoPoolsApi ~ error:",s),{}}},_=(s,o)=>{var a,u,l,r,V,g,f;const t=o[s.pool_id];console.log("ðŸš€ ~ file: useVaultList.ts:26 ~ getVaultList ~ poolsObj:",o);const e=[t!=null&&t.needReverse?(u=t==null?void 0:t.coinB)==null?void 0:u.address:(a=t==null?void 0:t.coinA)==null?void 0:a.address,t!=null&&t.needReverse?(r=t==null?void 0:t.coinA)==null?void 0:r.address:(l=t==null?void 0:t.coinB)==null?void 0:l.address];return(V=t==null?void 0:t.rewarderInfo)==null||V.forEach(c=>{c.emissionsEveryDay>0&&e.push(A(c.coinAddress))}),(f=(g=t==null?void 0:t.stable_farming)==null?void 0:g.stable_rewarder)==null||f.forEach(c=>{c.amount_second>0&&e.push(A(c.coin))}),{...t,token_a:t.coinA,token_b:t.coinB,id:s.id,lp_token_type:s.lp_token_type,autoPoolPositionInfo:s.position,is_pause:s.is_pause,total_supply:s.total_supply,liquidity:s.liquidity,protocol_fee_rate:s.protocol_fee_rate,max_quota:s.max_quota,stakeProtocol:s.stake_protocol,quota_based_type:C(s.quota_based_type).full_address,supportHaedalStake:!!s.stake_protocol,isTokenA:t!=null&&t.needReverse?(t==null?void 0:t.coin_b_address)=="0000000000000000000000000000000000000000000000000000000000000002::sui::SUI":(t==null?void 0:t.coin_a_address)=="0000000000000000000000000000000000000000000000000000000000000002::sui::SUI",rewardList:Array.from(new Set(e))}};return{getVaultList:async s=>{var o;console.log("ðŸš€ ~ file: useVaultList.ts:26 ~ getVaultList ~ start",s);try{const t=h.Sui.vaultFilter,e=await n();if(e&&!T(e)){const a=await L.Vaults.getVaultList();console.log("ðŸš€ ~ file: useVaultList.ts:26 ~ getVaultList ~ result:",a);const u=t?(o=a==null?void 0:a.data)==null?void 0:o.filter(r=>e==null?void 0:e[r==null?void 0:r.id]):a==null?void 0:a.data;console.log("ðŸš€ ~ file: useVaultList.ts:26 ~ getVaultList ~ openPoolList:",u);const l=u.map(r=>_(r,s));console.log("ðŸš€ ~ file: useVaultList.ts:26 ~ autoPoolList ~ autoPoolList:",l),i(l)}}catch(t){console.error("ðŸš€ ~ file: useVaultList.ts:87 ~ getVaultList ~ error:",t),i([])}}}}const R=y("h3",null,"Vaults",-1),z=v({__name:"vaults",setup(L){const{getVaultList:d}=O(),i=N(),n=k(()=>i),_=()=>{d(n.value.poolConfigObj)};return w(()=>n.value.RATES,p=>{console.log("ðŸš€ ~ file: vaults.vue:28 ~ watch ~ newValue:",p)},{immediate:!0,deep:!0}),(p,s)=>{const o=B;return S(),b("div",null,[R,y("div",null,[P(o,{onClick:_},{default:x(()=>[j("get vault list")]),_:1})])])}}});export{z as default};
