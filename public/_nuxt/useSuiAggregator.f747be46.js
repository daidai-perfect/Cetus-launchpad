import{m as E,af as Ee}from"./entry.69b7b6a8.js";import{u as Te,c as A,$ as be,m as le,a0 as Pe,d as F,k as Be,a1 as ge,a2 as Le,a3 as ce}from"./index.67c45b5d.js";import{a as Ue,b as Ne,i as Me,c as Ve}from"./pool.c995c591.js";import{D as xe}from"./decimal.0bdeb344.js";const je=Ee(),ie=je.public.appEnv;console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:14 ~ env:",ie);function Je(){const{tokensObj:k,setTokensObj:de}=Ue(),pe=Te(),Se=E(()=>pe),fe=Ne(),l=E(()=>fe),ve=A.Sui.aggregatorv2Url,Ae=localStorage.getItem("Sui-currentRpclocal6")||A.Sui.fullRpcUrl,Re=A.Sui.simulationAccount;A.Sui.aggregatorV2.package_id,A.Sui.aggregatorV2.published_at,A.Sui.integrate.package_id,A.Sui.integrate.published_at;const we=new be({url:Ae}),O=E(()=>new Le(ve,Se.value.address||Re,we,ie=="test"?ce.Testnet:ce.Mainnet)),Ie=Me(),R=E(()=>Ie),he=e=>({transactionBlock:e,options:{showEffects:!0,showEvents:!0,showInput:!0,showRawInput:!0,showObjectChanges:!0,showBalanceChanges:!0}}),ye=(e,r)=>r.minus(e).div(r).mul(100),T=(e,r,n)=>{console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:71 ~ getPriceImpact ~ routerData:",e);const{routes:a}=e;let d=F(0);return a==null||a.forEach(o=>{const g=F(o.amountOut).div(Math.pow(10,n)),c=F(o.amountIn).div(Math.pow(10,r)),S=g.div(c),f=F(o==null?void 0:o.amountIn).div(e==null?void 0:e.amountIn),v=ye(S,F(o.initialPrice.toString())).mul(new xe(f));d=d.add(v)}),Number(Be(d.toNumber(),2))},i=e=>ge(e)==="0x2::sui::SUI"?"0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI":ge(e),b=(e,r,n)=>{var d,o,g;const a=e.filter(c=>{const S=i(r),f=i(n),v=i(c==null?void 0:c.base),h=i(c==null?void 0:c.quote);return S===v&&f===h||f===v&&S===h});return(a==null?void 0:a.length)>0?(Object.values((d=a==null?void 0:a[0])==null?void 0:d.addressMap),Array.from((g=(o=a==null?void 0:a[0])==null?void 0:o.addressMap)==null?void 0:g.values())):null},P=e=>e==null?void 0:e.map(r=>{var n,a;return{...r,amountIn:(n=r==null?void 0:r.amountIn)==null?void 0:n.toString(),amountOut:(a=r==null?void 0:r.amountOut)==null?void 0:a.toString(),initialPrice:(r==null?void 0:r.initial_price)||(r==null?void 0:r.initialPrice)}}),Fe=async(e,r,n,a,d,o,g,c)=>{var S,f,v,h,B,L,U,N,M,V,x,j,q,_,K,W,X,J,D,G,Y,z,$,H,Q,Z,m,C,ee,re,te,se,ae;console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:131 ~ getFindRouter ~ index?.value?.liquiditySourceList:",(S=l==null?void 0:l.value)==null?void 0:S.liquiditySourceList),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:131 ~ getFindRouter ~ index?.value?.includeRoutes:",(f=l==null?void 0:l.value)==null?void 0:f.includeRoutes);try{const w=(h=(v=l==null?void 0:l.value)==null?void 0:v.liquiditySourceList)==null?void 0:h.filter(t=>(t==null?void 0:t.status)==="open");console.log("ðŸš€ ~ file: useSuiAggregator.ts:154 ~ function ~ liquiditySources:",w);const p=(B=w==null?void 0:w.filter(t=>{var y;return((y=t==null?void 0:t.name)==null?void 0:y.toUpperCase())!=="CETUS"}))==null?void 0:B.map(t=>{var y,oe,ne;if(((y=t==null?void 0:t.name)==null?void 0:y.indexOf("Kriya"))>-1){if((t==null?void 0:t.name)==="Kriya V2")return"KRIYA";if((t==null?void 0:t.name)==="Kriya V3")return"KRIYAV3"}else{if((t==null?void 0:t.name)==="Aftermath LSD")return"AFSUI";if(((oe=t==null?void 0:t.name)==null?void 0:oe.indexOf("FlowX"))>-1){if((t==null?void 0:t.name)==="FlowX V2")return"FLOWX";if((t==null?void 0:t.name)==="FlowX V3")return"FLOWXV3"}else return(ne=t==null?void 0:t.name)==null?void 0:ne.toUpperCase()}});console.log("ðŸš€ ~ file: useSuiAggregator.ts:155 ~ providers ~ providers:",p);const u={from:i((L=e==null?void 0:e.value)==null?void 0:L.address),target:i((U=r==null?void 0:r.value)==null?void 0:U.address),amount:new le(n),byAmountIn:a,depth:3,providers:["CETUS",...p],liquidityChanges:c};((N=l==null?void 0:l.value)==null?void 0:N.includeRoutes)!=="open"&&(u.splitCount=1),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:145 ~ getFindRouter ~ findRouterParams:",u),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:193 ~ providers ~ client.value:",O.value);const s=await O.value.findRouters(u);if(console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:163 ~ function ~ res:",s),((M=s==null?void 0:s.error)==null?void 0:M.code)==10001)return{...s,id:g};if(s!=null&&s.insufficientLiquidity)return{...s,id:g};if(!(s!=null&&s.routes)||((V=s==null?void 0:s.routes)==null?void 0:V.length)===0)throw Error("Aggregator no router");console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:156 ~ getFindRouter ~ findRouter res Before formatting:",JSON.stringify(s,null,2));const I={...s,amountIn:(x=s==null?void 0:s.amountIn)==null?void 0:x.toString(),amountOut:(j=s==null?void 0:s.amountOut)==null?void 0:j.toString(),routes:P(s==null?void 0:s.routes),originRes:s};console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:159 ~ getFindRouter ~ findRouter formatRes:",JSON.stringify(I,null,2));const ue=T(I,(q=e==null?void 0:e.value)==null?void 0:q.decimals,(_=r==null?void 0:r.value)==null?void 0:_.decimals);return console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:170 ~ getFindRouter ~ priceImpact:",ue),{...I,priceImpact:ue,fromCoinAddress:(K=e==null?void 0:e.value)==null?void 0:K.address,toCoinAddress:(W=r==null?void 0:r.value)==null?void 0:W.address,id:g}}catch(w){try{console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ error:",w),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ swapRouterStore?.value?.poolListGroupByTokenAB:",(X=R==null?void 0:R.value)==null?void 0:X.poolListGroupByTokenAB);const p=b((J=R==null?void 0:R.value)==null?void 0:J.poolListGroupByTokenAB,(D=e==null?void 0:e.value)==null?void 0:D.address,(G=r==null?void 0:r.value)==null?void 0:G.address);if(console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ pools:",p),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ params:",{from:i((Y=e==null?void 0:e.value)==null?void 0:Y.address),target:i((z=r==null?void 0:r.value)==null?void 0:z.address),amount:n,byAmountIn:a,pools:p}),p){const u=await O.value.swapInPools({from:i(($=e==null?void 0:e.value)==null?void 0:$.address),target:i((H=r==null?void 0:r.value)==null?void 0:H.address),amount:new le(n),byAmountIn:a,pools:p});if(console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ res:",u),u){const s={isExceed:u==null?void 0:u.isExceed,amountIn:(Z=(Q=u==null?void 0:u.routeData)==null?void 0:Q.amountIn)==null?void 0:Z.toString(),amountOut:(C=(m=u==null?void 0:u.routeData)==null?void 0:m.amountOut)==null?void 0:C.toString(),routes:P((ee=u==null?void 0:u.routeData)==null?void 0:ee.routes)};console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ forMatRes:",s);const I=T(s,(re=e==null?void 0:e.value)==null?void 0:re.decimals,(te=r==null?void 0:r.value)==null?void 0:te.decimals);return console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ priceImpact:",I),{...s,priceImpact:I,fromCoinAddress:(se=e==null?void 0:e.value)==null?void 0:se.address,toCoinAddress:(ae=r==null?void 0:r.value)==null?void 0:ae.address,id:g,originRes:u==null?void 0:u.routeData}}return null}return null}catch(p){return console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ e:",p),null}}},ke=async(e,r,n,a,d)=>{try{console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:246 ~ getRouterSwapPayload ~ router:",e),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:246 ~ getRouterSwapPayload ~ router.originRes:",e.originRes);const o=new Pe,g={routers:e.originRes.routes,byAmountIn:r,txb:o,slippage:n,isMergeTragetCoin:!0,refreshAllCoins:!0};console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:258 ~ getRouterSwapPayload ~ routerParams:",JSON.stringify(g,null,2));const c=await O.value.fastRouterSwap(g);return console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:122 ~ function ~ res:",o),he(o)}catch(o){console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:49 ~ function ~ error:",o)}},{getTokenBySymbol:Oe}=Ve("Sui");return{getFindRouter:Fe,getRouterSwapPayload:ke,getTokenInfo:async e=>{if(console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:288 ~ getTokenInfo ~ address:",e),k[e])return k[e];{const r=await Oe(k,e),n={[e]:r},a={...k,...n};de(a);try{localStorage.setItem("SuiTokenObj",JSON.stringify(a))}catch(d){console.log("ðŸš€ ~ file: useSuiAggregator.ts:295 ~ getTokenInfo ~ err:",d)}return r}},getFilterPoolsWithCoinAB:b}}export{Je as u};
