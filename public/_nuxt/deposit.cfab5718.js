import{j as io,n as gt,d as he,e as wt,u as Bt,a as Fe,c as oe,s as pt,T as lt,G as no,b as ze,l as Nt,p as qt}from"./pool.07e3ac18.js";import{a as ot,r as B,l as L,H as Rt,q as _e,e as it,o as M,f as W,t as Ot,N as ao,h as l,O as bt,v as ae,u as fe,x as Q,c as We,p as yt,k as _t,S as Ut,y as jt,m as Ct,K as zt,s as ro,F as ht,E as Mt,i as He,A as mt,w as ut,j as Pt,P as Ht,a2 as lo,b as so,B as uo}from"./entry.4c007e3b.js";/* empty css              */import{s as ct,m as co,l as mo,b as vo,a as fo}from"./transform.c672907f.js";import{D as r}from"./decimal.0bdeb344.js";import{u as Tt,a as go}from"./sha256.090e129e.js";import{d as xt,_ as Xt,c as Et,a as Dt,b as po}from"./new-liquidity-title.e488690d.js";import{i as kt}from"./import-icon.de3e6c66.js";/* empty css              */import{positionError as et,fromCoin as _,toCoin as h,tickList as Ve,minPrice as I,maxPrice as k,currentPrice as tt,currentPriceReverse as st,direction as re,currentPriceTab as D,defaultMinPrice as vt,defaultMaxPrice as ft,toggle as Wt,isStableFarmingRange as Ue,isInputTotalAmount as Xe,priceConfigObj as Qe,fromCoinAmount as C,toCoinAmount as S,fixedFromCoin as Le,resetTickList as $t,resetData as bo}from"./data.3f03df56.js";import{u as St}from"./farms.e84010a5.js";import{_ as ho}from"./coin-lock.7bea0ec0.js";import{_ as ko}from"./coin-select.4dd729f1.js";import{_ as wo}from"./viewDetail.b9f012f0.js";import{a as yo}from"./new-add-or-create.d847864a.js";import{u as _o}from"./notifi.f4453d8d.js";import{_ as Co,a as Po}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.a28135f4.js";import"./lock.b706f0c3.js";/* empty css              *//* empty css              */import"./token-warning.131cb3ba.js";import"./swap-setting.a4fbe33c.js";/* empty css              */import"./icon-error_2x.695cb477.js";import"./img-lock_2x.fa0de714.js";import"./img-no-Positions_2x.20e54a02.js";import"./img-no-Positions_2x.8ffe4228.js";import"./status-block.fdf1fe76.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./useWhale.f0211332.js";function Ft(e,d,ge){const le=new r(10).pow(d-ge);return new r(1.0001).pow(e).mul(le)}const To=ot({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,d){const ge=B(""),le=B(""),$=L(()=>{var n,P,m,v,R,ee;return console.log(e.poolInfo,"===>props.poolInfo"),(n=e.poolInfo)!=null&&n.current_sqrt_price&&((P=e.poolInfo)!=null&&P.coinA.decimals)&&((m=e.poolInfo)!=null&&m.coinB.decimals)?i.sqrtPriceX64ToPrice((v=e.poolInfo)==null?void 0:v.current_sqrt_price,(R=e.poolInfo)==null?void 0:R.coinA.decimals,(ee=e.poolInfo)==null?void 0:ee.coinB.decimals).toString():"0"}),se=L(()=>{let n=0;return e.direction?n=(Number(e.minPrice)/Number($.value)-1)*100:n=(Number(e.minPrice)/Number(1/Number($.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),j=L(()=>{let n=0;return e.direction?n=(Number(e.maxPrice)/Number($.value)-1)*100:n=(Number(e.maxPrice)/Number(1/Number($.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),z=Tt(),N=L(()=>z),ie=L(()=>N.value.chainName?wt(N.value.chainName):{}),{TickMath:i,getNearestTickByTick:w}=ie.value,V=(n=[])=>{let P=6;const m=Math.abs(Number(n[0])-Number(n[n.length-1]));return m>=6?P=0:m>=1?P=1:m>=.1?P=2:m>=.01?P=3:m>=.001?P=4:m>=1e-4?P=5:m>=1e-5?P=6:m>=1e-6?P=7:m>=1e-7&&(P=8),P},Ce=(n,P=1)=>{if(n&&n.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const m=Number(e.poolInfo.current_tick_index);console.log("0117###dataProcessing###currentTick###",m),console.log("0117###dataProcessing###props.poolInfo###",e.poolInfo),console.log("0117###dataProcessing###minPrice###",e.minPrice),console.log("0117###dataProcessing###maxPrice###",e.maxPrice),console.log("0117###dataProcessing###poolInfo###",e.poolInfo);let v=m+100*P,R=m-100*P,ee,ke;if(e.maxPrice==="∞")ke=ie.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ke=i.priceToTickIndex(new r(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ke=i.priceToTickIndex(new r(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ke=443636}if(e.minPrice==="0")ee=ie.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ee=i.priceToTickIndex(new r(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ee=i.priceToTickIndex(new r(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ee=-443636}let Ie=0;if(e.currentPriceTab!=="full range"){if(m>=ee&&m<=ke){const A=m-ee,ce=ke-m;Ie=Math.max(Math.abs(A),Math.abs(ce))}else m<ee?Ie=Math.abs(ke-m):Ie=Math.abs(m-ee);v=m+Ie+100*P,R=m-Ie-100*P}else{const A=(Math.abs(m)>5e3,2e4);v=m+A*P,R=m-A*P}R<-443636&&(R=-443636),v>443636&&(v=443636);const b=new r(n.liquidity).div(Math.pow(10,8)).toString(),q=e.tickList;console.log("0117####drawChart####tick_info_array####",q);const H=[],Pe=[];let y={};for(let A=0;A<q.length;A++){if(y=q[A],y.index<=m&&y.index>=R){if(H.length<1&&A!==0){const ce=q[A-1];H.unshift({...ce,index:R,source:"left"})}H.unshift(y)}else if(y.index>m&&y.index<=v&&(Pe.push(y),H.length<1&&A!==0)){const ce=q[A-1];H.push({...ce,index:R,source:"left"})}if(y.index>v){const ce=q[A];if(Pe.push({...ce,index:v,source:"right"}),H.length<1&&A!==0){const Ke=q[A-1];H.push({...Ke,index:R,source:"left"})}break}}let O="0";for(let A=H.length-1;A>=0;A--)O=new r(O).plus(new r(H[A].liquidityNet.toString()).div(Math.pow(10,8))).toString(),H[A].liquityAmount=O;let G=b;for(let A=0;A<Pe.length;A++)G=new r(G).plus(new r(Pe[A].liquidityNet.toString()).div(Math.pow(10,8))).toString(),Pe[A].liquityAmount=G;let K=[];const U=q&&q.length>0?{index:m,liquityAmount:Number(b)}:{index:m,liquityAmount:0};(H.length>0||Pe.length>0)&&(K=[...H.reverse(),U,...Pe],e.direction||(K=K.reverse()));const je=[];q.forEach(A=>{je.push({...A,liquidityGross:A.liquidityGross.toString(),liquidityNet:A.liquidityNet.toString()})}),console.log("0117####drawChart####testTickInfoArray####",je),console.log("0117####drawChart####currentLiquity####",b),console.log(K,"###chartData"),f(K,R,v,ee,ke,m)}};let Ne=B(!1);const ue=B(!1);Rt(()=>{const n=document.body.clientWidth;ue.value=!0,n<750?Ne.value=!1:Ne.value=!0,window.onresize=()=>{document.body.clientWidth<750?Ne.value=!1:Ne.value=!0,console.log("这里执行了吗"),Ce(e.poolInfo,e.zoom)}});const f=(n,P,m,v,R,ee)=>{console.log("0117####drawChart####chartData####",n),console.log("0117####drawChart####tickMin####",P),console.log("0117####drawChart####tickMax####",m),console.log("0117####drawChart####minPriceTick####",v),console.log("0117####drawChart####maxPriceTick####",R),console.log("0117####drawChart####currentTick####",ee),console.log("0117####drawChart####props.direction####",e.direction),console.log("0518###newd3###props.before7dContractPriceLowest###",e.before7dContractPriceLowest),console.log("0518###newd3###props.before7dContractPriceHighest###",e.before7dContractPriceHighest);let ke,Ie;e.direction?(ke=e.before7dContractPriceLowest?i.priceToTickIndex(new r(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",Ie=e.before7dContractPriceHighest?i.priceToTickIndex(new r(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(ke=e.before7dContractPriceLowest?i.priceToTickIndex(new r(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",Ie=e.before7dContractPriceHighest?i.priceToTickIndex(new r(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const b={top:30,right:35,bottom:20,left:80};let q,H;Ne.value?(q=460-b.left-b.right,H=205-b.top-b.bottom):(q=340-b.left-b.right,H=205-b.top-b.bottom);const Pe=m-P,y=parseInt(String(Pe/4));let O=[P+y/4,P+y,P+2*y,m-y,m-y/4];const G=P,K=m,U=q/(K-G);e.currentPriceTab==="full range"&&(O=[P,P+2*y,m]),console.log("0117####drawChart####xArr####",O),console.log("0117####drawChart####utickMin####",G),console.log("0117####drawChart####utickMax####",K),console.log("0117####drawChart####unit####",U);const je=O.map(u=>e.direction?Ft(u,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new r(1).div(Ft(u,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),A=V(je);ct("#chart").selectAll("*").remove();const ce=ct("#chart").attr("width",q+b.left+b.right).attr("height",H+b.top+b.bottom).append("g").attr("transform",`translate(${b.left},${b.right})`),Ke=co(n,function(u){return Number(Math.abs(u.liquityAmount))})||0,Me=mo().range([0,H]).domain([Ke,0]);vo().rangeRound([0,q]).padding(.1);const Ye=ce.append("g").attr("id","barsBox").selectAll("rect").data(n).enter().append("rect");N.value.theme=="default"?Ye.attr("x",function(u,a){return a===0?0:e.direction?Math.abs(u.index-G)*U:Math.abs(K-u.index)*U}).attr("y",function(u,a){return e.direction?a===n.length-1?0:Me(u.liquityAmount):a===n.length-1?0:Me(n[a+1].liquityAmount)}).attr("width",function(u,a){return a===0&&n.length===1&&u.liquityAmount>0?q:(e.direction,a!==n.length-1?Math.abs(n[a+1].index-u.index)*U:0)}).attr("height",function(u,a){return a===0&&n.length===1&&u.liquityAmount>0?H:e.direction?a===n.length-1?0:H-Me(u.liquityAmount):a===n.length-1?0:H-Me(n[a+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):Ye.attr("x",function(u,a){return a===0?0:e.direction?Math.abs(u.index-G)*U:Math.abs(K-u.index)*U}).attr("y",function(u,a){return e.direction?a===n.length-1?0:Me(Math.abs(u.liquityAmount)):a===n.length-1?0:Me(Math.abs(n[a+1].liquityAmount))}).attr("width",function(u,a){return a===0&&n.length===1&&u.liquityAmount>0?q:(e.direction,a!==n.length-1?Math.abs(n[a+1].index-u.index)*U:0)}).attr("height",function(u,a){if(a===0&&n.length===1&&u.liquityAmount>0)return H;if(e.direction)return a===n.length-1?0:Number(u.liquityAmount)?H-Me(Math.abs(u.liquityAmount)):0;{if(a===n.length-1)return 0;const me=H-Me(Math.abs(n[a+1].liquityAmount));return Number(n[a+1].liquityAmount)?me:0}}).attr("fill",function(u,a){return"#417494"}).attr("class","bars").attr("stroke-width",1).attr("stroke",function(u,a){return"#417494"});const Je=ce.append("g");Je.append("line").attr("x1",0).attr("y1",155).attr("x2",q).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const Ze=Je.append("g");let X=0;if(e.direction){for(let u=0;u<O.length;u++){const a=he(je[u],A)||"0";console.log("0423####price####",a),je.push(a);const me=Math.abs(O[u]-G)*U;let te=0;for(let we=0;we<a.length;we++)a[we]==="1"?te+=4.02:a[we]==="."?te+=2.64:a[we]==="7"?te+=5.48:te+=6;console.log(me,"x=>>>"),Ze.append("text").text(a).attr("x",me-te/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}X=Math.abs(ee-G)*U}else{for(let u=O.length-1;u>=0;u--){const a=he(je[u],A)||0;je.push(a);const me=Math.abs(O[u]-K)*U;let te=0;for(let we=0;we<a.length;we++)a[we]==="1"?te+=4.02:a[we]==="."?te+=2.64:a[we]==="7"?te+=5.48:te+=6;Ze.append("text").text(a).attr("x",me-te/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}X=Math.abs(ee-K)*U}console.log(ee,K,U,"######currentPricePositon"),(N.value.theme=="default"?ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+X+", 0)");let t,s,g,T;e.direction?(t=v<G?-100:parseInt(String(Math.abs(v-G)*U)),s=R<G?-100:parseInt(String(Math.abs(R-G)*U)),g=ke<G?-100:Math.abs(ke-G)*U,T=Ie<G?-100:Math.abs(Ie-G)*U):(s=v<G?-100:Math.abs(K-v)*U,t=R<G?-100:Math.abs(K-R)*U,T=ke>K?-100:Math.abs(K-ke)*U,g=Ie>K?-100:Math.abs(K-Ie)*U),e.minPrice==="0"&&(t=0),e.maxPrice==="∞"&&(s=q),console.log(t,"==>minPriceTickX"),Ne.value,ge.value=q-t+87+"px",le.value=s+98+"px",ke&&g<q&&ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+g+", 0)"),Ie&&T<q&&ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+T+", 0)");const F=ce.append("g").attr("id","left-handle"),x=ce.append("g").attr("id","right-handle");N.value.theme=="default"?(F.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),F.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),F.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),F.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),x.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),x.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),x.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),x.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(F.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),F.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),F.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),F.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),x.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),x.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),x.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),x.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),console.log("0525###d3###select###minPriceTickX###",t),console.log("0525###d3###select###maxPriceTickX###",s),F.attr("transform","translate("+t+", 0)"),x.attr("transform","translate("+s+", 0)");const de=fo().extent([[0,0],[q,H]]).handleSize(30).on("end",Ee);ce.append("g").attr("class","brush").call(de).call(de.move,[t,s]);function Ee(u){if(!u.sourceEvent||!u.selection)return;F.attr("transform","translate("+u.selection[0]+", 0)"),x.attr("transform","translate("+u.selection[1]+", 0)"),Ne.value,ge.value=q-u.selection[0]+87+"px",le.value=u.selection[1]+74+"px";let a,me;console.log("0525###d3###select###e.selection[0]###",u.selection[0]),console.log("0525###d3###select###e.selection[0]###",u.selection[1]),console.log("0525###d3###select###props.direction###",e.direction),console.log("0525###d3###select###width###",q),console.log("0525###d3###select###unit###",U),console.log("0525###d3###select###utickMin###",G),console.log("0525###d3###select###utickMax###",K),console.log("0525###d3###select###props.poolInfo###",e.poolInfo);let te=0,we=0;e.direction?(te=w(parseInt(String(u.selection[0]/U+G)),Number(e.poolInfo.tickSpacing)),a=i.tickIndexToPrice(te,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),we=w(parseInt(String(u.selection[1]/U+G)),Number(e.poolInfo.tickSpacing)),me=i.tickIndexToPrice(we,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),console.log("1114###d3###select###minTick###",te),console.log("1114###d3###select###maxTick###",we),console.log("1114###d3###select###minPrice###",a),console.log("1114###d3###select###maxPrice###",me)):(we=w(K-u.selection[0]/U,Number(e.poolInfo.tickSpacing)),a=1/i.tickIndexToPrice(we,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),te=w(K-u.selection[1]/U,Number(e.poolInfo.tickSpacing)),me=1/i.tickIndexToPrice(te,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),d.emit("onChangeMinPrice",String(he(String(a),6))),d.emit("onChangeMaxPrice",String(he(String(me),6)))}N.value.theme=="default"?ct(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):ct(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632"),console.log("画完了##")};return B(""),_e(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom,e.tickList],([n,P,m,v,R,ee])=>{console.log(n,P,m,m>P,R,"poolInfo && minPrice && maxPrice && (maxPrice > minPrice)"),n&&P&&m&&(n!=null&&n.liquidity)&&(v!=="Custom"||console.log("绘制"),Ce(n,R))},{immediate:!0}),console.log(e,"props===>"),{store:N,loading:ue,rangeSizeLower:se,rangeSizeUpper:j,rangeSizeLowerPosition:ge,rangeSizeUpperPosition:le,decimalFormat:io,numberformat:gt}}});const So=e=>(yt("data-v-60bd7ae2"),e=e(),_t(),e),Io={class:"chart-box"},Ao={class:"chart"},Lo=So(()=>l("svg",{id:"chart"},null,-1));function No(e,d,ge,le,$,se){const j=Ut;return M(),W("div",Io,[Ot(l("div",Ao,[e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(M(),W("div",{key:0,class:"range-size range-size-lower",style:bt({right:e.rangeSizeLowerPosition})},ae(("numberformat"in e?e.numberformat:fe(gt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):Q("",!0),e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(M(),W("div",{key:1,class:"range-size range-size-upper",style:bt({left:e.rangeSizeUpperPosition})},ae(("numberformat"in e?e.numberformat:fe(gt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):Q("",!0),Lo],512),[[ao,!e.chartLoading]]),e.chartLoading?(M(),We(j,{key:0})):Q("",!0)])}const Zt=it(To,[["render",No],["__scopeId","data-v-60bd7ae2"]]),qo=ot({props:{lever:{type:String,default:""}},setup(){return{}}});const Mo=e=>(yt("data-v-619778e2"),e=e(),_t(),e),$o={class:"lever"},Fo=Mo(()=>l("div",{class:"lever-title"},"Leverage",-1)),Bo={class:"lever-text"};function Ro(e,d,ge,le,$,se){return M(),W("div",$o,[Fo,l("div",Bo,ae(e.lever),1)])}const Oo=it(qo,[["render",Ro],["__scopeId","data-v-619778e2"]]),Uo=ot({components:{NewLiquidityD3Chart:Zt,NewLiquidityPrice:xt},setup(){const{t:e,locale:d}=jt(),ge=B("liquidity"),le=Tt(),$=L(()=>le),se=L(()=>$.value.chainName),j=Bt(),z=L(()=>j),N=L(()=>$.value.chainName?wt($.value.chainName):{});Rt(()=>{et.value=!1});const ie=Ct(),i=L(()=>{let t=null;for(let s=0;s<z.value.poolConfigList.length;s++){const g=z.value.poolConfigList[s];g.address==ie.query.poolAddress&&(t=g)}return console.log(t,"===>basePoolInfo"),t}),w=L(()=>{let t=null;for(const s in z.value.poolsObj){const g=z.value.poolsObj[s];g.address==ie.query.poolAddress&&(console.log(g,"p===>"),t=g)}return t}),V=B(),Ce=B(!0),Ne=async(t,s)=>{if(console.log(Ce.value,"==>chartLoading.value"),Ce.value=!0,s){Ve.value=[],f.value=[],Ue.value=!1;const g=t.token_a.decimals,T=t.token_b.decimals;console.log(t,"pool===>1111"),console.log("poolPrice###pool.current_tick_index####",t.current_tick_index);const F=lt.tickIndexToPrice(t.current_tick_index,g,T);console.log("poolPrice###",F.toString()),tt.value=lt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,g,T).toString(),console.log(tt.value,"##currentPrice.value"),st.value=new r(1).div(lt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,g,T)).toString(),console.log(st.value,"##currentPriceReverse.value"),_.value=t.needReverse?t.token_b:t.token_a,h.value=t.needReverse?t.token_a:t.token_b,V.value=t.needReverse,t.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===h.value.address.toLowerCase()?re.value=!0:re.value=!1,console.log(t,"187===>"),console.log(t,"###pool===>");let x={poolAddress:t.address,coinTypeA:t.coin_a_address,coinTypeB:t.coin_b_address};const de=await N.value.getTicks(x);Ve.value=de?N.value.getTickDataFromUrlData(de):[],console.log(Ve.value,"===>chartLoadingtickList.value"),Ce.value=!1,P(t)}},ue=t=>{const s=t.token_a.decimals,g=t.token_b.decimals;console.log(t,"pool===>1111"),console.log("poolPrice###pool.current_tick_index####",t.current_tick_index),tt.value=lt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,s,g).toString(),st.value=new r(1).div(lt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,s,g)).toString()},f=B([]),n=B(),P=t=>{const s=t.token_a.decimals,g=t.token_b.decimals;let T=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[t.address]&&z.value.poolPriceConfigObj[t.address].recommend_ranges||{};const F=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[t.address]&&z.value.poolPriceConfigObj[t.address].type||"";console.log(T,"===>priceConfigList");let x,de;const Ee=no(t.current_tick_index,t.tickSpacing);n.value=t.current_tick_index,console.log(Ee,t.tickSpacing,"==>pool.tickSpacing"),x=Ee-Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3),de=Ee+Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3);const u=N.value.TickMath.tickIndexToPrice(x,s,g).toString(),a=N.value.TickMath.tickIndexToPrice(de,s,g).toString();T["full range"]={lower:N.value.TickUtil.getMinIndex(Number(w.value.tickSpacing)),upper:N.value.TickUtil.getMaxIndex(Number(w.value.tickSpacing))},T.custom={lower:x,upper:de,minPrice:u,maxPrice:a};const me=[];for(let te in T)T[te]&&(console.log(te,"j==>"),me.push({...T[te],key:te}));console.log(me,"priceList"),console.log(t,"###pool.type 504"),F&&me&&me.length>2?t.isSelfBuilt?D.value="custom":F=="stable"?D.value="suggested":D.value="passive":D.value="custom",f.value=me||{},Qe.value=T,R({key:D.value,...T[D.value]})},m=B(""),v=B(""),R=t=>{console.log("priceTab====>",t),console.log("priceTab###poolInfo###",w.value),D.value=t.key.toLowerCase();const s=w.value.token_a.decimals,g=w.value.token_b.decimals,{lower:T,upper:F}=t;Xe.value=!1;const x=N.value.TickMath.tickIndexToPrice(T,s,g).toString(),de=N.value.TickMath.tickIndexToPrice(F,s,g).toString();if(t.key=="full range"){m.value=T,v.value=F,ee();return}console.log(re.value,"===>direct.value"),re.value?(vt.value=String(x),I.value=String(x),ft.value=String(de),k.value=String(de),m.value=T,v.value=F):(vt.value=String(1/Number(de)),I.value=String(1/Number(de)),ft.value=String(1/Number(x)),k.value=String(1/Number(x)),m.value=N.value.TickMath.priceToTickIndex(new r(1/Number(de)),s,g),v.value=N.value.TickMath.priceToTickIndex(new r(1/Number(x)),s,g)),console.log(I.value,k.value,"===>111")},ee=t=>{I.value="0",k.value="∞"};_e(()=>w.value,(t,s)=>{console.log(s,"===>oldVal"),console.log(t,"===>newVal"),(!s&&t&&!oe(t)||s&&t&&s.address!==t.address)&&(console.log("池子信息"),Ne(t,!s||t.address!==s.address)),t&&!oe(t)&&ue(t)},{immediate:!0}),zt(()=>{_.value=B(),h.value=B(),Ve.value=[]}),_e(()=>[i.value,w.value,z.value.recommendRangesObj],(t,s)=>{var g,T;console.log(t,"===>newValue369"),console.log(s,"===>oldValue369"),(!s||t[0]&&t[1]&&t[2]&&!oe(t[0])&&!oe(t[1]&&!oe(t[2]))||((g=t[0])==null?void 0:g.address)!==((T=s[0])==null?void 0:T.address))&&t[0]&&t[2]&&!oe(t[0])&&!oe(t[2])&&(console.log(t[0],t[2],"======>374"),j.setSinglePool(t[0],t[2],se.value))},{immediate:!0,deep:!0});const ke=t=>{if(se.value=="Sui")switch(t){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(t){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},Ie=t=>{switch(t){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},b=t=>{var g,T;const s=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[(g=w.value)==null?void 0:g.address]&&z.value.poolPriceConfigObj[(T=w.value)==null?void 0:T.address].type||"";if(console.log(s,t,"==>poolType"),f.value.length>2)if(s=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}else if(s=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"full range":return{top:"35%"};case"custom":return{top:"60%"}}},q=B(1),H=()=>{const t=q.value/2;q.value=t},Pe=()=>{const t=q.value*2;q.value=t};console.log(f.value,"==>priceTablList");const y=L(()=>{var t,s,g;return!w.value||oe($.value.addressHistTokens)||!$.value.addressHistTokens[(t=w.value)==null?void 0:t.poolAddress]?null:Object.fromEntries((g=$.value.addressHistTokens[(s=w.value)==null?void 0:s.poolAddress])==null?void 0:g.data.map(T=>[T.key,T.value]))}),O=B(30),G=B("30D"),K=L(()=>re.value?y.value&&he(O.value==7?y.value.before_7_d_contract_price_lowest:O.value==24?y.value.before_24_h_contract_price_lowest:y.value.before_30_d_contract_price_lowest,6)||0:y.value&&he(new r(1).div(O.value==7?y.value.before_7_d_contract_price_highest:O.value==24?y.value.before_24_h_contract_price_highest:y.value.before_30_d_contract_price_highest).toString(),6)||0),U=L(()=>re.value?y.value&&he(O.value==7?y.value.before_7_d_contract_price_highest:O.value==24?y.value.before_24_h_contract_price_highest:y.value.before_30_d_contract_price_highest,6)||0:(y.value&&he(1/Number(O.value==7?y.value.before_7_d_contract_price_lowest:O.value==24?y.value.before_24_h_contract_price_lowest:y.value.before_30_d_contract_price_lowest),6))==1/0?0:y.value&&he(1/Number(O.value==7?y.value.before_7_d_contract_price_lowest:O.value==24?y.value.before_24_h_contract_price_lowest:y.value.before_30_d_contract_price_lowest),6)||0),je=L(()=>{const t=Number(I.value),s=Number(k.value);if(I.value=="0"&&k.value=="∞"||D.value=="full range")return"1x";if(I.value==k.value||D.value=="full range")return"--";if(I.value&&k.value&&I.value!=="0"&&k.value!=="∞"){const g=pt(1/(1-Number((t/s)**.25)),2);return Number(g)>0?g+"x":"--"}else return 1}),A=L(()=>{var t,s,g,T,F,x;return((t=_.value)==null?void 0:t.isSelfBuilt)||((s=h.value)==null?void 0:s.isSelfBuilt)||((T=z.value.tokensObj[(g=_.value)==null?void 0:g.address])==null?void 0:T.isSelfBuilt)||((x=z.value.tokensObj[(F=h.value)==null?void 0:F.address])==null?void 0:x.isSelfBuilt)}),ce=(t,s)=>{console.log(t,"####0731 priceRangeChangeMin"),t!==I.value&&D.value=="full range"?(console.log(f.value,"===>priceTablList"),R({key:"custom",...f.value.custom})):D.value!=="full range"&&D.value!=="custom"?(D.value="custom",I.value=t):I.value=t,Ue.value?(re.value&&I.value!==X.value.minPrice&&(Ue.value=!1),!re.value&&Number(I.value)!==1/Number(X.value.maxPrice)&&(Ue.value=!1)):(re.value&&I.value==X.value.minPrice&&k.value==X.value.maxPrice&&(Ue.value=!0),!re.value&&Number(I.value)==1/Number(X.value.maxPrice)&&Number(k.value)==1/Number(X.value.minPrice)&&(Ue.value=!0))},Ke=(t,s)=>{console.log(t,"###priceRangeChangeMax maxPirce"),t!==k.value&&D.value=="full range"?R({key:"custom",...f.value.custom}):D.value!=="full range"&&D.value!=="custom"?(D.value="custom",t=="0"?k.value="∞":k.value=t):t=="0"?k.value="∞":k.value=t,Ue.value?(re.value&&k.value!==X.value.maxPrice&&(Ue.value=!1),!re.value&&Number(k.value)!==1/Number(X.value.minPrice)&&(Ue.value=!1)):(re.value&&I.value==X.value.minPrice&&k.value==X.value.maxPrice&&(Ue.value=!0),!re.value&&Number(I.value)==1/Number(X.value.maxPrice)&&Number(k.value)==1/Number(X.value.minPrice)&&(Ue.value=!0))};console.log(I.value,k.value,"683==>"),_e(()=>[I.value,k.value],([t,s])=>{console.log(t,s,"minmax new-liquidity-left")},{deep:!0,immediate:!0});const Me=t=>{var s;return(t==null?void 0:t.logoURI)||(t==null?void 0:t.logo_url)||((s=z.value.tokensObj[t==null?void 0:t.address])==null?void 0:s.logo_url)||($.value.theme==="default"?kt("/image/coins/unknown.png"):kt("/image/coins/sui-unknown.png"))},nt=t=>{switch(t){case"active":return e("newAdd.activeTips");case"passive":return e("newAdd.passiveTips");case"full range":return e("newAdd.fullRangTips");case"suggested":return e("newAdd.suggestedTips");case"custom":return e("newAdd.customTips")}},Ye=[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}],Je=St(),Ze=L(()=>Je),X=L(()=>{var t;return Ze.value.farmsPoolObj[(t=w==null?void 0:w.value)==null?void 0:t.address]}),at=L(()=>z.value.poolPriceConfigObj);return _e(()=>[Ue.value,w.value,f.value,at.value,X.value,re.value],([t,s,g,T,F,x])=>{var de,Ee;if(console.log(F,x,"##farmsPoolInfo"),t&&F&&!oe(F))D.value="custom",I.value=x?F.minPrice:String(1/F.maxPrice),k.value=x?F.maxPrice:String(1/F.minPrice),console.log(I.value,k.value,"###1195");else if(s&&!oe(s)&&g&&!oe(g)&&T&&!oe(T)&&F&&!oe(F)){const u=T&&T[(de=s.value)==null?void 0:de.address]&&T[(Ee=s.value)==null?void 0:Ee.address].type||"",a=g.filter(me=>me.key===(g.length==4?"passive":"suggested"));console.log(u,"##poolType"),a!=null&&a[0]&&R({...a[0]})}},{immediate:!0}),{positionError:et,getCoinIcon:Me,chainName:se,store:$,currentTab:ge,currentPrice:tt,currentPriceReverse:st,fromCoin:_,toCoin:h,direction:re,needReverse:V,addCommom:Fe,decimalUi:he,priceTablList:f,currentPriceTab:D,sliderStyle:b,poolInfo:w,tickList:Ve,getPriceTabImage:ke,getPriceTabText:Ie,defaultMinPrice:vt,defaultMaxPrice:ft,minPrice:I,maxPrice:k,currentTick:n,chartLoading:Ce,zoomOut:H,zoomIn:Pe,zoom:q,priceTab:R,before7dContractPriceLowest:K,before7dContractPriceHighest:U,aprRewardsTime:G,lever:je,aprRewardsParameter:O,isSelfBuilt:A,priceRangeChangeMin:ce,priceRangeChangeMax:Ke,toggle:Wt,getPirceTabTips:nt,timeList:Ye,farmsPoolInfo:X,checkNullObj:oe,isStableFarmingRange:Ue}}}),Gt=""+globalThis.__publicAssetsURL("sui-image/icon_sel@2x.png");const jo={class:"new-liquidity-left"},zo=l("span",{class:"selectRange"},"Select Range",-1),Ho={class:"price-info"},xo={class:"left"},Xo={class:"base-coin"},Eo={class:"base-coin-title"},Do=l("span",null,"Base coin",-1),Wo=l("svg",{class:"icon icon-up","aria-hidden":"true"},[l("use",{"xlink:href":"#icon-exchange_up1"})],-1),Zo=l("svg",{class:"icon icon-down","aria-hidden":"true"},[l("use",{"xlink:href":"#icon-exchange_down1"})],-1),Go=[Wo,Zo],Ko={class:"base-coin-bottom"},Jo={alt:""},Qo={class:"current-price"},Yo=l("div",{class:"current-price-title"},"Current Price",-1),Vo={key:0,class:"from-pre-to"},ei={class:"right"},ti={class:"price-range"},oi={class:"left"},ii={class:"price-slider"},ni={class:"slider"},ai=l("div",{class:"slider-ratio-content"},null,-1),ri=[ai],li={class:"price-tab-list"},si=["onClick"],ui=["src"],ci={class:"right"},di={class:"price-zoom"},mi={class:"current-price"},vi=l("div",{class:"current-price-title"},"Current Price",-1),fi={key:0,class:"from-pre-to"},gi={class:"price-zoom-right"},pi={class:"leverage"},bi=l("div",{class:"left"},null,-1),hi={class:"right"},ki={class:"right-time"},wi={key:0,class:"day-7-price-range"},yi=l("i",null,null,-1),_i={class:"gray"},Ci={class:"time-list"},Pi=["onClick"],Ti={class:"right-price-h5"},Si={key:0,class:"stable-farming-range"},Ii={key:0,src:Gt,alt:""},Ai={class:"apr-leverage"},Li={key:0,class:"position-tips"},Ni=["src"],qi={class:"error"};function Mi(e,d,ge,le,$,se){var w,V,Ce,Ne,ue,f,n,P,m;const j=Ht,z=Zt,N=Oo,ie=xt,i=ro("image");return M(),W("div",jo,[zo,l("div",Ho,[l("div",xo,[l("div",Xo,[l("div",Eo,[Do,l("div",{class:"change-price",onClick:d[0]||(d[0]=(...v)=>e.toggle&&e.toggle(...v))},Go)]),l("div",Ko,[Ot(l("img",Jo,null,512),[[i,e.getCoinIcon(e.fromCoin)]]),l("span",null,ae((w=e.fromCoin)==null?void 0:w.symbol),1)])]),l("div",Qo,[Yo,l("div",null,[l("span",null,ae(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.currentPrice,6)):("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(M(),W("span",Vo,ae((V=e.toCoin)==null?void 0:V.symbol)+" per "+ae((Ce=e.fromCoin)==null?void 0:Ce.symbol),1)):Q("",!0)])])]),l("div",ei,[e.currentTab=="liquidity"?(M(),W("div",{key:0,class:"zoom-out",onClick:d[1]||(d[1]=(...v)=>e.zoomOut&&e.zoomOut(...v))}," + ")):Q("",!0),e.currentTab=="liquidity"?(M(),W("div",{key:1,class:"zoom-in",onClick:d[2]||(d[2]=(...v)=>e.zoomIn&&e.zoomIn(...v))}," - ")):Q("",!0)])]),l("div",ti,[l("div",oi,[l("div",ii,[l("div",ni,[l("div",{class:"slider-ratio",style:bt(e.sliderStyle(e.currentPriceTab))},ri,4)])]),l("div",li,[(M(!0),W(ht,null,Mt(e.priceTablList,v=>(M(),W("div",{key:v.key,class:mt(["price-tab-item",e.currentPriceTab==v.key?"price-tab-item-active":""]),onClick:R=>e.priceTab(v)},[He(j,{placement:"bottom","arrow-point-at-center":""},{title:ut(()=>[Pt(ae(e.getPirceTabTips(v.key)),1)]),default:ut(()=>[l("img",{src:e.getPriceTabImage(v.key),alt:""},null,8,ui),l("span",null,ae(e.getPriceTabText(v.key)),1)]),_:2},1024)],10,si))),128))])]),l("div",ci,[l("div",di,[l("div",mi,[vi,l("div",null,[l("span",null,ae(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.currentPrice,6)):("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(M(),W("span",fi,ae(e.direction&&!e.needReverse?`${(Ne=e.fromCoin)==null?void 0:Ne.symbol} per ${(ue=e.toCoin)==null?void 0:ue.symbol}`:`${(f=e.toCoin)==null?void 0:f.symbol} per ${(n=e.fromCoin)==null?void 0:n.symbol}`),1)):Q("",!0)])]),l("div",gi,[e.currentTab=="liquidity"?(M(),W("div",{key:0,class:"zoom-out",onClick:d[3]||(d[3]=(...v)=>e.zoomOut&&e.zoomOut(...v))}," + ")):Q("",!0),e.currentTab=="liquidity"?(M(),W("div",{key:1,class:"zoom-in",onClick:d[4]||(d[4]=(...v)=>e.zoomIn&&e.zoomIn(...v))}," - ")):Q("",!0)])]),e.poolInfo?(M(),We(z,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):Q("",!0)])]),l("div",pi,[bi,l("div",hi,[l("div",ki,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(M(),W("div",wi,[yi,l("span",_i,ae(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),l("span",null,ae(("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.before7dContractPriceLowest,6)))+" - "+ae(("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.before7dContractPriceHighest,6))),1)])):Q("",!0),l("div",Ci,[(M(!0),W(ht,null,Mt(e.timeList,v=>(M(),W("div",{key:v.value,class:mt(["time-item",v.value==e.aprRewardsParameter?"time-item-active":""]),onClick:R=>e.aprRewardsParameter=v.value},ae(v.label),11,Pi))),128))])]),l("div",Ti,[l("span",null,ae(("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.before7dContractPriceLowest,6)))+" - "+ae(("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.before7dContractPriceHighest,6))),1)])])]),e.farmsPoolInfo&&!("checkNullObj"in e?e.checkNullObj:fe(oe))(e.farmsPoolInfo)&&e.fromCoin&&e.toCoin?(M(),W("div",Si,[l("span",null," Farm rewards range："+ae(("decimalUi"in e?e.decimalUi:fe(he))(e.direction?e.farmsPoolInfo.minPrice:1/e.farmsPoolInfo.maxPrice,6))+" - "+ae(("decimalUi"in e?e.decimalUi:fe(he))(e.direction?e.farmsPoolInfo.maxPrice:1/e.farmsPoolInfo.minPrice,6))+" "+ae((P=e.toCoin)==null?void 0:P.symbol)+" per "+ae((m=e.fromCoin)==null?void 0:m.symbol),1),l("div",{class:"check-box-active",onClick:d[5]||(d[5]=v=>e.isStableFarmingRange=!e.isStableFarmingRange)},[e.isStableFarmingRange?(M(),W("img",Ii)):Q("",!0)])])):Q("",!0),l("div",{class:mt(["apr-and-price",e.positionError&&e.poolInfo?"padding-apr-and-price":""])},[l("div",Ai,[He(N,{lever:e.lever},null,8,["lever"])]),He(ie,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?(M(),W("div",Li,[l("img",{src:("importIcon"in e?e.importIcon:fe(kt))("/image/icon-tips-error@2x.png"),alt:""},null,8,Ni),l("p",qi,ae(e.$t("tips.positionError")),1)])):Q("",!0)],2)])}const Kt=it(Uo,[["render",Mi]]),$i=ot({props:{poolInfo:{type:Object,default:()=>({})},isActive:{type:Boolean,default:!0}},setup(e,d){const ge=St(),le=B(!1),$=B(),se=B(!0),j=L(()=>ge),z=L(()=>j.value.farmsPoolList.filter(i=>i.status=="Live"));_e(()=>e.poolInfo,i=>{i&&!oe(i)&&ge.getFarmsPoolList()},{immediate:!0});const N=i=>{const w=i.filter(V=>{var Ce;return V.status=="Live"&&V.clmm_pool_id==((Ce=e.poolInfo)==null?void 0:Ce.poolAddress)});w&&w.length>0&&(le.value=!0,$.value=w[0],d.emit("sendFarmsPoolInfo",se.value&&e.isActive?$.value:"")),console.log(w,"##isFarmingPool")};return _e(()=>z.value,i=>{i&&i.length>0&&N(i)},{immediate:!0}),_e(()=>e.isActive,i=>{console.log(e.isActive,"##props.isActive"),i||d.emit("sendFarmsPoolInfo",se.value&&e.isActive?$.value:"")},{immediate:!0}),{isShowAutoStake:le,changeIsOpen:()=>{se.value=!se.value,d.emit("sendFarmsPoolInfo",se.value&&e.isActive?$.value:"")},isOpen:se}}}),Fi=""+globalThis.__publicAssetsURL("sui-image/farming_huo.png");const It=e=>(yt("data-v-26841f53"),e=e(),_t(),e),Bi={key:0,class:"farms-auto-stake"},Ri=It(()=>l("img",{class:"farms-icon",src:Fi,alt:""},null,-1)),Oi=It(()=>l("div",{class:"desc"},"Automatically stake your position into the farm to enjoy higher yield.",-1)),Ui={key:0,src:Gt,alt:""},ji=It(()=>l("div",{class:"check-box"},null,-1));function zi(e,d,ge,le,$,se){const j=Ht;return e.isShowAutoStake?(M(),W("div",Bi,[Ri,Oi,e.isActive?(M(),W("div",{key:0,class:"check-box-active",onClick:d[0]||(d[0]=(...z)=>e.changeIsOpen&&e.changeIsOpen(...z))},[e.isOpen?(M(),W("img",Ui)):Q("",!0)])):(M(),We(j,{key:1,"overlay-style":{"min-width":"200px"}},lo({default:ut(()=>[ji]),_:2},[e.isActive?void 0:{name:"title",fn:ut(()=>[Pt("Farming rewards only available for active positions.")]),key:"0"}]),1024))])):Q("",!0)}const Hi=it($i,[["render",zi],["__scopeId","data-v-26841f53"]]),xi=ot({components:{NewLiquidityTitle:Xt,NewLiquidityAssetsCard:Et,NewLiquidityDepositRatio:Dt},setup(){const{t:e,locale:d}=jt(),ge=Tt(),le=L(()=>ge),$=L(()=>le.value.chainName),se=Bt(),j=L(()=>se),z=go(),N=L(()=>z),ie=Ct(),i=L(()=>{let o=null;for(const c in j.value.poolsObj){const p=j.value.poolsObj[c];p.address==ie.query.poolAddress&&(console.log(p,"p===>"),o=p)}return o}),w=B(!1),V=B(!1),Ce=L(()=>le.value.theme),Ne=async(o,c)=>{_.value=o.needReverse?o.token_b:o.token_a,h.value=o.needReverse?o.token_a:o.token_b,C.value="",S.value=""},ue=L(()=>N.value.assets&&_.value&&N.value.assets[_.value.address]?qt(N.value.assets[_.value.address].balance,_.value.decimals):"0"),f=L(()=>N.value.assets&&h.value&&N.value.assets[h.value.address]?qt(N.value.assets[h.value.address].balance,h.value.decimals):"0"),n=o=>{o==="fromCoin"?(Le.value=!0,$.value==="Aptos"?C.value=Number(ue.value)>0?_.value.symbol=="APT"?new r(Number(ue.value)).sub(new r(.1)).lt(new r(0))?"0":new r(Number(ue.value)).sub(new r(.1)).toString():String(ue.value):"":C.value=Number(ue.value)>0?_.value.symbol=="SUI"?new r(Number(ue.value)).sub(new r(.05)).lt(new r(0))?"0":new r(Number(ue.value)).sub(new r(.05)).toString():String(ue.value):""):(Le.value=!1,$.value==="Aptos"?S.value=Number(f.value)>0?h.value.symbol=="APT"?new r(Number(f.value)).sub(new r(.1)).lt(new r(0))?"0":new r(Number(f.value)).sub(new r(.1)).toString():String(f.value):"":S.value=Number(f.value)>0?h.value.symbol=="SUI"?new r(Number(f.value)).sub(new r(.05)).lt(new r(0))?"0":new r(Number(f.value)).sub(new r(.05)).toString():String(f.value):"")},P=o=>{o==="fromCoin"?(Le.value=!0,C.value=Number(ue.value)>0?pt(new r(Number(ue.value)).div(2).toString(),_.value.decimals).toString():""):(Le.value=!1,S.value=Number(f.value)>0?pt(new r(Number(f.value)).div(2).toString(),h.value.decimals).toString():"")},m=B(),v=B(),R=B(),ee=B(!1),ke=o=>{var c,p,pe,E;m.value=o,o==="fromCoin"?(v.value=((c=h.value)==null?void 0:c.address)||"",R.value=ie.query.actions=="new-position"?(p=_.value)==null?void 0:p.address:i.value.needReverse?i.value.token_b.address:i.value.token_a.address):(v.value=((pe=_.value)==null?void 0:pe.address)||"",R.value=ie.query.actions=="new-position"?(E=h.value)==null?void 0:E.address:i.value.needReverse?i.value.token_a.address:i.value.token_b.address),ee.value=!0,console.log(ee.value,"==>showCoinSelect.value ")},Ie=o=>{var pe,E,ve,be,ne,Y,J,Te;const c=i.value.needReverse?i.value.token_b:i.value.token_a,p=i.value.needReverse?i.value.token_a:i.value.token_b;m.value==="fromCoin"?(((pe=_.value)==null?void 0:pe.address)===(c==null?void 0:c.address)||!((E=_.value)!=null&&E.address)?(h.value&&o.address.toLowerCase()===((ve=h)==null?void 0:ve.value.address.toLowerCase())&&(h.value=null),_.value=o):(_.value&&o.address.toLowerCase()===((be=_)==null?void 0:be.value.address.toLowerCase())&&(_.value=null),h.value=o),ie.query.action||(ie.query.fee="")):((ne=h.value)==null?void 0:ne.address)===(p==null?void 0:p.address)||!((Y=h.value)!=null&&Y.address)?(_.value&&o.address.toLowerCase()===((J=_)==null?void 0:J.value.address.toLowerCase())&&(_.value=null),h.value=o):(h.value&&o.address.toLowerCase()===((Te=h)==null?void 0:Te.value.address.toLowerCase())&&(h.value=null),_.value=o),ee.value=!1},b=L(()=>le.value.chainName?wt(le.value.chainName):{}),q=L(()=>le.value.slippage),H=B(),Pe=async()=>{var Oe,qe,Be,Re;if(Xe.value)return console.log("跳出"),!1;if(!I.value&&!k.value)return!1;if(!C.value&&!S.value&&!I.value&&!k.value)return;const o=i.value||{};if(oe(o))return;const{TickUtil:c,TickMath:p,getNearestTickByTick:pe}=b.value,E=o==null?void 0:o.token_a.decimals,ve=o==null?void 0:o.token_b.decimals;let be,ne,Y,J,Te,$e,xe,De,ye=o==null?void 0:o.current_tick_index,Z;if(o.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===h.value.address.toLowerCase()?Z=!0:Z=!1,I.value==="0"&&k.value==="∞")Y=c.getMinIndex(Number(o.tickSpacing)),J=c.getMaxIndex(Number(o.tickSpacing)),Te=p.tickIndexToSqrtPriceX64(Y),$e=p.tickIndexToSqrtPriceX64(J),console.log(Y,J,"#######updateAmounts 513");else if(D.value=="custom"){console.log(Z,"===>directs1866"),Z?(be=I.value,ne=k.value):(be=k.value!=="∞"?new r(1).div(k.value).toString():1/0,ne=new r(1).div(I.value).toString());try{xe=new r(be).equals(new r(0))?-443636:p.priceToTickIndex(new r(be),E,ve)}catch{xe=-443636}try{De=p.priceToTickIndex(new r(ne),E,ve)}catch{De=443636}console.log("1113###updateAmounts###min###",be),console.log("1113###updateAmounts###max###",ne),console.log("1113###updateAmounts###minTick###",xe),console.log("1113###updateAmounts###maxTick###",De),Y=pe(xe,Number(o.tickSpacing),!0),J=pe(De,Number(o.tickSpacing),!0),console.log("1113###updateAmounts###tick_lower###",Y),console.log("1113###updateAmounts###tick_upper###",J);try{Te=p.priceToSqrtPriceX64(new r(be),E,ve)}catch{(ne===1/0||ne==="∞")&&(Te=p.tickIndexToSqrtPriceX64(c.getMinIndex(Number(o.tickSpacing))))}try{$e=p.priceToSqrtPriceX64(new r(ne),E,ve)}catch{console.log("0523###test###max###",ne),(ne===1/0||ne==="∞")&&(console.log("0523###test###max###11111"),$e=p.tickIndexToSqrtPriceX64(c.getMaxIndex(Number(o.tickSpacing))))}console.log("0518###pre###tick_lower###",Y,J,ye),console.log("0518###pre###tick_upper###",J)}else Y=(Oe=Qe.value[D.value])==null?void 0:Oe.lower,J=(qe=Qe.value[D.value])==null?void 0:qe.upper,Te=p.tickIndexToSqrtPriceX64(Y),$e=p.tickIndexToSqrtPriceX64(J);if(console.log("1116###updateAmounts###tick_lower####",Y),console.log("1116###updateAmounts###tick_upper####",J),console.log("1116###updateAmounts###currentTickIndex####",ye),k.value!=="∞"&&Y>=J){w.value=!0,C.value="",V.value=!0,S.value="";return}if(console.log(J,ye,Y,"1922"),k.value==="∞"||ye>=Y&&ye<J){w.value=!1,V.value=!1;let Se;if(C.value||S.value){if(Le.value){const dt=new r(C.value).mul(Math.pow(10,_.value.decimals)).toString();Se=new ze(dt)}else{const dt=new r(S.value).mul(Math.pow(10,h.value.decimals)).toString();Se=new ze(dt)}console.log(Z,"======>directs"),p.tickIndexToSqrtPriceX64(i.value.current_tick_index);const{liquidityAmount:Ae,tokenMaxA:Ge,tokenMaxB:rt,tokenMaxAOrigin:to,tokenMaxBOrigin:oo}=b.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:o.token_a,tokenB:o.token_b,lowerTick:Y,upperTick:J,coinAmount:Se,iscoinA:Z?Le.value:!Le.value,roundUp:!0,slippage:Number(q.value)/100,curSqrtPrice:new ze(i.value.current_sqrt_price)});H.value={liquidityAmount:Ae,tokenMaxA:Ge,tokenMaxB:rt,tokenMaxAOrigin:to,tokenMaxBOrigin:oo},console.log(Ge,rt,"preAdd"),Z?Le.value?S.value=Number(rt)>0?rt:"":C.value=Number(Ge)>0?Ge:"":Le.value?S.value=Ge:C.value=rt}}else if(ye>=J){if(Z?C.value="":S.value="",w.value=Z,V.value=!Z,C.value||S.value){let Se;if(Z){const Ae=new r(S.value).mul(Math.pow(10,(Be=h.value)==null?void 0:Be.decimals)).toString();Se=new ze(Ae),H.value={liquidityAmount:b.value.estimateLiquidityForCoinB(Te,$e,Se),tokenMaxA:0,tokenMaxB:S.value}}else{const Ae=new r(C.value).mul(Math.pow(10,(Re=_.value)==null?void 0:Re.decimals)).toString();Se=new ze(Ae),H.value={liquidityAmount:b.value.estimateLiquidityForCoinB(Te,$e,Se),tokenMaxA:0,tokenMaxB:C.value}}}}else if(ye<Y){if(w.value=!Z,V.value=Z,Z?S.value="":C.value="",C.value||S.value){let Se;if(Z){const Ae=new r(C.value).mul(Math.pow(10,_.value.decimals)).toString();Se=new ze(Ae),H.value={liquidityAmount:b.value.estimateLiquidityForCoinA(Te,$e,Se),tokenMaxA:C.value,tokenMaxB:0}}else{const Ae=new r(S.value).mul(Math.pow(10,h.value.decimals)).toString();Se=new ze(Ae),H.value={liquidityAmount:b.value.estimateLiquidityForCoinA(Te,$e,Se),tokenMaxA:S.value,tokenMaxB:0}}}}else w.value=!0,C.value="",V.value=!0,S.value=""};_e(()=>i.value,(o,c)=>{console.log(c,"===>oldVal"),console.log(o,"===>newVal"),(!c&&o&&!oe(o)||c&&o&&c.address!==o.address)&&(console.log("池子信息"),Ne(o,!c||o.address!==c.address)),o&&!oe(o)&&Pe()},{immediate:!0}),_e(C,(o,c)=>{console.log(C,"===>fromCoinAmount"),o==""&&Le.value&&(S.value=""),o&&Le.value&&!Xe.value&&Pe()}),_e(S,(o,c)=>{console.log(o,"===>>>>newValsda"),o==""&&!Le.value&&(C.value=""),o&&!Le.value&&!Xe.value&&Pe()}),_e(()=>re.value,(o,c)=>{Pe()}),_e(()=>[_.value,h.value],([o,c])=>{o&&c&&(w.value=!1,V.value=!1)});const y=B("--"),O=L(()=>j.value.RATES),G=()=>{const o=O.value&&O.value[_.value.address]&&O.value[_.value.address].price,c=O.value&&O.value[h.value.address]&&O.value[h.value.address].price;if(o&&c){const p=new r(C.value>0?C.value:0).mul(o),pe=new r(S.value>0?S.value:0).mul(c),E=p.add(pe).toNumber();y.value=E>0&&E<.01?"<$0.01":"$"+Fe(E,2)}else y.value="--"};_e(()=>[C.value,S.value,Xe.value],([o,c,p])=>{(o||c)&&!p?G():(!o||!c)&&!p&&(y.value="--")},{immediate:!0}),_e(()=>y,o=>{console.log(o,"71911111")},{immediate:!0});const K=B(),U=async()=>{var Z,Oe;if(!I.value&&!k.value)return!1;if(!C.value&&!S.value&&!I.value&&!k.value)return;const o=i.value;if(oe(o))return;const{TickUtil:c,TickMath:p,getNearestTickByTick:pe}=b.value,E=o==null?void 0:o.token_a.decimals,ve=o==null?void 0:o.token_b.decimals;let be,ne,Y,J,Te,$e,xe;if(o.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===h.value.address.toLowerCase()?xe=!0:xe=!1,I.value==="0"&&k.value==="∞")Y=c.getMinIndex(Number(o.tickSpacing)),J=c.getMaxIndex(Number(o.tickSpacing));else if(D.value=="custom"){xe?(be=Number(I.value),ne=Number(k.value)):(be=new r(1).div(k.value).toString(),ne=new r(1).div(I.value).toString());try{Te=be==0?-443636:p.priceToTickIndex(new r(be),E,ve)}catch{Te=-443636}try{$e=p.priceToTickIndex(new r(ne),E,ve)}catch{$e=443636}Y=pe(Te,Number(o.tickSpacing),!0),J=pe($e,Number(o.tickSpacing),!0)}else Y=(Z=Qe.value[D.value])==null?void 0:Z.lower,J=(Oe=Qe.value[D.value])==null?void 0:Oe.upper;const De=O.value[o==null?void 0:o.token_a.address].price,ye=O.value[o==null?void 0:o.token_b.address].price;re.value?new ze(o.current_sqrt_price):new ze(1/o.current_sqrt_price),console.log(re.value,"===>direction.value"),console.log(o,"poolInfos===>"),console.log(Y,J,"####tick_lower tick_upper 889"),console.log(y.value,"liquidityTotalAmount.value");try{const{amountA:qe,amountB:Be,tokenAmountsInfo:Re}=await b.value.estCoinAmountsFromTotalAmount({lowerTick:Y,upperTick:J,decimalsA:E,decimalsB:ve,curSqrtPrice:new ze(o.current_sqrt_price),totalAmount:y.value.replace(/[^\d.]/g,""),tokenPriceA:De,tokenPriceB:ye});console.log(qe,Be,"###estCoinAmountsFromTotalAmount 844"),console.log(o.needReverse,re.value,"===>849"),K.value=Re,o.needReverse?re.value?(C.value=qe,S.value=Be):(C.value=Be,S.value=qe):(C.value=qe,S.value=Be)}catch(qe){console.log(qe,"e===>")}};_e([I,k],([o,c])=>{console.log(o,c,"==>minPrice,maxPrice"),Xe.value?Xe.value&&U():Pe(),c!=="∞"&&Number(o)!==0&&Number(c)!==0&&Number(o)>=Number(c)?et.value=!0:et.value=!1,Number(o)==0&&Number(c)==0&&tt.value&&(et.value=!0,console.log("价格区间错误"))},{deep:!0,immediate:!0});const je=o=>{console.log(o,"e");const c=o.replace(/[^\d.]/g,""),p="$"+Fe(c);Xe.value=!0,y.value=p,c>0?U():(C.value="",S.value="")},A=B(!1),{setTransactionTxid:ce,setTransactionDesc:Ke,setIsShowWaiting:Me,setIsShowSuccess:nt,setPositiomNum:Ye,setIsShowRejected:Je}=ge,Ze=_o(),X=L(()=>j.value.currentPositionInfo),at=B(!1),t=B(!0),s=St(),g=L(()=>s),T=L(()=>g.value.farmsPoolObj);_e(()=>[T.value,i.value],([o,c])=>{o&&!oe(o)&&c&&!oe(c)&&(o[c.address]||(t.value=!1))},{immediate:!0});const F=B(),x=o=>{console.log(o,"getFarmsPoolInfo:"),F.value=o,o||(t.value=!1)},de=async o=>{var Te,$e,xe,De;console.log(i.value,"===> poolInfo.value"),console.log(F.value,"##farmPoolInfo"),A.value=!1,j.value.currentPositionInfo={},ce(""),Ke(e("tips.increaseLiquiditySuccess",{from:w.value?"":`${Fe(C.value)} ${(Te=_.value)==null?void 0:Te.symbol}`,and:!w.value&&!V.value?"and":"",to:V.value?"":`${Fe(S.value)} ${($e=h.value)==null?void 0:$e.symbol}`})),Me(!0);const c=re.value?Le.value:!Le.value;let p,pe,E,ve,be,ne;const Y=i.value.token_a.decimals,J=i.value.token_b.decimals;if(I.value==="0"&&k.value==="∞")E=b.value.TickUtil.getMinIndex(Number(i.value.tickSpacing)),ve=b.value.TickUtil.getMaxIndex(Number(i.value.tickSpacing));else if(D.value=="custom"){re.value?(p=I.value,pe=k.value):(p=new r(1).div(k.value).toString(),pe=new r(1).div(I.value).toString()),console.log("0519###toAdd###min###",p),console.log("0519###toAdd###max###",pe),console.log("0519###toAdd###minPrice.value###",I.value),console.log("0519###toAdd###maxPrice.value###",k.value);try{be=p==0?b.value.TickUtil.getMinIndex(Number(i.value.tickSpacing)):b.value.TickMath.priceToTickIndex(new r(p),Y,J)}catch{be=b.value.TickUtil.getMinIndex(Number(i.value.tickSpacing))}try{ne=b.value.TickMath.priceToTickIndex(new r(pe),Y,J)}catch{ne=b.value.TickUtil.getMaxIndex(Number(i.value.tickSpacing))}E=b.value.getNearestTickByTick(be,Number(i.value.tickSpacing),!0),ve=b.value.getNearestTickByTick(ne,Number(i.value.tickSpacing),!0)}else E=Qe.value[D.value].lower,ve=Qe.value[D.value].upper;console.log(E,ve,"####tick_lower tick_upper 889"),console.log(i.value,"==>poolInfo.value.curSqrtPrice"),console.log("1202###Add###tick_lower####",E),console.log("1202###Add###tick_upper####",ve),console.log("1202###Add###poolInfo.value####",i.value);try{let ye;Xe.value?ye=await b.value.getCreateAddLiquidityPayload({pool:i.value,curSqrtPrice:new ze(i.value.current_sqrt_price),tickLower:E,tickUpper:ve,slippage:Number(q.value)/100,tokenAmounts:K.value}):ye=await b.value.getAddLiquidityTransactionPayload({pool:{poolAddress:i.value.poolAddress,token_a:i.value.token_a,token_b:i.value.token_b},amount:Le.value?C.value:S.value,fix_amount_a:c,tick_lower:E,tick_upper:ve,index:0,slippage:Number(q.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new ze(i.value.current_sqrt_price),farmPoolInfo:F.value}),console.log(ye,"payload===?");let Z;if($.value==="Aptos")Z=await N.value.currentWallet.signAndSubmitTransaction(ye);else{const Oe=await N.value.currentWallet.signAndExecuteTransactionBlock(ye);Z=b.value.handleTx(Oe)}if(console.log("0410###tx###",Z),Z&&Z.hash){ce(Z.hash),Me(!1),nt(!0);let Oe;i.value.needReverse?i.value.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&i.value.token_b.address.toLowerCase()===h.value.address.toLowerCase()?Oe=!1:Oe=!0:i.value.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&i.value.token_b.address.toLowerCase()===h.value.address.toLowerCase()?Oe=!0:Oe=!1,console.log(Oe,"===>directs");const qe={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:w.value?"":`${Fe(C.value)} ${(xe=_.value)==null?void 0:xe.symbol}`,and:!w.value&&!V.value?"and":"",to:V.value?"":`${Fe(S.value)} ${(De=h.value)==null?void 0:De.symbol}`}),hash:Z.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};$.value!=="Aptos"&&(qe.res=Z.res),b.value.showTransitionPending(qe),console.log(qe,"toAdd params###");const Be=await b.value.watchTransaction(qe,!0);if(Be.status){if(nt(!1),j.value.setCurrentPositionLoading(!0),at.value=!0,console.log(Be.nftInfo,"===> watchInfo.nftInfo"),$.value==="Aptos"){if(await j.value.setCurrentPositionInfo(Be.nftInfo[0].data.id.creator,Be.nftInfo[0].data.id.collection,Be.nftInfo[0].data.name,$.value),o)try{await Ze.subscribePosition({pool_address:X.value.poolAddress,position_index:X.value.index},X.value.nftHash)}catch(Re){console.log(Re,"e")}}else{const Re=Be.nftInfo,Se=await Nt(2e3);if(t.value){let Ae;Z.res.events.forEach(Ge=>{Ge.type.indexOf("::pool::DepositEvent")>-1&&(Ae=Ge.parsedJson.wrapped_position_id)}),console.log(Ae,"###farmPositionId"),await j.value.setCurrentPositionInfo("","","","Sui",Ae,"farming")}else await j.value.setCurrentPositionInfo(Re==null?void 0:Re.pool,"","",$.value,Re==null?void 0:Re.position);if(await Nt(1e3),console.log("0529###nftInfo###",Re),console.log("0529###currentPositionInfo.value.index###",X.value),o&&!t.value)try{await Ze.subscribePosition({pool_address:X.value.poolAddress,position_index:X.value.index},X.value.nftHash)}catch(Ae){console.log(Ae)}else if(o&&t.value)try{await Ze.subscribePosition({pool_address:X.value.clmm_pool_id,position_index:X.value.name.split("-")[1]},X.value.clmm_position_id)}catch(Ae){console.log(Ae)}}setTimeout(()=>{se.updateCurrentPools(i.value.poolAddress,$.value),b.value.getAccount(N.value.address)},3e3),setTimeout(async()=>{$t(b,i)},3e3)}Ye()}else Me(!1),Je(!0);C.value="",S.value=""}catch(ye){C.value="",S.value="",console.log("0330###Add liquidity Error###",ye),Me(!1),Je(!0)}},Ee=L(()=>!C.value&&!S.value?(console.log("addLiquidityBtnDisabled11111"),!0):Number(C.value)>Number(ue.value)||Number(S.value)>Number(f.value)?(console.log("addLiquidityBtnDisabled22222"),!0):a.value!==e("button.addLiquidity")&&a.value!==e("newAdd.preview")?(console.log("addLiquidityBtnDisabled33333###",a.value),!0):i.value&&i.value&&i.value.is_pause?(console.log("addLiquidityBtnDisabled44444"),!0):Number(C.value)<=0&&Number(S.value)<=0||!w.value&&Number(C.value)==0||!V.value&&Number(S.value)==0),u=L(()=>!_.value||!h.value),a=L(()=>i.value&&i.value.is_pause?"Pool Closed":!_.value||!h.value||u.value?e("modal.selectTokenModalTitle"):Number(C.value)>Number(ue.value)?e("button.insufficientBalance",{name:_.value.symbol}):Number(S.value)>Number(f.value)?e("button.insufficientBalance",{name:h.value.symbol}):!Number(C.value)&&!Number(S.value)?e("button.enterAmount"):k.value!=="∞"&&Number(I.value)>=Number(k.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),me=B({}),te=B({}),we=B(!1),At=(o,c)=>{console.log(m.value,"===>currentCoinKey.value"),console.log(o);const p=localStorage.getItem(o.address);console.log(j.value.tokensObj,"===>pools.value.tokensObj"),console.log(p,"===>coinLocak"),j.value.tokensObj&&j.value.tokensObj[o.address]&&j.value.tokensObj[o.address].isSelfBuilt&&!p&&(c=="fromCoin"&&(me.value=o),c=="toCoin"&&(te.value=o),we.value=!0)};_e(()=>[_.value,h.value],([o,c])=>{o&&!oe(o)&&At(o,"fromCoin"),c&&!oe(c)&&At(c,"toCoin")},{immediate:!0});const Lt=so(),Qt=()=>{$.value!=="Aptos"?Lt.push("/pool/list"):Lt.push("/pools")},Yt=o=>{Xe.value,de(o)},Vt=()=>{ie.query.action!=="create-pool"&&ie.query.actions!=="new-position"&&($t(b,i),Pe(),se.updateCurrentPools(i.value.poolAddress,$.value)),se.setPoolConfigList($.value,le.value.filterCoinsObj)},eo=L(()=>{var p,pe,E,ve,be,ne;const o=(E=O.value[(pe=(p=_)==null?void 0:p.value)==null?void 0:pe.address])==null?void 0:E.price,c=(ne=O.value[(be=(ve=h)==null?void 0:ve.value)==null?void 0:be.address])==null?void 0:ne.price;return!!(o&&c)});return _e(()=>[ie,j.value.tokensObj],([o,c])=>{var p;c&&!oe(c)&&(h.value||(h.value=j.value.tokensObj[(p=o==null?void 0:o.query)==null?void 0:p.toCoin]))},{immediate:!0,deep:!0}),{positionError:et,decimalUi:he,poolInfo:i,fromCoinAmount:C,toCoinAmount:S,fromCoin:_,toCoin:h,theme:Ce,showFromCoinLock:w,showToCoinLock:V,fromCoinBlance:ue,toCoinBlance:f,maxBtnSelect:n,halfBtnSelect:P,fixedFromCoin:Le,openCoinSelect:ke,currentCoinKey:m,existingCoins:v,lastSelectCoin:R,showCoinSelect:ee,onCoinSelect:Ie,liquidityTotalAmount:y,toggle:Wt,onInput:je,isInputTotalAmount:Xe,isViewDetail:at,addLiquidityBtnDisabled:Ee,addLiquidityBtnText:a,isShowTokenWarning:we,chainName:$,closeTokenWarning:Qt,warningFromCoin:me,warningToCoin:te,isShowLiquidityModal:A,currentPrice:tt,currentPriceReverse:st,currentPriceTab:D,minPrice:I,maxPrice:k,toAdd:de,direction:re,wallet:N,getAddLiquidityType:Yt,clickRefresh:Vt,isShowtotalAmount:eo,isAutoStakeFarming:t,farmPoolInfo:F,getFarmsPoolInfo:x}}});const Xi={class:"new-liquidity-right"},Ei={class:"deposit-title"},Di={class:"card-container"},Wi={key:0,class:"lock"},Zi={class:"card-item"},Gi={class:"card-item"},Ki={key:0,class:"total-amount"},Ji=l("span",null,"Total Amount",-1);function Qi(e,d,ge,le,$,se){const j=Xt,z=po,N=Et,ie=ho,i=Dt,w=uo,V=ko,Ce=wo,Ne=yo,ue=Hi;return M(),W("div",Xi,[l("div",Ei,[He(j,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),l("div",Di,[e.positionError?(M(),W("div",Wi,[He(z)])):Q("",!0),l("div",Zi,[He(N,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":d[0]||(d[0]=f=>e.fromCoinAmount=f),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:d[1]||(d[1]=f=>e.maxBtnSelect("fromCoin")),onOnHalf:d[2]||(d[2]=f=>e.halfBtnSelect("fromCoin")),onOnInput:d[3]||(d[3]=f=>{e.fromCoinAmount=f,e.fixedFromCoin=!0,e.isInputTotalAmount=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock&&!e.positionError?(M(),We(ie,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):Q("",!0)]),l("div",Gi,[He(N,{modelValue:e.toCoinAmount,"onUpdate:modelValue":d[4]||(d[4]=f=>e.toCoinAmount=f),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:d[5]||(d[5]=f=>e.maxBtnSelect("toCoin")),onOnHalf:d[6]||(d[6]=f=>e.halfBtnSelect("toCoin")),onOnInput:d[7]||(d[7]=f=>{e.toCoinAmount=f,e.fixedFromCoin=!1,e.isInputTotalAmount=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock&&!e.positionError?(M(),We(ie,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):Q("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(M(),W("img",{key:1,class:"add",src:Co,alt:"",onClick:d[8]||(d[8]=(...f)=>e.toggle&&e.toggle(...f))})):Q("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(M(),W("img",{key:2,class:"add",src:Po,alt:"",onClick:d[9]||(d[9]=(...f)=>e.toggle&&e.toggle(...f))})):Q("",!0)]),e.isShowtotalAmount?(M(),W("div",Ki,[Ji,l("span",null,ae(e.liquidityTotalAmount)+" ",1)])):Q("",!0),He(i,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),He(w,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:d[10]||(d[10]=f=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:ut(()=>[Pt(ae(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(M(),We(V,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:d[11]||(d[11]=f=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):Q("",!0),e.isViewDetail?(M(),We(Ce,{key:2,"pool-info":e.poolInfo,"farm-pool-info":e.farmPoolInfo,"is-auto-stake-farming":e.isAutoStakeFarming,onOnClose:d[12]||(d[12]=f=>e.isViewDetail=!1)},null,8,["pool-info","farm-pool-info","is-auto-stake-farming"])):Q("",!0),e.isShowLiquidityModal?(M(),We(Ne,{key:3,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:d[13]||(d[13]=f=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):Q("",!0),e.chainName=="Sui"?(M(),We(ue,{key:4,"pool-info":e.poolInfo,"is-active":!e.showFromCoinLock&&!e.showToCoinLock,"is-auto-stake-farming":e.isAutoStakeFarming,onSendFarmsPoolInfo:e.getFarmsPoolInfo},null,8,["pool-info","is-active","is-auto-stake-farming","onSendFarmsPoolInfo"])):Q("",!0)])}const Jt=it(xi,[["render",Qi]]),Yi=ot({components:{NewLiquidityLeft:Kt,NewLiquidityRight:Jt},setup(){zt(()=>{bo()});const e=Ct();return{tickList:Ve,route:e}}});const Vi={key:0,class:"loading-spin-liquidity loading-global"},en={class:"privide-liquidity"};function tn(e,d,ge,le,$,se){var ie,i;const j=Ut,z=Kt,N=Jt;return M(),W(ht,null,[!e.tickList&&((i=(ie=e.route)==null?void 0:ie.query)!=null&&i.poolAddress)?(M(),W("div",Vi,[He(j)])):Q("",!0),l("div",en,[He(z),He(N)])],64)}const Bn=it(Yi,[["render",tn],["__scopeId","data-v-fc58011a"]]);export{Bn as default};
