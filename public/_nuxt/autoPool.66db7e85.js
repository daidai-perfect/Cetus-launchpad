var qr=Object.defineProperty;var Tr=(t,e,i)=>e in t?qr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Ht=(t,e,i)=>(Tr(t,typeof e!="symbol"?e+"":e,i),i);import{m as Br,C as Nr,D as Pr}from"./entry.1afe32c4.js";import{aM as Or,V as Er,e as jt,aN as Ce,aO as qi,aP as Me,m as X,p as D,T as Xt,H as Qt,Y as Ue,X as Jt,a1 as ge,aQ as $i,aR as re,aS as Ui,aT as Ir,aU as Vi,aV as xr,aW as Lr,aX as Zi,aH as Wt,ar as Ti,W as te,c as Kt,S as Rr,u as jr,k as Dt,b as Hi,B as Re,h as je}from"./index.c41a185a.js";import{D as E}from"./decimal.0bdeb344.js";import{E as Wi}from"./index.08ca7d22.js";import{k as we,u as Fr,c as Gi,m as Xi,p as Ne}from"./pool.83f6439f.js";import{r as Dr,a as $r}from"./index.3f134baf.js";var yi=Dr,Ur=$r,Vr=Object.create,Bi=Object.defineProperty,Zr=Object.defineProperties,Hr=Object.getOwnPropertyDescriptor,Wr=Object.getOwnPropertyDescriptors,hr=Object.getOwnPropertyNames,Ki=Object.getOwnPropertySymbols,Gr=Object.getPrototypeOf,dr=Object.prototype.hasOwnProperty,Xr=Object.prototype.propertyIsEnumerable,zi=(t,e,i)=>e in t?Bi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Kr=(t,e)=>{for(var i in e||(e={}))dr.call(e,i)&&zi(t,i,e[i]);if(Ki)for(var i of Ki(e))Xr.call(e,i)&&zi(t,i,e[i]);return t},zr=(t,e)=>Zr(t,Wr(e)),Jr=(t=>typeof we<"u"?we:typeof Proxy<"u"?new Proxy(t,{get:(e,i)=>(typeof we<"u"?we:e)[i]}):t)(function(t){if(typeof we<"u")return we.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),Yr=(t,e)=>function(){return e||(0,t[hr(t)[0]])((e={exports:{}}).exports,e),e.exports},Qr=(t,e,i,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of hr(e))!dr.call(t,r)&&r!==i&&Bi(t,r,{get:()=>e[r],enumerable:!(n=Hr(e,r))||n.enumerable});return t},Te=(t,e,i)=>(i=t!=null?Vr(Gr(t)):{},Qr(!t||!t.__esModule?Bi(i,"default",{value:t,enumerable:!0}):i,t)),nt=(t,e,i)=>new Promise((n,r)=>{var a=d=>{try{c(i.next(d))}catch(h){r(h)}},s=d=>{try{c(i.throw(d))}catch(h){r(h)}},c=d=>d.done?n(d.value):Promise.resolve(d.value).then(a,s);c((i=i.apply(t,e)).next())}),Be=Yr({"node_modules/bn.js/lib/bn.js"(t,e){(function(i,n){function r(y,o){if(!y)throw new Error(o||"Assertion failed")}function a(y,o){y.super_=o;var l=function(){};l.prototype=o.prototype,y.prototype=new l,y.prototype.constructor=y}function s(y,o,l){if(s.isBN(y))return y;this.negative=0,this.words=null,this.length=0,this.red=null,y!==null&&((o==="le"||o==="be")&&(l=o,o=10),this._init(y||0,o||10,l||"be"))}typeof i=="object"?i.exports=s:n.BN=s,s.BN=s,s.wordSize=26;var c;try{typeof window<"u"&&typeof window.Buffer<"u"?c=window.Buffer:c=Jr("buffer").Buffer}catch{}s.isBN=function(o){return o instanceof s?!0:o!==null&&typeof o=="object"&&o.constructor.wordSize===s.wordSize&&Array.isArray(o.words)},s.max=function(o,l){return o.cmp(l)>0?o:l},s.min=function(o,l){return o.cmp(l)<0?o:l},s.prototype._init=function(o,l,p){if(typeof o=="number")return this._initNumber(o,l,p);if(typeof o=="object")return this._initArray(o,l,p);l==="hex"&&(l=16),r(l===(l|0)&&l>=2&&l<=36),o=o.toString().replace(/\s+/g,"");var _=0;o[0]==="-"&&(_++,this.negative=1),_<o.length&&(l===16?this._parseHex(o,_,p):(this._parseBase(o,l,_),p==="le"&&this._initArray(this.toArray(),l,p)))},s.prototype._initNumber=function(o,l,p){o<0&&(this.negative=1,o=-o),o<67108864?(this.words=[o&67108863],this.length=1):o<4503599627370496?(this.words=[o&67108863,o/67108864&67108863],this.length=2):(r(o<9007199254740992),this.words=[o&67108863,o/67108864&67108863,1],this.length=3),p==="le"&&this._initArray(this.toArray(),l,p)},s.prototype._initArray=function(o,l,p){if(r(typeof o.length=="number"),o.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(o.length/3),this.words=new Array(this.length);for(var _=0;_<this.length;_++)this.words[_]=0;var v,A,M=0;if(p==="be")for(_=o.length-1,v=0;_>=0;_-=3)A=o[_]|o[_-1]<<8|o[_-2]<<16,this.words[v]|=A<<M&67108863,this.words[v+1]=A>>>26-M&67108863,M+=24,M>=26&&(M-=26,v++);else if(p==="le")for(_=0,v=0;_<o.length;_+=3)A=o[_]|o[_+1]<<8|o[_+2]<<16,this.words[v]|=A<<M&67108863,this.words[v+1]=A>>>26-M&67108863,M+=24,M>=26&&(M-=26,v++);return this._strip()};function d(y,o){var l=y.charCodeAt(o);if(l>=48&&l<=57)return l-48;if(l>=65&&l<=70)return l-55;if(l>=97&&l<=102)return l-87;r(!1,"Invalid character in "+y)}function h(y,o,l){var p=d(y,l);return l-1>=o&&(p|=d(y,l-1)<<4),p}s.prototype._parseHex=function(o,l,p){this.length=Math.ceil((o.length-l)/6),this.words=new Array(this.length);for(var _=0;_<this.length;_++)this.words[_]=0;var v=0,A=0,M;if(p==="be")for(_=o.length-1;_>=l;_-=2)M=h(o,l,_)<<v,this.words[A]|=M&67108863,v>=18?(v-=18,A+=1,this.words[A]|=M>>>26):v+=8;else{var m=o.length-l;for(_=m%2===0?l+1:l;_<o.length;_+=2)M=h(o,l,_)<<v,this.words[A]|=M&67108863,v>=18?(v-=18,A+=1,this.words[A]|=M>>>26):v+=8}this._strip()};function f(y,o,l,p){for(var _=0,v=0,A=Math.min(y.length,l),M=o;M<A;M++){var m=y.charCodeAt(M)-48;_*=p,m>=49?v=m-49+10:m>=17?v=m-17+10:v=m,r(m>=0&&v<p,"Invalid character"),_+=v}return _}s.prototype._parseBase=function(o,l,p){this.words=[0],this.length=1;for(var _=0,v=1;v<=67108863;v*=l)_++;_--,v=v/l|0;for(var A=o.length-p,M=A%_,m=Math.min(A,A-M)+p,u=0,w=p;w<m;w+=_)u=f(o,w,w+_,l),this.imuln(v),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u);if(M!==0){var $=1;for(u=f(o,w,o.length,l),w=0;w<M;w++)$*=l;this.imuln($),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u)}this._strip()},s.prototype.copy=function(o){o.words=new Array(this.length);for(var l=0;l<this.length;l++)o.words[l]=this.words[l];o.length=this.length,o.negative=this.negative,o.red=this.red};function g(y,o){y.words=o.words,y.length=o.length,y.negative=o.negative,y.red=o.red}if(s.prototype._move=function(o){g(o,this)},s.prototype.clone=function(){var o=new s(null);return this.copy(o),o},s.prototype._expand=function(o){for(;this.length<o;)this.words[this.length++]=0;return this},s.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},s.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{s.prototype[Symbol.for("nodejs.util.inspect.custom")]=b}catch{s.prototype.inspect=b}else s.prototype.inspect=b;function b(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var C=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],S=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],k=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];s.prototype.toString=function(o,l){o=o||10,l=l|0||1;var p;if(o===16||o==="hex"){p="";for(var _=0,v=0,A=0;A<this.length;A++){var M=this.words[A],m=((M<<_|v)&16777215).toString(16);v=M>>>24-_&16777215,_+=2,_>=26&&(_-=26,A--),v!==0||A!==this.length-1?p=C[6-m.length]+m+p:p=m+p}for(v!==0&&(p=v.toString(16)+p);p.length%l!==0;)p="0"+p;return this.negative!==0&&(p="-"+p),p}if(o===(o|0)&&o>=2&&o<=36){var u=S[o],w=k[o];p="";var $=this.clone();for($.negative=0;!$.isZero();){var I=$.modrn(w).toString(o);$=$.idivn(w),$.isZero()?p=I+p:p=C[u-I.length]+I+p}for(this.isZero()&&(p="0"+p);p.length%l!==0;)p="0"+p;return this.negative!==0&&(p="-"+p),p}r(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var o=this.words[0];return this.length===2?o+=this.words[1]*67108864:this.length===3&&this.words[2]===1?o+=4503599627370496+this.words[1]*67108864:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-o:o},s.prototype.toJSON=function(){return this.toString(16,2)},c&&(s.prototype.toBuffer=function(o,l){return this.toArrayLike(c,o,l)}),s.prototype.toArray=function(o,l){return this.toArrayLike(Array,o,l)};var T=function(o,l){return o.allocUnsafe?o.allocUnsafe(l):new o(l)};s.prototype.toArrayLike=function(o,l,p){this._strip();var _=this.byteLength(),v=p||Math.max(1,_);r(_<=v,"byte array longer than desired length"),r(v>0,"Requested array length <= 0");var A=T(o,v),M=l==="le"?"LE":"BE";return this["_toArrayLike"+M](A,_),A},s.prototype._toArrayLikeLE=function(o,l){for(var p=0,_=0,v=0,A=0;v<this.length;v++){var M=this.words[v]<<A|_;o[p++]=M&255,p<o.length&&(o[p++]=M>>8&255),p<o.length&&(o[p++]=M>>16&255),A===6?(p<o.length&&(o[p++]=M>>24&255),_=0,A=0):(_=M>>>24,A+=2)}if(p<o.length)for(o[p++]=_;p<o.length;)o[p++]=0},s.prototype._toArrayLikeBE=function(o,l){for(var p=o.length-1,_=0,v=0,A=0;v<this.length;v++){var M=this.words[v]<<A|_;o[p--]=M&255,p>=0&&(o[p--]=M>>8&255),p>=0&&(o[p--]=M>>16&255),A===6?(p>=0&&(o[p--]=M>>24&255),_=0,A=0):(_=M>>>24,A+=2)}if(p>=0)for(o[p--]=_;p>=0;)o[p--]=0},Math.clz32?s.prototype._countBits=function(o){return 32-Math.clz32(o)}:s.prototype._countBits=function(o){var l=o,p=0;return l>=4096&&(p+=13,l>>>=13),l>=64&&(p+=7,l>>>=7),l>=8&&(p+=4,l>>>=4),l>=2&&(p+=2,l>>>=2),p+l},s.prototype._zeroBits=function(o){if(o===0)return 26;var l=o,p=0;return l&8191||(p+=13,l>>>=13),l&127||(p+=7,l>>>=7),l&15||(p+=4,l>>>=4),l&3||(p+=2,l>>>=2),l&1||p++,p},s.prototype.bitLength=function(){var o=this.words[this.length-1],l=this._countBits(o);return(this.length-1)*26+l};function N(y){for(var o=new Array(y.bitLength()),l=0;l<o.length;l++){var p=l/26|0,_=l%26;o[l]=y.words[p]>>>_&1}return o}s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var o=0,l=0;l<this.length;l++){var p=this._zeroBits(this.words[l]);if(o+=p,p!==26)break}return o},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(o){return this.negative!==0?this.abs().inotn(o).iaddn(1):this.clone()},s.prototype.fromTwos=function(o){return this.testn(o-1)?this.notn(o).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return this.negative!==0},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(o){for(;this.length<o.length;)this.words[this.length++]=0;for(var l=0;l<o.length;l++)this.words[l]=this.words[l]|o.words[l];return this._strip()},s.prototype.ior=function(o){return r((this.negative|o.negative)===0),this.iuor(o)},s.prototype.or=function(o){return this.length>o.length?this.clone().ior(o):o.clone().ior(this)},s.prototype.uor=function(o){return this.length>o.length?this.clone().iuor(o):o.clone().iuor(this)},s.prototype.iuand=function(o){var l;this.length>o.length?l=o:l=this;for(var p=0;p<l.length;p++)this.words[p]=this.words[p]&o.words[p];return this.length=l.length,this._strip()},s.prototype.iand=function(o){return r((this.negative|o.negative)===0),this.iuand(o)},s.prototype.and=function(o){return this.length>o.length?this.clone().iand(o):o.clone().iand(this)},s.prototype.uand=function(o){return this.length>o.length?this.clone().iuand(o):o.clone().iuand(this)},s.prototype.iuxor=function(o){var l,p;this.length>o.length?(l=this,p=o):(l=o,p=this);for(var _=0;_<p.length;_++)this.words[_]=l.words[_]^p.words[_];if(this!==l)for(;_<l.length;_++)this.words[_]=l.words[_];return this.length=l.length,this._strip()},s.prototype.ixor=function(o){return r((this.negative|o.negative)===0),this.iuxor(o)},s.prototype.xor=function(o){return this.length>o.length?this.clone().ixor(o):o.clone().ixor(this)},s.prototype.uxor=function(o){return this.length>o.length?this.clone().iuxor(o):o.clone().iuxor(this)},s.prototype.inotn=function(o){r(typeof o=="number"&&o>=0);var l=Math.ceil(o/26)|0,p=o%26;this._expand(l),p>0&&l--;for(var _=0;_<l;_++)this.words[_]=~this.words[_]&67108863;return p>0&&(this.words[_]=~this.words[_]&67108863>>26-p),this._strip()},s.prototype.notn=function(o){return this.clone().inotn(o)},s.prototype.setn=function(o,l){r(typeof o=="number"&&o>=0);var p=o/26|0,_=o%26;return this._expand(p+1),l?this.words[p]=this.words[p]|1<<_:this.words[p]=this.words[p]&~(1<<_),this._strip()},s.prototype.iadd=function(o){var l;if(this.negative!==0&&o.negative===0)return this.negative=0,l=this.isub(o),this.negative^=1,this._normSign();if(this.negative===0&&o.negative!==0)return o.negative=0,l=this.isub(o),o.negative=1,l._normSign();var p,_;this.length>o.length?(p=this,_=o):(p=o,_=this);for(var v=0,A=0;A<_.length;A++)l=(p.words[A]|0)+(_.words[A]|0)+v,this.words[A]=l&67108863,v=l>>>26;for(;v!==0&&A<p.length;A++)l=(p.words[A]|0)+v,this.words[A]=l&67108863,v=l>>>26;if(this.length=p.length,v!==0)this.words[this.length]=v,this.length++;else if(p!==this)for(;A<p.length;A++)this.words[A]=p.words[A];return this},s.prototype.add=function(o){var l;return o.negative!==0&&this.negative===0?(o.negative=0,l=this.sub(o),o.negative^=1,l):o.negative===0&&this.negative!==0?(this.negative=0,l=o.sub(this),this.negative=1,l):this.length>o.length?this.clone().iadd(o):o.clone().iadd(this)},s.prototype.isub=function(o){if(o.negative!==0){o.negative=0;var l=this.iadd(o);return o.negative=1,l._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(o),this.negative=1,this._normSign();var p=this.cmp(o);if(p===0)return this.negative=0,this.length=1,this.words[0]=0,this;var _,v;p>0?(_=this,v=o):(_=o,v=this);for(var A=0,M=0;M<v.length;M++)l=(_.words[M]|0)-(v.words[M]|0)+A,A=l>>26,this.words[M]=l&67108863;for(;A!==0&&M<_.length;M++)l=(_.words[M]|0)+A,A=l>>26,this.words[M]=l&67108863;if(A===0&&M<_.length&&_!==this)for(;M<_.length;M++)this.words[M]=_.words[M];return this.length=Math.max(this.length,M),_!==this&&(this.negative=1),this._strip()},s.prototype.sub=function(o){return this.clone().isub(o)};function q(y,o,l){l.negative=o.negative^y.negative;var p=y.length+o.length|0;l.length=p,p=p-1|0;var _=y.words[0]|0,v=o.words[0]|0,A=_*v,M=A&67108863,m=A/67108864|0;l.words[0]=M;for(var u=1;u<p;u++){for(var w=m>>>26,$=m&67108863,I=Math.min(u,o.length-1),R=Math.max(0,u-y.length+1);R<=I;R++){var st=u-R|0;_=y.words[st]|0,v=o.words[R]|0,A=_*v+$,w+=A/67108864|0,$=A&67108863}l.words[u]=$|0,m=w|0}return m!==0?l.words[u]=m|0:l.length--,l._strip()}var P=function(o,l,p){var _=o.words,v=l.words,A=p.words,M=0,m,u,w,$=_[0]|0,I=$&8191,R=$>>>13,st=_[1]|0,J=st&8191,Q=st>>>13,me=_[2]|0,lt=me&8191,it=me>>>13,ie=_[3]|0,et=ie&8191,ct=ie>>>13,se=_[4]|0,at=se&8191,z=se>>>13,ae=_[5]|0,Y=ae&8191,tt=ae>>>13,ue=_[6]|0,rt=ue&8191,ht=ue>>>13,Ie=_[7]|0,ft=Ie&8191,dt=Ie>>>13,xe=_[8]|0,pt=xe&8191,mt=xe>>>13,Le=_[9]|0,gt=Le&8191,_t=Le>>>13,Pi=v[0]|0,wt=Pi&8191,vt=Pi>>>13,Oi=v[1]|0,yt=Oi&8191,bt=Oi>>>13,Ei=v[2]|0,At=Ei&8191,Mt=Ei>>>13,Ii=v[3]|0,St=Ii&8191,Ct=Ii>>>13,xi=v[4]|0,kt=xi&8191,qt=xi>>>13,Li=v[5]|0,Tt=Li&8191,Bt=Li>>>13,Ri=v[6]|0,Nt=Ri&8191,Pt=Ri>>>13,ji=v[7]|0,Ot=ji&8191,Et=ji>>>13,Fi=v[8]|0,It=Fi&8191,xt=Fi>>>13,Di=v[9]|0,Lt=Di&8191,Rt=Di>>>13;p.negative=o.negative^l.negative,p.length=19,m=Math.imul(I,wt),u=Math.imul(I,vt),u=u+Math.imul(R,wt)|0,w=Math.imul(R,vt);var Qe=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(Qe>>>26)|0,Qe&=67108863,m=Math.imul(J,wt),u=Math.imul(J,vt),u=u+Math.imul(Q,wt)|0,w=Math.imul(Q,vt),m=m+Math.imul(I,yt)|0,u=u+Math.imul(I,bt)|0,u=u+Math.imul(R,yt)|0,w=w+Math.imul(R,bt)|0;var ti=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(ti>>>26)|0,ti&=67108863,m=Math.imul(lt,wt),u=Math.imul(lt,vt),u=u+Math.imul(it,wt)|0,w=Math.imul(it,vt),m=m+Math.imul(J,yt)|0,u=u+Math.imul(J,bt)|0,u=u+Math.imul(Q,yt)|0,w=w+Math.imul(Q,bt)|0,m=m+Math.imul(I,At)|0,u=u+Math.imul(I,Mt)|0,u=u+Math.imul(R,At)|0,w=w+Math.imul(R,Mt)|0;var ei=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(ei>>>26)|0,ei&=67108863,m=Math.imul(et,wt),u=Math.imul(et,vt),u=u+Math.imul(ct,wt)|0,w=Math.imul(ct,vt),m=m+Math.imul(lt,yt)|0,u=u+Math.imul(lt,bt)|0,u=u+Math.imul(it,yt)|0,w=w+Math.imul(it,bt)|0,m=m+Math.imul(J,At)|0,u=u+Math.imul(J,Mt)|0,u=u+Math.imul(Q,At)|0,w=w+Math.imul(Q,Mt)|0,m=m+Math.imul(I,St)|0,u=u+Math.imul(I,Ct)|0,u=u+Math.imul(R,St)|0,w=w+Math.imul(R,Ct)|0;var ii=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(ii>>>26)|0,ii&=67108863,m=Math.imul(at,wt),u=Math.imul(at,vt),u=u+Math.imul(z,wt)|0,w=Math.imul(z,vt),m=m+Math.imul(et,yt)|0,u=u+Math.imul(et,bt)|0,u=u+Math.imul(ct,yt)|0,w=w+Math.imul(ct,bt)|0,m=m+Math.imul(lt,At)|0,u=u+Math.imul(lt,Mt)|0,u=u+Math.imul(it,At)|0,w=w+Math.imul(it,Mt)|0,m=m+Math.imul(J,St)|0,u=u+Math.imul(J,Ct)|0,u=u+Math.imul(Q,St)|0,w=w+Math.imul(Q,Ct)|0,m=m+Math.imul(I,kt)|0,u=u+Math.imul(I,qt)|0,u=u+Math.imul(R,kt)|0,w=w+Math.imul(R,qt)|0;var ri=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(ri>>>26)|0,ri&=67108863,m=Math.imul(Y,wt),u=Math.imul(Y,vt),u=u+Math.imul(tt,wt)|0,w=Math.imul(tt,vt),m=m+Math.imul(at,yt)|0,u=u+Math.imul(at,bt)|0,u=u+Math.imul(z,yt)|0,w=w+Math.imul(z,bt)|0,m=m+Math.imul(et,At)|0,u=u+Math.imul(et,Mt)|0,u=u+Math.imul(ct,At)|0,w=w+Math.imul(ct,Mt)|0,m=m+Math.imul(lt,St)|0,u=u+Math.imul(lt,Ct)|0,u=u+Math.imul(it,St)|0,w=w+Math.imul(it,Ct)|0,m=m+Math.imul(J,kt)|0,u=u+Math.imul(J,qt)|0,u=u+Math.imul(Q,kt)|0,w=w+Math.imul(Q,qt)|0,m=m+Math.imul(I,Tt)|0,u=u+Math.imul(I,Bt)|0,u=u+Math.imul(R,Tt)|0,w=w+Math.imul(R,Bt)|0;var ni=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(ni>>>26)|0,ni&=67108863,m=Math.imul(rt,wt),u=Math.imul(rt,vt),u=u+Math.imul(ht,wt)|0,w=Math.imul(ht,vt),m=m+Math.imul(Y,yt)|0,u=u+Math.imul(Y,bt)|0,u=u+Math.imul(tt,yt)|0,w=w+Math.imul(tt,bt)|0,m=m+Math.imul(at,At)|0,u=u+Math.imul(at,Mt)|0,u=u+Math.imul(z,At)|0,w=w+Math.imul(z,Mt)|0,m=m+Math.imul(et,St)|0,u=u+Math.imul(et,Ct)|0,u=u+Math.imul(ct,St)|0,w=w+Math.imul(ct,Ct)|0,m=m+Math.imul(lt,kt)|0,u=u+Math.imul(lt,qt)|0,u=u+Math.imul(it,kt)|0,w=w+Math.imul(it,qt)|0,m=m+Math.imul(J,Tt)|0,u=u+Math.imul(J,Bt)|0,u=u+Math.imul(Q,Tt)|0,w=w+Math.imul(Q,Bt)|0,m=m+Math.imul(I,Nt)|0,u=u+Math.imul(I,Pt)|0,u=u+Math.imul(R,Nt)|0,w=w+Math.imul(R,Pt)|0;var oi=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(oi>>>26)|0,oi&=67108863,m=Math.imul(ft,wt),u=Math.imul(ft,vt),u=u+Math.imul(dt,wt)|0,w=Math.imul(dt,vt),m=m+Math.imul(rt,yt)|0,u=u+Math.imul(rt,bt)|0,u=u+Math.imul(ht,yt)|0,w=w+Math.imul(ht,bt)|0,m=m+Math.imul(Y,At)|0,u=u+Math.imul(Y,Mt)|0,u=u+Math.imul(tt,At)|0,w=w+Math.imul(tt,Mt)|0,m=m+Math.imul(at,St)|0,u=u+Math.imul(at,Ct)|0,u=u+Math.imul(z,St)|0,w=w+Math.imul(z,Ct)|0,m=m+Math.imul(et,kt)|0,u=u+Math.imul(et,qt)|0,u=u+Math.imul(ct,kt)|0,w=w+Math.imul(ct,qt)|0,m=m+Math.imul(lt,Tt)|0,u=u+Math.imul(lt,Bt)|0,u=u+Math.imul(it,Tt)|0,w=w+Math.imul(it,Bt)|0,m=m+Math.imul(J,Nt)|0,u=u+Math.imul(J,Pt)|0,u=u+Math.imul(Q,Nt)|0,w=w+Math.imul(Q,Pt)|0,m=m+Math.imul(I,Ot)|0,u=u+Math.imul(I,Et)|0,u=u+Math.imul(R,Ot)|0,w=w+Math.imul(R,Et)|0;var si=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(si>>>26)|0,si&=67108863,m=Math.imul(pt,wt),u=Math.imul(pt,vt),u=u+Math.imul(mt,wt)|0,w=Math.imul(mt,vt),m=m+Math.imul(ft,yt)|0,u=u+Math.imul(ft,bt)|0,u=u+Math.imul(dt,yt)|0,w=w+Math.imul(dt,bt)|0,m=m+Math.imul(rt,At)|0,u=u+Math.imul(rt,Mt)|0,u=u+Math.imul(ht,At)|0,w=w+Math.imul(ht,Mt)|0,m=m+Math.imul(Y,St)|0,u=u+Math.imul(Y,Ct)|0,u=u+Math.imul(tt,St)|0,w=w+Math.imul(tt,Ct)|0,m=m+Math.imul(at,kt)|0,u=u+Math.imul(at,qt)|0,u=u+Math.imul(z,kt)|0,w=w+Math.imul(z,qt)|0,m=m+Math.imul(et,Tt)|0,u=u+Math.imul(et,Bt)|0,u=u+Math.imul(ct,Tt)|0,w=w+Math.imul(ct,Bt)|0,m=m+Math.imul(lt,Nt)|0,u=u+Math.imul(lt,Pt)|0,u=u+Math.imul(it,Nt)|0,w=w+Math.imul(it,Pt)|0,m=m+Math.imul(J,Ot)|0,u=u+Math.imul(J,Et)|0,u=u+Math.imul(Q,Ot)|0,w=w+Math.imul(Q,Et)|0,m=m+Math.imul(I,It)|0,u=u+Math.imul(I,xt)|0,u=u+Math.imul(R,It)|0,w=w+Math.imul(R,xt)|0;var ai=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(ai>>>26)|0,ai&=67108863,m=Math.imul(gt,wt),u=Math.imul(gt,vt),u=u+Math.imul(_t,wt)|0,w=Math.imul(_t,vt),m=m+Math.imul(pt,yt)|0,u=u+Math.imul(pt,bt)|0,u=u+Math.imul(mt,yt)|0,w=w+Math.imul(mt,bt)|0,m=m+Math.imul(ft,At)|0,u=u+Math.imul(ft,Mt)|0,u=u+Math.imul(dt,At)|0,w=w+Math.imul(dt,Mt)|0,m=m+Math.imul(rt,St)|0,u=u+Math.imul(rt,Ct)|0,u=u+Math.imul(ht,St)|0,w=w+Math.imul(ht,Ct)|0,m=m+Math.imul(Y,kt)|0,u=u+Math.imul(Y,qt)|0,u=u+Math.imul(tt,kt)|0,w=w+Math.imul(tt,qt)|0,m=m+Math.imul(at,Tt)|0,u=u+Math.imul(at,Bt)|0,u=u+Math.imul(z,Tt)|0,w=w+Math.imul(z,Bt)|0,m=m+Math.imul(et,Nt)|0,u=u+Math.imul(et,Pt)|0,u=u+Math.imul(ct,Nt)|0,w=w+Math.imul(ct,Pt)|0,m=m+Math.imul(lt,Ot)|0,u=u+Math.imul(lt,Et)|0,u=u+Math.imul(it,Ot)|0,w=w+Math.imul(it,Et)|0,m=m+Math.imul(J,It)|0,u=u+Math.imul(J,xt)|0,u=u+Math.imul(Q,It)|0,w=w+Math.imul(Q,xt)|0,m=m+Math.imul(I,Lt)|0,u=u+Math.imul(I,Rt)|0,u=u+Math.imul(R,Lt)|0,w=w+Math.imul(R,Rt)|0;var ui=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(ui>>>26)|0,ui&=67108863,m=Math.imul(gt,yt),u=Math.imul(gt,bt),u=u+Math.imul(_t,yt)|0,w=Math.imul(_t,bt),m=m+Math.imul(pt,At)|0,u=u+Math.imul(pt,Mt)|0,u=u+Math.imul(mt,At)|0,w=w+Math.imul(mt,Mt)|0,m=m+Math.imul(ft,St)|0,u=u+Math.imul(ft,Ct)|0,u=u+Math.imul(dt,St)|0,w=w+Math.imul(dt,Ct)|0,m=m+Math.imul(rt,kt)|0,u=u+Math.imul(rt,qt)|0,u=u+Math.imul(ht,kt)|0,w=w+Math.imul(ht,qt)|0,m=m+Math.imul(Y,Tt)|0,u=u+Math.imul(Y,Bt)|0,u=u+Math.imul(tt,Tt)|0,w=w+Math.imul(tt,Bt)|0,m=m+Math.imul(at,Nt)|0,u=u+Math.imul(at,Pt)|0,u=u+Math.imul(z,Nt)|0,w=w+Math.imul(z,Pt)|0,m=m+Math.imul(et,Ot)|0,u=u+Math.imul(et,Et)|0,u=u+Math.imul(ct,Ot)|0,w=w+Math.imul(ct,Et)|0,m=m+Math.imul(lt,It)|0,u=u+Math.imul(lt,xt)|0,u=u+Math.imul(it,It)|0,w=w+Math.imul(it,xt)|0,m=m+Math.imul(J,Lt)|0,u=u+Math.imul(J,Rt)|0,u=u+Math.imul(Q,Lt)|0,w=w+Math.imul(Q,Rt)|0;var li=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(li>>>26)|0,li&=67108863,m=Math.imul(gt,At),u=Math.imul(gt,Mt),u=u+Math.imul(_t,At)|0,w=Math.imul(_t,Mt),m=m+Math.imul(pt,St)|0,u=u+Math.imul(pt,Ct)|0,u=u+Math.imul(mt,St)|0,w=w+Math.imul(mt,Ct)|0,m=m+Math.imul(ft,kt)|0,u=u+Math.imul(ft,qt)|0,u=u+Math.imul(dt,kt)|0,w=w+Math.imul(dt,qt)|0,m=m+Math.imul(rt,Tt)|0,u=u+Math.imul(rt,Bt)|0,u=u+Math.imul(ht,Tt)|0,w=w+Math.imul(ht,Bt)|0,m=m+Math.imul(Y,Nt)|0,u=u+Math.imul(Y,Pt)|0,u=u+Math.imul(tt,Nt)|0,w=w+Math.imul(tt,Pt)|0,m=m+Math.imul(at,Ot)|0,u=u+Math.imul(at,Et)|0,u=u+Math.imul(z,Ot)|0,w=w+Math.imul(z,Et)|0,m=m+Math.imul(et,It)|0,u=u+Math.imul(et,xt)|0,u=u+Math.imul(ct,It)|0,w=w+Math.imul(ct,xt)|0,m=m+Math.imul(lt,Lt)|0,u=u+Math.imul(lt,Rt)|0,u=u+Math.imul(it,Lt)|0,w=w+Math.imul(it,Rt)|0;var ci=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(ci>>>26)|0,ci&=67108863,m=Math.imul(gt,St),u=Math.imul(gt,Ct),u=u+Math.imul(_t,St)|0,w=Math.imul(_t,Ct),m=m+Math.imul(pt,kt)|0,u=u+Math.imul(pt,qt)|0,u=u+Math.imul(mt,kt)|0,w=w+Math.imul(mt,qt)|0,m=m+Math.imul(ft,Tt)|0,u=u+Math.imul(ft,Bt)|0,u=u+Math.imul(dt,Tt)|0,w=w+Math.imul(dt,Bt)|0,m=m+Math.imul(rt,Nt)|0,u=u+Math.imul(rt,Pt)|0,u=u+Math.imul(ht,Nt)|0,w=w+Math.imul(ht,Pt)|0,m=m+Math.imul(Y,Ot)|0,u=u+Math.imul(Y,Et)|0,u=u+Math.imul(tt,Ot)|0,w=w+Math.imul(tt,Et)|0,m=m+Math.imul(at,It)|0,u=u+Math.imul(at,xt)|0,u=u+Math.imul(z,It)|0,w=w+Math.imul(z,xt)|0,m=m+Math.imul(et,Lt)|0,u=u+Math.imul(et,Rt)|0,u=u+Math.imul(ct,Lt)|0,w=w+Math.imul(ct,Rt)|0;var hi=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(hi>>>26)|0,hi&=67108863,m=Math.imul(gt,kt),u=Math.imul(gt,qt),u=u+Math.imul(_t,kt)|0,w=Math.imul(_t,qt),m=m+Math.imul(pt,Tt)|0,u=u+Math.imul(pt,Bt)|0,u=u+Math.imul(mt,Tt)|0,w=w+Math.imul(mt,Bt)|0,m=m+Math.imul(ft,Nt)|0,u=u+Math.imul(ft,Pt)|0,u=u+Math.imul(dt,Nt)|0,w=w+Math.imul(dt,Pt)|0,m=m+Math.imul(rt,Ot)|0,u=u+Math.imul(rt,Et)|0,u=u+Math.imul(ht,Ot)|0,w=w+Math.imul(ht,Et)|0,m=m+Math.imul(Y,It)|0,u=u+Math.imul(Y,xt)|0,u=u+Math.imul(tt,It)|0,w=w+Math.imul(tt,xt)|0,m=m+Math.imul(at,Lt)|0,u=u+Math.imul(at,Rt)|0,u=u+Math.imul(z,Lt)|0,w=w+Math.imul(z,Rt)|0;var di=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(di>>>26)|0,di&=67108863,m=Math.imul(gt,Tt),u=Math.imul(gt,Bt),u=u+Math.imul(_t,Tt)|0,w=Math.imul(_t,Bt),m=m+Math.imul(pt,Nt)|0,u=u+Math.imul(pt,Pt)|0,u=u+Math.imul(mt,Nt)|0,w=w+Math.imul(mt,Pt)|0,m=m+Math.imul(ft,Ot)|0,u=u+Math.imul(ft,Et)|0,u=u+Math.imul(dt,Ot)|0,w=w+Math.imul(dt,Et)|0,m=m+Math.imul(rt,It)|0,u=u+Math.imul(rt,xt)|0,u=u+Math.imul(ht,It)|0,w=w+Math.imul(ht,xt)|0,m=m+Math.imul(Y,Lt)|0,u=u+Math.imul(Y,Rt)|0,u=u+Math.imul(tt,Lt)|0,w=w+Math.imul(tt,Rt)|0;var fi=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(fi>>>26)|0,fi&=67108863,m=Math.imul(gt,Nt),u=Math.imul(gt,Pt),u=u+Math.imul(_t,Nt)|0,w=Math.imul(_t,Pt),m=m+Math.imul(pt,Ot)|0,u=u+Math.imul(pt,Et)|0,u=u+Math.imul(mt,Ot)|0,w=w+Math.imul(mt,Et)|0,m=m+Math.imul(ft,It)|0,u=u+Math.imul(ft,xt)|0,u=u+Math.imul(dt,It)|0,w=w+Math.imul(dt,xt)|0,m=m+Math.imul(rt,Lt)|0,u=u+Math.imul(rt,Rt)|0,u=u+Math.imul(ht,Lt)|0,w=w+Math.imul(ht,Rt)|0;var pi=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(pi>>>26)|0,pi&=67108863,m=Math.imul(gt,Ot),u=Math.imul(gt,Et),u=u+Math.imul(_t,Ot)|0,w=Math.imul(_t,Et),m=m+Math.imul(pt,It)|0,u=u+Math.imul(pt,xt)|0,u=u+Math.imul(mt,It)|0,w=w+Math.imul(mt,xt)|0,m=m+Math.imul(ft,Lt)|0,u=u+Math.imul(ft,Rt)|0,u=u+Math.imul(dt,Lt)|0,w=w+Math.imul(dt,Rt)|0;var mi=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(mi>>>26)|0,mi&=67108863,m=Math.imul(gt,It),u=Math.imul(gt,xt),u=u+Math.imul(_t,It)|0,w=Math.imul(_t,xt),m=m+Math.imul(pt,Lt)|0,u=u+Math.imul(pt,Rt)|0,u=u+Math.imul(mt,Lt)|0,w=w+Math.imul(mt,Rt)|0;var gi=(M+m|0)+((u&8191)<<13)|0;M=(w+(u>>>13)|0)+(gi>>>26)|0,gi&=67108863,m=Math.imul(gt,Lt),u=Math.imul(gt,Rt),u=u+Math.imul(_t,Lt)|0,w=Math.imul(_t,Rt);var _i=(M+m|0)+((u&8191)<<13)|0;return M=(w+(u>>>13)|0)+(_i>>>26)|0,_i&=67108863,A[0]=Qe,A[1]=ti,A[2]=ei,A[3]=ii,A[4]=ri,A[5]=ni,A[6]=oi,A[7]=si,A[8]=ai,A[9]=ui,A[10]=li,A[11]=ci,A[12]=hi,A[13]=di,A[14]=fi,A[15]=pi,A[16]=mi,A[17]=gi,A[18]=_i,M!==0&&(A[19]=M,p.length++),p};Math.imul||(P=q);function O(y,o,l){l.negative=o.negative^y.negative,l.length=y.length+o.length;for(var p=0,_=0,v=0;v<l.length-1;v++){var A=_;_=0;for(var M=p&67108863,m=Math.min(v,o.length-1),u=Math.max(0,v-y.length+1);u<=m;u++){var w=v-u,$=y.words[w]|0,I=o.words[u]|0,R=$*I,st=R&67108863;A=A+(R/67108864|0)|0,st=st+M|0,M=st&67108863,A=A+(st>>>26)|0,_+=A>>>26,A&=67108863}l.words[v]=M,p=A,A=_}return p!==0?l.words[v]=p:l.length--,l._strip()}function x(y,o,l){return O(y,o,l)}s.prototype.mulTo=function(o,l){var p,_=this.length+o.length;return this.length===10&&o.length===10?p=P(this,o,l):_<63?p=q(this,o,l):_<1024?p=O(this,o,l):p=x(this,o,l),p},s.prototype.mul=function(o){var l=new s(null);return l.words=new Array(this.length+o.length),this.mulTo(o,l)},s.prototype.mulf=function(o){var l=new s(null);return l.words=new Array(this.length+o.length),x(this,o,l)},s.prototype.imul=function(o){return this.clone().mulTo(o,this)},s.prototype.imuln=function(o){var l=o<0;l&&(o=-o),r(typeof o=="number"),r(o<67108864);for(var p=0,_=0;_<this.length;_++){var v=(this.words[_]|0)*o,A=(v&67108863)+(p&67108863);p>>=26,p+=v/67108864|0,p+=A>>>26,this.words[_]=A&67108863}return p!==0&&(this.words[_]=p,this.length++),l?this.ineg():this},s.prototype.muln=function(o){return this.clone().imuln(o)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(o){var l=N(o);if(l.length===0)return new s(1);for(var p=this,_=0;_<l.length&&l[_]===0;_++,p=p.sqr());if(++_<l.length)for(var v=p.sqr();_<l.length;_++,v=v.sqr())l[_]!==0&&(p=p.mul(v));return p},s.prototype.iushln=function(o){r(typeof o=="number"&&o>=0);var l=o%26,p=(o-l)/26,_=67108863>>>26-l<<26-l,v;if(l!==0){var A=0;for(v=0;v<this.length;v++){var M=this.words[v]&_,m=(this.words[v]|0)-M<<l;this.words[v]=m|A,A=M>>>26-l}A&&(this.words[v]=A,this.length++)}if(p!==0){for(v=this.length-1;v>=0;v--)this.words[v+p]=this.words[v];for(v=0;v<p;v++)this.words[v]=0;this.length+=p}return this._strip()},s.prototype.ishln=function(o){return r(this.negative===0),this.iushln(o)},s.prototype.iushrn=function(o,l,p){r(typeof o=="number"&&o>=0);var _;l?_=(l-l%26)/26:_=0;var v=o%26,A=Math.min((o-v)/26,this.length),M=67108863^67108863>>>v<<v,m=p;if(_-=A,_=Math.max(0,_),m){for(var u=0;u<A;u++)m.words[u]=this.words[u];m.length=A}if(A!==0)if(this.length>A)for(this.length-=A,u=0;u<this.length;u++)this.words[u]=this.words[u+A];else this.words[0]=0,this.length=1;var w=0;for(u=this.length-1;u>=0&&(w!==0||u>=_);u--){var $=this.words[u]|0;this.words[u]=w<<26-v|$>>>v,w=$&M}return m&&w!==0&&(m.words[m.length++]=w),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},s.prototype.ishrn=function(o,l,p){return r(this.negative===0),this.iushrn(o,l,p)},s.prototype.shln=function(o){return this.clone().ishln(o)},s.prototype.ushln=function(o){return this.clone().iushln(o)},s.prototype.shrn=function(o){return this.clone().ishrn(o)},s.prototype.ushrn=function(o){return this.clone().iushrn(o)},s.prototype.testn=function(o){r(typeof o=="number"&&o>=0);var l=o%26,p=(o-l)/26,_=1<<l;if(this.length<=p)return!1;var v=this.words[p];return!!(v&_)},s.prototype.imaskn=function(o){r(typeof o=="number"&&o>=0);var l=o%26,p=(o-l)/26;if(r(this.negative===0,"imaskn works only with positive numbers"),this.length<=p)return this;if(l!==0&&p++,this.length=Math.min(p,this.length),l!==0){var _=67108863^67108863>>>l<<l;this.words[this.length-1]&=_}return this._strip()},s.prototype.maskn=function(o){return this.clone().imaskn(o)},s.prototype.iaddn=function(o){return r(typeof o=="number"),r(o<67108864),o<0?this.isubn(-o):this.negative!==0?this.length===1&&(this.words[0]|0)<=o?(this.words[0]=o-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(o),this.negative=1,this):this._iaddn(o)},s.prototype._iaddn=function(o){this.words[0]+=o;for(var l=0;l<this.length&&this.words[l]>=67108864;l++)this.words[l]-=67108864,l===this.length-1?this.words[l+1]=1:this.words[l+1]++;return this.length=Math.max(this.length,l+1),this},s.prototype.isubn=function(o){if(r(typeof o=="number"),r(o<67108864),o<0)return this.iaddn(-o);if(this.negative!==0)return this.negative=0,this.iaddn(o),this.negative=1,this;if(this.words[0]-=o,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var l=0;l<this.length&&this.words[l]<0;l++)this.words[l]+=67108864,this.words[l+1]-=1;return this._strip()},s.prototype.addn=function(o){return this.clone().iaddn(o)},s.prototype.subn=function(o){return this.clone().isubn(o)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(o,l,p){var _=o.length+p,v;this._expand(_);var A,M=0;for(v=0;v<o.length;v++){A=(this.words[v+p]|0)+M;var m=(o.words[v]|0)*l;A-=m&67108863,M=(A>>26)-(m/67108864|0),this.words[v+p]=A&67108863}for(;v<this.length-p;v++)A=(this.words[v+p]|0)+M,M=A>>26,this.words[v+p]=A&67108863;if(M===0)return this._strip();for(r(M===-1),M=0,v=0;v<this.length;v++)A=-(this.words[v]|0)+M,M=A>>26,this.words[v]=A&67108863;return this.negative=1,this._strip()},s.prototype._wordDiv=function(o,l){var p=this.length-o.length,_=this.clone(),v=o,A=v.words[v.length-1]|0,M=this._countBits(A);p=26-M,p!==0&&(v=v.ushln(p),_.iushln(p),A=v.words[v.length-1]|0);var m=_.length-v.length,u;if(l!=="mod"){u=new s(null),u.length=m+1,u.words=new Array(u.length);for(var w=0;w<u.length;w++)u.words[w]=0}var $=_.clone()._ishlnsubmul(v,1,m);$.negative===0&&(_=$,u&&(u.words[m]=1));for(var I=m-1;I>=0;I--){var R=(_.words[v.length+I]|0)*67108864+(_.words[v.length+I-1]|0);for(R=Math.min(R/A|0,67108863),_._ishlnsubmul(v,R,I);_.negative!==0;)R--,_.negative=0,_._ishlnsubmul(v,1,I),_.isZero()||(_.negative^=1);u&&(u.words[I]=R)}return u&&u._strip(),_._strip(),l!=="div"&&p!==0&&_.iushrn(p),{div:u||null,mod:_}},s.prototype.divmod=function(o,l,p){if(r(!o.isZero()),this.isZero())return{div:new s(0),mod:new s(0)};var _,v,A;return this.negative!==0&&o.negative===0?(A=this.neg().divmod(o,l),l!=="mod"&&(_=A.div.neg()),l!=="div"&&(v=A.mod.neg(),p&&v.negative!==0&&v.iadd(o)),{div:_,mod:v}):this.negative===0&&o.negative!==0?(A=this.divmod(o.neg(),l),l!=="mod"&&(_=A.div.neg()),{div:_,mod:A.mod}):this.negative&o.negative?(A=this.neg().divmod(o.neg(),l),l!=="div"&&(v=A.mod.neg(),p&&v.negative!==0&&v.isub(o)),{div:A.div,mod:v}):o.length>this.length||this.cmp(o)<0?{div:new s(0),mod:this}:o.length===1?l==="div"?{div:this.divn(o.words[0]),mod:null}:l==="mod"?{div:null,mod:new s(this.modrn(o.words[0]))}:{div:this.divn(o.words[0]),mod:new s(this.modrn(o.words[0]))}:this._wordDiv(o,l)},s.prototype.div=function(o){return this.divmod(o,"div",!1).div},s.prototype.mod=function(o){return this.divmod(o,"mod",!1).mod},s.prototype.umod=function(o){return this.divmod(o,"mod",!0).mod},s.prototype.divRound=function(o){var l=this.divmod(o);if(l.mod.isZero())return l.div;var p=l.div.negative!==0?l.mod.isub(o):l.mod,_=o.ushrn(1),v=o.andln(1),A=p.cmp(_);return A<0||v===1&&A===0?l.div:l.div.negative!==0?l.div.isubn(1):l.div.iaddn(1)},s.prototype.modrn=function(o){var l=o<0;l&&(o=-o),r(o<=67108863);for(var p=(1<<26)%o,_=0,v=this.length-1;v>=0;v--)_=(p*_+(this.words[v]|0))%o;return l?-_:_},s.prototype.modn=function(o){return this.modrn(o)},s.prototype.idivn=function(o){var l=o<0;l&&(o=-o),r(o<=67108863);for(var p=0,_=this.length-1;_>=0;_--){var v=(this.words[_]|0)+p*67108864;this.words[_]=v/o|0,p=v%o}return this._strip(),l?this.ineg():this},s.prototype.divn=function(o){return this.clone().idivn(o)},s.prototype.egcd=function(o){r(o.negative===0),r(!o.isZero());var l=this,p=o.clone();l.negative!==0?l=l.umod(o):l=l.clone();for(var _=new s(1),v=new s(0),A=new s(0),M=new s(1),m=0;l.isEven()&&p.isEven();)l.iushrn(1),p.iushrn(1),++m;for(var u=p.clone(),w=l.clone();!l.isZero();){for(var $=0,I=1;!(l.words[0]&I)&&$<26;++$,I<<=1);if($>0)for(l.iushrn($);$-- >0;)(_.isOdd()||v.isOdd())&&(_.iadd(u),v.isub(w)),_.iushrn(1),v.iushrn(1);for(var R=0,st=1;!(p.words[0]&st)&&R<26;++R,st<<=1);if(R>0)for(p.iushrn(R);R-- >0;)(A.isOdd()||M.isOdd())&&(A.iadd(u),M.isub(w)),A.iushrn(1),M.iushrn(1);l.cmp(p)>=0?(l.isub(p),_.isub(A),v.isub(M)):(p.isub(l),A.isub(_),M.isub(v))}return{a:A,b:M,gcd:p.iushln(m)}},s.prototype._invmp=function(o){r(o.negative===0),r(!o.isZero());var l=this,p=o.clone();l.negative!==0?l=l.umod(o):l=l.clone();for(var _=new s(1),v=new s(0),A=p.clone();l.cmpn(1)>0&&p.cmpn(1)>0;){for(var M=0,m=1;!(l.words[0]&m)&&M<26;++M,m<<=1);if(M>0)for(l.iushrn(M);M-- >0;)_.isOdd()&&_.iadd(A),_.iushrn(1);for(var u=0,w=1;!(p.words[0]&w)&&u<26;++u,w<<=1);if(u>0)for(p.iushrn(u);u-- >0;)v.isOdd()&&v.iadd(A),v.iushrn(1);l.cmp(p)>=0?(l.isub(p),_.isub(v)):(p.isub(l),v.isub(_))}var $;return l.cmpn(1)===0?$=_:$=v,$.cmpn(0)<0&&$.iadd(o),$},s.prototype.gcd=function(o){if(this.isZero())return o.abs();if(o.isZero())return this.abs();var l=this.clone(),p=o.clone();l.negative=0,p.negative=0;for(var _=0;l.isEven()&&p.isEven();_++)l.iushrn(1),p.iushrn(1);do{for(;l.isEven();)l.iushrn(1);for(;p.isEven();)p.iushrn(1);var v=l.cmp(p);if(v<0){var A=l;l=p,p=A}else if(v===0||p.cmpn(1)===0)break;l.isub(p)}while(!0);return p.iushln(_)},s.prototype.invm=function(o){return this.egcd(o).a.umod(o)},s.prototype.isEven=function(){return(this.words[0]&1)===0},s.prototype.isOdd=function(){return(this.words[0]&1)===1},s.prototype.andln=function(o){return this.words[0]&o},s.prototype.bincn=function(o){r(typeof o=="number");var l=o%26,p=(o-l)/26,_=1<<l;if(this.length<=p)return this._expand(p+1),this.words[p]|=_,this;for(var v=_,A=p;v!==0&&A<this.length;A++){var M=this.words[A]|0;M+=v,v=M>>>26,M&=67108863,this.words[A]=M}return v!==0&&(this.words[A]=v,this.length++),this},s.prototype.isZero=function(){return this.length===1&&this.words[0]===0},s.prototype.cmpn=function(o){var l=o<0;if(this.negative!==0&&!l)return-1;if(this.negative===0&&l)return 1;this._strip();var p;if(this.length>1)p=1;else{l&&(o=-o),r(o<=67108863,"Number is too big");var _=this.words[0]|0;p=_===o?0:_<o?-1:1}return this.negative!==0?-p|0:p},s.prototype.cmp=function(o){if(this.negative!==0&&o.negative===0)return-1;if(this.negative===0&&o.negative!==0)return 1;var l=this.ucmp(o);return this.negative!==0?-l|0:l},s.prototype.ucmp=function(o){if(this.length>o.length)return 1;if(this.length<o.length)return-1;for(var l=0,p=this.length-1;p>=0;p--){var _=this.words[p]|0,v=o.words[p]|0;if(_!==v){_<v?l=-1:_>v&&(l=1);break}}return l},s.prototype.gtn=function(o){return this.cmpn(o)===1},s.prototype.gt=function(o){return this.cmp(o)===1},s.prototype.gten=function(o){return this.cmpn(o)>=0},s.prototype.gte=function(o){return this.cmp(o)>=0},s.prototype.ltn=function(o){return this.cmpn(o)===-1},s.prototype.lt=function(o){return this.cmp(o)===-1},s.prototype.lten=function(o){return this.cmpn(o)<=0},s.prototype.lte=function(o){return this.cmp(o)<=0},s.prototype.eqn=function(o){return this.cmpn(o)===0},s.prototype.eq=function(o){return this.cmp(o)===0},s.red=function(o){return new F(o)},s.prototype.toRed=function(o){return r(!this.red,"Already a number in reduction context"),r(this.negative===0,"red works only with positives"),o.convertTo(this)._forceRed(o)},s.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(o){return this.red=o,this},s.prototype.forceRed=function(o){return r(!this.red,"Already a number in reduction context"),this._forceRed(o)},s.prototype.redAdd=function(o){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,o)},s.prototype.redIAdd=function(o){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,o)},s.prototype.redSub=function(o){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,o)},s.prototype.redISub=function(o){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,o)},s.prototype.redShl=function(o){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,o)},s.prototype.redMul=function(o){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,o),this.red.mul(this,o)},s.prototype.redIMul=function(o){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,o),this.red.imul(this,o)},s.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(o){return r(this.red&&!o.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,o)};var U={k256:null,p224:null,p192:null,p25519:null};function V(y,o){this.name=y,this.p=new s(o,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}V.prototype._tmp=function(){var o=new s(null);return o.words=new Array(Math.ceil(this.n/13)),o},V.prototype.ireduce=function(o){var l=o,p;do this.split(l,this.tmp),l=this.imulK(l),l=l.iadd(this.tmp),p=l.bitLength();while(p>this.n);var _=p<this.n?-1:l.ucmp(this.p);return _===0?(l.words[0]=0,l.length=1):_>0?l.isub(this.p):l.strip!==void 0?l.strip():l._strip(),l},V.prototype.split=function(o,l){o.iushrn(this.n,0,l)},V.prototype.imulK=function(o){return o.imul(this.k)};function K(){V.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(K,V),K.prototype.split=function(o,l){for(var p=4194303,_=Math.min(o.length,9),v=0;v<_;v++)l.words[v]=o.words[v];if(l.length=_,o.length<=9){o.words[0]=0,o.length=1;return}var A=o.words[9];for(l.words[l.length++]=A&p,v=10;v<o.length;v++){var M=o.words[v]|0;o.words[v-10]=(M&p)<<4|A>>>22,A=M}A>>>=22,o.words[v-10]=A,A===0&&o.length>10?o.length-=10:o.length-=9},K.prototype.imulK=function(o){o.words[o.length]=0,o.words[o.length+1]=0,o.length+=2;for(var l=0,p=0;p<o.length;p++){var _=o.words[p]|0;l+=_*977,o.words[p]=l&67108863,l=_*64+(l/67108864|0)}return o.words[o.length-1]===0&&(o.length--,o.words[o.length-1]===0&&o.length--),o};function W(){V.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(W,V);function ut(){V.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(ut,V);function G(){V.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(G,V),G.prototype.imulK=function(o){for(var l=0,p=0;p<o.length;p++){var _=(o.words[p]|0)*19+l,v=_&67108863;_>>>=26,o.words[p]=v,l=_}return l!==0&&(o.words[o.length++]=l),o},s._prime=function(o){if(U[o])return U[o];var l;if(o==="k256")l=new K;else if(o==="p224")l=new W;else if(o==="p192")l=new ut;else if(o==="p25519")l=new G;else throw new Error("Unknown prime "+o);return U[o]=l,l};function F(y){if(typeof y=="string"){var o=s._prime(y);this.m=o.p,this.prime=o}else r(y.gtn(1),"modulus must be greater than 1"),this.m=y,this.prime=null}F.prototype._verify1=function(o){r(o.negative===0,"red works only with positives"),r(o.red,"red works only with red numbers")},F.prototype._verify2=function(o,l){r((o.negative|l.negative)===0,"red works only with positives"),r(o.red&&o.red===l.red,"red works only with red numbers")},F.prototype.imod=function(o){return this.prime?this.prime.ireduce(o)._forceRed(this):(g(o,o.umod(this.m)._forceRed(this)),o)},F.prototype.neg=function(o){return o.isZero()?o.clone():this.m.sub(o)._forceRed(this)},F.prototype.add=function(o,l){this._verify2(o,l);var p=o.add(l);return p.cmp(this.m)>=0&&p.isub(this.m),p._forceRed(this)},F.prototype.iadd=function(o,l){this._verify2(o,l);var p=o.iadd(l);return p.cmp(this.m)>=0&&p.isub(this.m),p},F.prototype.sub=function(o,l){this._verify2(o,l);var p=o.sub(l);return p.cmpn(0)<0&&p.iadd(this.m),p._forceRed(this)},F.prototype.isub=function(o,l){this._verify2(o,l);var p=o.isub(l);return p.cmpn(0)<0&&p.iadd(this.m),p},F.prototype.shl=function(o,l){return this._verify1(o),this.imod(o.ushln(l))},F.prototype.imul=function(o,l){return this._verify2(o,l),this.imod(o.imul(l))},F.prototype.mul=function(o,l){return this._verify2(o,l),this.imod(o.mul(l))},F.prototype.isqr=function(o){return this.imul(o,o.clone())},F.prototype.sqr=function(o){return this.mul(o,o)},F.prototype.sqrt=function(o){if(o.isZero())return o.clone();var l=this.m.andln(3);if(r(l%2===1),l===3){var p=this.m.add(new s(1)).iushrn(2);return this.pow(o,p)}for(var _=this.m.subn(1),v=0;!_.isZero()&&_.andln(1)===0;)v++,_.iushrn(1);r(!_.isZero());var A=new s(1).toRed(this),M=A.redNeg(),m=this.m.subn(1).iushrn(1),u=this.m.bitLength();for(u=new s(2*u*u).toRed(this);this.pow(u,m).cmp(M)!==0;)u.redIAdd(M);for(var w=this.pow(u,_),$=this.pow(o,_.addn(1).iushrn(1)),I=this.pow(o,_),R=v;I.cmp(A)!==0;){for(var st=I,J=0;st.cmp(A)!==0;J++)st=st.redSqr();r(J<R);var Q=this.pow(w,new s(1).iushln(R-J-1));$=$.redMul(Q),w=Q.redSqr(),I=I.redMul(w),R=J}return $},F.prototype.invm=function(o){var l=o._invmp(this.m);return l.negative!==0?(l.negative=0,this.imod(l).redNeg()):this.imod(l)},F.prototype.pow=function(o,l){if(l.isZero())return new s(1).toRed(this);if(l.cmpn(1)===0)return o.clone();var p=4,_=new Array(1<<p);_[0]=new s(1).toRed(this),_[1]=o;for(var v=2;v<_.length;v++)_[v]=this.mul(_[v-1],o);var A=_[0],M=0,m=0,u=l.bitLength()%26;for(u===0&&(u=26),v=l.length-1;v>=0;v--){for(var w=l.words[v],$=u-1;$>=0;$--){var I=w>>$&1;if(A!==_[0]&&(A=this.sqr(A)),I===0&&M===0){m=0;continue}M<<=1,M|=I,m++,!(m!==p&&(v!==0||$!==0))&&(A=this.mul(A,_[M]),m=0,M=0)}u=26}return A},F.prototype.convertTo=function(o){var l=o.umod(this.m);return l===o?l.clone():l},F.prototype.convertFrom=function(o){var l=o.clone();return l.red=null,l},s.mont=function(o){return new H(o)};function H(y){F.call(this,y),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(H,F),H.prototype.convertTo=function(o){return this.imod(o.ushln(this.shift))},H.prototype.convertFrom=function(o){var l=this.imod(o.mul(this.rinv));return l.red=null,l},H.prototype.imul=function(o,l){if(o.isZero()||l.isZero())return o.words[0]=0,o.length=1,o;var p=o.imul(l),_=p.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),v=p.isub(_).iushrn(this.shift),A=v;return v.cmp(this.m)>=0?A=v.isub(this.m):v.cmpn(0)<0&&(A=v.iadd(this.m)),A._forceRed(this)},H.prototype.mul=function(o,l){if(o.isZero()||l.isZero())return new s(0)._forceRed(this);var p=o.mul(l),_=p.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),v=p.isub(_).iushrn(this.shift),A=v;return v.cmp(this.m)>=0?A=v.isub(this.m):v.cmpn(0)<0&&(A=v.iadd(this.m)),A._forceRed(this)},H.prototype.invm=function(o){var l=this.imod(o._invmp(this.m).mul(this.r2));return l._forceRed(this)}})(typeof e>"u"||e,t)}}),be=9e15,pe=1e9,bi="0123456789abcdef",We="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ge="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Ai={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-be,maxE:be,crypto:!1},fr,oe,Z=!0,ze="[DecimalError] ",de=ze+"Invalid argument: ",pr=ze+"Precision limit exceeded",mr=ze+"crypto unavailable",gr="[object Decimal]",Zt=Math.floor,Ft=Math.pow,tn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,en=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,rn=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,_r=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Yt=1e7,j=7,nn=9007199254740991,on=We.length-1,Mi=Ge.length-1,B={toStringTag:gr};B.absoluteValue=B.abs=function(){var t=new this.constructor(this);return t.s<0&&(t.s=1),L(t)};B.ceil=function(){return L(new this.constructor(this),this.e+1,2)};B.clampedTo=B.clamp=function(t,e){var i,n=this,r=n.constructor;if(t=new r(t),e=new r(e),!t.s||!e.s)return new r(NaN);if(t.gt(e))throw Error(de+e);return i=n.cmp(t),i<0?t:n.cmp(e)>0?e:new r(n)};B.comparedTo=B.cmp=function(t){var e,i,n,r,a=this,s=a.d,c=(t=new a.constructor(t)).d,d=a.s,h=t.s;if(!s||!c)return!d||!h?NaN:d!==h?d:s===c?0:!s^d<0?1:-1;if(!s[0]||!c[0])return s[0]?d:c[0]?-h:0;if(d!==h)return d;if(a.e!==t.e)return a.e>t.e^d<0?1:-1;for(n=s.length,r=c.length,e=0,i=n<r?n:r;e<i;++e)if(s[e]!==c[e])return s[e]>c[e]^d<0?1:-1;return n===r?0:n>r^d<0?1:-1};B.cosine=B.cos=function(){var t,e,i=this,n=i.constructor;return i.d?i.d[0]?(t=n.precision,e=n.rounding,n.precision=t+Math.max(i.e,i.sd())+j,n.rounding=1,i=sn(n,Ar(n,i)),n.precision=t,n.rounding=e,L(oe==2||oe==3?i.neg():i,t,e,!0)):new n(1):new n(NaN)};B.cubeRoot=B.cbrt=function(){var t,e,i,n,r,a,s,c,d,h,f=this,g=f.constructor;if(!f.isFinite()||f.isZero())return new g(f);for(Z=!1,a=f.s*Ft(f.s*f,1/3),!a||Math.abs(a)==1/0?(i=Ut(f.d),t=f.e,(a=(t-i.length+1)%3)&&(i+=a==1||a==-2?"0":"00"),a=Ft(i,1/3),t=Zt((t+1)/3)-(t%3==(t<0?-1:2)),a==1/0?i="5e"+t:(i=a.toExponential(),i=i.slice(0,i.indexOf("e")+1)+t),n=new g(i),n.s=f.s):n=new g(a.toString()),s=(t=g.precision)+3;;)if(c=n,d=c.times(c).times(c),h=d.plus(f),n=ot(h.plus(f).times(c),h.plus(d),s+2,1),Ut(c.d).slice(0,s)===(i=Ut(n.d)).slice(0,s))if(i=i.slice(s-3,s+1),i=="9999"||!r&&i=="4999"){if(!r&&(L(c,t+1,0),c.times(c).times(c).eq(f))){n=c;break}s+=4,r=1}else{(!+i||!+i.slice(1)&&i.charAt(0)=="5")&&(L(n,t+1,1),e=!n.times(n).times(n).eq(f));break}return Z=!0,L(n,t,g.rounding,e)};B.decimalPlaces=B.dp=function(){var t,e=this.d,i=NaN;if(e){if(t=e.length-1,i=(t-Zt(this.e/j))*j,t=e[t],t)for(;t%10==0;t/=10)i--;i<0&&(i=0)}return i};B.dividedBy=B.div=function(t){return ot(this,new this.constructor(t))};B.dividedToIntegerBy=B.divToInt=function(t){var e=this,i=e.constructor;return L(ot(e,new i(t),0,1,1),i.precision,i.rounding)};B.equals=B.eq=function(t){return this.cmp(t)===0};B.floor=function(){return L(new this.constructor(this),this.e+1,3)};B.greaterThan=B.gt=function(t){return this.cmp(t)>0};B.greaterThanOrEqualTo=B.gte=function(t){var e=this.cmp(t);return e==1||e===0};B.hyperbolicCosine=B.cosh=function(){var t,e,i,n,r,a=this,s=a.constructor,c=new s(1);if(!a.isFinite())return new s(a.s?1/0:NaN);if(a.isZero())return c;i=s.precision,n=s.rounding,s.precision=i+Math.max(a.e,a.sd())+4,s.rounding=1,r=a.d.length,r<32?(t=Math.ceil(r/3),e=(1/Ye(4,t)).toString()):(t=16,e="2.3283064365386962890625e-10"),a=ke(s,1,a.times(e),new s(1),!0);for(var d,h=t,f=new s(8);h--;)d=a.times(a),a=c.minus(d.times(f.minus(d.times(f))));return L(a,s.precision=i,s.rounding=n,!0)};B.hyperbolicSine=B.sinh=function(){var t,e,i,n,r=this,a=r.constructor;if(!r.isFinite()||r.isZero())return new a(r);if(e=a.precision,i=a.rounding,a.precision=e+Math.max(r.e,r.sd())+4,a.rounding=1,n=r.d.length,n<3)r=ke(a,2,r,r,!0);else{t=1.4*Math.sqrt(n),t=t>16?16:t|0,r=r.times(1/Ye(5,t)),r=ke(a,2,r,r,!0);for(var s,c=new a(5),d=new a(16),h=new a(20);t--;)s=r.times(r),r=r.times(c.plus(s.times(d.times(s).plus(h))))}return a.precision=e,a.rounding=i,L(r,e,i,!0)};B.hyperbolicTangent=B.tanh=function(){var t,e,i=this,n=i.constructor;return i.isFinite()?i.isZero()?new n(i):(t=n.precision,e=n.rounding,n.precision=t+7,n.rounding=1,ot(i.sinh(),i.cosh(),n.precision=t,n.rounding=e)):new n(i.s)};B.inverseCosine=B.acos=function(){var t,e=this,i=e.constructor,n=e.abs().cmp(1),r=i.precision,a=i.rounding;return n!==-1?n===0?e.isNeg()?zt(i,r,a):new i(0):new i(NaN):e.isZero()?zt(i,r+4,a).times(.5):(i.precision=r+6,i.rounding=1,e=e.asin(),t=zt(i,r+4,a).times(.5),i.precision=r,i.rounding=a,t.minus(e))};B.inverseHyperbolicCosine=B.acosh=function(){var t,e,i=this,n=i.constructor;return i.lte(1)?new n(i.eq(1)?0:NaN):i.isFinite()?(t=n.precision,e=n.rounding,n.precision=t+Math.max(Math.abs(i.e),i.sd())+4,n.rounding=1,Z=!1,i=i.times(i).minus(1).sqrt().plus(i),Z=!0,n.precision=t,n.rounding=e,i.ln()):new n(i)};B.inverseHyperbolicSine=B.asinh=function(){var t,e,i=this,n=i.constructor;return!i.isFinite()||i.isZero()?new n(i):(t=n.precision,e=n.rounding,n.precision=t+2*Math.max(Math.abs(i.e),i.sd())+6,n.rounding=1,Z=!1,i=i.times(i).plus(1).sqrt().plus(i),Z=!0,n.precision=t,n.rounding=e,i.ln())};B.inverseHyperbolicTangent=B.atanh=function(){var t,e,i,n,r=this,a=r.constructor;return r.isFinite()?r.e>=0?new a(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(t=a.precision,e=a.rounding,n=r.sd(),Math.max(n,t)<2*-r.e-1?L(new a(r),t,e,!0):(a.precision=i=n-r.e,r=ot(r.plus(1),new a(1).minus(r),i+t,1),a.precision=t+4,a.rounding=1,r=r.ln(),a.precision=t,a.rounding=e,r.times(.5))):new a(NaN)};B.inverseSine=B.asin=function(){var t,e,i,n,r=this,a=r.constructor;return r.isZero()?new a(r):(e=r.abs().cmp(1),i=a.precision,n=a.rounding,e!==-1?e===0?(t=zt(a,i+4,n).times(.5),t.s=r.s,t):new a(NaN):(a.precision=i+6,a.rounding=1,r=r.div(new a(1).minus(r.times(r)).sqrt().plus(1)).atan(),a.precision=i,a.rounding=n,r.times(2)))};B.inverseTangent=B.atan=function(){var t,e,i,n,r,a,s,c,d,h=this,f=h.constructor,g=f.precision,b=f.rounding;if(h.isFinite()){if(h.isZero())return new f(h);if(h.abs().eq(1)&&g+4<=Mi)return s=zt(f,g+4,b).times(.25),s.s=h.s,s}else{if(!h.s)return new f(NaN);if(g+4<=Mi)return s=zt(f,g+4,b).times(.5),s.s=h.s,s}for(f.precision=c=g+10,f.rounding=1,i=Math.min(28,c/j+2|0),t=i;t;--t)h=h.div(h.times(h).plus(1).sqrt().plus(1));for(Z=!1,e=Math.ceil(c/j),n=1,d=h.times(h),s=new f(h),r=h;t!==-1;)if(r=r.times(d),a=s.minus(r.div(n+=2)),r=r.times(d),s=a.plus(r.div(n+=2)),s.d[e]!==void 0)for(t=e;s.d[t]===a.d[t]&&t--;);return i&&(s=s.times(2<<i-1)),Z=!0,L(s,f.precision=g,f.rounding=b,!0)};B.isFinite=function(){return!!this.d};B.isInteger=B.isInt=function(){return!!this.d&&Zt(this.e/j)>this.d.length-2};B.isNaN=function(){return!this.s};B.isNegative=B.isNeg=function(){return this.s<0};B.isPositive=B.isPos=function(){return this.s>0};B.isZero=function(){return!!this.d&&this.d[0]===0};B.lessThan=B.lt=function(t){return this.cmp(t)<0};B.lessThanOrEqualTo=B.lte=function(t){return this.cmp(t)<1};B.logarithm=B.log=function(t){var e,i,n,r,a,s,c,d,h=this,f=h.constructor,g=f.precision,b=f.rounding,C=5;if(t==null)t=new f(10),e=!0;else{if(t=new f(t),i=t.d,t.s<0||!i||!i[0]||t.eq(1))return new f(NaN);e=t.eq(10)}if(i=h.d,h.s<0||!i||!i[0]||h.eq(1))return new f(i&&!i[0]?-1/0:h.s!=1?NaN:i?0:1/0);if(e)if(i.length>1)a=!0;else{for(r=i[0];r%10===0;)r/=10;a=r!==1}if(Z=!1,c=g+C,s=he(h,c),n=e?Xe(f,c+10):he(t,c),d=ot(s,n,c,1),Pe(d.d,r=g,b))do if(c+=10,s=he(h,c),n=e?Xe(f,c+10):he(t,c),d=ot(s,n,c,1),!a){+Ut(d.d).slice(r+1,r+15)+1==1e14&&(d=L(d,g+1,0));break}while(Pe(d.d,r+=10,b));return Z=!0,L(d,g,b)};B.minus=B.sub=function(t){var e,i,n,r,a,s,c,d,h,f,g,b,C=this,S=C.constructor;if(t=new S(t),!C.d||!t.d)return!C.s||!t.s?t=new S(NaN):C.d?t.s=-t.s:t=new S(t.d||C.s!==t.s?C:NaN),t;if(C.s!=t.s)return t.s=-t.s,C.plus(t);if(h=C.d,b=t.d,c=S.precision,d=S.rounding,!h[0]||!b[0]){if(b[0])t.s=-t.s;else if(h[0])t=new S(C);else return new S(d===3?-0:0);return Z?L(t,c,d):t}if(i=Zt(t.e/j),f=Zt(C.e/j),h=h.slice(),a=f-i,a){for(g=a<0,g?(e=h,a=-a,s=b.length):(e=b,i=f,s=h.length),n=Math.max(Math.ceil(c/j),s)+2,a>n&&(a=n,e.length=1),e.reverse(),n=a;n--;)e.push(0);e.reverse()}else{for(n=h.length,s=b.length,g=n<s,g&&(s=n),n=0;n<s;n++)if(h[n]!=b[n]){g=h[n]<b[n];break}a=0}for(g&&(e=h,h=b,b=e,t.s=-t.s),s=h.length,n=b.length-s;n>0;--n)h[s++]=0;for(n=b.length;n>a;){if(h[--n]<b[n]){for(r=n;r&&h[--r]===0;)h[r]=Yt-1;--h[r],h[n]+=Yt}h[n]-=b[n]}for(;h[--s]===0;)h.pop();for(;h[0]===0;h.shift())--i;return h[0]?(t.d=h,t.e=Je(h,i),Z?L(t,c,d):t):new S(d===3?-0:0)};B.modulo=B.mod=function(t){var e,i=this,n=i.constructor;return t=new n(t),!i.d||!t.s||t.d&&!t.d[0]?new n(NaN):!t.d||i.d&&!i.d[0]?L(new n(i),n.precision,n.rounding):(Z=!1,n.modulo==9?(e=ot(i,t.abs(),0,3,1),e.s*=t.s):e=ot(i,t,0,n.modulo,1),e=e.times(t),Z=!0,i.minus(e))};B.naturalExponential=B.exp=function(){return Si(this)};B.naturalLogarithm=B.ln=function(){return he(this)};B.negated=B.neg=function(){var t=new this.constructor(this);return t.s=-t.s,L(t)};B.plus=B.add=function(t){var e,i,n,r,a,s,c,d,h,f,g=this,b=g.constructor;if(t=new b(t),!g.d||!t.d)return!g.s||!t.s?t=new b(NaN):g.d||(t=new b(t.d||g.s===t.s?g:NaN)),t;if(g.s!=t.s)return t.s=-t.s,g.minus(t);if(h=g.d,f=t.d,c=b.precision,d=b.rounding,!h[0]||!f[0])return f[0]||(t=new b(g)),Z?L(t,c,d):t;if(a=Zt(g.e/j),n=Zt(t.e/j),h=h.slice(),r=a-n,r){for(r<0?(i=h,r=-r,s=f.length):(i=f,n=a,s=h.length),a=Math.ceil(c/j),s=a>s?a+1:s+1,r>s&&(r=s,i.length=1),i.reverse();r--;)i.push(0);i.reverse()}for(s=h.length,r=f.length,s-r<0&&(r=s,i=f,f=h,h=i),e=0;r;)e=(h[--r]=h[r]+f[r]+e)/Yt|0,h[r]%=Yt;for(e&&(h.unshift(e),++n),s=h.length;h[--s]==0;)h.pop();return t.d=h,t.e=Je(h,n),Z?L(t,c,d):t};B.precision=B.sd=function(t){var e,i=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(de+t);return i.d?(e=wr(i.d),t&&i.e+1>e&&(e=i.e+1)):e=NaN,e};B.round=function(){var t=this,e=t.constructor;return L(new e(t),t.e+1,e.rounding)};B.sine=B.sin=function(){var t,e,i=this,n=i.constructor;return i.isFinite()?i.isZero()?new n(i):(t=n.precision,e=n.rounding,n.precision=t+Math.max(i.e,i.sd())+j,n.rounding=1,i=un(n,Ar(n,i)),n.precision=t,n.rounding=e,L(oe>2?i.neg():i,t,e,!0)):new n(NaN)};B.squareRoot=B.sqrt=function(){var t,e,i,n,r,a,s=this,c=s.d,d=s.e,h=s.s,f=s.constructor;if(h!==1||!c||!c[0])return new f(!h||h<0&&(!c||c[0])?NaN:c?s:1/0);for(Z=!1,h=Math.sqrt(+s),h==0||h==1/0?(e=Ut(c),(e.length+d)%2==0&&(e+="0"),h=Math.sqrt(e),d=Zt((d+1)/2)-(d<0||d%2),h==1/0?e="5e"+d:(e=h.toExponential(),e=e.slice(0,e.indexOf("e")+1)+d),n=new f(e)):n=new f(h.toString()),i=(d=f.precision)+3;;)if(a=n,n=a.plus(ot(s,a,i+2,1)).times(.5),Ut(a.d).slice(0,i)===(e=Ut(n.d)).slice(0,i))if(e=e.slice(i-3,i+1),e=="9999"||!r&&e=="4999"){if(!r&&(L(a,d+1,0),a.times(a).eq(s))){n=a;break}i+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(L(n,d+1,1),t=!n.times(n).eq(s));break}return Z=!0,L(n,d,f.rounding,t)};B.tangent=B.tan=function(){var t,e,i=this,n=i.constructor;return i.isFinite()?i.isZero()?new n(i):(t=n.precision,e=n.rounding,n.precision=t+10,n.rounding=1,i=i.sin(),i.s=1,i=ot(i,new n(1).minus(i.times(i)).sqrt(),t+10,0),n.precision=t,n.rounding=e,L(oe==2||oe==4?i.neg():i,t,e,!0)):new n(NaN)};B.times=B.mul=function(t){var e,i,n,r,a,s,c,d,h,f=this,g=f.constructor,b=f.d,C=(t=new g(t)).d;if(t.s*=f.s,!b||!b[0]||!C||!C[0])return new g(!t.s||b&&!b[0]&&!C||C&&!C[0]&&!b?NaN:!b||!C?t.s/0:t.s*0);for(i=Zt(f.e/j)+Zt(t.e/j),d=b.length,h=C.length,d<h&&(a=b,b=C,C=a,s=d,d=h,h=s),a=[],s=d+h,n=s;n--;)a.push(0);for(n=h;--n>=0;){for(e=0,r=d+n;r>n;)c=a[r]+C[n]*b[r-n-1]+e,a[r--]=c%Yt|0,e=c/Yt|0;a[r]=(a[r]+e)%Yt|0}for(;!a[--s];)a.pop();return e?++i:a.shift(),t.d=a,t.e=Je(a,i),Z?L(t,g.precision,g.rounding):t};B.toBinary=function(t,e){return Ni(this,2,t,e)};B.toDecimalPlaces=B.toDP=function(t,e){var i=this,n=i.constructor;return i=new n(i),t===void 0?i:(Gt(t,0,pe),e===void 0?e=n.rounding:Gt(e,0,8),L(i,t+i.e+1,e))};B.toExponential=function(t,e){var i,n=this,r=n.constructor;return t===void 0?i=ee(n,!0):(Gt(t,0,pe),e===void 0?e=r.rounding:Gt(e,0,8),n=L(new r(n),t+1,e),i=ee(n,!0,t+1)),n.isNeg()&&!n.isZero()?"-"+i:i};B.toFixed=function(t,e){var i,n,r=this,a=r.constructor;return t===void 0?i=ee(r):(Gt(t,0,pe),e===void 0?e=a.rounding:Gt(e,0,8),n=L(new a(r),t+r.e+1,e),i=ee(n,!1,t+n.e+1)),r.isNeg()&&!r.isZero()?"-"+i:i};B.toFraction=function(t){var e,i,n,r,a,s,c,d,h,f,g,b,C=this,S=C.d,k=C.constructor;if(!S)return new k(C);if(h=i=new k(1),n=d=new k(0),e=new k(n),a=e.e=wr(S)-C.e-1,s=a%j,e.d[0]=Ft(10,s<0?j+s:s),t==null)t=a>0?e:h;else{if(c=new k(t),!c.isInt()||c.lt(h))throw Error(de+c);t=c.gt(e)?a>0?e:h:c}for(Z=!1,c=new k(Ut(S)),f=k.precision,k.precision=a=S.length*j*2;g=ot(c,e,0,1,1),r=i.plus(g.times(n)),r.cmp(t)!=1;)i=n,n=r,r=h,h=d.plus(g.times(r)),d=r,r=e,e=c.minus(g.times(r)),c=r;return r=ot(t.minus(i),n,0,1,1),d=d.plus(r.times(h)),i=i.plus(r.times(n)),d.s=h.s=C.s,b=ot(h,n,a,1).minus(C).abs().cmp(ot(d,i,a,1).minus(C).abs())<1?[h,n]:[d,i],k.precision=f,Z=!0,b};B.toHexadecimal=B.toHex=function(t,e){return Ni(this,16,t,e)};B.toNearest=function(t,e){var i=this,n=i.constructor;if(i=new n(i),t==null){if(!i.d)return i;t=new n(1),e=n.rounding}else{if(t=new n(t),e===void 0?e=n.rounding:Gt(e,0,8),!i.d)return t.s?i:t;if(!t.d)return t.s&&(t.s=i.s),t}return t.d[0]?(Z=!1,i=ot(i,t,0,e,1).times(t),Z=!0,L(i)):(t.s=i.s,i=t),i};B.toNumber=function(){return+this};B.toOctal=function(t,e){return Ni(this,8,t,e)};B.toPower=B.pow=function(t){var e,i,n,r,a,s,c=this,d=c.constructor,h=+(t=new d(t));if(!c.d||!t.d||!c.d[0]||!t.d[0])return new d(Ft(+c,h));if(c=new d(c),c.eq(1))return c;if(n=d.precision,a=d.rounding,t.eq(1))return L(c,n,a);if(e=Zt(t.e/j),e>=t.d.length-1&&(i=h<0?-h:h)<=nn)return r=vr(d,c,i,n),t.s<0?new d(1).div(r):L(r,n,a);if(s=c.s,s<0){if(e<t.d.length-1)return new d(NaN);if(t.d[e]&1||(s=1),c.e==0&&c.d[0]==1&&c.d.length==1)return c.s=s,c}return i=Ft(+c,h),e=i==0||!isFinite(i)?Zt(h*(Math.log("0."+Ut(c.d))/Math.LN10+c.e+1)):new d(i+"").e,e>d.maxE+1||e<d.minE-1?new d(e>0?s/0:0):(Z=!1,d.rounding=c.s=1,i=Math.min(12,(e+"").length),r=Si(t.times(he(c,n+i)),n),r.d&&(r=L(r,n+5,1),Pe(r.d,n,a)&&(e=n+10,r=L(Si(t.times(he(c,e+i)),e),e+5,1),+Ut(r.d).slice(n+1,n+15)+1==1e14&&(r=L(r,n+1,0)))),r.s=s,Z=!0,d.rounding=a,L(r,n,a))};B.toPrecision=function(t,e){var i,n=this,r=n.constructor;return t===void 0?i=ee(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Gt(t,1,pe),e===void 0?e=r.rounding:Gt(e,0,8),n=L(new r(n),t,e),i=ee(n,t<=n.e||n.e<=r.toExpNeg,t)),n.isNeg()&&!n.isZero()?"-"+i:i};B.toSignificantDigits=B.toSD=function(t,e){var i=this,n=i.constructor;return t===void 0?(t=n.precision,e=n.rounding):(Gt(t,1,pe),e===void 0?e=n.rounding:Gt(e,0,8)),L(new n(i),t,e)};B.toString=function(){var t=this,e=t.constructor,i=ee(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()&&!t.isZero()?"-"+i:i};B.truncated=B.trunc=function(){return L(new this.constructor(this),this.e+1,1)};B.valueOf=B.toJSON=function(){var t=this,e=t.constructor,i=ee(t,t.e<=e.toExpNeg||t.e>=e.toExpPos);return t.isNeg()?"-"+i:i};function Ut(t){var e,i,n,r=t.length-1,a="",s=t[0];if(r>0){for(a+=s,e=1;e<r;e++)n=t[e]+"",i=j-n.length,i&&(a+=ce(i)),a+=n;s=t[e],n=s+"",i=j-n.length,i&&(a+=ce(i))}else if(s===0)return"0";for(;s%10===0;)s/=10;return a+s}function Gt(t,e,i){if(t!==~~t||t<e||t>i)throw Error(de+t)}function Pe(t,e,i,n){var r,a,s,c;for(a=t[0];a>=10;a/=10)--e;return--e<0?(e+=j,r=0):(r=Math.ceil((e+1)/j),e%=j),a=Ft(10,j-e),c=t[r]%a|0,n==null?e<3?(e==0?c=c/100|0:e==1&&(c=c/10|0),s=i<4&&c==99999||i>3&&c==49999||c==5e4||c==0):s=(i<4&&c+1==a||i>3&&c+1==a/2)&&(t[r+1]/a/100|0)==Ft(10,e-2)-1||(c==a/2||c==0)&&(t[r+1]/a/100|0)==0:e<4?(e==0?c=c/1e3|0:e==1?c=c/100|0:e==2&&(c=c/10|0),s=(n||i<4)&&c==9999||!n&&i>3&&c==4999):s=((n||i<4)&&c+1==a||!n&&i>3&&c+1==a/2)&&(t[r+1]/a/1e3|0)==Ft(10,e-3)-1,s}function Ve(t,e,i){for(var n,r=[0],a,s=0,c=t.length;s<c;){for(a=r.length;a--;)r[a]*=e;for(r[0]+=bi.indexOf(t.charAt(s++)),n=0;n<r.length;n++)r[n]>i-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/i|0,r[n]%=i)}return r.reverse()}function sn(t,e){var i,n,r;if(e.isZero())return e;n=e.d.length,n<32?(i=Math.ceil(n/3),r=(1/Ye(4,i)).toString()):(i=16,r="2.3283064365386962890625e-10"),t.precision+=i,e=ke(t,1,e.times(r),new t(1));for(var a=i;a--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return t.precision-=i,e}var ot=function(){function t(n,r,a){var s,c=0,d=n.length;for(n=n.slice();d--;)s=n[d]*r+c,n[d]=s%a|0,c=s/a|0;return c&&n.unshift(c),n}function e(n,r,a,s){var c,d;if(a!=s)d=a>s?1:-1;else for(c=d=0;c<a;c++)if(n[c]!=r[c]){d=n[c]>r[c]?1:-1;break}return d}function i(n,r,a,s){for(var c=0;a--;)n[a]-=c,c=n[a]<r[a]?1:0,n[a]=c*s+n[a]-r[a];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,a,s,c,d){var h,f,g,b,C,S,k,T,N,q,P,O,x,U,V,K,W,ut,G,F,H=n.constructor,y=n.s==r.s?1:-1,o=n.d,l=r.d;if(!o||!o[0]||!l||!l[0])return new H(!n.s||!r.s||(o?l&&o[0]==l[0]:!l)?NaN:o&&o[0]==0||!l?y*0:y/0);for(d?(C=1,f=n.e-r.e):(d=Yt,C=j,f=Zt(n.e/C)-Zt(r.e/C)),G=l.length,W=o.length,N=new H(y),q=N.d=[],g=0;l[g]==(o[g]||0);g++);if(l[g]>(o[g]||0)&&f--,a==null?(U=a=H.precision,s=H.rounding):c?U=a+(n.e-r.e)+1:U=a,U<0)q.push(1),S=!0;else{if(U=U/C+2|0,g=0,G==1){for(b=0,l=l[0],U++;(g<W||b)&&U--;g++)V=b*d+(o[g]||0),q[g]=V/l|0,b=V%l|0;S=b||g<W}else{for(b=d/(l[0]+1)|0,b>1&&(l=t(l,b,d),o=t(o,b,d),G=l.length,W=o.length),K=G,P=o.slice(0,G),O=P.length;O<G;)P[O++]=0;F=l.slice(),F.unshift(0),ut=l[0],l[1]>=d/2&&++ut;do b=0,h=e(l,P,G,O),h<0?(x=P[0],G!=O&&(x=x*d+(P[1]||0)),b=x/ut|0,b>1?(b>=d&&(b=d-1),k=t(l,b,d),T=k.length,O=P.length,h=e(k,P,T,O),h==1&&(b--,i(k,G<T?F:l,T,d))):(b==0&&(h=b=1),k=l.slice()),T=k.length,T<O&&k.unshift(0),i(P,k,O,d),h==-1&&(O=P.length,h=e(l,P,G,O),h<1&&(b++,i(P,G<O?F:l,O,d))),O=P.length):h===0&&(b++,P=[0]),q[g++]=b,h&&P[0]?P[O++]=o[K]||0:(P=[o[K]],O=1);while((K++<W||P[0]!==void 0)&&U--);S=P[0]!==void 0}q[0]||q.shift()}if(C==1)N.e=f,fr=S;else{for(g=1,b=q[0];b>=10;b/=10)g++;N.e=g+f*C-1,L(N,c?a+N.e+1:a,s,S)}return N}}();function L(t,e,i,n){var r,a,s,c,d,h,f,g,b,C=t.constructor;t:if(e!=null){if(g=t.d,!g)return t;for(r=1,c=g[0];c>=10;c/=10)r++;if(a=e-r,a<0)a+=j,s=e,f=g[b=0],d=f/Ft(10,r-s-1)%10|0;else if(b=Math.ceil((a+1)/j),c=g.length,b>=c)if(n){for(;c++<=b;)g.push(0);f=d=0,r=1,a%=j,s=a-j+1}else break t;else{for(f=c=g[b],r=1;c>=10;c/=10)r++;a%=j,s=a-j+r,d=s<0?0:f/Ft(10,r-s-1)%10|0}if(n=n||e<0||g[b+1]!==void 0||(s<0?f:f%Ft(10,r-s-1)),h=i<4?(d||n)&&(i==0||i==(t.s<0?3:2)):d>5||d==5&&(i==4||n||i==6&&(a>0?s>0?f/Ft(10,r-s):0:g[b-1])%10&1||i==(t.s<0?8:7)),e<1||!g[0])return g.length=0,h?(e-=t.e+1,g[0]=Ft(10,(j-e%j)%j),t.e=-e||0):g[0]=t.e=0,t;if(a==0?(g.length=b,c=1,b--):(g.length=b+1,c=Ft(10,j-a),g[b]=s>0?(f/Ft(10,r-s)%Ft(10,s)|0)*c:0),h)for(;;)if(b==0){for(a=1,s=g[0];s>=10;s/=10)a++;for(s=g[0]+=c,c=1;s>=10;s/=10)c++;a!=c&&(t.e++,g[0]==Yt&&(g[0]=1));break}else{if(g[b]+=c,g[b]!=Yt)break;g[b--]=0,c=1}for(a=g.length;g[--a]===0;)g.pop()}return Z&&(t.e>C.maxE?(t.d=null,t.e=NaN):t.e<C.minE&&(t.e=0,t.d=[0])),t}function ee(t,e,i){if(!t.isFinite())return br(t);var n,r=t.e,a=Ut(t.d),s=a.length;return e?(i&&(n=i-s)>0?a=a.charAt(0)+"."+a.slice(1)+ce(n):s>1&&(a=a.charAt(0)+"."+a.slice(1)),a=a+(t.e<0?"e":"e+")+t.e):r<0?(a="0."+ce(-r-1)+a,i&&(n=i-s)>0&&(a+=ce(n))):r>=s?(a+=ce(r+1-s),i&&(n=i-r-1)>0&&(a=a+"."+ce(n))):((n=r+1)<s&&(a=a.slice(0,n)+"."+a.slice(n)),i&&(n=i-s)>0&&(r+1===s&&(a+="."),a+=ce(n))),a}function Je(t,e){var i=t[0];for(e*=j;i>=10;i/=10)e++;return e}function Xe(t,e,i){if(e>on)throw Z=!0,i&&(t.precision=i),Error(pr);return L(new t(We),e,1,!0)}function zt(t,e,i){if(e>Mi)throw Error(pr);return L(new t(Ge),e,i,!0)}function wr(t){var e=t.length-1,i=e*j+1;if(e=t[e],e){for(;e%10==0;e/=10)i--;for(e=t[0];e>=10;e/=10)i++}return i}function ce(t){for(var e="";t--;)e+="0";return e}function vr(t,e,i,n){var r,a=new t(1),s=Math.ceil(n/j+4);for(Z=!1;;){if(i%2&&(a=a.times(e),Yi(a.d,s)&&(r=!0)),i=Zt(i/2),i===0){i=a.d.length-1,r&&a.d[i]===0&&++a.d[i];break}e=e.times(e),Yi(e.d,s)}return Z=!0,a}function Ji(t){return t.d[t.d.length-1]&1}function yr(t,e,i){for(var n,r=new t(e[0]),a=0;++a<e.length;)if(n=new t(e[a]),n.s)r[i](n)&&(r=n);else{r=n;break}return r}function Si(t,e){var i,n,r,a,s,c,d,h=0,f=0,g=0,b=t.constructor,C=b.rounding,S=b.precision;if(!t.d||!t.d[0]||t.e>17)return new b(t.d?t.d[0]?t.s<0?0:1/0:1:t.s?t.s<0?0:t:0/0);for(e==null?(Z=!1,d=S):d=e,c=new b(.03125);t.e>-2;)t=t.times(c),g+=5;for(n=Math.log(Ft(2,g))/Math.LN10*2+5|0,d+=n,i=a=s=new b(1),b.precision=d;;){if(a=L(a.times(t),d,1),i=i.times(++f),c=s.plus(ot(a,i,d,1)),Ut(c.d).slice(0,d)===Ut(s.d).slice(0,d)){for(r=g;r--;)s=L(s.times(s),d,1);if(e==null)if(h<3&&Pe(s.d,d-n,C,h))b.precision=d+=10,i=a=c=new b(1),f=0,h++;else return L(s,b.precision=S,C,Z=!0);else return b.precision=S,s}s=c}}function he(t,e){var i,n,r,a,s,c,d,h,f,g,b,C=1,S=10,k=t,T=k.d,N=k.constructor,q=N.rounding,P=N.precision;if(k.s<0||!T||!T[0]||!k.e&&T[0]==1&&T.length==1)return new N(T&&!T[0]?-1/0:k.s!=1?NaN:T?0:k);if(e==null?(Z=!1,f=P):f=e,N.precision=f+=S,i=Ut(T),n=i.charAt(0),Math.abs(a=k.e)<15e14){for(;n<7&&n!=1||n==1&&i.charAt(1)>3;)k=k.times(t),i=Ut(k.d),n=i.charAt(0),C++;a=k.e,n>1?(k=new N("0."+i),a++):k=new N(n+"."+i.slice(1))}else return h=Xe(N,f+2,P).times(a+""),k=he(new N(n+"."+i.slice(1)),f-S).plus(h),N.precision=P,e==null?L(k,P,q,Z=!0):k;for(g=k,d=s=k=ot(k.minus(1),k.plus(1),f,1),b=L(k.times(k),f,1),r=3;;){if(s=L(s.times(b),f,1),h=d.plus(ot(s,new N(r),f,1)),Ut(h.d).slice(0,f)===Ut(d.d).slice(0,f))if(d=d.times(2),a!==0&&(d=d.plus(Xe(N,f+2,P).times(a+""))),d=ot(d,new N(C),f,1),e==null)if(Pe(d.d,f-S,q,c))N.precision=f+=S,h=s=k=ot(g.minus(1),g.plus(1),f,1),b=L(k.times(k),f,1),r=c=1;else return L(d,N.precision=P,q,Z=!0);else return N.precision=P,d;d=h,r+=2}}function br(t){return String(t.s*t.s/0)}function Ci(t,e){var i,n,r;for((i=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(i<0&&(i=n),i+=+e.slice(n+1),e=e.substring(0,n)):i<0&&(i=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,t.e=i=i-n-1,t.d=[],n=(i+1)%j,i<0&&(n+=j),n<r){for(n&&t.d.push(+e.slice(0,n)),r-=j;n<r;)t.d.push(+e.slice(n,n+=j));e=e.slice(n),n=j-e.length}else n-=r;for(;n--;)e+="0";t.d.push(+e),Z&&(t.e>t.constructor.maxE?(t.d=null,t.e=NaN):t.e<t.constructor.minE&&(t.e=0,t.d=[0]))}else t.e=0,t.d=[0];return t}function an(t,e){var i,n,r,a,s,c,d,h,f;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),_r.test(e))return Ci(t,e)}else if(e==="Infinity"||e==="NaN")return+e||(t.s=NaN),t.e=NaN,t.d=null,t;if(en.test(e))i=16,e=e.toLowerCase();else if(tn.test(e))i=2;else if(rn.test(e))i=8;else throw Error(de+e);for(a=e.search(/p/i),a>0?(d=+e.slice(a+1),e=e.substring(2,a)):e=e.slice(2),a=e.indexOf("."),s=a>=0,n=t.constructor,s&&(e=e.replace(".",""),c=e.length,a=c-a,r=vr(n,new n(i),a,a*2)),h=Ve(e,i,Yt),f=h.length-1,a=f;h[a]===0;--a)h.pop();return a<0?new n(t.s*0):(t.e=Je(h,f),t.d=h,Z=!1,s&&(t=ot(t,r,c*4)),d&&(t=t.times(Math.abs(d)<54?Ft(2,d):Oe.pow(2,d))),Z=!0,t)}function un(t,e){var i,n=e.d.length;if(n<3)return e.isZero()?e:ke(t,2,e,e);i=1.4*Math.sqrt(n),i=i>16?16:i|0,e=e.times(1/Ye(5,i)),e=ke(t,2,e,e);for(var r,a=new t(5),s=new t(16),c=new t(20);i--;)r=e.times(e),e=e.times(a.plus(r.times(s.times(r).minus(c))));return e}function ke(t,e,i,n,r){var a,s,c,d,h=t.precision,f=Math.ceil(h/j);for(Z=!1,d=i.times(i),c=new t(n);;){if(s=ot(c.times(d),new t(e++*e++),h,1),c=r?n.plus(s):n.minus(s),n=ot(s.times(d),new t(e++*e++),h,1),s=c.plus(n),s.d[f]!==void 0){for(a=f;s.d[a]===c.d[a]&&a--;);if(a==-1)break}a=c,c=n,n=s,s=a}return Z=!0,s.d.length=f+1,s}function Ye(t,e){for(var i=t;--e;)i*=t;return i}function Ar(t,e){var i,n=e.s<0,r=zt(t,t.precision,1),a=r.times(.5);if(e=e.abs(),e.lte(a))return oe=n?4:1,e;if(i=e.divToInt(r),i.isZero())oe=n?3:2;else{if(e=e.minus(i.times(r)),e.lte(a))return oe=Ji(i)?n?2:3:n?4:1,e;oe=Ji(i)?n?1:4:n?3:2}return e.minus(r).abs()}function Ni(t,e,i,n){var r,a,s,c,d,h,f,g,b,C=t.constructor,S=i!==void 0;if(S?(Gt(i,1,pe),n===void 0?n=C.rounding:Gt(n,0,8)):(i=C.precision,n=C.rounding),!t.isFinite())f=br(t);else{for(f=ee(t),s=f.indexOf("."),S?(r=2,e==16?i=i*4-3:e==8&&(i=i*3-2)):r=e,s>=0&&(f=f.replace(".",""),b=new C(1),b.e=f.length-s,b.d=Ve(ee(b),10,r),b.e=b.d.length),g=Ve(f,10,r),a=d=g.length;g[--d]==0;)g.pop();if(!g[0])f=S?"0p+0":"0";else{if(s<0?a--:(t=new C(t),t.d=g,t.e=a,t=ot(t,b,i,n,0,r),g=t.d,a=t.e,h=fr),s=g[i],c=r/2,h=h||g[i+1]!==void 0,h=n<4?(s!==void 0||h)&&(n===0||n===(t.s<0?3:2)):s>c||s===c&&(n===4||h||n===6&&g[i-1]&1||n===(t.s<0?8:7)),g.length=i,h)for(;++g[--i]>r-1;)g[i]=0,i||(++a,g.unshift(1));for(d=g.length;!g[d-1];--d);for(s=0,f="";s<d;s++)f+=bi.charAt(g[s]);if(S){if(d>1)if(e==16||e==8){for(s=e==16?4:3,--d;d%s;d++)f+="0";for(g=Ve(f,r,e),d=g.length;!g[d-1];--d);for(s=1,f="1.";s<d;s++)f+=bi.charAt(g[s])}else f=f.charAt(0)+"."+f.slice(1);f=f+(a<0?"p":"p+")+a}else if(a<0){for(;++a;)f="0"+f;f="0."+f}else if(++a>d)for(a-=d;a--;)f+="0";else a<d&&(f=f.slice(0,a)+"."+f.slice(a))}f=(e==16?"0x":e==2?"0b":e==8?"0o":"")+f}return t.s<0?"-"+f:f}function Yi(t,e){if(t.length>e)return t.length=e,!0}function ln(t){return new this(t).abs()}function cn(t){return new this(t).acos()}function hn(t){return new this(t).acosh()}function dn(t,e){return new this(t).plus(e)}function fn(t){return new this(t).asin()}function pn(t){return new this(t).asinh()}function mn(t){return new this(t).atan()}function gn(t){return new this(t).atanh()}function _n(t,e){t=new this(t),e=new this(e);var i,n=this.precision,r=this.rounding,a=n+4;return!t.s||!e.s?i=new this(NaN):!t.d&&!e.d?(i=zt(this,a,1).times(e.s>0?.25:.75),i.s=t.s):!e.d||t.isZero()?(i=e.s<0?zt(this,n,r):new this(0),i.s=t.s):!t.d||e.isZero()?(i=zt(this,a,1).times(.5),i.s=t.s):e.s<0?(this.precision=a,this.rounding=1,i=this.atan(ot(t,e,a,1)),e=zt(this,a,1),this.precision=n,this.rounding=r,i=t.s<0?i.minus(e):i.plus(e)):i=this.atan(ot(t,e,a,1)),i}function wn(t){return new this(t).cbrt()}function vn(t){return L(t=new this(t),t.e+1,2)}function yn(t,e,i){return new this(t).clamp(e,i)}function bn(t){if(!t||typeof t!="object")throw Error(ze+"Object expected");var e,i,n,r=t.defaults===!0,a=["precision",1,pe,"rounding",0,8,"toExpNeg",-be,0,"toExpPos",0,be,"maxE",0,be,"minE",-be,0,"modulo",0,9];for(e=0;e<a.length;e+=3)if(i=a[e],r&&(this[i]=Ai[i]),(n=t[i])!==void 0)if(Zt(n)===n&&n>=a[e+1]&&n<=a[e+2])this[i]=n;else throw Error(de+i+": "+n);if(i="crypto",r&&(this[i]=Ai[i]),(n=t[i])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[i]=!0;else throw Error(mr);else this[i]=!1;else throw Error(de+i+": "+n);return this}function An(t){return new this(t).cos()}function Mn(t){return new this(t).cosh()}function Mr(t){var e,i,n;function r(a){var s,c,d,h=this;if(!(h instanceof r))return new r(a);if(h.constructor=r,Qi(a)){h.s=a.s,Z?!a.d||a.e>r.maxE?(h.e=NaN,h.d=null):a.e<r.minE?(h.e=0,h.d=[0]):(h.e=a.e,h.d=a.d.slice()):(h.e=a.e,h.d=a.d?a.d.slice():a.d);return}if(d=typeof a,d==="number"){if(a===0){h.s=1/a<0?-1:1,h.e=0,h.d=[0];return}if(a<0?(a=-a,h.s=-1):h.s=1,a===~~a&&a<1e7){for(s=0,c=a;c>=10;c/=10)s++;Z?s>r.maxE?(h.e=NaN,h.d=null):s<r.minE?(h.e=0,h.d=[0]):(h.e=s,h.d=[a]):(h.e=s,h.d=[a]);return}else if(a*0!==0){a||(h.s=NaN),h.e=NaN,h.d=null;return}return Ci(h,a.toString())}else if(d!=="string")throw Error(de+a);return(c=a.charCodeAt(0))===45?(a=a.slice(1),h.s=-1):(c===43&&(a=a.slice(1)),h.s=1),_r.test(a)?Ci(h,a):an(h,a)}if(r.prototype=B,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=bn,r.clone=Mr,r.isDecimal=Qi,r.abs=ln,r.acos=cn,r.acosh=hn,r.add=dn,r.asin=fn,r.asinh=pn,r.atan=mn,r.atanh=gn,r.atan2=_n,r.cbrt=wn,r.ceil=vn,r.clamp=yn,r.cos=An,r.cosh=Mn,r.div=Sn,r.exp=Cn,r.floor=kn,r.hypot=qn,r.ln=Tn,r.log=Bn,r.log10=Pn,r.log2=Nn,r.max=On,r.min=En,r.mod=In,r.mul=xn,r.pow=Ln,r.random=Rn,r.round=jn,r.sign=Fn,r.sin=Dn,r.sinh=$n,r.sqrt=Un,r.sub=Vn,r.sum=Zn,r.tan=Hn,r.tanh=Wn,r.trunc=Gn,t===void 0&&(t={}),t&&t.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)t.hasOwnProperty(i=n[e++])||(t[i]=this[i]);return r.config(t),r}function Sn(t,e){return new this(t).div(e)}function Cn(t){return new this(t).exp()}function kn(t){return L(t=new this(t),t.e+1,3)}function qn(){var t,e,i=new this(0);for(Z=!1,t=0;t<arguments.length;)if(e=new this(arguments[t++]),e.d)i.d&&(i=i.plus(e.times(e)));else{if(e.s)return Z=!0,new this(1/0);i=e}return Z=!0,i.sqrt()}function Qi(t){return t instanceof Oe||t&&t.toStringTag===gr||!1}function Tn(t){return new this(t).ln()}function Bn(t,e){return new this(t).log(e)}function Nn(t){return new this(t).log(2)}function Pn(t){return new this(t).log(10)}function On(){return yr(this,arguments,"lt")}function En(){return yr(this,arguments,"gt")}function In(t,e){return new this(t).mod(e)}function xn(t,e){return new this(t).mul(e)}function Ln(t,e){return new this(t).pow(e)}function Rn(t){var e,i,n,r,a=0,s=new this(1),c=[];if(t===void 0?t=this.precision:Gt(t,1,pe),n=Math.ceil(t/j),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));a<n;)r=e[a],r>=429e7?e[a]=crypto.getRandomValues(new Uint32Array(1))[0]:c[a++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);a<n;)r=e[a]+(e[a+1]<<8)+(e[a+2]<<16)+((e[a+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,a):(c.push(r%1e7),a+=4);a=n/4}else throw Error(mr);else for(;a<n;)c[a++]=Math.random()*1e7|0;for(n=c[--a],t%=j,n&&t&&(r=Ft(10,j-t),c[a]=(n/r|0)*r);c[a]===0;a--)c.pop();if(a<0)i=0,c=[0];else{for(i=-1;c[0]===0;i-=j)c.shift();for(n=1,r=c[0];r>=10;r/=10)n++;n<j&&(i-=j-n)}return s.e=i,s.d=c,s}function jn(t){return L(t=new this(t),t.e+1,this.rounding)}function Fn(t){return t=new this(t),t.d?t.d[0]?t.s:0*t.s:t.s||NaN}function Dn(t){return new this(t).sin()}function $n(t){return new this(t).sinh()}function Un(t){return new this(t).sqrt()}function Vn(t,e){return new this(t).sub(e)}function Zn(){var t=0,e=arguments,i=new this(e[t]);for(Z=!1;i.s&&++t<e.length;)i=i.plus(e[t]);return Z=!0,L(i,this.precision,this.rounding)}function Hn(t){return new this(t).tan()}function Wn(t){return new this(t).tanh()}function Gn(t){return L(t=new this(t),t.e+1,1)}B[Symbol.for("nodejs.util.inspect.custom")]=B.toString;B[Symbol.toStringTag]="Decimal";var Oe=B.constructor=Mr(Ai);We=new Oe(We);Ge=new Oe(Ge);var Ze=Oe,ne=Te(Be()),wi=Te(Be()),Xn=class{constructor(t){if(t!==0)throw new Error("Aftermath only supported on mainnet");this.slippage="900000000000000000",this.poolRegistry="0xfcc774493db2c45c79f688f88d28023a3e7d98e4ee9f48bbf5c7990f651577ae",this.protocolFeeVault="0xf194d9b1bcad972e45a7dd67dd49b3ee1e3357a00a50850c52cd51bb450e13b4",this.treasury="0x28e499dff5e864a2eafe476269a4f5035f1c16f338da7be18b103499abf271ce",this.insuranceFund="0xf0c40d67b078000e18032334c3325c47b9ec9f3d9ae4128be820d54663d14e3b",this.referrealVault="0x35d35b0e5b177593d8c3a801462485572fc30861e6ce96a55af6dc4730709278"}amountLimit(t){return Number(new wi.default(t).mul(new wi.default(this.slippage)).div(new wi.default("1000000000000000000")).toString())}swap(t,e,i,n){return nt(this,null,function*(){const{direction:r,from:a,target:s}=i,[c,d,h]=r?["swap_a2b",a,s]:["swap_b2a",s,a];if(i.extendedDetails==null)throw new Error("Extended details not supported");if(i.extendedDetails.aftermathLpSupplyType==null)throw new Error("LP supply type not supported");const f=[e.object(i.id),e.object(this.poolRegistry),e.object(this.protocolFeeVault),e.object(this.treasury),e.object(this.insuranceFund),e.object(this.referrealVault),e.pure.u64(this.amountLimit(i.amountOut)),e.pure.u64(this.slippage),n];return e.moveCall({target:`${t.publishedAt()}::aftermath::${c}`,typeArguments:[d,h,i.extendedDetails.aftermathLpSupplyType],arguments:f})})}},tr="0x000000000000000000000000000000000000000000000000000000000000dee9",Kn=class{constructor(t){if(t!==0)throw new Error("Aftermath only supported on mainnet")}getAccountCap(t,e){return nt(this,null,function*(){let i=50,n=null;for(;;){const r=t.getOwnedObjects({owner:e,cursor:n,limit:i,filter:{MoveModule:{package:tr,module:"custodian_v2"}}});if(r!=null&&r.data!=null){if(r.data.length!==0)return r.data[0].data.objectId;if(r.data.length<50)break}else break}return null})}getOrCreateAccountCap(t,e,i){return nt(this,null,function*(){let n=yield this.getAccountCap(e,i);return n!==null?{accountCap:t.object(n),isCreate:!1}:{accountCap:t.moveCall({target:`${tr}::clob_v2::create_account`,typeArguments:[],arguments:[]}),isCreate:!0}})}swap(t,e,i,n){return nt(this,null,function*(){const{direction:r,from:a,target:s}=i,[c,d,h]=r?["swap_a2b",a,s]:["swap_b2a",s,a],f=yield this.getOrCreateAccountCap(e,t.client,t.signer),g=[e.object(i.id),n,f.accountCap,e.object(qe)],b=e.moveCall({target:`${t.publishedAt()}::deepbook::${c}`,typeArguments:[d,h],arguments:g});return f.isCreate&&e.transferObjects([f.accountCap],t.signer),b})}},zn=class{constructor(t){if(t!==0)throw new Error("Kriya amm only supported on mainnet")}swap(t,e,i,n){return nt(this,null,function*(){const{direction:r,from:a,target:s}=i,[c,d,h]=r?["swap_a2b",a,s]:["swap_b2a",s,a],f=[e.object(i.id),n];return e.moveCall({target:`${t.publishedAt()}::kriya_amm::${c}`,typeArguments:[d,h],arguments:f})})}},Jn=class{constructor(t){if(t!==0)throw new Error("Flowx only supported on mainnet");this.container="0xb65dcbf63fd3ad5d0ebfbf334780dc9f785eff38a4459e37ab08fa79576ee511"}swap(t,e,i,n){return nt(this,null,function*(){const{direction:r,from:a,target:s}=i,[c,d,h]=r?["swap_a2b",a,s]:["swap_b2a",s,a],f=[e.object(this.container),n];return e.moveCall({target:`${t.publishedAt()}::flowx_amm::${c}`,typeArguments:[d,h],arguments:f})})}},Yn=class{constructor(t){if(t!==0)throw new Error("Turbos only supported on mainnet");this.versioned="0xf1cf0e81048df168ebeb1b8030fad24b3e0b53ae827c25053fff0779c1445b6f"}swap(t,e,i,n){return nt(this,null,function*(){const{direction:r,from:a,target:s}=i,[c,d,h]=r?["swap_a2b",a,s]:["swap_b2a",s,a];if(i.extendedDetails==null)throw new Error("Extended details not supported");if(i.extendedDetails.turbosFeeType==null)throw new Error("Turbos fee type not supported");const f=[e.object(i.id),n,e.object(qe),e.object(this.versioned)];return e.moveCall({target:`${t.publishedAt()}::turbos::${c}`,typeArguments:[d,h,i.extendedDetails.turbosFeeType],arguments:f})})}},er=class{constructor(t,e){this.globalConfig=t===0?"0xdaa46292632c3c4d8f31f23ea0f9b36a28ff3677e9684980e4438403a67a3d8f":"0x6f4149091a5aea0e818e7243a13adcfb403842d670b9a2089de058512620687a",this.partner=e??t===0?"0x639b5e433da31739e800cd085f356e64cae222966d0f1b11bd9dc76b322ff58b":"0x8e0b7668a79592f70fbfb1ae0aebaf9e2019a7049783b9a4b6fe7c6ae038b528"}flash_swap(t,e,i,n){const{direction:r,from:a,target:s}=i,[c,d,h]=r?["flash_swap_a2b",a,s]:["flash_swap_b2a",s,a];let f=n?i.amountIn:i.amountOut;const g=[e.object(this.globalConfig),e.object(i.id),e.object(this.partner),e.pure.u64(f),e.pure.bool(n),e.object(qe)],b=e.moveCall({target:`${t.publishedAt()}::cetus::${c}`,typeArguments:[d,h],arguments:g});return{targetCoin:b[0],flashReceipt:b[1],payAmount:b[2]}}repay_flash_swap(t,e,i,n,r){const{direction:a,from:s,target:c}=i,[d,h,f]=a?["repay_flash_swap_a2b",s,c]:["repay_flash_swap_b2a",c,s],g=[e.object(this.globalConfig),e.object(i.id),e.object(this.partner),n,r];return e.moveCall({target:`${t.publishedAt()}::cetus::${d}`,typeArguments:[h,f],arguments:g})[0]}swap(t,e,i,n){return nt(this,null,function*(){const{direction:r,from:a,target:s}=i,[c,d,h]=r?["swap_a2b",a,s]:["swap_b2a",s,a],f=[e.object(this.globalConfig),e.object(i.id),e.object(this.partner),n,e.object(qe)];return e.moveCall({target:`${t.publishedAt()}::cetus::${c}`,typeArguments:[d,h],arguments:f})})}};function ir(t,...e){const i=Array.isArray(e[e.length-1])?e.pop():[];let r=[t,...e].filter(Boolean).join("::");return i&&i.length&&(r+=`<${i.join(", ")}>`),r}function Se(t){var e;try{let i=t.replace(/\s/g,"");const n=i.match(/(<.+>)$/),r=(e=n==null?void 0:n[0])==null?void 0:e.match(/(\w+::\w+::\w+)(?:<.*?>(?!>))?/g);if(r){i=i.slice(0,i.indexOf("<"));const d=Se(i),h=zr(Kr({},d),{type_arguments:r.map(f=>Se(f).source_address)});return h.type_arguments=h.type_arguments.map(f=>_e.isSuiCoin(f)?f:Se(f).source_address),h.source_address=ir(h.full_address,h.type_arguments),h}const a=i.split("::"),c={full_address:i,address:i===Sr||i===eo?"0x2":yi.normalizeSuiObjectId(a[0]),module:a[1],name:a[2],type_arguments:[],source_address:""};return c.full_address=`${c.address}::${c.module}::${c.name}`,c.source_address=ir(c.full_address,c.type_arguments),c}catch{return{full_address:t,address:"",module:"",name:"",type_arguments:[],source_address:t}}}function rr(t){return Se(t).source_address}var Qn="0x2::coin::Coin",to=/^0x2::coin::Coin<(.+)>$/,Sr="0x2::sui::SUI",eo="0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI",_e=class le{static getCoinTypeArg(e){const i=e.type.match(to);return i?i[1]:null}static isSUI(e){const i=le.getCoinTypeArg(e);return i?le.getCoinSymbol(i)==="SUI":!1}static getCoinSymbol(e){return e.substring(e.lastIndexOf(":")+1)}static getBalance(e){return BigInt(e.fields.balance)}static totalBalance(e,i){let n=BigInt(0);return e.forEach(r=>{i===r.coinAddress&&(n+=BigInt(r.balance))}),n}static getID(e){return e.fields.id.id}static getCoinTypeFromArg(e){return`${Qn}<${e}>`}static getCoinAssets(e,i){const n=[];return i.forEach(r=>{rr(r.coinAddress)===rr(e)&&n.push(r)}),n}static isSuiCoin(e){return Se(e).full_address===Sr}static selectCoinObjectIdGreaterThanOrEqual(e,i,n=[]){const r=le.selectCoinAssetGreaterThanOrEqual(e,i,n),a=r.selectedCoins.map(d=>d.coinObjectId),s=r.remainingCoins,c=r.selectedCoins.map(d=>d.balance.toString());return{objectArray:a,remainCoins:s,amountArray:c}}static selectCoinAssetGreaterThanOrEqual(e,i,n=[]){const r=le.sortByBalance(e.filter(h=>!n.includes(h.coinObjectId))),a=le.calculateTotalBalance(r);if(a<i)return{selectedCoins:[],remainingCoins:r};if(a===i)return{selectedCoins:r,remainingCoins:[]};let s=BigInt(0);const c=[],d=[...r];for(;s<a;){const h=i-s,f=d.findIndex(b=>b.balance>=h);if(f!==-1){c.push(d[f]),d.splice(f,1);break}const g=d.pop();g.balance>0&&(c.push(g),s+=g.balance)}return{selectedCoins:le.sortByBalance(c),remainingCoins:le.sortByBalance(d)}}static sortByBalance(e){return e.sort((i,n)=>i.balance<n.balance?-1:i.balance>n.balance?1:0)}static sortByBalanceDes(e){return e.sort((i,n)=>i.balance>n.balance?-1:i.balance<n.balance?0:1)}static calculateTotalBalance(e){return e.reduce((i,n)=>i+n.balance,BigInt(0))}};function nr(t){switch(t){case 1e4:return"Calculate error";case 10001:return"Input number too large can not fit in target type";case 10002:return"No router";case 10003:return"Insufficient Liquidity";default:return"Unknown error"}}function fe(t){const e=t.indexOf("::");if(e===-1)return t;const i=t.substring(0,e),n=t.substring(e);if(!i.startsWith("0x"))return t;const r=i.substring(2);return r.length>64?t:`0x${r.padStart(64,"0")}${n}`}function io(t,e){t=fe(t),e=fe(e);const i=Math.min(t.length,e.length);for(let n=0;n<i;n++){if(t[n]>e[n])return!0;if(t[n]<e[n])return!1}return!0}function ro(t,e){return t.moveCall({target:"0x2::coin::zero",typeArguments:[e]})}function or(t,e,i,n){const r=_e.getCoinAssets(n,e);if(i===BigInt(0)&&r.length===0)return{targetCoin:ro(t,n),isMintZeroCoin:!0,targetCoinAmount:0};if(_e.calculateTotalBalance(r)<i)throw new AggregateError("Insufficient balance when build merge coin","InsufficientBalance");if(_e.isSuiCoin(n))return{targetCoin:t.splitCoins(t.gas,[t.pure.u64(i.toString())]),isMintZeroCoin:!0,targetCoinAmount:Number(i.toString())};let s=_e.sortByBalance(r);s.slice(0,3).reduce((g,b)=>g+b.balance,BigInt(0))<BigInt(i)&&(s=_e.sortByBalanceDes(r));let d=_e.selectCoinObjectIdGreaterThanOrEqual(s,i);const[h,...f]=d.objectArray;return f.length>0&&t.mergeCoins(h,f.map(g=>t.object(g))),{targetCoin:t.object(h),isMintZeroCoin:!1,targetCoinAmount:Number(i.toString())}}function no(t){return!(!t.startsWith("0x")||t.length!==66)}var ve=Te(Be()),Fe=Te(Be()),Ee=Te(Be()),Ae=new Ee.default(0);new Ee.default(1);var oo=new Ee.default(2);oo.pow(new Ee.default(128));var so=new Ee.default("18446744073709551615"),ye=1e9;function sr(t,e,i){let n=Ae;return e?n=t.mul(new Fe.default(ye-i*ye)).div(new Fe.default(ye)):n=t.mul(new Fe.default(ye+i*ye)).div(new Fe.default(ye)),Number(n.toString())}function ao(t,e,i){return new Ze(t).mul(Ze.pow(2,-64)).pow(2).mul(Ze.pow(10,e-i))}function uo(t,e,i){return nt(this,null,function*(){var n,r,a,s,c;const{from:d,target:h,amount:f,byAmountIn:g,pools:b}=e,C=fe(d),S=fe(h),k=new Ur.Transaction,T=io(C,S),N="0x8faab90228e4c4df91c41626bbaefa19fc25c514405ac64de54578dec9e6f5ee",q=T?C:S,P=T?S:C,O=[q,P];for(let l=0;l<b.length;l++){const p=[k.object(b[l]),k.pure.bool(T),k.pure.bool(g),k.pure.u64(f.toString())];k.moveCall({target:`${N}::fetcher_script::calculate_swap_result`,arguments:p,typeArguments:O})}if(!no(i))throw new AggregateError("Aggregator package not set","InvalidWallet");const x=yield t.devInspectTransactionBlock({transactionBlock:k,sender:i});if(x.error!=null)throw new AggregateError("Aggregator package not set","SimulateError");const U=(n=x.events)==null?void 0:n.filter(l=>l.type.includes("CalculatedSwapResultEvent"));if(U.length===0||U.length!==b.length)throw new AggregateError("Simulate event result error","simulateEventError");let V=g?Ae:so,K=0;for(let l=0;l<U.length;l+=1)if(!U[l].parsedJson.data.is_exceed)if(e.byAmountIn){const p=new ve.BN(U[l].parsedJson.data.amount_out);p.gt(V)&&(K=l,V=p)}else{const p=new ve.BN(U[l].parsedJson.data.amount_out);p.lt(V)&&(K=l,V=p)}const W=U[K].parsedJson.data;console.log("event",JSON.stringify(W,null,2));const ut=W.step_results[0].current_sqrt_price,[G,F]=yield Promise.all([t.getCoinMetadata({coinType:q}).then(l=>l==null?void 0:l.decimals),t.getCoinMetadata({coinType:P}).then(l=>l==null?void 0:l.decimals)]);if(G==null||F==null)throw new AggregateError("Simulate event result error","CannotGetDecimals");const H=ao(ut,G,F),y={amountIn:new ve.BN((r=W.amount_in)!=null?r:0),amountOut:new ve.BN((a=W.amount_out)!=null?a:0),routes:[{path:[{id:b[K],direction:T,provider:"CETUS",from:C,target:S,feeRate:W.fee_rate,amountIn:W.amount_in,amountOut:W.amount_out,extendedDetails:{afterSqrtPrice:W.after_sqrt_price}}],amountIn:new ve.BN((s=W.amount_in)!=null?s:0),amountOut:new ve.BN((c=W.amount_out)!=null?c:0),initialPrice:H}],insufficientLiquidity:!1};return{isExceed:W.is_exceed,routeData:y}})}var lo=class{constructor(t){if(t!==0)throw new Error("Kriya clmm only supported on mainnet");this.version="0xf5145a7ac345ca8736cf8c76047d00d6d378f30e81be6f6eb557184d9de93c78"}swap(t,e,i,n){return nt(this,null,function*(){const{direction:r,from:a,target:s}=i,[c,d,h]=r?["swap_a2b",a,s]:["swap_b2a",s,a],f=[e.object(i.id),n,e.object(this.version),e.object(qe)];return e.moveCall({target:`${t.publishedAt()}::kriya_clmm::${c}`,typeArguments:[d,h],arguments:f})})}},co=class{constructor(t){if(t!==0)throw new Error("Haedal only supported on mainnet")}swap(t,e,i,n){return nt(this,null,function*(){const{direction:r}=i;if(!r)throw new Error("Haedal not support b2a swap");const a="swap_a2b",s=[e.object(i.id),e.object("0x5"),n];return e.moveCall({target:`${t.publishedAt()}::haedal::${a}`,typeArguments:[],arguments:s})})}},ho=class{constructor(t){if(t!==0)throw new Error("Afsui only supported on mainnet");this.stakedSuiVault="0x2f8f6d5da7f13ea37daa397724280483ed062769813b6f31e9788e59cc88994d",this.safe="0xeb685899830dd5837b47007809c76d91a098d52aabbf61e8ac467c59e5cc4610",this.referVault="0x4ce9a19b594599536c53edb25d22532f82f18038dc8ef618afd00fbbfb9845ef",this.validator="0xd30018ec3f5ff1a3c75656abf927a87d7f0529e6dc89c7ddd1bd27ecb05e3db2"}swap(t,e,i,n){return nt(this,null,function*(){const{direction:r}=i;if(!r)throw new Error("Afsui not support b2a swap");const a="swap_a2b",s=[e.object(this.stakedSuiVault),e.object(this.safe),e.object("0x5"),e.object(this.referVault),e.object(this.validator),n];return e.moveCall({target:`${t.publishedAt()}::afsui::${a}`,typeArguments:[],arguments:s})})}},fo=class{constructor(t){if(t!==0)throw new Error("Volo only supported on mainnet");this.nativePool="0x7fa2faa111b8c65bea48a23049bfd81ca8f971a262d981dcd9a17c3825cb5baf",this.metadata="0x680cd26af32b2bde8d3361e804c53ec1d1cfe24c7f039eb7f549e8dfde389a60"}swap(t,e,i,n){return nt(this,null,function*(){const{direction:r}=i;if(!r)throw new Error("Volo not support b2a swap");const a="swap_a2b",s=[e.object(this.nativePool),e.object(this.metadata),e.object("0x5"),n];return e.moveCall({target:`${t.publishedAt()}::volo::${a}`,typeArguments:[],arguments:s})})}},po=class{constructor(t){if(t!==0)throw new Error("Flowx clmm only supported on mainnet");this.versioned="0x67624a1533b5aff5d0dfcf5e598684350efd38134d2d245f475524c03a64e656",this.poolRegistry="0x27565d24a4cd51127ac90e4074a841bbe356cca7bf5759ddc14a975be1632abc"}swap(t,e,i,n){return nt(this,null,function*(){const{direction:r,from:a,target:s}=i,[c,d,h]=r?["swap_a2b",a,s]:["swap_b2a",s,a],f=[e.object(this.poolRegistry),e.pure.u64(i.feeRate*1e6),n,e.object(this.versioned),e.object(qe)];return e.moveCall({target:`${t.publishedAt()}::flowx_clmm::${c}`,typeArguments:[d,h],arguments:f})})}},Cr="CETUS",mo="DEEPBOOK",go="KRIYA",_o="FLOWX",wo="FLOWXV3",vo="KRIYAV3",kr="TURBOS",ki="AFTERMATH",yo="HAEDAL",bo="VOLO",Ao="AFSUI",Mo=class{constructor(t,e,i,n){this.endpoint=t,this.client=i,this.signer=e,this.env=n,this.allCoins=[]}getAllCoins(){return nt(this,null,function*(){let t=null,e=50;const i=[];for(;;){const n=yield this.client.getAllCoins({owner:this.signer,cursor:t,limit:e});for(const r of n.data)i.push({coinAddress:Se(r.coinType).source_address,coinObjectId:r.coinObjectId,balance:BigInt(r.balance)});if(n.data.length<e)break;t=n.data[e-1].coinObjectId}return i})}findRouters(t){return nt(this,null,function*(){return Co(this.endpoint,t)})}expectInputSwap(t,e,i,n,r){return nt(this,null,function*(){if(i.length===0)throw new Error("No router found");const a=i.map(g=>g.amountIn.toString()),s=i[0].path[0].from,c=i[0].path[i[0].path.length-1].target,d=t.splitCoins(e,a),h=[];for(let g=0;g<i.length;g++){if(i[g].path.length===0)throw new Error("Empty path");let b=d[g];for(const C of i[g].path)b=yield this.newDex(C.provider,r).swap(this,t,C,b);h.push(b)}return this.transferOrDestoryCoin(t,e,s),this.checkCoinThresholdAndMergeCoin(t,h,c,n)})}expectOutputSwap(t,e,i,n){return nt(this,null,function*(){const r=[],a=[],s=[],c=new er(this.env,n);for(let h=0;h<i.length;h++){const f=i[h];for(let b=f.path.length-1;b>=0;b--){const C=f.path[b],S=c.flash_swap(this,t,C,!1);r.unshift(S.targetCoin),a.unshift(S.flashReceipt)}let g=e;for(let b=0;b<f.path.length;b++){const C=f.path[b],S=c.repay_flash_swap(this,t,C,g,a[b]);g=r[b],b===0?e=S:this.transferOrDestoryCoin(t,S,C.from),b===f.path.length-1&&s.push(g)}}const d=i[0].path[0].from;if(this.transferOrDestoryCoin(t,e,d),s.length>1){const h=t.makeMoveVec({elements:s.slice(1)});t.moveCall({target:`${yi.SUI_FRAMEWORK_ADDRESS}::pay::join_vec`,typeArguments:[i[0].path[i[0].path.length-1].target],arguments:[s[0],h]})}return s[0]})}swapInPools(t){return nt(this,null,function*(){let e;try{e=yield uo(this.client,t,this.signer)}catch(i){return console.error("swapInPools error:",i),null}return e})}routerSwap(t){return nt(this,null,function*(){const{routers:e,inputCoin:i,slippage:n,byAmountIn:r,txb:a,partner:s}=t,c=e.reduce((b,C)=>b.add(C.amountIn),new ne.default(0)),d=e.reduce((b,C)=>b.add(C.amountOut),new ne.default(0)),h=sr(r?d:c,r,n);if(r)return yield this.expectInputSwap(a,i,e,new ne.default(h),s);const f=a.splitCoins(i,[h.toString()]);return this.transferOrDestoryCoin(a,i,e[0].path[0].from),yield this.expectOutputSwap(a,f[0],e,s)})}fastRouterSwap(t){return nt(this,null,function*(){const{routers:e,byAmountIn:i,slippage:n,txb:r,partner:a,isMergeTragetCoin:s,refreshAllCoins:c}=t;(c||this.allCoins.length===0)&&(this.allCoins=yield this.getAllCoins());const d=e[0].path[0].from,h=e[0].path[e[0].path.length-1].target,f=e.reduce((T,N)=>T.add(N.amountIn),new ne.default(0)),g=e.reduce((T,N)=>T.add(N.amountOut),new ne.default(0)),b=sr(i?g:f,i,n),C=i?f:b,S=or(r,this.allCoins,BigInt(C.toString()),d),k=yield this.routerSwap({routers:e,inputCoin:S.targetCoin,slippage:n,byAmountIn:i,txb:r,partner:a});if(s){const T=or(r,this.allCoins,BigInt(0),h);r.mergeCoins(T.targetCoin,[k]),T.isMintZeroCoin&&this.transferOrDestoryCoin(r,T.targetCoin,h)}else this.transferOrDestoryCoin(r,k,h)})}publishedAt(){return this.env===0?"0xeffc8ae61f439bb34c9b905ff8f29ec56873dcedf81c7123ff2f1f67c45ec302":"0x6cbaa3e9fbe902d90191b12f315932bc58079cba422bafbd4b4369f80e61f595"}transferOrDestoryCoin(t,e,i){t.moveCall({target:`${this.publishedAt()}::utils::transfer_or_destroy_coin`,typeArguments:[i],arguments:[e]})}checkCoinThresholdAndMergeCoin(t,e,i,n){let r=e[0];if(e.length>1){let a=t.makeMoveVec({elements:e.slice(1)});t.moveCall({target:`${yi.SUI_FRAMEWORK_ADDRESS}::pay::join_vec`,typeArguments:[i],arguments:[e[0],a]}),r=e[0]}return t.moveCall({target:`${this.publishedAt()}::utils::check_coin_threshold`,typeArguments:[i],arguments:[r,t.pure.u64(n.toString())]}),r}newDex(t,e){switch(t){case Cr:return new er(this.env,e);case mo:return new Kn(this.env);case go:return new zn(this.env);case vo:return new lo(this.env);case _o:return new Jn(this.env);case wo:return new po(this.env);case kr:return new Yn(this.env);case ki:return new Xn(this.env);case yo:return new co(this.env);case Ao:return new ho(this.env);case bo:return new fo(this.env);default:throw new Error(`Unsupported dex ${t}`)}}signAndExecuteTransaction(t,e){return nt(this,null,function*(){return yield this.client.signAndExecuteTransaction({transaction:t,signer:e,options:{showEffects:!0,showEvents:!0,showInput:!0,showBalanceChanges:!0}})})}devInspectTransactionBlock(t){return nt(this,null,function*(){return yield this.client.devInspectTransactionBlock({transactionBlock:t,sender:this.signer})})}sendTransaction(t,e){return nt(this,null,function*(){return yield this.client.signAndExecuteTransaction({transaction:t,signer:e})})}};function So(t){return{amountIn:new ne.default(t.amount_in.toString()),amountOut:new ne.default(t.amount_out.toString()),insufficientLiquidity:!1,routes:t.routes.map(e=>({path:e.path.map(i=>{var n,r,a;let s;i.provider===ki&&(s=i.extended_details.aftermath_pool_flatness===0?"v2":"v3");let c;return(i.provider===kr||i.provider===ki||i.provider===Cr)&&(c={aftermathLpSupplyType:(n=i.extended_details)==null?void 0:n.aftermath_lp_supply_type,turbosFeeType:(r=i.extended_details)==null?void 0:r.turbos_fee_type,afterSqrtPrice:(a=i.extended_details)==null?void 0:a.after_sqrt_price}),{id:i.id,direction:i.direction,provider:i.provider,from:i.from,target:i.target,feeRate:i.fee_rate,amountIn:i.amount_in,amountOut:i.amount_out,extendedDetails:c,version:s}}),amountIn:new ne.default(e.amount_in.toString()),amountOut:new ne.default(e.amount_out.toString()),initialPrice:new Ze(e.initial_price.toString())}))}}var qe="0x0000000000000000000000000000000000000000000000000000000000000006";Te(Be());function Co(t,e){return nt(this,null,function*(){let i;if(e.liquidityChanges&&e.liquidityChanges.length>0?i=yield qo(t,e):i=yield ko(t,e),!i)return null;if(!i.ok)return{amountIn:Ae,amountOut:Ae,routes:[],insufficientLiquidity:!1,error:{code:10001,msg:nr(10001)}};const n=yield i.json();if(n.data!=null)return So(n.data);const r=n.msg==="liquidity is not enough";return{amountIn:Ae,amountOut:Ae,routes:[],insufficientLiquidity:r,error:{code:10003,msg:nr(10003)}}})}function ko(t,e){return nt(this,null,function*(){try{const{from:i,target:n,amount:r,byAmountIn:a,depth:s,splitAlgorithm:c,splitFactor:d,splitCount:h,providers:f}=e,g=fe(i),b=fe(n);let C=`${t}?from=${g}&target=${b}&amount=${r.toString()}&by_amount_in=${a}`;return s&&(C+=`&depth=${s}`),c&&(C+=`&split_algorithm=${c}`),d&&(C+=`&split_factor=${d}`),h&&(C+=`&split_count=${h}`),f&&f.length>0&&(C+=`&providers=${f.join(",")}`),yield fetch(C)}catch(i){return console.error(i),null}})}function qo(t,e){return nt(this,null,function*(){const{from:i,target:n,amount:r,byAmountIn:a,depth:s,splitAlgorithm:c,splitFactor:d,splitCount:h,providers:f,liquidityChanges:g}=e,b=fe(i),C=fe(n),S=`${t}`,k=f==null?void 0:f.join(","),T={from:b,target:C,amount:Number(r.toString()),by_amount_in:a,depth:s,split_algorithm:c,split_factor:d,split_count:h,providers:k,liquidity_changes:g.map(N=>({pool:N.poolID,tick_lower:N.ticklower,tick_upper:N.tickUpper,delta_liquidity:N.deltaLiquidity}))};console.log("requestData",JSON.stringify(T,null,2));try{return yield fetch(S,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)})}catch(N){return console.error("Error:",N),null}})}var vi=Mo,To="router",Bo="vaults",No=1e4,Po=(t=>(t.STATUS_RUNNING="STATUS_RUNNING",t.STATUS_REBALANCING="STATUS_REBALANCING",t))(Po||{}),Oo=(t=>(t.Haedal="Haedal",t.Volo="Volo",t.Aftermath="aftermath",t))(Oo||{}),Eo=(t=>(t.Cetus="Cetus",t.Haedal="Haedal",t.Volo="Volo",t.Aftermath="aftermath",t))(Eo||{}),He=(t=>(t.Both="both",t.OneSide="oneSide",t))(He||{}),Ke=class extends Error{constructor(e,i){super(e);Ht(this,"message");Ht(this,"errorCode");this.message=e,this.errorCode=i}static isClmmpoolsErrorCode(e,i){return e instanceof Ke&&e.errorCode===i}},De="0x0000000000000000000000000000000000000000000000000000000000000006",ar="router";function Vt(t){if(t.config===void 0)throw new Ke(`package: ${t.package_id}  not config in sdk SdkOptions`,"InvalidConfig");return t.config}var $t=class{static generateNextTickRange(t,e,i){let n=t-e/2,r=t+e/2;return{new_tick_lower:$t.getValidTickIndex(n,i),new_tick_upper:$t.getValidTickIndex(r,i)}}static calculateDepositRatio(t,e,i){let n=Xt.sqrtPriceX64ToTickIndex(i);if(n<t)return{ratioA:new E(1),ratioB:new E(0)};if(n>e)return{ratioA:new E(0),ratioB:new E(1)};let r=new X(1e8),{coinAmountB:a}=Qt.estLiquidityAndcoinAmountFromOneAmounts(t,e,r,!0,!0,0,i),s=Xt.sqrtPriceX64ToPrice(i,0,0),c=D(r.toString()).mul(s),d=c.add(a.toString()),h=c.div(d),f=D(a.toString()).div(d);return{ratioA:h,ratioB:f}}static getValidTickIndex(t,e){if(t%e===0)return t;let i;if(t>0?i=t-t%e+e:t<0?i=t+Math.abs(t)%e-e:i=t,i%e!==0)throw new Error("Assertion failed: res % tickSpacing == 0");if(Math.abs(i)<Math.abs(t))throw new Error("Assertion failed: res.abs() >= tickIndex");return i}static get_lp_amount_by_liquidity(t,e){return t.total_supply==="0"?"0":D(t.total_supply).mul(e).div(t.liquidity).toFixed(0,E.ROUND_DOWN).toString()}static get_share_liquidity_by_amount(t,e){return t.total_supply==="0"?"0":D(e).mul(t.liquidity).div(t.total_supply).toFixed(0,E.ROUND_DOWN).toString()}static get_protocol_fee_amount(t,e){return D(e).mul(t.protocol_fee_rate).div(No).toFixed(0,E.ROUND_CEIL)}static buildFramsPositionNFT(t){let e=t.clmm_postion.fields;return{id:t.id.id,url:e.url,pool_id:t.pool_id,coinTypeA:jt(e.coin_type_a.fields.name).full_address,coinTypeB:jt(e.coin_type_b.fields.name).full_address,description:e.description,name:e.name,liquidity:e.liquidity,clmm_position_id:e.id.id,clmm_pool_id:e.pool,tick_lower_index:Vi(BigInt(e.tick_lower_index.fields.bits)),tick_upper_index:Vi(BigInt(e.tick_upper_index.fields.bits)),rewards:[]}}static buildPool(t){console.log("🚀🚀🚀 ~ file: vaults.ts:135 ~ VaultsUtils ~ buildPool ~ objects:",t);let e=xr(t),i=Lr(t),{positions:n}=e;if(e&&n.length>0){let r=$t.buildFramsPositionNFT(n[0].fields);return{id:e.id.id,pool_id:e.pool,protocol_fee_rate:e.protocol_fee_rate,is_pause:e.is_pause,harvest_assets:{harvest_assets_handle:e.harvest_assets.fields.id.id,size:Number(e.harvest_assets.fields.size)},lp_token_type:jt(i).type_arguments[0],total_supply:e.lp_token_treasury.fields.total_supply.fields.value,liquidity:e.liquidity,max_quota:e.max_quota,status:e.status===1?"STATUS_RUNNING":"STATUS_REBALANCING",quota_based_type:e.quota_based_type.fields.name,position:r}}}static async getSuiCoin(t,e,i){let n=await t.getOwnerCoinAssets(t.getVerifySenderAddress(),Zi);i=i||new Jt;let r;if(e>95e10){let[a,...s]=n;s.length>0&&i.mergeCoins(i.object(a.coinObjectId),s.map(c=>i.object(c.coinObjectId))),r=i.splitCoins(i.object(a.coinObjectId),[e])}else r=ge.buildCoinForAmount(i,n,BigInt(e),Zi,!1,!0).targetCoin;return r}},ur=class{static async getExchangeRateForStake(t,e,i){let{vaults:n}=t.sdkOptions,{haedal:r}=Wt(n);if(r===void 0)throw Error("the haedal config is undefined");let{simulationAccount:a}=t.sdkOptions,{staking_id:s}=Wt(r);try{let c=new Jt;e?await this.requestStake(t,i||1e9,c):c.moveCall({target:`${r.published_at}::staking::get_exchange_rate`,typeArguments:[],arguments:[c.object(s)]});let d=await t.fullClient.devInspectTransactionBlock({transactionBlock:c,sender:e?t.senderAddress:a.address});if(console.log("🚀🚀🚀 ~ file: haedal.ts:35 ~ HaedalUtils ~ getExchangeRateForStake ~ shouldRequestStake:",e),console.log("🚀🚀🚀 ~ file: haedal.ts:39 ~ HaedalUtils ~ findItem ~ res.events:",JSON.stringify(d.events)),e){let f=d.events.find(C=>C.type.includes("UserStaked")),{sui_amount:g,st_amount:b}=f.parsedJson;return D(g).div(b).toString()}let h=d.results[0].returnValues[0][0];return D(Ti.u64().parse(Uint8Array.from(h))).div(1e6).toString()}catch(c){console.log("getExchangeRateForHaedal",c)}return"0"}static async requestStake(t,e,i){var a,s;let{vaults:n}=t.sdkOptions;i=i||new Jt;let r=await $t.getSuiCoin(t,e,i);return i.moveCall({target:`${(s=(a=n.config)==null?void 0:a.haedal)==null?void 0:s.published_at}::interface::request_stake`,typeArguments:[],arguments:[i.object(te("0x5")),i.object(n.config.haedal.config.staking_id),r,i.pure.address(te("0x0"))]}),i}static requestStakeCoin(t,e,i){let{haedal:n}=t.sdkOptions.vaults.config;return e.moveCall({target:`${n.published_at}::staking::request_stake_coin`,typeArguments:[],arguments:[e.object(te("0x5")),e.object(n.config.staking_id),i,e.pure.address(te("0x0"))]})}},lr=class{static async getExchangeRateForStake(t,e,i){let{vaults:n}=t.sdkOptions,{volo:r}=Wt(n);if(r===void 0)throw Error("the volo config is undefined");let{simulationAccount:a}=t.sdkOptions,{native_pool:s,vsui_metadata:c}=Wt(r);try{let d=new Jt;e?await this.requestStake(t,i||1e9,d):d.moveCall({target:`${r.published_at}::native_pool::get_ratio`,typeArguments:[],arguments:[d.object(s),d.object(c)]});let h=await t.fullClient.devInspectTransactionBlock({transactionBlock:d,sender:e?t.senderAddress:a.address});if(e){let b=h.events.find(k=>k.type.includes("StakedEvent")),{cert_amount:C,sui_amount:S}=b.parsedJson;return D(S).div(C).toString()}let f=h.results[0].returnValues[0][0],g=D(Ti.u256().parse(Uint8Array.from(f))).div("1000000000000000000").toNumber();return D(1).div(g).toString()}catch(d){console.log("getExchangeRateForHaedal",d)}return"0"}static async requestStake(t,e,i){let{vaults:n}=t.sdkOptions,{volo:r}=Wt(n);if(r===void 0)throw Error("the volo config is undefined");i=i||new Jt;let{native_pool:a,vsui_metadata:s}=Wt(r),c=await $t.getSuiCoin(t,e,i);return i.moveCall({target:`${r.published_at}::native_pool::stake`,typeArguments:[],arguments:[i.object(a),i.object(s),i.object(te("0x5")),c]}),i}static requestStakeCoin(t,e,i){let{vaults:n}=t.sdkOptions,{volo:r}=Wt(n);if(r===void 0)throw Error("the volo config is undefined");e=e||new Jt;let{native_pool:a,vsui_metadata:s}=Wt(r);return e.moveCall({target:`${r.published_at}::native_pool::stake_non_entry`,typeArguments:[],arguments:[e.object(a),e.object(s),e.object(te("0x5")),i]})}},cr=class{static async getExchangeRateForStake(t,e,i){let{vaults:n}=t.sdkOptions,{aftermath:r}=Wt(n);if(r===void 0)throw Error("the aftermath config is undefined");let{simulationAccount:a}=t.sdkOptions,{staked_sui_vault:s,safe:c}=Wt(r);try{let d=new Jt;e?await this.requestStake(t,i||1e9,d):d.moveCall({target:`${r.published_at}::staked_sui_vault::afsui_to_sui_exchange_rate`,typeArguments:[],arguments:[d.object(s),d.object(c)]});let h=await t.fullClient.devInspectTransactionBlock({transactionBlock:d,sender:e?t.senderAddress:a.address});if(e){let g=h.events.find(S=>S.type.includes("StakedEvent")),{afsui_amount:b,sui_amount:C}=g.parsedJson;return D(C).div(b).toString()}let f=h.results[0].returnValues[0][0];return D(Ti.u128().parse(Uint8Array.from(f))).div(1e18).toString()}catch(d){console.log("getExchangeRateForHaedal",d)}return"0"}static async requestStake(t,e,i){let{vaults:n}=t.sdkOptions,{aftermath:r}=Wt(n);if(r===void 0)throw Error("the aftermath config is undefined");i=i||new Jt;let{staked_sui_vault:a,referral_vault:s,safe:c,validator_address:d}=Wt(r),h=await $t.getSuiCoin(t,e,i);return i.moveCall({target:`${r.published_at}::staked_sui_vault::request_stake_and_keep`,typeArguments:[],arguments:[i.object(a),i.object(c),i.object(te("0x5")),i.object(s),h,i.pure.address(te(d))]}),i}static requestStakeCoin(t,e,i){let{vaults:n}=t.sdkOptions,{aftermath:r}=Wt(n);if(r===void 0)throw Error("the aftermath config is undefined");e=e||new Jt;let{staked_sui_vault:a,referral_vault:s,safe:c,validator_address:d}=Wt(r);return e.moveCall({target:`${r.published_at}::staked_sui_vault::request_stake`,typeArguments:[],arguments:[e.object(a),e.object(c),e.object(te("0x5")),e.object(s),i,e.pure.address(te(d))]})}},Io=class{constructor(t){Ht(this,"_sdk");Ht(this,"_cache",{});Ht(this,"getOwnerVaultsBalance",async t=>{let{data:e}=await this.getVaultList(),i=[];for(let n=0;n<e.length;n++){let r=e[n],a=await this._sdk.fullClient.getBalance({owner:t,coinType:r.lp_token_type}),s=await this._sdk.Pool.getPool(r.pool_id,!0),c=$t.get_share_liquidity_by_amount(r,a.totalBalance),{tick_lower_index:d,tick_upper_index:h,coinTypeA:f,coinTypeB:g}=r.position,b=Xt.tickIndexToSqrtPriceX64(d),C=Xt.tickIndexToSqrtPriceX64(h),S=Qt.getCoinAmountFromLiquidity(new X.BN(c),new X.BN(s.current_sqrt_price),b,C,!0);i.push({vault_id:e[n].id,clmm_pool_id:r.pool_id,owner:t,lp_token_type:r.lp_token_type,lp_token_balance:a.totalBalance,liquidity:c,tick_lower_index:d,tick_upper_index:h,amount_a:S.coinA.toString(),amount_b:S.coinB.toString(),coin_type_a:f,coin_type_b:g})}return i});this._sdk=t}get sdk(){return this._sdk}async calculateDepositAmount(t,e=!1,i=!1){return t.side==="both"?await this.calculateAmountFromBoth(t,!0):await this.calculateDepositAmountFromOneSide(t,e,i)}async calculateWithdrawAmount(t){if(t.side==="both"){if(t.is_ft_input)return{...await this.estLiquidityAmountFromFtAmount({...t,input_ft_amount:t.input_amount}),request_id:t.input_amount,burn_ft_amount:t.input_amount,side:t.side};let n=await this.calculateAmountFromBoth(t,!1);return{...n,request_id:t.input_amount,burn_ft_amount:n.ft_amount,side:t.side}}let{vault:e}=await this.getVaultAndPool(t.vault_id),i=$t.get_share_liquidity_by_amount(e,t.max_ft_amount);return await this.calculateWithdrawAmountFromOneSide({fix_amount_a:t.fix_amount_a,vault_id:t.vault_id,receive_amount:t.is_ft_input?"0":t.input_amount,slippage:t.slippage,maxLiquidity:i,removeLiquidity:t.is_ft_input?$t.get_share_liquidity_by_amount(e,t.input_amount):void 0},!0)}async calculateWithdrawAmountFromOneSide(t,e,i){try{let{vault_id:n,removeLiquidity:r,maxLiquidity:a}=t,{vault:s,pool:c}=await this.getVaultAndPool(n),{position:d}=s,h=d.tick_lower_index,f=d.tick_upper_index,g=r===a,b=$t.calculateDepositRatio(h,f,new X.BN(c.current_sqrt_price)),C=t.fix_amount_a?b.ratioA:b.ratioB,S=D(t.receive_amount).mul(C),k,T;if(r){let G=Xt.tickIndexToSqrtPriceX64(h),F=Xt.tickIndexToSqrtPriceX64(f),H=Qt.getCoinAmountFromLiquidity(new X.BN(r),new X.BN(c.current_sqrt_price),G,F,!1);T=r,k=t.fix_amount_a?H.coinB.toString():H.coinA.toString(),S=t.fix_amount_a?D(H.coinA.toString()):D(H.coinB.toString())}else{let G=Qt.estLiquidityAndcoinAmountFromOneAmounts(h,f,new X.BN(S.toFixed(0)),t.fix_amount_a,!1,t.slippage,new X.BN(c.current_sqrt_price));T=G.liquidityAmount.toString(),k=t.fix_amount_a?G.coinAmountB.toString():G.coinAmountA.toString()}let N=!t.fix_amount_a,q=await this.findRouters(c.poolAddress,c.current_sqrt_price.toString(),t.fix_amount_a?c.coinTypeB:c.coinTypeA,t.fix_amount_a?c.coinTypeA:c.coinTypeB,D(k),!0,[c.poolAddress],{poolID:c.poolAddress,ticklower:h,tickUpper:f,deltaLiquidity:Number(T)}),P=S.add(q.amount_out),O=D(t.receive_amount),x=O.sub(P);if(!g&&(!t.removeLiquidity||t.removeLiquidity&&i)&&x.abs().greaterThan(O.mul(.01))){let G=P.lessThan(O),F,H;i?G?(F=D(T),H=i.right):(F=i.left,H=D(T)):(F=G?D(T):D(0),H=G?D(t.maxLiquidity):D(T));let y=D(F).add(H).div(2).toFixed(0);if(!i||i&&i.count<15&&F<H)return await this.calculateWithdrawAmountFromOneSide({...t,removeLiquidity:y},e,{left:F,right:H,count:i?i.count+1:0})}let U=q.amount_in&&q.fee_amount?new X.BN(q.amount_in).add(new X.BN(q.fee_amount)).toString():q.amount_in,V=q.amount_out,{is_exceed:K}=q,W=$t.get_lp_amount_by_liquidity(s,T.toString());return{side:"oneSide",...await this.estLiquidityAmountFromFtAmount({vault_id:n,input_ft_amount:W,slippage:t.slippage}),burn_ft_amount:W,request_id:t.receive_amount,swap_result:{swap_in_amount:U,swap_out_amount:V,a2b:N,is_exceed:K,sui_stake_protocol:"Cetus",route_obj:q.route_obj}}}catch(n){if(e&&(String(n)==="Error: route unavailable"||String(n)==="Error: router timeout"))return await this.calculateWithdrawAmountFromOneSide(t,!1);throw n}}async calculateDepositAmountFromOneSide(t,e,i=!1,n=!0,r=5,a=.02){try{let{vault_id:s,input_amount:c,fix_amount_a:d,slippage:h}=t,{vault:f,pool:g}=await this.getVaultAndPool(s),{position:b}=f,C=b.tick_lower_index,S=b.tick_upper_index,k=Xt.sqrtPriceX64ToTickIndex(new X.BN(g.current_sqrt_price)),{ratioA:T,ratioB:N}=$t.calculateDepositRatio(C,S,new X.BN(g.current_sqrt_price)),q=D(c).mul(d?T:N),P=D(c).sub(q),O=d;if(P.toFixed(0)==="0")return await this.calculateAmountFromBoth(t,!0);let x,U,V,K,W,ut=this.findSuiStakeProtocol(b.coinTypeA,b.coinTypeB,d);if(ut!=="Cetus")x=await this.calculateStakeDepositFixSui({inputSuiAmount:D(t.input_amount),swapSuiAmount:P,lowerTick:C,upperTick:S,curSqrtPrice:g.current_sqrt_price.toString(),remainRate:.01,fixCoinA:t.fix_amount_a,rebalanceCount:0,shouldRequestStake:e,leftSuiAmount:O?new E(P.toFixed(0)):new E(0),rightSuiAmount:O?new E(t.input_amount):new E(P.toFixed(0)),stakeProtocol:ut}),U=g.current_sqrt_price.toString(),V=x.fixAmountA,K=x.swapInAmount,W=x.swapOutAmount;else{x=await this.findRouters(g.poolAddress,g.current_sqrt_price.toString(),O?g.coinTypeA:g.coinTypeB,O?g.coinTypeB:g.coinTypeA,P,!0,[g.poolAddress]);let l=this.paresSwapData(x,t.input_amount,t.fix_amount_a,O,C,S,T,N),p=D(t.input_amount).mul(a);if(D(t.input_amount).sub(l.preAmountTotal).gt(p)){let _={clmm_pool:g.poolAddress,curSqrtPrice:g.current_sqrt_price.toString(),a2b:O,amount_a:O?D(c):D(0),amount_b:O?D(0):D(t.input_amount),amount_left:O?D(P.toFixed(0)):D(0),amount_right:O?D(c):D(P.toFixed(0)),lowerTick:C,upperTick:S,tick_spacing:2,coinTypeA:b.coinTypeA,coinTypeB:b.coinTypeB,remainRate:.02,priceSplitPoint:h,useRoute:n,maxLoopLimit:r};x=i&&k<=S?await this.calculateRebalance(_):await this.findRouters(g.poolAddress,g.current_sqrt_price.toString(),O?g.coinTypeA:g.coinTypeB,O?g.coinTypeB:g.coinTypeA,P,!0,[g.poolAddress])}U=x.after_sqrt_price,l=this.paresSwapData(x,t.input_amount,t.fix_amount_a,O,C,S,T,N),V=l.fixAmountA,K=l.swapInAmount,W=l.swapOutAmount,U=l.afterSqrtPrice}let G=V===d?D(c).sub(K).toFixed(0):W,F=Qt.estLiquidityAndcoinAmountFromOneAmounts(C,S,new X.BN(G),V,!0,h,new X.BN(U)),H=F.coinAmountA.toString(),y=F.coinAmountB.toString(),o=$t.get_lp_amount_by_liquidity(f,F.liquidityAmount.toString());return{request_id:t.input_amount,side:"oneSide",amount_a:H,amount_b:y,amount_limit_a:F.tokenMaxA.toString(),amount_limit_b:F.tokenMaxB.toString(),ft_amount:o,fix_amount_a:V,swap_result:{swap_in_amount:K,swap_out_amount:W,a2b:d,sui_stake_protocol:ut,route_obj:x.route_obj,is_exceed:x.is_exceed,afterSqrtPrice:U}}}catch(s){if(n&&(String(s)==="Error: route unavailable"||String(s)==="Error: router timeout"))return await this.calculateDepositAmountFromOneSide(t,e,!1);throw s}}paresSwapData(t,e,i,n,r,a,s,c){let d=t.after_sqrt_price,h=Xt.sqrtPriceX64ToTickIndex(new X.BN(d)),{ratioA:f,ratioB:g}=$t.calculateDepositRatio(r,a,new X.BN(d)),b=g.div(f).sub(c.div(s)).greaterThan("0"),C=t.amount_in&&t.fee_amount?new X.BN(t.amount_in).add(new X.BN(t.fee_amount)).toString():t.amount_in,S=t.amount_out,k=b===n?new X.BN(D(e).sub(C).toString()):new X.BN(S),T=D(e);if(h<r)b=!0;else if(h>a)b=!1;else{let N=Qt.estLiquidityAndcoinAmountFromOneAmounts(r,a,k,b,!0,0,new X.BN(d)),q=N.coinAmountA,P=N.coinAmountB;T=D(i?q.toString():P.toString()).add(C),T.greaterThanOrEqualTo(e)&&(b=!b)}return{preAmountTotal:T,fixAmountA:b,swapInAmount:C,swapOutAmount:S,afterSqrtPrice:d}}async calculateStakeDepositFixSui(t){let e=t.inputSuiAmount.mul(t.remainRate),i=t.inputSuiAmount.sub(t.swapSuiAmount),n;t.shouldRequestStake?n=await this.getExchangeRateForStake(t.stakeProtocol,t.shouldRequestStake,Number(t.swapSuiAmount.toFixed(0))):n=t.exchangeRate?t.exchangeRate:await this.getExchangeRateForStake(t.stakeProtocol,t.shouldRequestStake,Number(t.swapSuiAmount.toFixed(0)));let r=t.swapSuiAmount.div(n).toFixed(0,E.ROUND_DOWN),a=Qt.estLiquidityAndcoinAmountFromOneAmounts(t.lowerTick,t.upperTick,new X.BN(r.toString()),!t.fixCoinA,!0,0,new X.BN(t.curSqrtPrice)),s=t.fixCoinA?a.coinAmountA.toString():a.coinAmountB.toString(),c=D(i).sub(s);return c.greaterThanOrEqualTo(0)&&c.lessThanOrEqualTo(e)||t.rebalanceCount>12||t.leftSuiAmount.greaterThanOrEqualTo(t.rightSuiAmount)?{swapInAmount:t.swapSuiAmount.toFixed(0),swapOutAmount:r,afterSqrtPrice:t.curSqrtPrice,fixAmountA:!t.fixCoinA,is_exceed:!0,request_id:"",stake_protocol:t.stakeProtocol}:c.lessThan(0)?await this.calculateStakeDepositFixSui({...t,rightSuiAmount:t.swapSuiAmount,swapSuiAmount:t.swapSuiAmount.add(t.leftSuiAmount).div(2),exchangeRate:n,rebalanceCount:t.rebalanceCount+1}):c.greaterThan(e)?await this.calculateStakeDepositFixSui({...t,leftSuiAmount:t.swapSuiAmount,swapSuiAmount:t.swapSuiAmount.add(t.rightSuiAmount).div(2),exchangeRate:n,rebalanceCount:t.rebalanceCount+1}):null}async getExchangeRateForStake(t,e,i){return t==="Haedal"?await ur.getExchangeRateForStake(this._sdk,e,i):t==="Volo"?await lr.getExchangeRateForStake(this._sdk,e,i):t==="aftermath"?await cr.getExchangeRateForStake(this._sdk,e,i):"0"}async findRouters(t,e,i,n,r,a,s,c,d=!1){var C,S;let{aggregator:h}=this._sdk.sdkOptions,f=`${h.walletAddress}_getAggregatorClient`,g=this.getCache(f,d),b;if(g!==void 0)b=g;else{let k=new Ue({url:this.sdk.sdkOptions.fullRpcUrl});b=new vi(h.endPoint,h.walletAddress,k,h.env)}try{let k={from:i,target:n,amount:new X.BN(r.toFixed(0).toString()),byAmountIn:a,depth:3,providers:h.providers};c&&c.poolID&&(k.liquidityChanges=[c]);let T=await b.findRouters(k);if(((C=T==null?void 0:T.error)==null?void 0:C.code)===10001)return{...T,is_exceed:T.insufficientLiquidity};if(T!=null&&T.insufficientLiquidity)return{...T,is_exceed:T.insufficientLiquidity};if(!(T!=null&&T.routes)||((S=T==null?void 0:T.routes)==null?void 0:S.length)===0)throw Error("Aggregator no router");let N=e;return T.routes.forEach(q=>{let P=q.path.find(O=>O.id.toLowerCase()===t.toLowerCase());P&&P.extendedDetails&&P.extendedDetails.afterSqrtPrice&&(N=String(P.extendedDetails.afterSqrtPrice))}),{amount_in:T.amountIn.toString(),amount_out:T.amountOut.toString(),is_exceed:T.insufficientLiquidity,after_sqrt_price:N,route_obj:T,byAmountIn:!0,liquidity:c==null?void 0:c.deltaLiquidity}}catch{try{if(s){let k=await b.swapInPools({from:i,target:n,amount:new X.BN(r.toFixed(0).toString()),byAmountIn:a,pools:s});if(k){let T=e;return k.routeData.routes.forEach(N=>{let q=N.path.find(P=>P.id.toLowerCase()===t.toLowerCase());q&&(T=String(q.extendedDetails.afterSqrtPrice))}),{amount_in:k.routeData.amountIn.toString(),amount_out:k.routeData.amountOut.toString(),is_exceed:k.isExceed,after_sqrt_price:T,route_obj:k.routeData,byAmountIn:!0,liquidity:c==null?void 0:c.deltaLiquidity}}return null}return null}catch{return null}}}async calculateRebalance(t){let{clmm_pool:e,a2b:i,curSqrtPrice:n,amount_a:r,amount_b:a,lowerTick:s,upperTick:c,amount_left:d,amount_right:h,coinTypeA:f,coinTypeB:g,useRoute:b,priceSplitPoint:C,remainRate:S,maxLoopLimit:k=5}=t,T=async(N,q,P)=>{let O=N.plus(q).div(2),x=await this.findRouters(e,n,f,g,O,i,[e]);if(x.amount_out==="0")return x;if(x.after_sqrt_price||(x.after_sqrt_price=t.curSqrtPrice),x.is_exceed)return q=O,T(N,q,P+1);let U=i?r.sub(x.amount_in):r.add(x.amount_out),V=i?a.add(x.amount_out):a.sub(x.amount_in),K=Qt.estLiquidityAndcoinAmountFromOneAmounts(s,c,new X.BN(U.toString()),!0,!0,1,new X.BN(x.after_sqrt_price)),W=new E(K.coinAmountA.toString()),ut=new E(K.coinAmountB.toString());if(W.toString()!==U.toString())throw new Error("usedA does not match afterA");if(V.lessThan(ut))i?N=O:q=O;else{i?q=O:N=O;let G=V.sub(ut);if(V.mul(S).sub(G).greaterThanOrEqualTo(0)||P>=k)return{...x,remainingB:G}}return N.greaterThan(q)||q.sub(N).lessThan(10)?x:T(N,q,P+1)};return d.greaterThanOrEqualTo(h)?T(new E(0),d,0):T(d,h,0)}async calculateAmountFromBoth(t,e){let{vault_id:i,input_amount:n,fix_amount_a:r,slippage:a}=t,{vault:s,pool:c}=await this.getVaultAndPool(i),{position:d}=s,h=d.tick_lower_index,f=d.tick_upper_index,g=Qt.estLiquidityAndcoinAmountFromOneAmounts(h,f,new X.BN(n),r,e,a,new X.BN(c.current_sqrt_price)),b=$t.get_lp_amount_by_liquidity(s,g.liquidityAmount.toString());return{request_id:t.input_amount,amount_a:g.coinAmountA.toString(),amount_b:g.coinAmountB.toString(),amount_limit_a:g.tokenMaxA.toString(),amount_limit_b:g.tokenMaxB.toString(),ft_amount:b,fix_amount_a:r,side:"both"}}async estLiquidityAmountFromFtAmount(t){let{vault_id:e,input_ft_amount:i,slippage:n}=t,{vault:r,pool:a}=await this.getVaultAndPool(e),{position:s}=r,c=s.tick_lower_index,d=s.tick_upper_index,h=Xt.tickIndexToSqrtPriceX64(c),f=Xt.tickIndexToSqrtPriceX64(d),g=new X.BN(i),b=$t.get_share_liquidity_by_amount(r,g.toString()),C=new X.BN(a.current_sqrt_price),S=Qt.getCoinAmountFromLiquidity(new X.BN(b),C,h,f,!1),k=D(S.coinA.toString()).mul(D(1-n)),T=D(S.coinB.toString()).mul(D(1-n));return{amount_a:S.coinA.toString(),amount_b:S.coinB.toString(),amount_limit_a:k.toFixed(0),amount_limit_b:T.toFixed(0)}}async deposit(t){let{vault_id:e}=t,{vault:i,pool:n}=await this.getVaultAndPool(e,!0),r=await this.calculateDepositAmount(t,!0,!0),a=new Jt,s,c;if(t.side==="oneSide"&&r.swap_result){let f=await this.handleDepositSwap({...r,coinTypeA:n.coinTypeA,coinTypeB:n.coinTypeB,slippage:t.slippage,clmm_pool:n.poolAddress},a);s=f.primaryCoinAInputs,c=f.primaryCoinBInputs}let{amount_a:d,amount_b:h}=r;return t.side==="oneSide"&&t.fix_amount_a&&(d=D(r.amount_a).mul(D(1).sub(.001)).toFixed(0,E.ROUND_DOWN).toString(),h=D(r.amount_b).mul(D(1).sub(.001)).toFixed(0,E.ROUND_DOWN).toString()),await this.depositInternal({coinTypeA:n.coinTypeA,coinTypeB:n.coinTypeB,lp_token_type:i.lp_token_type,farming_pool:i.position.pool_id,clmm_pool:n.poolAddress,primaryCoinAInputs:s,primaryCoinBInputs:c,vault_id:e,slippage:t.slippage,amount_a:r.fix_amount_a?d:r.amount_limit_a,amount_b:r.fix_amount_a?r.amount_limit_b:h,fix_amount_a:r.fix_amount_a},a),a}async handleDepositSwap(t,e){let i=await this._sdk.getOwnerCoinAssets(this._sdk.senderAddress),{clmm_pool:n,integrate:r}=this._sdk.sdkOptions,{swap_in_amount:a,a2b:s,sui_stake_protocol:c,route_obj:d}=t.swap_result,h=s?t.coinTypeA:t.coinTypeB,f=ge.buildCoinForAmount(e,i,BigInt(a),h,!1,!0),g=BigInt(f.tragetCoinAmount)-BigInt(a),b=[];if(c!=="Cetus"){let N=this.requestStakeCoin(c,e,f.targetCoin),q=ge.buildCoinForAmount(e,f.remainCoins,BigInt(0),h,!1).targetCoin;b=s?[q,N]:[N,q]}else if(d){let N={routers:d.routes,byAmountIn:!0,txb:e,slippage:t.slippage,inputCoin:f.targetCoin},{aggregator:q}=this._sdk.sdkOptions,P=`${q.walletAddress}_getAggregatorClient`,O=this.getCache(P,!1),x;if(O!==void 0)x=O;else{let V=new Ue({url:this.sdk.sdkOptions.fullRpcUrl});x=new vi(q.endPoint,q.walletAddress,V,q.env)}let U=await x.routerSwap(N);b=s?[f.originalSplitedCoin,U]:[U,f.originalSplitedCoin]}else{let N=ge.buildCoinForAmount(e,i,0n,s?t.coinTypeB:t.coinTypeA,!1),q=$i.getDefaultSqrtPriceLimit(s).toString();b=e.moveCall({target:`${r.published_at}::${ar}::swap`,typeArguments:[t.coinTypeA,t.coinTypeB],arguments:[e.object(Vt(n).global_config_id),e.object(t.clmm_pool),s?f.targetCoin:N.targetCoin,s?N.targetCoin:f.targetCoin,e.pure.bool(s),e.pure.bool(!0),e.pure.u64(a),e.pure.u128(q),e.pure.bool(!1),e.object(De)]})}let C,S,k=b[0],T=b[1];if(s){let N=BigInt(t.amount_a)-g;re.isSuiCoin(h)?(d||e.transferObjects([k],e.pure.address(this._sdk.getVerifySenderAddress())),C=e.splitCoins(e.gas,[e.pure.u64(t.amount_a)])):N>0n?C=this.buildCoinInput(e,f.remainCoins,h,N,k).coinInput:C=k,S=T}else{C=k;let N=BigInt(t.amount_b)-g;re.isSuiCoin(h)?(d||e.transferObjects([T],e.pure.address(this._sdk.getVerifySenderAddress())),S=e.splitCoins(e.gas,[e.pure.u64(t.amount_b)])):N>0n?S=this.buildCoinInput(e,f.remainCoins,h,N,T).coinInput:S=T}return{primaryCoinAInputs:C,primaryCoinBInputs:S}}requestStakeCoin(t,e,i){if(t==="Haedal")return ur.requestStakeCoin(this._sdk,e,i);if(t==="Volo")return lr.requestStakeCoin(this._sdk,e,i);if(t==="aftermath")return cr.requestStakeCoin(this._sdk,e,i)}async depositInternal(t,e){var f,g;let{vaults:i,frams:n,clmm_pool:r}=this._sdk.sdkOptions,a=Vt(i),s=Vt(n),c=Vt(r),{primaryCoinAInputs:d,primaryCoinBInputs:h}=t;if(d===void 0||h===void 0){let b=await this._sdk.getOwnerCoinAssets(this._sdk.senderAddress);d=(f=ge.buildAddLiquidityFixTokenCoinInput(e,!t.fix_amount_a,t.amount_a,t.slippage,t.coinTypeA,b,!1))==null?void 0:f.targetCoin,h=(g=ge.buildAddLiquidityFixTokenCoinInput(e,t.fix_amount_a,t.amount_b,t.slippage,t.coinTypeB,b,!1))==null?void 0:g.targetCoin}e.moveCall({target:`${i.published_at}::${To}::deposit`,typeArguments:[t.coinTypeA,t.coinTypeB,t.lp_token_type],arguments:[e.object(a.vaults_manager_id),e.object(t.vault_id),e.object(s.rewarder_manager_id),e.object(s.global_config_id),e.object(t.farming_pool),e.object(c.global_config_id),e.object(t.clmm_pool),d,h,e.pure.u64(t.amount_a),e.pure.u64(t.amount_b),e.pure.bool(t.fix_amount_a),e.object(De)]})}async withdraw(t){let e="is_ft_input"in t,{vault:i,pool:n}=await this.getVaultAndPool(t.vault_id,!0),r=new Jt,a,s,c,d;if(e)d=await this._sdk.Vaults.calculateWithdrawAmount({...t,side:"oneSide"}),s=d.amount_limit_a,c=d.amount_limit_b,a=t.is_ft_input?t.input_amount:d.burn_ft_amount;else{let{vault_id:g,ft_amount:b,slippage:C}=t;a=b;let S=await this.estLiquidityAmountFromFtAmount({vault_id:g,input_ft_amount:b,slippage:C});s=S.amount_limit_a,c=S.amount_limit_b}let{reciveCoinA:h,reciveCoinB:f}=await this.withdrawInternal({coinTypeA:n.coinTypeA,coinTypeB:n.coinTypeB,lp_token_type:i.lp_token_type,farming_pool:i.position.pool_id,clmm_pool:n.poolAddress,min_amount_a:s,min_amount_b:c,vault_id:t.vault_id,ft_amount:a},r);if(e&&d){let{a2b:g,swap_in_amount:b,route_obj:C}=d.swap_result;if(C){let S={targetCoin:g?h:f,remainCoins:[],isMintZeroCoin:!1,tragetCoinAmount:""},k={routers:C.routes,byAmountIn:!0,txb:r,slippage:t.slippage,inputCoin:S.targetCoin},{aggregator:T}=this._sdk.sdkOptions,N=`${T.walletAddress}_getAggregatorClient`,q=this.getCache(N,!1),P;if(q!==void 0)P=q;else{let U=new Ue({url:this.sdk.sdkOptions.fullRpcUrl});P=new vi(T.endPoint,T.walletAddress,U,T.env)}let O=await P.routerSwap(k),x=g?[S.targetCoin,O]:[O,S.targetCoin];g?r.mergeCoins(x[1],[f]):r.mergeCoins(x[0],[h]),r.transferObjects([O],r.pure.address(this._sdk.getVerifySenderAddress()))}else{let{clmm_pool:S,integrate:k}=this._sdk.sdkOptions,T=$i.getDefaultSqrtPriceLimit(g).toString(),N=r.moveCall({target:`${k.published_at}::${ar}::swap`,typeArguments:[n.coinTypeA,n.coinTypeB],arguments:[r.object(Vt(S).global_config_id),r.object(n.poolAddress),h,f,r.pure.bool(g),r.pure.bool(!0),r.pure.u64(b),r.pure.u128(T),r.pure.bool(!0),r.object(De)]});r.transferObjects([N[0],N[1]],r.pure.address(this._sdk.senderAddress))}}else r.transferObjects([h,f],r.pure.address(this._sdk.senderAddress));return r}async withdrawInternal(t,e){let{vaults:i,frams:n,clmm_pool:r}=this._sdk.sdkOptions,a=Vt(i),s=Vt(n),c=Vt(r),{primaryCoinInputs:d}=t;if(d===void 0){let g=await this._sdk.getOwnerCoinAssets(this._sdk.senderAddress,t.lp_token_type);d=ge.buildCoinForAmount(e,g,BigInt(t.ft_amount),t.lp_token_type,!1).targetCoin}let h=[t.coinTypeA,t.coinTypeB,t.lp_token_type],f=e.moveCall({target:`${i.published_at}::${Bo}::remove`,typeArguments:h,arguments:[e.object(a.vaults_manager_id),e.object(t.vault_id),e.object(s.rewarder_manager_id),e.object(s.global_config_id),e.object(t.farming_pool),e.object(c.global_config_id),e.object(t.clmm_pool),d,e.pure.u64(t.ft_amount),e.pure.u64(t.min_amount_a),e.pure.u64(t.min_amount_b),e.object(De)]});return{reciveCoinA:f[0],reciveCoinB:f[1]}}async getVaultAndPool(t,e=!1){let i=await this.sdk.Vaults.getVault(t);if(i===void 0)throw new Error("please check config and vault id");let n=await this._sdk.Pool.getPool(i.pool_id,e);return{vault:i,pool:n}}async getVaultList(t="all"){let{vaults:e}=this._sdk.sdkOptions,i=await this._sdk.fullClient.queryEventsByPage({MoveEventType:`${e.package_id}::vaults::CreateEvent`},t),n=i.data.map(s=>s.parsedJson.id),r=await this._sdk.fullClient.batchGetObjects(n,{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}),a=[];return r.forEach(s=>{let c=$t.buildPool(s);c&&(c.stake_protocol=this.findStakeProtocol(c.position.coinTypeA,c.position.coinTypeB),this.savePoolToCache(c),a.push(c))}),i.data=a,i}findStakeProtocol(t,e){let{haedal:i,volo:n,aftermath:r}=Vt(this._sdk.sdkOptions.vaults),a=jt(t).full_address,s=jt(e).full_address;if(re.isSuiCoin(a)||re.isSuiCoin(s)){if(i){let c=jt(Vt(i).coin_type).full_address;if(a===c||s===c)return"Haedal"}if(n){let c=jt(Vt(n).coin_type).full_address;if(a===c||s===c)return"Volo"}if(r){let c=jt(Vt(r).coin_type).full_address;if(a===c||s===c)return"aftermath"}}}async getVault(t,e=!1){let i=this.readPoolFromCache(t,e);if(i)return i;try{let n=await this._sdk.fullClient.getObject({id:t,options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}}),r=$t.buildPool(n);if(r)return this.savePoolToCache(r),r}catch(n){console.log(n)}}savePoolToCache(t){let e=`${t.id}_mirrorPool`;this.updateCache(e,t,Me)}readPoolFromCache(t,e=!1){let i=`${t}_mirrorPool`;return this.getCache(i,e)}findSuiStakeProtocol(t,e,i){let{haedal:n,volo:r,aftermath:a}=Vt(this._sdk.sdkOptions.vaults),s=jt(t).full_address,c=jt(e).full_address;if(re.isSuiCoin(s)&&i||re.isSuiCoin(c)&&!i){if(n){let d=jt(Vt(n).coin_type).full_address;if(s===d||c===d)return"Haedal"}if(r){let d=jt(Vt(r).coin_type).full_address;if(s===d||c===d)return"Volo"}if(a){let d=jt(Vt(a).coin_type).full_address;if(s===d||c===d)return"aftermath"}}return"Cetus"}buildCoinInput(t,e,i,n,r){let{selectedCoins:a,remainingCoins:s}=re.selectCoinAssetGreaterThanOrEqual(e,BigInt(n)),c=re.calculateTotalBalance(a);if(c<BigInt(n))throw new Error(`The amount(${c}) is Insufficient balance for ${i} , expect ${n} `);let d=c-BigInt(n),h;if(re.isSuiCoin(i))h=t.splitCoins(t.gas,[t.pure.u64(n)]);else{let[f,...g]=a.map(b=>b.coinObjectId);h=t.object(f),g.length>0?r?t.mergeCoins(h,[...g.map(b=>t.object(b)),r]):t.mergeCoins(h,[...g.map(b=>t.object(b))]):r&&t.mergeCoins(h,[r])}return{selectedUnusedAmount:d,coinInput:h,remainingCoins:s}}updateCache(t,e,i=Me){let n=this._cache[t];n?(n.overdueTime=Ce(i),n.value=e):n=new qi(e,Ce(i)),this._cache[t]=n}getCache(t,e=!1){let i=this._cache[t];if(!e&&(i!=null&&i.isValid()))return i.value;delete this._cache[t]}},xo=class{constructor(t){Ht(this,"_sdk");Ht(this,"_cache",{});this._sdk=t}get sdk(){return this._sdk}async getPoolImmutables(t=[],e=0,i=100,n=!1){let{package_id:r}=this._sdk.sdkOptions.clmm_pool,a=`${r}_getInitPoolEvent`,s=this.getCache(a,n),c=[],d=[];if(s!==void 0&&c.push(...s),c.length===0)try{(await this._sdk.fullClient.queryEventsByPage({MoveEventType:`${r}::factory::CreatePoolEvent`})).data.forEach(f=>{let g=f.parsedJson;g&&c.push({poolAddress:g.pool_id,tickSpacing:g.tick_spacing,coinTypeA:jt(g.coin_type_a).full_address,coinTypeB:jt(g.coin_type_b).full_address})}),this.updateCache(a,c,Me)}catch(f){console.log("getPoolImmutables",f)}let h=t.length>0;for(let f=0;f<c.length;f+=1){let g=c[f];h&&!t.includes(g.poolAddress)||!h&&(f<e||f>=e+i)||d.push(g)}return d}async getPools(t=[],e=0,i=100){var s,c,d;let n=[],r=[];t.length>0?r=[...t]:(await this.getPoolImmutables([],e,i,!1)).forEach(h=>r.push(h.poolAddress));let a=await this._sdk.fullClient.batchGetObjects(r,{showContent:!0,showType:!0});for(let h of a){if(h.error!=null||((c=(s=h.data)==null?void 0:s.content)==null?void 0:c.dataType)!=="moveObject")throw new Ke(`getPools error code: ${((d=h.error)==null?void 0:d.code)??"unknown error"}, please check config and object ids`,"InvalidPoolObject");let f=Ui(h);n.push(f);let g=`${f.poolAddress}_getPoolObject`;this.updateCache(g,f,Me)}return n}async getPool(t,e=!0){var s,c,d;let i=`${t}_getPoolObject`,n=this.getCache(i,e);if(n!==void 0)return n;let r=await this._sdk.fullClient.getObject({id:t,options:{showType:!0,showContent:!0}});if(r.error!=null||((c=(s=r.data)==null?void 0:s.content)==null?void 0:c.dataType)!=="moveObject")throw new Ke(`getPool error code: ${((d=r.error)==null?void 0:d.code)??"unknown error"}, please check config and object id`,"InvalidPoolObject");let a=Ui(r);return this.updateCache(i,a),a}async getSuiTransactionResponse(t,e=!1){let i=`${t}_getSuiTransactionResponse`,n=this.getCache(i,e);if(n!==void 0)return n;let r;try{r=await this._sdk.fullClient.getTransactionBlock({digest:t,options:{showEvents:!0,showEffects:!0,showBalanceChanges:!0,showInput:!0,showObjectChanges:!0}})}catch{r=await this._sdk.fullClient.getTransactionBlock({digest:t,options:{showEvents:!0,showEffects:!0}})}return this.updateCache(i,r,Me),r}updateCache(t,e,i=Ir){let n=this._cache[t];n?(n.overdueTime=Ce(i),n.value=e):n=new qi(e,Ce(i)),this._cache[t]=n}getCache(t,e=!1){let i=this._cache[t],n=i==null?void 0:i.isValid();if(!e&&n)return i.value;n||delete this._cache[t]}},Lo=class extends Ue{async queryEventsByPage(t,e="all"){let i=[],n=!0,r=e==="all",a=r?null:e.cursor;do{let s=await this.queryEvents({query:t,cursor:a,limit:r?null:e.limit});s.data?(i=[...i,...s.data],n=s.hasNextPage,a=s.nextCursor):n=!1}while(r&&n);return{data:i,nextCursor:a,hasNextPage:n}}async getOwnedObjectsByPage(t,e,i="all"){let n=[],r=!0,a=i==="all",s=a?null:i.cursor;do{let c=await this.getOwnedObjects({owner:t,...e,cursor:s,limit:a?null:i.limit});c.data?(n=[...n,...c.data],r=c.hasNextPage,s=c.nextCursor):r=!1}while(a&&r);return{data:n,nextCursor:s,hasNextPage:r}}async getDynamicFieldsByPage(t,e="all"){let i=[],n=!0,r=e==="all",a=r?null:e.cursor;do{let s=await this.getDynamicFields({parentId:t,cursor:a,limit:r?null:e.limit});s.data?(i=[...i,...s.data],n=s.hasNextPage,a=s.nextCursor):n=!1}while(r&&n);return{data:i,nextCursor:a,hasNextPage:n}}async batchGetObjects(t,e,i=50){let n=[];try{for(let r=0;r<Math.ceil(t.length/i);r++){let a=await this.multiGetObjects({ids:t.slice(r*i,i*(r+1)),options:e});n=[...n,...a]}}catch(r){console.log(r)}return n}async calculationTxGas(t){let{sender:e}=t.blockData;if(e===void 0)throw Error("sdk sender is empty");let i=await this.devInspectTransactionBlock({transactionBlock:t,sender:e}),{gasUsed:n}=i.effects;return Number(n.computationCost)+Number(n.storageCost)-Number(n.storageRebate)}async sendTransaction(t,e){try{return await this.signAndExecuteTransaction({transaction:e,signer:t,options:{showEffects:!0,showEvents:!0}})}catch(i){console.log("error: ",i)}}async sendSimulationTransaction(t,e,i=!0){try{if(i)return await this.devInspectTransactionBlock({transactionBlock:t,sender:e})}catch(n){console.log("devInspectTransactionBlock error",n)}}},Ro=class{constructor(t){Ht(this,"_cache",{});Ht(this,"_rpcModule");Ht(this,"_vaults");Ht(this,"_sdkOptions");Ht(this,"_senderAddress","");Ht(this,"_pool");this._sdkOptions=t,this._rpcModule=new Lo({url:t.fullRpcUrl}),this._vaults=new Io(this),this._pool=new xo(this),Or(this._sdkOptions)}get senderAddress(){return this._senderAddress}set senderAddress(t){this._senderAddress=t}get fullClient(){return this._rpcModule}get sdkOptions(){return this._sdkOptions}get Vaults(){return this._vaults}get Pool(){return this._pool}getVerifySenderAddress(){if(this.senderAddress.length===0||!Er(this.senderAddress))throw Error("this clmm config sdk senderAddess is illegal");return this.senderAddress}async getOwnerCoinAssets(t,e,i=!0){let n=[],r=null,a=`${this.sdkOptions.fullRpcUrl}_${t}_${e}_getOwnerCoinAssets`,s=this.getCache(a,i);if(s)return s;for(;;){let c=await(e?this.fullClient.getCoins({owner:t,coinType:e,cursor:r}):this.fullClient.getAllCoins({owner:t,cursor:r}));if(c.data.forEach(d=>{BigInt(d.balance)>0&&n.push({coinAddress:jt(d.coinType).source_address,coinObjectId:d.coinObjectId,balance:BigInt(d.balance)})}),r=c.nextCursor,!c.hasNextPage)break}return this.updateCache(a,n,30*1e3),n}async getOwnerCoinBalances(t,e){let i=[];return e?i=[await this.fullClient.getBalance({owner:t,coinType:e})]:i=[...await this.fullClient.getAllBalances({owner:t})],i}updateCache(t,e,i=Me){let n=this._cache[t];n?(n.overdueTime=Ce(i),n.value=e):n=new qi(e,Ce(i)),this._cache[t]=n}getCache(t,e=!1){let i=this._cache[t],n=i==null?void 0:i.isValid();if(!e&&n)return i.value;n||delete this._cache[t]}},jo=Ro;function $e(t="Sui"){const e={fullRpcUrl:localStorage.getItem(`${t}-currentRpclocal6`)||Kt[t||"Sui"].fullRpcUrl,simulationAccount:Kt[t||"Sui"].simulationAccount,clmm_pool:Kt[t||"Sui"].clmm_pool,integrate:Kt[t||"Sui"].integrate,frams:Kt[t||"Sui"].frams,vaults:Kt[t||"Sui"].vaults,aggregator:{endPoint:Kt[t||"SUI"].aggregatorv2Url,fullNodeurl:localStorage.getItem(`${t}-currentRpclocal6`)||Kt[t||"Sui"].fullRpcUrl,walletAddress:Kt[t||"Sui"].simulationAccount.address,env:Rr=="test"?Wi.Testnet:Wi.Mainnet,providers:["CETUS","DEEPBOOK","KRIYA","KRIYAV3","FLOWX","FLOWXV3","AFTERMATH","TURBOS","HAEDAL","VOLO","AFSUI"]}},i=new jo(e),n=jr(),r=Br(()=>n);Nr(()=>{r.value.address&&(i.senderAddress=r.value.address)});const a=async()=>{const S=await i.Vaults.getVaultList();return console.log("result.data:",S.data),S&&S.data||[]},s=async S=>{const k=await i.Vaults.getVault(S);return console.log(k,"vault##"),{...k,quota_based_type:jt(k.quota_based_type).full_address}},c=async S=>{if(console.log(S,"###coinType"),i.senderAddress){const k=await i.fullClient.getBalance({owner:i.senderAddress,coinType:S});return k&&k.totalBalance}else return 0},d=async()=>{try{if(i.senderAddress){const S=await i.fullClient.getAllBalances({owner:i.senderAddress});return console.log("🚀 ~ file: useAutoPool.ts:95 ~ getAllBalances ~ allBalance:",S),S}else return[]}catch(S){console.log("🚀 ~ file: useAutoPool.ts:102 ~ getAllBalances ~ error:",S)}},h=S=>({transactionBlock:S,options:{showEffects:!0,showEvents:!0,showInput:!0,showRawInput:!0,showObjectChanges:!0,showBalanceChanges:!0}});return{getVaultList:a,getVault:s,getLpBalance:c,calculateDepositAmount:async S=>{const k=await i.Vaults.calculateDepositAmount(S);if(console.log("🚀🚀🚀 ~ file: useVaults.ts:104 ~ calculateDepositAmount ~ params:",S),console.log("🚀🚀🚀 ~ file: useVaults.ts:104 ~ calculateDepositAmount ~ result:",k),console.log("🚀🚀🚀 ~ file: useVaults.ts:106 ~ calculateDepositAmount ~ params.side == InputType.OneSide:",S.side==He.OneSide),S.side==He.OneSide){if(k.swap_result){const T=new E(k.swap_result.swap_out_amount);return{...k.swap_result,swapInAmount:k.swap_result.swap_in_amount,swapOutAmount:T.toString(),swapOutAmountLimit:Dt(T.sub(T.mul(S.slippage)).toNumber(),0),request_id:k.request_id}}return k.swap_result}else return k},deposit:async S=>{const k=await i.Vaults.deposit(S);return h(k)},calculateWithdrawAmount:async S=>{const k=await i.Vaults.calculateWithdrawAmount(S);if(S.side==He.OneSide){if(k.swap_result){const T=new E(k.swap_result.swap_out_amount);return{...k.swap_result,swapInAmount:k.swap_result.swap_in_amount,swapOutAmount:T.toString(),swapOutAmountLimit:Dt(T.sub(T.mul(S.slippage)).toNumber(),0),request_id:k.request_id}}return k.swap_result}else return k},withdraw:async S=>{const k=await i.Vaults.withdraw(S);return h(k)},getAllBalances:d}}const Wo=Pr("autoPool",{state:()=>({autoPoolList:[],autoPoolObj:{},positionInfoObj:{},positionInfoList:[],positionUSDObj:{},apyObj:{},currentAutoPoolStatus:"STATUS_RUNNING",slippage:localStorage.getItem("cetus-auto-slippage")||"0.1",autoPoolLoading:!0}),getters:{getPoolStore(){return Fr()}},actions:{setApyObj(t){this.apyObj=t},setAutoPoolList(t){this.autoPoolList=t;const e=Object.fromEntries(t.map((i,n)=>[i.address,i]));this.autoPoolObj={...e}},async getAutoPoolList(){var d;const e=await $e("Sui").getVaultList();console.log("🚀🚀🚀 ~ file: autoPool.ts:35 ~ getAutoPoolList ~ list:",e),console.log(e,"list###");const i=this.getPoolStore,n=Kt.Sui.vaultFilter;let r;try{r=await fetch(`${Kt.Sui.api}/v2/sui/auto_pools`).then(h=>h.json()),r.data&&r.data.pools&&r.data.pools.length>0&&(this.apyObj=Object.fromEntries(r.data.pools.map((h,f)=>[h.object_id,{...h,apr:h.apr.replace("%","")>0&&h.apr.replace("%","")<.01?"<0.01%":h.apr.replace("%","")<0?"--":Dt(h.apr.replace("%",""),2)+"%",resultApr:h.apr.replace("%","")}])),console.log(this.apyObj,"data##"))}catch{r=[],this.apyObj={}}console.log(r==null?void 0:r.data,"data##37");const a=((d=r==null?void 0:r.data)==null?void 0:d.pools)||[],s=a&&a.length>0?e.filter(h=>a.some(f=>f.object_id===h.id)):e;console.log(s,"##openPoolList");const c=(n?s:e).map(h=>{var b,C,S,k,T,N,q;const f=i.poolConfigObj[h.pool_id];console.log("🚀🚀🚀 ~ file: autoPool.ts:55 ~ autoPoolList ~ poolStore.poolConfigObj:",i.poolConfigObj),console.log("autoPoolList map",h,f);const g=[f!=null&&f.needReverse?(C=f==null?void 0:f.coinB)==null?void 0:C.address:(b=f==null?void 0:f.coinA)==null?void 0:b.address,f!=null&&f.needReverse?(k=f==null?void 0:f.coinA)==null?void 0:k.address:(S=f==null?void 0:f.coinB)==null?void 0:S.address];return(T=f==null?void 0:f.rewarderInfo)==null||T.forEach(P=>{P.emissionsEveryDay>0&&g.push(Hi(P.coinAddress))}),(q=(N=f==null?void 0:f.stable_farming)==null?void 0:N.stable_rewarder)==null||q.forEach(P=>{P.amount_second>0&&g.push(Hi(P.coin))}),{...f,token_a:f.coinA,token_b:f.coinB,id:h.id,lp_token_type:h.lp_token_type,autoPoolPositionInfo:h.position,is_pause:h.is_pause,total_supply:h.total_supply,liquidity:h.liquidity,protocol_fee_rate:h.protocol_fee_rate,max_quota:h.max_quota,stakeProtocol:h.stake_protocol,quota_based_type:jt(h.quota_based_type).full_address,supportHaedalStake:!!h.stake_protocol,isTokenA:f!=null&&f.needReverse?(f==null?void 0:f.coin_b_address)=="0000000000000000000000000000000000000000000000000000000000000002::sui::SUI":(f==null?void 0:f.coin_a_address)=="0000000000000000000000000000000000000000000000000000000000000002::sui::SUI",rewardList:Array.from(new Set(g))}});this.autoPoolObj=Object.fromEntries(c.map((h,f)=>[h.address,h])),this.autoPoolList=c,console.log(c,"##autoPoolList")},async getMyAutoPoolPosition(t){var g,b,C,S,k,T;console.log("🚀 ~ file: autoPool.ts:116 ~ getMyAutoPoolPosition ~ getMyAutoPoolPosition Start");const e=$e("Sui"),i=t||this.autoPoolList;console.log("🚀 ~ file: autoPool.ts:119 ~ getMyAutoPoolPosition ~ list:",i);const n=Gi("Sui"),r=[],{RATES:a}=this.getPoolStore,s=i.map(N=>{var q;return(N==null?void 0:N.address)||((q=N==null?void 0:N.autoPoolPositionInfo)==null?void 0:q.clmm_pool_id)}),c=await n.getPools(s);console.log("🚀 ~ file: autoPool.ts:129 ~ getMyAutoPoolPosition ~ newClmmPools:",c);const d=Object.fromEntries((g=Object.values(c))==null?void 0:g.map(N=>[N.poolAddress,N])),h=await e.getAllBalances();console.log("🚀 ~ file: autoPool.ts:148 ~ getMyAutoPoolPosition ~ allBalance:",h);const f=Object.fromEntries(h==null?void 0:h.map(N=>[jt(N.coinType).full_address,N]));for(let N=0;N<i.length;N++){const q=i[N];console.log(q,"poolINfo###");const P=d==null?void 0:d[q.address||q.autoPoolPositionInfo.clmm_pool_id];console.log("🚀 ~ file: autoPool.ts:142 ~ getMyAutoPoolPosition ~ newPool:",P),console.log("🚀 ~ file: autoPool.ts:148 ~ getMyAutoPoolPosition ~ poolInfo?.lp_token_type:",q==null?void 0:q.lp_token_type);const O=(b=f==null?void 0:f[jt(q==null?void 0:q.lp_token_type).full_address])==null?void 0:b.totalBalance;console.log("🚀 ~ file: autoPool.ts:148 ~ getMyAutoPoolPosition ~ balance:",O);const x=(await n.getTokenListByCoinType([i[N].lp_token_type]))[0];console.log("🚀 ~ file: autoPool.ts:154 ~ getMyAutoPoolPosition ~ lpInfo:",x);const U=((C=a[q.coinA.address])==null?void 0:C.price)||0,V=((S=a[q.coinB.address])==null?void 0:S.price)||0,K=q.autoPoolPositionInfo.tick_lower_index,W=q.autoPoolPositionInfo.tick_upper_index,ut=Number(O)>0?Re.get_share_liquidity_by_amount({...q,liquidity:q==null?void 0:q.liquidity,total_supply:q==null?void 0:q.total_supply},O):0;console.log("🚀 ~ file: autoPool.ts:159 ~ getMyAutoPoolPosition ~ liquidity:",ut);const G={tick_lower_index:K,tick_upper_index:W,current_sqrt_price:P==null?void 0:P.current_sqrt_price,liquidity:ut};console.log(q,"poolInfo##94");const F=n.getCoinAmountFromLiquidity({pool:{...q,current_sqrt_price:P==null?void 0:P.current_sqrt_price},position:G,roundUp:!1});console.log(F,"##amountInfo");const H=F.coinaAmount,y=F.coinbAmount,o=H,l=y,p=q.coinA.decimals,_=q.coinB.decimals,v=n.TickMath.tickIndexToPrice(Number(K),p,_).toString(),A=n.TickMath.tickIndexToPrice(Number(W),p,_).toString(),M=H>0?new E(U).mul(new E(H)).toNumber():0,m=y>0?new E(V).mul(new E(y)).toNumber():0,u=M>0&&M<.01?"<$0.01":`$${je(Dt(M,2))}`,w=m>0&&m<.01?"<$0.01":`$${je(Dt(m,2))}`,$=Xt.sqrtPriceX64ToPrice(P.current_sqrt_price,p,_),I=n.getCoinAmountFromLiquidity({pool:{...q,tick_lower_index:K,tick_upper_index:W,current_sqrt_price:P==null?void 0:P.current_sqrt_price},position:{...G,liquidity:q.liquidity},roundUp:!1}),R=new E(I.coinaAmount).toNumber(),st=new E(I.coinbAmount).toNumber();console.log(R,st,$.toString(),"###116");const J=Dt(new E(R).mul(new E(U)).toNumber(),2),Q=Dt(new E(st).mul(new E(V)).toNumber(),2);console.log(P,"newPool##"),console.log(R,st,U,V,Number(J)+Number(Q),"###poolCoinBNum");const{ratioA:me,ratioB:lt}=Re.calculateDepositRatio(K,W,new X.BN(P==null?void 0:P.current_sqrt_price));console.log(me,lt.toString(),"###139");const it=me.mul(100).toNumber().toFixed(0),ie=100-Number(it);console.log(R,st,it,ie,"###147");let et=0;Number(O)>0&&(et=new E(O).div(Math.pow(10,x.decimals))),console.log("🚀 ~ file: autoPool.ts:234 ~ getMyAutoPoolPosition ~ myLiquidity:",et.toString());const ct=new E(M).add(new E(m)).toNumber(),se=U&&V?ct>0&&ct<.01?"<0.01":Dt(new E(M).add(new E(m)).toString(),2):"--",at=q.total_supply;let z=0;et>0&&at>0&&(z=new E(et).mul(Math.pow(10,x.decimals)).div(new E(at)).mul(100).toNumber()),console.log(z,"##myShare");const ae=new E(1).div(Math.pow(10,q.decimals)).toNumber();let Y=0;if(z>1)Y=Dt(z,2);else if(z>0&&z<ae)Y=`<${ae}`;else if(z==0)Y=0;else{const mt=Xi(z),Le=mt==-1?2:mt+2;Y=Dt(z,Le)}console.log(O,et.toString(),"###balance");const tt=(await n.getTokenListByCoinType([q.quota_based_type]))[0],ue=Ne(q.max_quota,tt.decimals);console.log(q.quota_based_type,tt,ue,"##quoteCoinInfo");const rt=tt.address==q.coin_b_address,ht=rt?new E(I.coinaAmount).mul(q.price).add(I.coinbAmount):new E(I.coinaAmount).mul(1/q.price).add(I.coinbAmount),Ie=((k=a[tt.address])==null?void 0:k.price)||0,ft=ht.mul(new E(Ie)).toNumber();console.log(rt,ft,"#isQuotaCoin");const dt=ue,xe=rt?new E(I.coinaAmount).mul(q.price).add(I.coinbAmount):new E(I.coinaAmount).mul(1/q.price).add(I.coinbAmount),pt=new E(dt).sub(xe).mul(V).toNumber();console.log(pt,"remainingTokenUSD##"),console.log(ht.toNumber(),"#poolTokenNum"),this.positionInfoObj[q.id]={tick_lower_index:K,tick_upper_index:W,current_sqrt_price:P.current_sqrt_price,myLiquidity:Ne(O,x.decimals),amountA:o,amountB:l,...q,lpInfo:x,myAmountAUSD:u,myAmountBUSD:w,myLiquidityUSD:se,myShare:Y,minPrice:v,maxPrice:A,poolCoinARatio:it,poolCoinBRatio:ie,poolCoinANum:R,poolCoinBNum:st,poolCoinAUSD:J,poolCoinBUSD:Q,quoteUSD:dt,balance:O,quoteCoinInfo:tt,remainingTokenUSD:pt,currentDeposit:ft,positionLiquidity:ut,total_supply:q.total_supply},r.push({tick_lower_index:K,tick_upper_index:W,current_sqrt_price:(T=q==null?void 0:q.object)==null?void 0:T.current_sqrt_price,myLiquidity:Ne(O,x.decimals),amountA:o,amountB:l,...q,lpInfo:x,myAmountAUSD:u,myAmountBUSD:w,myLiquidityUSD:se,myShare:Y,minPrice:v,maxPrice:A,poolCoinARatio:it,poolCoinBRatio:ie,poolCoinANum:R,poolCoinBNum:st,poolCoinAUSD:J,poolCoinBUSD:Q,quoteUSD:dt,balance:O,total_supply:q.total_supply})}this.positionInfoList=r,this.autoPoolLoading=!1,console.log(this.positionInfoObj,"this.positionInfoObj###"),console.log(this.positionInfoList,"###this.positionInfoList")},async updatePositionItem(t){var se,at,z,ae,Y,tt,ue;console.log("🚀 ~ file: autoPool.ts:116  ~ updatePositionItem Start");const e=$e("Sui"),i=Gi("Sui"),n=await e.getVault(t);console.log("🚀🚀🚀 ~ file: autoPool.ts:318 ~ updatePositionItem ~ newPoolInfo:",n);const r=await i.getPool(n.address||n.position.clmm_pool_id);console.log("newPoolInfo:",n),console.log("newPool:",r),console.log("this.positionInfoObj[id]:",this.positionInfoObj[t]);const a={...this.positionInfoObj[t],autoPoolPositionInfo:n.position,...r},s=await e.getLpBalance(a.lp_token_type);console.log(s,"updatePositionItem lp balance");const c=(await i.getTokenListByCoinType([a.lp_token_type]))[0];console.log(s,"###balance updatePositionItem");const d=a.autoPoolPositionInfo.tick_lower_index,h=a.autoPoolPositionInfo.tick_upper_index;let f;n.total_supply==0?f=0:f=Re.get_share_liquidity_by_amount(n,String(s)),console.log(f,"##liquidity");const g={tick_lower_index:d,tick_upper_index:h,current_sqrt_price:r.current_sqrt_price,liquidity:f},b=i.getCoinAmountFromLiquidity({pool:{current_sqrt_price:r.current_sqrt_price,...a},position:g,roundUp:!1}),C=b.coinaAmount,S=b.coinbAmount,{RATES:k}=this.getPoolStore,T=n.total_supply,N=Xt.sqrtPriceX64ToPrice(r.current_sqrt_price,(se=a==null?void 0:a.coinA)==null?void 0:se.decimals,(at=a==null?void 0:a.coinB)==null?void 0:at.decimals),q=2,P=2,O=((ae=k[(z=a==null?void 0:a.coinA)==null?void 0:z.address])==null?void 0:ae.price)||0,x=((tt=k[(Y=a==null?void 0:a.coinB)==null?void 0:Y.address])==null?void 0:tt.price)||0,U=(b==null?void 0:b.coinaAmount)>0?new E(O).mul(new E(b==null?void 0:b.coinaAmount)).toNumber():0,V=(b==null?void 0:b.coinbAmount)>0?new E(x).mul(new E(b==null?void 0:b.coinbAmount)).toNumber():0,K=U>0&&U<.01?"<$0.01":`$${je(Dt(U,2))}`,W=V>0&&V<.01?"<$0.01":`$${je(Dt(V,2))}`;let ut=new E(0);Number(s)>0&&(ut=new E(s).div(Math.pow(10,c==null?void 0:c.decimals)),console.log("🚀🚀🚀 ~ file: autoPool.ts:379 ~ updatePositionItem ~ myLiquidity:",ut.toString()));const G=new E(U).add(new E(V)).toNumber(),F=O&&x?G>0&&G<.01?"<0.01":Dt(new E(U).add(new E(V)).toString(),2):"--";let H=0;ut.toNumber()>0&&T>0&&(H=new E(ut).mul(Math.pow(10,c.decimals)).div(new E(T)).mul(100).toNumber()),console.log(H,"##myShare");const y=new E(1).div(Math.pow(10,a.decimals)).toNumber();let o=0;if(H>1)o=Dt(H,2);else if(H>0&&H<y)o=`<${y}`;else if(H==0)o=0;else{const rt=Xi(H),ht=rt==-1?2:rt+2;o=Dt(H,ht)}const l=Xt.sqrtPriceX64ToPrice(r.current_sqrt_price,q,P),p=await i.getCoinAmountFromLiquidity({pool:{...a,tick_lower_index:d,tick_upper_index:h,current_sqrt_price:r==null?void 0:r.current_sqrt_price},position:{...g,liquidity:n.liquidity},roundUp:!1}),_=new E(p.coinaAmount).toNumber(),v=new E(p.coinbAmount).toNumber();console.log(_,v,l.toString(),"###116");const A=Dt(new E(_).mul(new E(O)).toNumber(),2),M=Dt(new E(v).mul(new E(x)).toNumber(),2);console.log(r,"newPool##"),console.log(_,v,O,x,Number(A)+Number(M),"###poolCoinBNum");const{ratioA:m,ratioB:u}=Re.calculateDepositRatio(d,h,new X.BN(r==null?void 0:r.current_sqrt_price));console.log(m,u.toString(),"###139");const w=m.mul(100).toNumber().toFixed(0),$=100-Number(w),I=(await i.getTokenListByCoinType([n.quota_based_type]))[0],R=Ne(n.max_quota,I.decimals);console.log(n.quota_based_type,I,R,"##quoteCoinInfo");const st=I.address==a.coin_b_address,J=st?new E(p.coinaAmount).mul(a.price).add(p.coinbAmount):new E(p.coinaAmount).mul(1/a.price).add(p.coinbAmount),Q=((ue=k[I.address])==null?void 0:ue.price)||0,me=J.mul(new E(Q)).toNumber(),lt=R,it=st?new E(p.coinaAmount).mul(a.price).add(p.coinbAmount):new E(p.coinaAmount).mul(1/a.price).add(p.coinbAmount),ie=new E(lt).sub(it).mul(x).toNumber();console.log(ie,"remainingTokenUSD##");const et=i.TickMath.tickIndexToPrice(Number(d),q,P).toString(),ct=i.TickMath.tickIndexToPrice(Number(h),q,P).toString();this.positionInfoObj[t]={...a,tick_lower_index:d,tick_upper_index:h,current_sqrt_price:r.current_sqrt_price,myLiquidity:Ne(s,c==null?void 0:c.decimals),amountA:C,amountB:S,myShare:o,myAmountAUSD:K,myAmountBUSD:W,myLiquidityUSD:F,poolCoinARatio:w,poolCoinBRatio:$,poolCoinANum:_,poolCoinBNum:v,poolCoinAUSD:A,poolCoinBUSD:M,quoteUSD:lt,balance:s,price:N,quoteCoinInfo:I,remainingTokenUSD:ie,currentDeposit:me,positionLiquidity:f,liquidity:n==null?void 0:n.liquidity,minPrice:et,maxPrice:ct,total_supply:n.total_supply},this.autoPoolLoading=!1,console.log(this.positionInfoObj[t],"###this.positionInfoObj[id]")},async getAutoPoolAPY(){try{const{data:t}=await fetch(`${Kt.Sui.api}/v2/sui/auto_pools`).then(e=>e.json());t&&t.pools&&t.pools.length>0&&(this.apyObj=Object.fromEntries(t.pools.map((e,i)=>[e.object_id,{...e,apr:e.apr.replace("%","")>0&&e.apr.replace("%","")<.01?"<0.01%":Dt(e.apr.replace("%",""),2)+"%",resultApr:e.apr.replace("%","")}])),console.log(this.apyObj,"data##"))}catch{this.apyObj={}}},async getVault(t,e){const i=$e("Sui");e||(this.autoPoolLoading=!0);const{status:n}=await i.getVault(t);this.currentAutoPoolStatus=n,this.updatePositionItem(t),console.log(n,"status##")},setSlippage(t){console.log(t,"slippage##"),this.slippage=t,localStorage.setItem("cetus-auto-slippage",t)},logout(){this.getMyAutoPoolPosition(),this.positionUSDObj={}}}});export{He as A,$e as a,Wo as u};
