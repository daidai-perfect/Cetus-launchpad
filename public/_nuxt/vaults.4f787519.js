import{a as v,m as b,A as k,o as w,f as S,h as y,i as P,w as m,B as x,j as B}from"./entry.36f3621b.js";import{f as j}from"./fetchFun.ff4aae28.js";import{u as q}from"./useSDK.30fcf67a.js";import{c as h,p as E}from"./index.55c13568.js";import{c as T,b as C,J as A}from"./common.8e6280e4.js";import{u as F}from"./autoPool.c59b9752.js";import{a as N}from"./index.fb680c8c.js";import"./decimal.765d8738.js";import"./decimal.a2826370.js";function R(){const{peripherySdk:L}=q(),{setApyObj:d,setAutoPoolList:c}=F(),n=async()=>{try{const s=await j(`${h.Sui.api}/v2/sui/auto_pools`);if(console.log("ðŸš€ ~ file: useVaultList.ts:11 ~ fetchAutoPoolsApi ~ res:",s),s!=null&&s.pools){const t=Object.fromEntries(s==null?void 0:s.pools.map(e=>[e==null?void 0:e.object_id,{...e,apr:e.apr.replace("%","")>0&&e.apr.replace("%","")<.01?"<0.01%":C(e.apr.replace("%",""),2)+"%",resultApr:e.apr.replace("%","")}]))||{};return d(t),t}return{}}catch(s){return console.error("ðŸš€ ~ file: useVaultList.ts:14 ~ fetchAutoPoolsApi ~ error:",s),{}}},p=(s,o)=>{var a,u,l,r,V,f,g;const t=o[s.pool_id];console.log("ðŸš€ ~ file: useVaultList.ts:26 ~ getVaultList ~ poolsObj:",o);const e=[t!=null&&t.needReverse?(u=t==null?void 0:t.coinB)==null?void 0:u.address:(a=t==null?void 0:t.coinA)==null?void 0:a.address,t!=null&&t.needReverse?(r=t==null?void 0:t.coinA)==null?void 0:r.address:(l=t==null?void 0:t.coinB)==null?void 0:l.address];return(V=t==null?void 0:t.rewarderInfo)==null||V.forEach(i=>{i.emissionsEveryDay>0&&e.push(A(i.coinAddress))}),(g=(f=t==null?void 0:t.stable_farming)==null?void 0:f.stable_rewarder)==null||g.forEach(i=>{i.amount_second>0&&e.push(A(i.coin))}),{...t,token_a:t.coinA,token_b:t.coinB,id:s.id,lp_token_type:s.lp_token_type,autoPoolPositionInfo:s.position,is_pause:s.is_pause,total_supply:s.total_supply,liquidity:s.liquidity,protocol_fee_rate:s.protocol_fee_rate,max_quota:s.max_quota,stakeProtocol:s.stake_protocol,quota_based_type:E(s.quota_based_type).full_address,supportHaedalStake:!!s.stake_protocol,isTokenA:t!=null&&t.needReverse?(t==null?void 0:t.coin_b_address)=="0000000000000000000000000000000000000000000000000000000000000002::sui::SUI":(t==null?void 0:t.coin_a_address)=="0000000000000000000000000000000000000000000000000000000000000002::sui::SUI",rewardList:Array.from(new Set(e))}};return{getVaultList:async s=>{var o;console.log("ðŸš€ ~ file: useVaultList.ts:26 ~ getVaultList ~ start",s);try{const t=h.Sui.vaultFilter,e=await n();if(e&&!T(e)){const a=await L.Vaults.getVaultList();console.log("ðŸš€ ~ file: useVaultList.ts:26 ~ getVaultList ~ result:",a);const u=t?(o=a==null?void 0:a.data)==null?void 0:o.filter(r=>e==null?void 0:e[r==null?void 0:r.id]):a==null?void 0:a.data;console.log("ðŸš€ ~ file: useVaultList.ts:26 ~ getVaultList ~ openPoolList:",u);const l=u.map(r=>p(r,s));console.log("ðŸš€ ~ file: useVaultList.ts:26 ~ autoPoolList ~ autoPoolList:",l),c(l)}}catch(t){console.error("ðŸš€ ~ file: useVaultList.ts:87 ~ getVaultList ~ error:",t),c([])}}}}const O=y("h3",null,"Vaults",-1),Q=v({__name:"vaults",setup(L){const{getVaultList:d}=R(),c=N(),n=b(()=>c),p=()=>{d(n.value.poolConfigObj)};return k(()=>n.value.RATES,_=>{console.log("ðŸš€ ~ file: vaults.vue:28 ~ watch ~ newValue:",_)},{immediate:!0,deep:!0}),(_,s)=>{const o=x;return w(),S("div",null,[O,y("div",null,[P(o,{onClick:p},{default:m(()=>[B("get vault list")]),_:1})])])}}});export{Q as default};
