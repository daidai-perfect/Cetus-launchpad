import{a as W,u as E,b as Y}from"./index.ab348efd.js";import{c as G,d as V}from"./common.831588b7.js";import{a as H,r as k,q as Z,s as ee,m as S,A as J,b as te,L as K,e as Q,l as j,o as D,f as z,h as n,i as R,G as oe,y as ne,p as ie,k as ae,x as O}from"./entry.81366e87.js";import{I as re}from"./icon-slippage.ffccdfb9.js";import{I as ce}from"./icon-refresh.0b3e3937.js";import"./decimal.a2826370.js";import{b as M}from"./index.3a5cc2eb.js";import{I as se}from"./icon-tooltip.ffac3883.js";import{C as le}from"./coin-img-warning.f87df7b5.js";import{D as o}from"./decimal.765d8738.js";const ue=H({components:{IconSlippage:re,IconRefresh:ce},props:{poolInfo:{type:Object,default:()=>({})}},setup(e,I){const u=k(!1),b=k(null),i=k(0);let a=k(!1);const t=k(20),m=W(),h=E(),d=k(!1);Z(()=>{}),ee(()=>{clearInterval(b.value)});const y=()=>{a.value=!1,b.value=setInterval(()=>{var g;d.value||i.value<t.value&&(i.value+=1,i.value===t.value&&(a.value=!0,(g=e==null?void 0:e.poolInfo)!=null&&g.poolAddress&&m.updateCurrentPools(e.poolInfo.poolAddress,h.chainName),i.value=0,setTimeout(()=>{a.value=!1},1e3)))},1e3)},B=S(()=>h.slippage),r=()=>{I.emit("clearAll")},f=()=>{a.value||(a.value=!0,i.value=0,I.emit("clickRefresh"),setTimeout(()=>{a.value=!1,y()},1e3))};J(()=>e.poolInfo,g=>{g&&!b.value&&y()},{immediate:!0});const c=te(),T=K();return{refresh:a,clickRefresh:f,isShowSwapSetting:u,countdown:i,autoRefreshTime:t,slippage:B,clearAll:r,checkNullObj:G,router:c,route:T}}});const me=e=>(ie("data-v-47ca611f"),e=e(),ae(),e),de={class:"title"},fe=me(()=>n("div",{class:"left"},[n("span",null,"Deposit Amounts")],-1)),ve={key:0,class:"deposit-progress"};function _e(e,I,u,b,i,a){const t=j("IconSlippage"),m=j("IconRefresh");return D(),z("div",de,[fe,n("div",{class:ne(["right",e.poolInfo?"havePoolInfo":"noPoolInfo"])},[R(t),e.route.name!=="liquidity-create"?(D(),z("div",ve,[R(m,{refresh:e.refresh,onClickRefresh:e.clickRefresh},null,8,["refresh","onClickRefresh"])])):oe("",!0)],2)])}const je=Q(ue,[["render",_e],["__scopeId","data-v-47ca611f"]]),pe=H({components:{IconTooltip:se,CoinImgWarning:le},props:{fromCoin:{type:Object,default:()=>({})},toCoin:{type:Object,default:()=>({})},fromCoinAmount:{type:String,default:""},toCoinAmount:{type:String,default:""},fixedFromCoin:{type:Boolean,defalut:!0},isInputTotalAmount:{type:Boolean,default:!1},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},createPoolInfo:{type:Object,default:()=>({})},currentPrice:{type:Number,default:0},currentPriceReverse:{type:Number,default:0},currentPriceTab:{type:String,default:""}},setup(e){const I=W(),u=S(()=>I),b=E(),i=S(()=>b),a=K(),t=S(()=>{let r=null;if(a.name=="liquidity-create")r=e.createPoolInfo;else for(const f in u.value.poolsObj){const c=u.value.poolsObj[f];c.address==a.query.poolAddress&&(r=c)}return r}),m=S(()=>i.value.chainName?Y(i.value.chainName):{}),h=S(()=>i.value.slippage),d=k(),y=k(),B=async()=>{var U;if(!e.minPrice&&!e.maxPrice)return;console.log("ðŸš€ðŸš€ðŸš€ ~ file: new-liquidity-deposit-ratio.vue:170 ~ getRatio ~ poolInfo.value:",t.value);const{TickUtil:r,TickMath:f,getNearestTickByTick:c}=m.value,T=t.value.token_a.decimals,g=t.value.token_b.decimals;let N,F,P,w,q,L,v,s=1,l=1;const $=t.value.current_tick_index;let x=u.value.poolPriceConfigObj&&u.value.poolPriceConfigObj[t.value.address]&&u.value.poolPriceConfigObj[t.value.address].recommend_ranges||{};if(t.value.token_a.address.toLowerCase()===e.fromCoin.address.toLowerCase()&&t.value.token_b.address.toLowerCase()===e.toCoin.address.toLowerCase()?v=!0:v=!1,e.minPrice==="0"&&e.maxPrice==="âˆž")P=r.getMinIndex(t.value.tickSpacing),w=r.getMaxIndex(t.value.tickSpacing);else if(e.currentPriceTab=="custom"){v?(N=e.minPrice,F=e.maxPrice):(N=e.maxPrice!=="âˆž"?new o(1).div(e.maxPrice).toString():1/0,F=new o(1).div(e.minPrice).toString());try{q=f.priceToTickIndex(new o(N),T,g)}catch{q=-443636}try{L=f.priceToTickIndex(new o(F),T,g)}catch{L=443636}N==0&&(q=-443636),P=c(q,Number(t.value.tickSpacing),!0),w=c(L,Number(t.value.tickSpacing),!0)}else P=x&&x[e.currentPriceTab]&&x[e.currentPriceTab].lower,w=x&&x[e.currentPriceTab]&&x[e.currentPriceTab].upper;if(e.maxPrice==="âˆž"||$>=P&&$<=w){let _;if(e.fixedFromCoin){const A=new o(Number(e.fromCoinAmount)==0?1:e.fromCoinAmount).mul(Math.pow(10,e.fromCoin.decimals)).toString();_=new M(A)}else{const A=new o(Number(e.toCoinAmount)==0?1:e.toCoinAmount).mul(Math.pow(10,e.toCoin.decimals)).toString();_=new M(A)}if(console.log("ðŸš€ðŸš€ðŸš€ ~ file: new-liquidity-deposit-ratio.vue:262 ~ getRatio ~ poolInfo.value.current_sqrt_price:",t.value.current_sqrt_price),((U=t==null?void 0:t.value)==null?void 0:U.current_sqrt_price)<=0)return!1;const{tokenMaxA:p,tokenMaxB:C}=await m.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:t.value.token_a,tokenB:t.value.token_b,lowerTick:P,upperTick:w,coinAmount:_,iscoinA:v?e.fixedFromCoin:!e.fixedFromCoin,roundUp:!0,slippage:Number(h.value)/100,curSqrtPrice:new M(t.value.current_sqrt_price)});v?e.fixedFromCoin?(l=Number(C)>0?C:"",s=Number(p)>0?p:""):(s=Number(p)>0?p:"",l=Number(C)>0?C:""):(e.fixedFromCoin,l=p,s=C)}else $>w?v?(l=1,s=0):(s=1,l=0):$<P&&(v?(l=0,s=1):(l=1,s=0));if(e.minPrice=="0"&&e.maxPrice=="âˆž")d.value=50,y.value=50;else{const _=s?Number(s):0,p=l?Number(l):0,C=new o(p).add(new o(v?new o(_*e.currentPrice):new o(_*e.currentPriceReverse))),A=V(new o(_).mul(new o(v?e.currentPrice:e.currentPriceReverse)).div(C).mul(100).toNumber().toFixed(2),2),X=V(new o(p).div(C).mul(100).toNumber().toFixed(2),2);d.value=A,y.value=X}};return J(()=>[t.value,e.minPrice,e.maxPrice,e.fromCoinAmount,e.toCoinAmount,e.isInputTotalAmount],([r,f,c,T,g])=>{f&&c&&r&&!G(r)&&(f!=="0"||c!=="0")?B():(d.value="",y.value="")},{immediate:!0,deep:!0}),{fromCoinRatio:d,toCoinRatio:y}}});const Ce={class:"deposit-ratio"},ge={class:"deposit-ratio-text"},ke=n("span",null,"Deposit Ratio",-1),be={class:"deposit-ratio-content"},he={class:"coin-ratio"},ye={class:"coin-a-ratio"},Ie={class:"coin-b-ratio"};function Pe(e,I,u,b,i,a){var h,d;const t=j("IconTooltip"),m=j("CoinImgWarning");return D(),z("div",Ce,[n("div",ge,[ke,R(t,{type:"depositRatio","xlink-href":"#icon-icon_tips"})]),n("div",be,[n("div",he,[n("div",ye,[R(m,{"token-info":e.fromCoin,"coin-size":"20px","warning-coin-size":"10px"},null,8,["token-info"]),n("span",null,O((h=e.fromCoin)==null?void 0:h.symbol),1),n("span",null,O(e.fromCoinRatio)+"%",1)]),n("div",Ie,[R(m,{"token-info":e.toCoin,"coin-size":"20px","warning-coin-size":"10px"},null,8,["token-info"]),n("span",null,O((d=e.toCoin)==null?void 0:d.symbol),1),n("span",null,O(e.toCoinRatio)+"%",1)])])])])}const Be=Q(pe,[["render",Pe]]);export{je as S,Be as a};
