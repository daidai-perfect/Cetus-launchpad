import{u as p,p as g,e as v,Z as S,s as x,_ as b}from"./pool.ec7155de.js";import{u as d}from"./useWhale.1ab3a139.js";import{a7 as A}from"./entry.99d20ac2.js";import{c as m}from"./sha256.f7311d31.js";import{D as r}from"./decimal.0bdeb344.js";const X=A("xcetus",{state:()=>({venft_id:"",xWhaleBalance:"--",venftInfo:{},pendingAmount:"--",newPendingAmount:"--",whaleBalance:"--",ownerLocks:[],availableXwhale:"--",redeemingXwhale:"--",nextStartTime:"",xcetusShare:"--",pendingCoinInfo:{},newPendingCoinInfo:{},cetusApr:"",claimLoading:"",dividendManagerInfo:{},rewardCoin:{},rewardCoinAmount:"--",xcetusRewardList:[]}),getters:{getPoolStore(){return p()}},actions:{async getOwnerVeNFT(n){const t=d("Sui");try{const e=await t.getOwnerVeNFT(n);console.log(e,"===>result"),e?(this.venft_id=e.id,this.xWhaleBalance=g(e.xcetus_balance,9),this.venftInfo={id:e.id,type:e.type,index:e.index,xcetus_balance:e.xcetus_balance},console.log("执行37"),this.getVeNFTDividendInfo()):(this.xWhaleBalance="0",this.availableXwhale="0",this.redeemingXwhale="0",this.pendingAmount="0",this.newPendingAmount="0")}catch{this.xWhaleBalance="--",this.availableXwhale="--",this.redeemingXwhale="--",this.pendingAmount="--",this.newPendingAmount="--"}},async getVeNFTDividendInfo(){const n=d("Sui"),t=v("Sui");try{const e=await n.getVeNFTDividendInfo(this.venft_id,this.dividendManagerInfo),o=await n.getPeriod(this.dividendManagerInfo),l=await t.getTokenList();console.log(o,"===>period"),console.log(e,"===>result");const c=[];if(e&&e.rewards&&e.rewards.length>0){for(let i=0;i<e.rewards.length;i++)if(e.rewards[i].period<o){const h=e.rewards[i].rewards;for(let a=0;a<h.length;a++){const s=h[a];Number(s.amount)>0&&c.push({...s})}}if(c&&c.length>0){const i={};for(let a=0;a<c.length;a++){const s=c[a];if(i[s.coin_type])i[s.coin_type].amount=new r(i[s.coin_type].amount).add(new r(s.amount)).toString();else{let u=l.filter(w=>S(w.address,s.coin_type))[0];u||(u=(await t.getTokenListByCoinType([s.coin_type]))[0]),i[s.coin_type]={...s,...u}}}const h=Object.values(i).map(a=>({...a,amount:x(g(a.amount,a.decimals),6)}));this.xcetusRewardList=h,console.log(h,"===>rewardArr")}else this.xcetusRewardList=[]}else this.xcetusRewardList=[]}catch{this.xcetusRewardList=[]}},async getDividendManager(){const t=await d("Sui").getDividendManager();this.nextStartTime=t.nextStartTime,this.dividendManagerInfo=t,this.getVeNFTDividendInfo()},async getAccountWhaleBalance(n){const e=await d("Sui").getOwnerCetusCoins(n);if(console.log(e,"==>assets"),e&&e.length>0){let o=new r(0);e.forEach(l=>{console.log(g(l.balance.toString(),9),"===>prettyAmount(ele.balance.toString(), 9)"),o=o.add(g(l.balance.toString(),9))}),console.log(this.whaleBalance,"===>this.whaleBalance"),this.whaleBalance=o}else this.whaleBalance="0"},async getOwnerLockCetuss(n){const e=await d("Sui").getOwnerLockCetuss(n);console.log(e,"assets===>");const o=e.sort((l,c)=>l.locked_until_time-c.locked_until_time);this.ownerLocks=o,console.log(this.ownerLocks,"===>this.ownerLocks"),this.setClaimLoading(""),this.getAvailableXCetus()},async getAvailableXCetus(){const n=d("Sui");console.log(this.ownerLocks,"==>this.ownerLocks");const t=await n.getAvailableXCetus(this.venftInfo,this.ownerLocks);console.log(t,"==>result1111"),this.availableXwhale=g(t,9),console.log(this.xWhaleBalance,"===>this.xWhaleBalance"),console.log(this.availableXwhale,"===>this.availableXwhale"),this.redeemingXwhale=this.xWhaleBalance!=="--"?new r(this.xWhaleBalance).sub(new r(this.availableXwhale)).toString():"0"},async getMyShare(n){const t=d("Sui");try{const e=await t.getMyShare(n);e?(this.xcetusShare=Number(e)>0&&Number(e)<.01?"<0.01":e,console.log(e,"result===>124")):this.xcetusShare="0"}catch(e){console.log(e,"e===>"),this.xcetusShare=""}},async getXcetusApr(){try{const n=d("Sui"),t=await n.getPhaseDividendInfo(this.dividendManagerInfo);if(t&&t.bonus&&t.bonus.length>0){const{tokensObj:e,RATES:o}=this.getPoolStore;let l=new r(0);console.log(t,"##phaseDividendInfo.bonus"),t.bonus.forEach(a=>{console.log(a,"##bonu");const s=a.name=="0000000000000000000000000000000000000000000000000000000000000002::sui::SUI"?"0x2::sui::SUI":b(a.name,!1);console.log(e,e[s],s,"##tokensObj[tokenAddress]");const u=e[s].decimals,w=o[s].price,f=new r(a.value).mul(new r(w)).div(new r(Math.pow(10,u)));l=l.add(f),console.log(l.toString(),"totalBonusAmount.toString()")});const{treasury:c}=await n.getXcetusManager(),i=o[m.Sui.xcetusTokenAddress].price;console.log(new r(c).div(Math.pow(10,9)).mul(i).toString(),"测试环境总质押"),console.log(l.div(7).mul(365).toString(),"测试环境奖励总数");const h=l.div(7).mul(365).div(new r(c).mul(i).div(Math.pow(10,9))).toNumber()*100;this.cetusApr=Number(h)>0&&Number(h)<.01?"<0.01":h}}catch(n){console.log("getXcetusApr error",n);const{data:t}=await fetch(`${m.Sui.api}/v2/sui/storm/dividend_rewards`).then(o=>o.json()),e=t.apr&&t.apr.replace("%","");this.cetusApr=Number(e)>0&&Number(e)<.01?"<0.01":e}},loginOut(){this.venft_id="",this.xWhaleBalance="--",this.venftInfo={},this.pendingAmount="--",this.whaleBalance="--",this.ownerLocks=[],this.availableXwhale="--",this.redeemingXwhale="--",this.xcetusShare="--",this.xcetusRewardList=[]},setClaimLoading(n){this.claimLoading=n}}});export{X as u};
