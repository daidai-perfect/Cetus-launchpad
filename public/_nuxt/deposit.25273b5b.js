import{j as eo,n as gt,d as he,e as wt,u as Mt,a as Fe,c as ce,s as pt,T as lt,G as to,b as ze,l as It,p as At}from"./pool.536b5e88.js";import{a as ot,r as F,l as $,H as $t,q as Se,e as it,o as q,f as W,t as Ft,N as oo,h as s,O as bt,v as ne,u as fe,x as Q,c as We,p as yt,k as _t,S as Bt,y as Rt,m as Ct,K as Ot,s as io,F as ht,E as Lt,i as He,A as mt,w as ut,j as Pt,P as Ut,a0 as no,b as ao,B as ro}from"./entry.d648dbe8.js";/* empty css              */import{s as ct,m as lo,l as so,b as uo,a as co}from"./transform.c672907f.js";import{D as a}from"./decimal.0bdeb344.js";import{u as Tt,a as mo}from"./sha256.00f5695d.js";import{d as jt,_ as zt,c as Ht,a as xt,b as vo}from"./new-liquidity-title.3ca40a98.js";import{i as kt}from"./import-icon.de3e6c66.js";/* empty css              */import{positionError as et,fromCoin as _,toCoin as h,tickList as Ve,minPrice as I,maxPrice as k,currentPrice as tt,currentPriceReverse as st,direction as ae,currentPriceTab as D,defaultMinPrice as vt,defaultMaxPrice as ft,toggle as Xt,isStableFarmingRange as Ue,isInputTotalAmount as Ee,priceConfigObj as Qe,fromCoinAmount as P,toCoinAmount as S,fixedFromCoin as Le,resetTickList as Nt,resetData as fo}from"./data.49295a7f.js";import{u as Et}from"./farms.7178b263.js";import{_ as go}from"./coin-lock.f6d4186c.js";import{_ as po}from"./coin-select.df3182ed.js";import{_ as bo}from"./viewDetail.f60b91db.js";import{a as ho}from"./new-add-or-create.3c366954.js";import{u as ko}from"./notifi.d495d744.js";import{_ as wo,a as yo}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.a28135f4.js";import"./lock.7436b5d5.js";/* empty css              *//* empty css              */import"./token-warning.c62bcb87.js";import"./swap-setting.23ef7b2c.js";/* empty css              */import"./icon-error_2x.b39bdc53.js";import"./img-lock_2x.b3051886.js";import"./img-no-Positions_2x.0bae41f5.js";import"./img-no-Positions_2x.6dc7e040.js";import"./status-block.6b67416b.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./useWhale.37ef0635.js";function qt(e,c,ge){const re=new a(10).pow(c-ge);return new a(1.0001).pow(e).mul(re)}const _o=ot({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,c){const ge=F(""),re=F(""),M=$(()=>{var n,T,m,v,B,ee;return console.log(e.poolInfo,"===>props.poolInfo"),(n=e.poolInfo)!=null&&n.current_sqrt_price&&((T=e.poolInfo)!=null&&T.coinA.decimals)&&((m=e.poolInfo)!=null&&m.coinB.decimals)?i.sqrtPriceX64ToPrice((v=e.poolInfo)==null?void 0:v.current_sqrt_price,(B=e.poolInfo)==null?void 0:B.coinA.decimals,(ee=e.poolInfo)==null?void 0:ee.coinB.decimals).toString():"0"}),le=$(()=>{let n=0;return e.direction?n=(Number(e.minPrice)/Number(M.value)-1)*100:n=(Number(e.minPrice)/Number(1/Number(M.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),j=$(()=>{let n=0;return e.direction?n=(Number(e.maxPrice)/Number(M.value)-1)*100:n=(Number(e.maxPrice)/Number(1/Number(M.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),z=Tt(),L=$(()=>z),oe=$(()=>L.value.chainName?wt(L.value.chainName):{}),{TickMath:i,getNearestTickByTick:w}=oe.value,V=(n=[])=>{let T=6;const m=Math.abs(Number(n[0])-Number(n[n.length-1]));return m>=6?T=0:m>=1?T=1:m>=.1?T=2:m>=.01?T=3:m>=.001?T=4:m>=1e-4?T=5:m>=1e-5?T=6:m>=1e-6?T=7:m>=1e-7&&(T=8),T},_e=(n,T=1)=>{if(n&&n.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const m=Number(e.poolInfo.current_tick_index);console.log("0117###dataProcessing###currentTick###",m),console.log("0117###dataProcessing###props.poolInfo###",e.poolInfo),console.log("0117###dataProcessing###minPrice###",e.minPrice),console.log("0117###dataProcessing###maxPrice###",e.maxPrice),console.log("0117###dataProcessing###poolInfo###",e.poolInfo);let v=m+100*T,B=m-100*T,ee,ke;if(e.maxPrice==="∞")ke=oe.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ke=i.priceToTickIndex(new a(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ke=i.priceToTickIndex(new a(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ke=443636}if(e.minPrice==="0")ee=oe.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ee=i.priceToTickIndex(new a(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ee=i.priceToTickIndex(new a(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ee=-443636}let Ie=0;if(e.currentPriceTab!=="full range"){if(m>=ee&&m<=ke){const A=m-ee,de=ke-m;Ie=Math.max(Math.abs(A),Math.abs(de))}else m<ee?Ie=Math.abs(ke-m):Ie=Math.abs(m-ee);v=m+Ie+100*T,B=m-Ie-100*T}else{const A=(Math.abs(m)>5e3,2e4);v=m+A*T,B=m-A*T}B<-443636&&(B=-443636),v>443636&&(v=443636);const b=new a(n.liquidity).div(Math.pow(10,8)).toString(),N=e.tickList;console.log("0117####drawChart####tick_info_array####",N);const H=[],Ce=[];let y={};for(let A=0;A<N.length;A++){if(y=N[A],y.index<=m&&y.index>=B){if(H.length<1&&A!==0){const de=N[A-1];H.unshift({...de,index:B,source:"left"})}H.unshift(y)}else if(y.index>m&&y.index<=v&&(Ce.push(y),H.length<1&&A!==0)){const de=N[A-1];H.push({...de,index:B,source:"left"})}if(y.index>v){const de=N[A];if(Ce.push({...de,index:v,source:"right"}),H.length<1&&A!==0){const Ke=N[A-1];H.push({...Ke,index:B,source:"left"})}break}}let R="0";for(let A=H.length-1;A>=0;A--)R=new a(R).plus(new a(H[A].liquidityNet.toString()).div(Math.pow(10,8))).toString(),H[A].liquityAmount=R;let G=b;for(let A=0;A<Ce.length;A++)G=new a(G).plus(new a(Ce[A].liquidityNet.toString()).div(Math.pow(10,8))).toString(),Ce[A].liquityAmount=G;let K=[];const O=N&&N.length>0?{index:m,liquityAmount:Number(b)}:{index:m,liquityAmount:0};(H.length>0||Ce.length>0)&&(K=[...H.reverse(),O,...Ce],e.direction||(K=K.reverse()));const je=[];N.forEach(A=>{je.push({...A,liquidityGross:A.liquidityGross.toString(),liquidityNet:A.liquidityNet.toString()})}),console.log("0117####drawChart####testTickInfoArray####",je),console.log("0117####drawChart####currentLiquity####",b),console.log(K,"###chartData"),f(K,B,v,ee,ke,m)}};let Ne=F(!1);const se=F(!1);$t(()=>{const n=document.body.clientWidth;se.value=!0,n<750?Ne.value=!1:Ne.value=!0,window.onresize=()=>{document.body.clientWidth<750?Ne.value=!1:Ne.value=!0,console.log("这里执行了吗"),_e(e.poolInfo,e.zoom)}});const f=(n,T,m,v,B,ee)=>{console.log("0117####drawChart####chartData####",n),console.log("0117####drawChart####tickMin####",T),console.log("0117####drawChart####tickMax####",m),console.log("0117####drawChart####minPriceTick####",v),console.log("0117####drawChart####maxPriceTick####",B),console.log("0117####drawChart####currentTick####",ee),console.log("0117####drawChart####props.direction####",e.direction),console.log("0518###newd3###props.before7dContractPriceLowest###",e.before7dContractPriceLowest),console.log("0518###newd3###props.before7dContractPriceHighest###",e.before7dContractPriceHighest);let ke,Ie;e.direction?(ke=e.before7dContractPriceLowest?i.priceToTickIndex(new a(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",Ie=e.before7dContractPriceHighest?i.priceToTickIndex(new a(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(ke=e.before7dContractPriceLowest?i.priceToTickIndex(new a(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",Ie=e.before7dContractPriceHighest?i.priceToTickIndex(new a(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const b={top:30,right:35,bottom:20,left:80};let N,H;Ne.value?(N=460-b.left-b.right,H=205-b.top-b.bottom):(N=340-b.left-b.right,H=205-b.top-b.bottom);const Ce=m-T,y=parseInt(String(Ce/4));let R=[T+y/4,T+y,T+2*y,m-y,m-y/4];const G=T,K=m,O=N/(K-G);e.currentPriceTab==="full range"&&(R=[T,T+2*y,m]),console.log("0117####drawChart####xArr####",R),console.log("0117####drawChart####utickMin####",G),console.log("0117####drawChart####utickMax####",K),console.log("0117####drawChart####unit####",O);const je=R.map(u=>e.direction?qt(u,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new a(1).div(qt(u,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),A=V(je);ct("#chart").selectAll("*").remove();const de=ct("#chart").attr("width",N+b.left+b.right).attr("height",H+b.top+b.bottom).append("g").attr("transform",`translate(${b.left},${b.right})`),Ke=lo(n,function(u){return Number(Math.abs(u.liquityAmount))})||0,Me=so().range([0,H]).domain([Ke,0]);uo().rangeRound([0,N]).padding(.1);const Ye=de.append("g").attr("id","barsBox").selectAll("rect").data(n).enter().append("rect");L.value.theme=="default"?Ye.attr("x",function(u,l){return l===0?0:e.direction?Math.abs(u.index-G)*O:Math.abs(K-u.index)*O}).attr("y",function(u,l){return e.direction?l===n.length-1?0:Me(u.liquityAmount):l===n.length-1?0:Me(n[l+1].liquityAmount)}).attr("width",function(u,l){return l===0&&n.length===1&&u.liquityAmount>0?N:(e.direction,l!==n.length-1?Math.abs(n[l+1].index-u.index)*O:0)}).attr("height",function(u,l){return l===0&&n.length===1&&u.liquityAmount>0?H:e.direction?l===n.length-1?0:H-Me(u.liquityAmount):l===n.length-1?0:H-Me(n[l+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):Ye.attr("x",function(u,l){return l===0?0:e.direction?Math.abs(u.index-G)*O:Math.abs(K-u.index)*O}).attr("y",function(u,l){return e.direction?l===n.length-1?0:Me(Math.abs(u.liquityAmount)):l===n.length-1?0:Me(Math.abs(n[l+1].liquityAmount))}).attr("width",function(u,l){return l===0&&n.length===1&&u.liquityAmount>0?N:(e.direction,l!==n.length-1?Math.abs(n[l+1].index-u.index)*O:0)}).attr("height",function(u,l){if(l===0&&n.length===1&&u.liquityAmount>0)return H;if(e.direction)return l===n.length-1?0:Number(u.liquityAmount)?H-Me(Math.abs(u.liquityAmount)):0;{if(l===n.length-1)return 0;const me=H-Me(Math.abs(n[l+1].liquityAmount));return Number(n[l+1].liquityAmount)?me:0}}).attr("fill",function(u,l){return"#417494"}).attr("class","bars").attr("stroke-width",1).attr("stroke",function(u,l){return"#417494"});const Je=de.append("g");Je.append("line").attr("x1",0).attr("y1",155).attr("x2",N).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const Ze=Je.append("g");let X=0;if(e.direction){for(let u=0;u<R.length;u++){const l=he(je[u],A)||"0";console.log("0423####price####",l),je.push(l);const me=Math.abs(R[u]-G)*O;let te=0;for(let we=0;we<l.length;we++)l[we]==="1"?te+=4.02:l[we]==="."?te+=2.64:l[we]==="7"?te+=5.48:te+=6;console.log(me,"x=>>>"),Ze.append("text").text(l).attr("x",me-te/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}X=Math.abs(ee-G)*O}else{for(let u=R.length-1;u>=0;u--){const l=he(je[u],A)||0;je.push(l);const me=Math.abs(R[u]-K)*O;let te=0;for(let we=0;we<l.length;we++)l[we]==="1"?te+=4.02:l[we]==="."?te+=2.64:l[we]==="7"?te+=5.48:te+=6;Ze.append("text").text(l).attr("x",me-te/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}X=Math.abs(ee-K)*O}console.log(ee,K,O,"######currentPricePositon"),(L.value.theme=="default"?de.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):de.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+X+", 0)");let t,r,g,C;e.direction?(t=v<G?-100:parseInt(String(Math.abs(v-G)*O)),r=B<G?-100:parseInt(String(Math.abs(B-G)*O)),g=ke<G?-100:Math.abs(ke-G)*O,C=Ie<G?-100:Math.abs(Ie-G)*O):(r=v<G?-100:Math.abs(K-v)*O,t=B<G?-100:Math.abs(K-B)*O,C=ke>K?-100:Math.abs(K-ke)*O,g=Ie>K?-100:Math.abs(K-Ie)*O),e.minPrice==="0"&&(t=0),e.maxPrice==="∞"&&(r=N),console.log(t,"==>minPriceTickX"),Ne.value,ge.value=N-t+87+"px",re.value=r+98+"px",ke&&g<N&&de.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+g+", 0)"),Ie&&C<N&&de.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+C+", 0)");const U=de.append("g").attr("id","left-handle"),x=de.append("g").attr("id","right-handle");L.value.theme=="default"?(U.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),U.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),U.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),U.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),x.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),x.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),x.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),x.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(U.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),U.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),U.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),U.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),x.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),x.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),x.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),x.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),console.log("0525###d3###select###minPriceTickX###",t),console.log("0525###d3###select###maxPriceTickX###",r),U.attr("transform","translate("+t+", 0)"),x.attr("transform","translate("+r+", 0)");const ue=co().extent([[0,0],[N,H]]).handleSize(30).on("end",xe);de.append("g").attr("class","brush").call(ue).call(ue.move,[t,r]);function xe(u){if(!u.sourceEvent||!u.selection)return;U.attr("transform","translate("+u.selection[0]+", 0)"),x.attr("transform","translate("+u.selection[1]+", 0)"),Ne.value,ge.value=N-u.selection[0]+87+"px",re.value=u.selection[1]+74+"px";let l,me;console.log("0525###d3###select###e.selection[0]###",u.selection[0]),console.log("0525###d3###select###e.selection[0]###",u.selection[1]),console.log("0525###d3###select###props.direction###",e.direction),console.log("0525###d3###select###width###",N),console.log("0525###d3###select###unit###",O),console.log("0525###d3###select###utickMin###",G),console.log("0525###d3###select###utickMax###",K),console.log("0525###d3###select###props.poolInfo###",e.poolInfo);let te=0,we=0;e.direction?(te=w(parseInt(String(u.selection[0]/O+G)),Number(e.poolInfo.tickSpacing)),l=i.tickIndexToPrice(te,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),we=w(parseInt(String(u.selection[1]/O+G)),Number(e.poolInfo.tickSpacing)),me=i.tickIndexToPrice(we,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),console.log("1114###d3###select###minTick###",te),console.log("1114###d3###select###maxTick###",we),console.log("1114###d3###select###minPrice###",l),console.log("1114###d3###select###maxPrice###",me)):(we=w(K-u.selection[0]/O,Number(e.poolInfo.tickSpacing)),l=1/i.tickIndexToPrice(we,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),te=w(K-u.selection[1]/O,Number(e.poolInfo.tickSpacing)),me=1/i.tickIndexToPrice(te,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),c.emit("onChangeMinPrice",String(he(String(l),6))),c.emit("onChangeMaxPrice",String(he(String(me),6)))}L.value.theme=="default"?ct(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):ct(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632"),console.log("画完了##")};return F(""),Se(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom,e.tickList],([n,T,m,v,B,ee])=>{console.log(n,T,m,m>T,B,"poolInfo && minPrice && maxPrice && (maxPrice > minPrice)"),n&&T&&m&&(n!=null&&n.liquidity)&&(v!=="Custom"||console.log("绘制"),_e(n,B))},{immediate:!0}),console.log(e,"props===>"),{store:L,loading:se,rangeSizeLower:le,rangeSizeUpper:j,rangeSizeLowerPosition:ge,rangeSizeUpperPosition:re,decimalFormat:eo,numberformat:gt}}});const Co=e=>(yt("data-v-60bd7ae2"),e=e(),_t(),e),Po={class:"chart-box"},To={class:"chart"},So=Co(()=>s("svg",{id:"chart"},null,-1));function Io(e,c,ge,re,M,le){const j=Bt;return q(),W("div",Po,[Ft(s("div",To,[e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(q(),W("div",{key:0,class:"range-size range-size-lower",style:bt({right:e.rangeSizeLowerPosition})},ne(("numberformat"in e?e.numberformat:fe(gt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):Q("",!0),e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(q(),W("div",{key:1,class:"range-size range-size-upper",style:bt({left:e.rangeSizeUpperPosition})},ne(("numberformat"in e?e.numberformat:fe(gt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):Q("",!0),So],512),[[oo,!e.chartLoading]]),e.chartLoading?(q(),We(j,{key:0})):Q("",!0)])}const Dt=it(_o,[["render",Io],["__scopeId","data-v-60bd7ae2"]]),Ao=ot({props:{lever:{type:String,default:""}},setup(){return{}}});const Lo=e=>(yt("data-v-619778e2"),e=e(),_t(),e),No={class:"lever"},qo=Lo(()=>s("div",{class:"lever-title"},"Leverage",-1)),Mo={class:"lever-text"};function $o(e,c,ge,re,M,le){return q(),W("div",No,[qo,s("div",Mo,ne(e.lever),1)])}const Fo=it(Ao,[["render",$o],["__scopeId","data-v-619778e2"]]),Bo=ot({components:{NewLiquidityD3Chart:Dt,NewLiquidityPrice:jt},setup(){const{t:e,locale:c}=Rt(),ge=F("liquidity"),re=Tt(),M=$(()=>re),le=$(()=>M.value.chainName),j=Mt(),z=$(()=>j),L=$(()=>M.value.chainName?wt(M.value.chainName):{});$t(()=>{et.value=!1});const oe=Ct(),i=$(()=>{let t=null;for(let r=0;r<z.value.poolConfigList.length;r++){const g=z.value.poolConfigList[r];g.address==oe.query.poolAddress&&(t=g)}return console.log(t,"===>basePoolInfo"),t}),w=$(()=>{let t=null;for(const r in z.value.poolsObj){const g=z.value.poolsObj[r];g.address==oe.query.poolAddress&&(console.log(g,"p===>"),t=g)}return t}),V=F(),_e=F(!0),Ne=async(t,r)=>{if(console.log(_e.value,"==>chartLoading.value"),_e.value=!0,r){Ve.value=[],f.value=[],Ue.value=!1;const g=t.token_a.decimals,C=t.token_b.decimals;console.log(t,"pool===>1111"),console.log("poolPrice###pool.current_tick_index####",t.current_tick_index);const U=lt.tickIndexToPrice(t.current_tick_index,g,C);console.log("poolPrice###",U.toString()),tt.value=lt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,g,C).toString(),console.log(tt.value,"##currentPrice.value"),st.value=new a(1).div(lt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,g,C)).toString(),console.log(st.value,"##currentPriceReverse.value"),_.value=t.needReverse?t.token_b:t.token_a,h.value=t.needReverse?t.token_a:t.token_b,V.value=t.needReverse,t.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===h.value.address.toLowerCase()?ae.value=!0:ae.value=!1,console.log(t,"187===>"),console.log(t,"###pool===>");let x={poolAddress:t.address,coinTypeA:t.coin_a_address,coinTypeB:t.coin_b_address};const ue=await L.value.getTicks(x);Ve.value=ue?L.value.getTickDataFromUrlData(ue):[],console.log(Ve.value,"===>chartLoadingtickList.value"),_e.value=!1,T(t)}},se=t=>{const r=t.token_a.decimals,g=t.token_b.decimals;console.log(t,"pool===>1111"),console.log("poolPrice###pool.current_tick_index####",t.current_tick_index),tt.value=lt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,r,g).toString(),st.value=new a(1).div(lt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,r,g)).toString()},f=F([]),n=F(),T=t=>{const r=t.token_a.decimals,g=t.token_b.decimals;let C=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[t.address]&&z.value.poolPriceConfigObj[t.address].recommend_ranges||{};const U=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[t.address]&&z.value.poolPriceConfigObj[t.address].type||"";console.log(C,"===>priceConfigList");let x,ue;const xe=to(t.current_tick_index,t.tickSpacing);n.value=t.current_tick_index,console.log(xe,t.tickSpacing,"==>pool.tickSpacing"),x=xe-Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3),ue=xe+Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3);const u=L.value.TickMath.tickIndexToPrice(x,r,g).toString(),l=L.value.TickMath.tickIndexToPrice(ue,r,g).toString();C["full range"]={lower:L.value.TickUtil.getMinIndex(Number(w.value.tickSpacing)),upper:L.value.TickUtil.getMaxIndex(Number(w.value.tickSpacing))},C.custom={lower:x,upper:ue,minPrice:u,maxPrice:l};const me=[];for(let te in C)C[te]&&(console.log(te,"j==>"),me.push({...C[te],key:te}));console.log(me,"priceList"),console.log(t,"###pool.type 504"),U&&me&&me.length>2?t.isSelfBuilt?D.value="custom":U=="stable"?D.value="suggested":D.value="passive":D.value="custom",f.value=me||{},Qe.value=C,B({key:D.value,...C[D.value]})},m=F(""),v=F(""),B=t=>{console.log("priceTab====>",t),console.log("priceTab###poolInfo###",w.value),D.value=t.key.toLowerCase();const r=w.value.token_a.decimals,g=w.value.token_b.decimals,{lower:C,upper:U}=t;Ee.value=!1;const x=L.value.TickMath.tickIndexToPrice(C,r,g).toString(),ue=L.value.TickMath.tickIndexToPrice(U,r,g).toString();if(t.key=="full range"){m.value=C,v.value=U,ee();return}console.log(ae.value,"===>direct.value"),ae.value?(vt.value=String(x),I.value=String(x),ft.value=String(ue),k.value=String(ue),m.value=C,v.value=U):(vt.value=String(1/Number(ue)),I.value=String(1/Number(ue)),ft.value=String(1/Number(x)),k.value=String(1/Number(x)),m.value=L.value.TickMath.priceToTickIndex(new a(1/Number(ue)),r,g),v.value=L.value.TickMath.priceToTickIndex(new a(1/Number(x)),r,g)),console.log(I.value,k.value,"===>111")},ee=t=>{I.value="0",k.value="∞"};Se(()=>w.value,(t,r)=>{console.log(r,"===>oldVal"),console.log(t,"===>newVal"),(!r&&t&&!ce(t)||r&&t&&r.address!==t.address)&&(console.log("池子信息"),Ne(t,!r||t.address!==r.address)),t&&!ce(t)&&se(t)},{immediate:!0}),Ot(()=>{_.value=F(),h.value=F(),Ve.value=[]}),Se(()=>[i.value,w.value,z.value.recommendRangesObj],(t,r)=>{var g,C;console.log(t,"===>newValue369"),console.log(r,"===>oldValue369"),(!r||t[0]&&t[1]&&t[2]&&!ce(t[0])&&!ce(t[1]&&!ce(t[2]))||((g=t[0])==null?void 0:g.address)!==((C=r[0])==null?void 0:C.address))&&t[0]&&t[2]&&!ce(t[0])&&!ce(t[2])&&(console.log(t[0],t[2],"======>374"),j.setSinglePool(t[0],t[2],le.value))},{immediate:!0,deep:!0});const ke=t=>{if(le.value=="Sui")switch(t){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(t){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},Ie=t=>{switch(t){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},b=t=>{var g,C;const r=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[(g=w.value)==null?void 0:g.address]&&z.value.poolPriceConfigObj[(C=w.value)==null?void 0:C.address].type||"";if(console.log(r,t,"==>poolType"),f.value.length>2)if(r=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}else if(r=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"full range":return{top:"35%"};case"custom":return{top:"60%"}}},N=F(1),H=()=>{const t=N.value/2;N.value=t},Ce=()=>{const t=N.value*2;N.value=t};console.log(f.value,"==>priceTablList");const y=$(()=>{var t,r,g;return!w.value||ce(M.value.addressHistTokens)||!M.value.addressHistTokens[(t=w.value)==null?void 0:t.poolAddress]?null:Object.fromEntries((g=M.value.addressHistTokens[(r=w.value)==null?void 0:r.poolAddress])==null?void 0:g.data.map(C=>[C.key,C.value]))}),R=F(30),G=F("30D"),K=$(()=>ae.value?y.value&&he(R.value==7?y.value.before_7_d_contract_price_lowest:R.value==24?y.value.before_24_h_contract_price_lowest:y.value.before_30_d_contract_price_lowest,6)||0:y.value&&he(new a(1).div(R.value==7?y.value.before_7_d_contract_price_highest:R.value==24?y.value.before_24_h_contract_price_highest:y.value.before_30_d_contract_price_highest).toString(),6)||0),O=$(()=>ae.value?y.value&&he(R.value==7?y.value.before_7_d_contract_price_highest:R.value==24?y.value.before_24_h_contract_price_highest:y.value.before_30_d_contract_price_highest,6)||0:(y.value&&he(1/Number(R.value==7?y.value.before_7_d_contract_price_lowest:R.value==24?y.value.before_24_h_contract_price_lowest:y.value.before_30_d_contract_price_lowest),6))==1/0?0:y.value&&he(1/Number(R.value==7?y.value.before_7_d_contract_price_lowest:R.value==24?y.value.before_24_h_contract_price_lowest:y.value.before_30_d_contract_price_lowest),6)||0),je=$(()=>{const t=Number(I.value),r=Number(k.value);if(I.value=="0"&&k.value=="∞"||D.value=="full range")return"1x";if(I.value==k.value||D.value=="full range")return"--";if(I.value&&k.value&&I.value!=="0"&&k.value!=="∞"){const g=pt(1/(1-Number((t/r)**.25)),2);return Number(g)>0?g+"x":"--"}else return 1}),A=$(()=>{var t,r,g,C,U,x;return((t=_.value)==null?void 0:t.isSelfBuilt)||((r=h.value)==null?void 0:r.isSelfBuilt)||((C=z.value.tokensObj[(g=_.value)==null?void 0:g.address])==null?void 0:C.isSelfBuilt)||((x=z.value.tokensObj[(U=h.value)==null?void 0:U.address])==null?void 0:x.isSelfBuilt)}),de=(t,r)=>{console.log(t,"####0731 priceRangeChangeMin"),t!==I.value&&D.value=="full range"?(console.log(f.value,"===>priceTablList"),B({key:"custom",...f.value.custom})):D.value!=="full range"&&D.value!=="custom"?(D.value="custom",I.value=t):I.value=t,Ue.value?(ae.value&&I.value!==X.value.minPrice&&(Ue.value=!1),!ae.value&&Number(I.value)!==1/Number(X.value.maxPrice)&&(Ue.value=!1)):(ae.value&&I.value==X.value.minPrice&&k.value==X.value.maxPrice&&(Ue.value=!0),!ae.value&&Number(I.value)==1/Number(X.value.maxPrice)&&Number(k.value)==1/Number(X.value.minPrice)&&(Ue.value=!0))},Ke=(t,r)=>{console.log(t,"###priceRangeChangeMax maxPirce"),t!==k.value&&D.value=="full range"?B({key:"custom",...f.value.custom}):D.value!=="full range"&&D.value!=="custom"?(D.value="custom",t=="0"?k.value="∞":k.value=t):t=="0"?k.value="∞":k.value=t,Ue.value?(ae.value&&k.value!==X.value.maxPrice&&(Ue.value=!1),!ae.value&&Number(k.value)!==1/Number(X.value.minPrice)&&(Ue.value=!1)):(ae.value&&I.value==X.value.minPrice&&k.value==X.value.maxPrice&&(Ue.value=!0),!ae.value&&Number(I.value)==1/Number(X.value.maxPrice)&&Number(k.value)==1/Number(X.value.minPrice)&&(Ue.value=!0))};console.log(I.value,k.value,"683==>"),Se(()=>[I.value,k.value],([t,r])=>{console.log(t,r,"minmax new-liquidity-left")},{deep:!0,immediate:!0});const Me=t=>{var r;return(t==null?void 0:t.logoURI)||(t==null?void 0:t.logo_url)||((r=z.value.tokensObj[t==null?void 0:t.address])==null?void 0:r.logo_url)||(M.value.theme==="default"?kt("/image/coins/unknown.png"):kt("/image/coins/sui-unknown.png"))},nt=t=>{switch(t){case"active":return e("newAdd.activeTips");case"passive":return e("newAdd.passiveTips");case"full range":return e("newAdd.fullRangTips");case"suggested":return e("newAdd.suggestedTips");case"custom":return e("newAdd.customTips")}},Ye=[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}],Je=Et(),Ze=$(()=>Je),X=$(()=>{var t;return Ze.value.farmsPoolObj[(t=w==null?void 0:w.value)==null?void 0:t.address]}),at=$(()=>z.value.poolPriceConfigObj);return Se(()=>[Ue.value,w.value,f.value,at.value,X.value,ae.value],([t,r,g,C,U,x])=>{var ue,xe;if(console.log(U,x,"##farmsPoolInfo"),t&&U&&!ce(U))D.value="custom",I.value=x?U.minPrice:String(1/U.maxPrice),k.value=x?U.maxPrice:String(1/U.minPrice),console.log(I.value,k.value,"###1195");else if(r&&!ce(r)&&g&&!ce(g)&&C&&!ce(C)&&U&&!ce(U)){const u=C&&C[(ue=r.value)==null?void 0:ue.address]&&C[(xe=r.value)==null?void 0:xe.address].type||"",l=g.filter(me=>me.key===(g.length==4?"passive":"suggested"));console.log(u,"##poolType"),l!=null&&l[0]&&B({...l[0]})}},{immediate:!0}),{positionError:et,getCoinIcon:Me,chainName:le,store:M,currentTab:ge,currentPrice:tt,currentPriceReverse:st,fromCoin:_,toCoin:h,direction:ae,needReverse:V,addCommom:Fe,decimalUi:he,priceTablList:f,currentPriceTab:D,sliderStyle:b,poolInfo:w,tickList:Ve,getPriceTabImage:ke,getPriceTabText:Ie,defaultMinPrice:vt,defaultMaxPrice:ft,minPrice:I,maxPrice:k,currentTick:n,chartLoading:_e,zoomOut:H,zoomIn:Ce,zoom:N,priceTab:B,before7dContractPriceLowest:K,before7dContractPriceHighest:O,aprRewardsTime:G,lever:je,aprRewardsParameter:R,isSelfBuilt:A,priceRangeChangeMin:de,priceRangeChangeMax:Ke,toggle:Xt,getPirceTabTips:nt,timeList:Ye,farmsPoolInfo:X,checkNullObj:ce,isStableFarmingRange:Ue}}}),Wt=""+globalThis.__publicAssetsURL("sui-image/icon_sel@2x.png");const Ro={class:"new-liquidity-left"},Oo=s("span",{class:"selectRange"},"Select Range",-1),Uo={class:"price-info"},jo={class:"left"},zo={class:"base-coin"},Ho={class:"base-coin-title"},xo=s("span",null,"Base coin",-1),Xo=s("svg",{class:"icon icon-up","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-exchange_up1"})],-1),Eo=s("svg",{class:"icon icon-down","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-exchange_down1"})],-1),Do=[Xo,Eo],Wo={class:"base-coin-bottom"},Zo={alt:""},Go={class:"current-price"},Ko=s("div",{class:"current-price-title"},"Current Price",-1),Jo={key:0,class:"from-pre-to"},Qo={class:"right"},Yo={class:"price-range"},Vo={class:"left"},ei={class:"price-slider"},ti={class:"slider"},oi=s("div",{class:"slider-ratio-content"},null,-1),ii=[oi],ni={class:"price-tab-list"},ai=["onClick"],ri=["src"],li={class:"right"},si={class:"price-zoom"},ui={class:"current-price"},ci=s("div",{class:"current-price-title"},"Current Price",-1),di={key:0,class:"from-pre-to"},mi={class:"price-zoom-right"},vi={class:"leverage"},fi=s("div",{class:"left"},null,-1),gi={class:"right"},pi={class:"right-time"},bi={key:0,class:"day-7-price-range"},hi=s("i",null,null,-1),ki={class:"gray"},wi={class:"time-list"},yi=["onClick"],_i={class:"right-price-h5"},Ci={key:0,class:"stable-farming-range"},Pi={key:0,src:Wt,alt:""},Ti={class:"apr-leverage"},Si={key:0,class:"position-tips"},Ii=["src"],Ai={class:"error"};function Li(e,c,ge,re,M,le){var w,V,_e,Ne,se,f,n,T,m;const j=Ut,z=Dt,L=Fo,oe=jt,i=io("image");return q(),W("div",Ro,[Oo,s("div",Uo,[s("div",jo,[s("div",zo,[s("div",Ho,[xo,s("div",{class:"change-price",onClick:c[0]||(c[0]=(...v)=>e.toggle&&e.toggle(...v))},Do)]),s("div",Wo,[Ft(s("img",Zo,null,512),[[i,e.getCoinIcon(e.fromCoin)]]),s("span",null,ne((w=e.fromCoin)==null?void 0:w.symbol),1)])]),s("div",Go,[Ko,s("div",null,[s("span",null,ne(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.currentPrice,6)):("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(q(),W("span",Jo,ne((V=e.toCoin)==null?void 0:V.symbol)+" per "+ne((_e=e.fromCoin)==null?void 0:_e.symbol),1)):Q("",!0)])])]),s("div",Qo,[e.currentTab=="liquidity"?(q(),W("div",{key:0,class:"zoom-out",onClick:c[1]||(c[1]=(...v)=>e.zoomOut&&e.zoomOut(...v))}," + ")):Q("",!0),e.currentTab=="liquidity"?(q(),W("div",{key:1,class:"zoom-in",onClick:c[2]||(c[2]=(...v)=>e.zoomIn&&e.zoomIn(...v))}," - ")):Q("",!0)])]),s("div",Yo,[s("div",Vo,[s("div",ei,[s("div",ti,[s("div",{class:"slider-ratio",style:bt(e.sliderStyle(e.currentPriceTab))},ii,4)])]),s("div",ni,[(q(!0),W(ht,null,Lt(e.priceTablList,v=>(q(),W("div",{key:v.key,class:mt(["price-tab-item",e.currentPriceTab==v.key?"price-tab-item-active":""]),onClick:B=>e.priceTab(v)},[He(j,{placement:"bottom","arrow-point-at-center":""},{title:ut(()=>[Pt(ne(e.getPirceTabTips(v.key)),1)]),default:ut(()=>[s("img",{src:e.getPriceTabImage(v.key),alt:""},null,8,ri),s("span",null,ne(e.getPriceTabText(v.key)),1)]),_:2},1024)],10,ai))),128))])]),s("div",li,[s("div",si,[s("div",ui,[ci,s("div",null,[s("span",null,ne(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.currentPrice,6)):("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(q(),W("span",di,ne(e.direction&&!e.needReverse?`${(Ne=e.fromCoin)==null?void 0:Ne.symbol} per ${(se=e.toCoin)==null?void 0:se.symbol}`:`${(f=e.toCoin)==null?void 0:f.symbol} per ${(n=e.fromCoin)==null?void 0:n.symbol}`),1)):Q("",!0)])]),s("div",mi,[e.currentTab=="liquidity"?(q(),W("div",{key:0,class:"zoom-out",onClick:c[3]||(c[3]=(...v)=>e.zoomOut&&e.zoomOut(...v))}," + ")):Q("",!0),e.currentTab=="liquidity"?(q(),W("div",{key:1,class:"zoom-in",onClick:c[4]||(c[4]=(...v)=>e.zoomIn&&e.zoomIn(...v))}," - ")):Q("",!0)])]),e.poolInfo?(q(),We(z,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):Q("",!0)])]),s("div",vi,[fi,s("div",gi,[s("div",pi,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(q(),W("div",bi,[hi,s("span",ki,ne(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),s("span",null,ne(("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.before7dContractPriceLowest,6)))+" - "+ne(("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.before7dContractPriceHighest,6))),1)])):Q("",!0),s("div",wi,[(q(!0),W(ht,null,Lt(e.timeList,v=>(q(),W("div",{key:v.value,class:mt(["time-item",v.value==e.aprRewardsParameter?"time-item-active":""]),onClick:B=>e.aprRewardsParameter=v.value},ne(v.label),11,yi))),128))])]),s("div",_i,[s("span",null,ne(("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.before7dContractPriceLowest,6)))+" - "+ne(("addCommom"in e?e.addCommom:fe(Fe))(("decimalUi"in e?e.decimalUi:fe(he))(e.before7dContractPriceHighest,6))),1)])])]),e.farmsPoolInfo&&!("checkNullObj"in e?e.checkNullObj:fe(ce))(e.farmsPoolInfo)&&e.fromCoin&&e.toCoin?(q(),W("div",Ci,[s("span",null," Farm rewards range："+ne(("decimalUi"in e?e.decimalUi:fe(he))(e.direction?e.farmsPoolInfo.minPrice:1/e.farmsPoolInfo.maxPrice,6))+" - "+ne(("decimalUi"in e?e.decimalUi:fe(he))(e.direction?e.farmsPoolInfo.maxPrice:1/e.farmsPoolInfo.minPrice,6))+" "+ne((T=e.toCoin)==null?void 0:T.symbol)+" per "+ne((m=e.fromCoin)==null?void 0:m.symbol),1),s("div",{class:"check-box-active",onClick:c[5]||(c[5]=v=>e.isStableFarmingRange=!e.isStableFarmingRange)},[e.isStableFarmingRange?(q(),W("img",Pi)):Q("",!0)])])):Q("",!0),s("div",{class:mt(["apr-and-price",e.positionError&&e.poolInfo?"padding-apr-and-price":""])},[s("div",Ti,[He(L,{lever:e.lever},null,8,["lever"])]),He(oe,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?(q(),W("div",Si,[s("img",{src:("importIcon"in e?e.importIcon:fe(kt))("/image/icon-tips-error@2x.png"),alt:""},null,8,Ii),s("p",Ai,ne(e.$t("tips.positionError")),1)])):Q("",!0)],2)])}const Zt=it(Bo,[["render",Li]]),Ni=ot({props:{poolInfo:{type:Object,default:()=>({})},isActive:{type:Boolean,default:!0}},setup(e,c){const ge=Et(),re=F(!1),M=F(),le=F(!0),j=$(()=>ge),z=$(()=>j.value.farmsPoolList.filter(i=>i.status=="Live"));Se(()=>e.poolInfo,i=>{i&&!ce(i)&&ge.getFarmsPoolList()},{immediate:!0});const L=i=>{const w=i.filter(V=>{var _e;return V.status=="Live"&&V.clmm_pool_id==((_e=e.poolInfo)==null?void 0:_e.poolAddress)});w&&w.length>0&&(re.value=!0,M.value=w[0],c.emit("sendFarmsPoolInfo",le.value&&e.isActive?M.value:"")),console.log(w,"##isFarmingPool")};return Se(()=>z.value,i=>{i&&i.length>0&&L(i)},{immediate:!0}),Se(()=>e.isActive,i=>{console.log(e.isActive,"##props.isActive"),i||c.emit("sendFarmsPoolInfo",le.value&&e.isActive?M.value:"")},{immediate:!0}),{isShowAutoStake:re,changeIsOpen:()=>{le.value=!le.value,c.emit("sendFarmsPoolInfo",le.value&&e.isActive?M.value:"")},isOpen:le}}}),qi=""+globalThis.__publicAssetsURL("sui-image/farming_huo.png");const St=e=>(yt("data-v-26841f53"),e=e(),_t(),e),Mi={key:0,class:"farms-auto-stake"},$i=St(()=>s("img",{class:"farms-icon",src:qi,alt:""},null,-1)),Fi=St(()=>s("div",{class:"desc"},"Automatically stake your position into the farm to enjoy higher yield.",-1)),Bi={key:0,src:Wt,alt:""},Ri=St(()=>s("div",{class:"check-box"},null,-1));function Oi(e,c,ge,re,M,le){const j=Ut;return e.isShowAutoStake?(q(),W("div",Mi,[$i,Fi,e.isActive?(q(),W("div",{key:0,class:"check-box-active",onClick:c[0]||(c[0]=(...z)=>e.changeIsOpen&&e.changeIsOpen(...z))},[e.isOpen?(q(),W("img",Bi)):Q("",!0)])):(q(),We(j,{key:1,"overlay-style":{"min-width":"200px"}},no({default:ut(()=>[Ri]),_:2},[e.isActive?void 0:{name:"title",fn:ut(()=>[Pt("Farming rewards only available for active positions.")]),key:"0"}]),1024))])):Q("",!0)}const Ui=it(Ni,[["render",Oi],["__scopeId","data-v-26841f53"]]),ji=ot({components:{NewLiquidityTitle:zt,NewLiquidityAssetsCard:Ht,NewLiquidityDepositRatio:xt},setup(){const{t:e,locale:c}=Rt(),ge=Tt(),re=$(()=>ge),M=$(()=>re.value.chainName),le=Mt(),j=$(()=>le),z=mo(),L=$(()=>z),oe=Ct(),i=$(()=>{let o=null;for(const d in j.value.poolsObj){const p=j.value.poolsObj[d];p.address==oe.query.poolAddress&&(console.log(p,"p===>"),o=p)}return o}),w=F(!1),V=F(!1),_e=$(()=>re.value.theme),Ne=async(o,d)=>{_.value=o.needReverse?o.token_b:o.token_a,h.value=o.needReverse?o.token_a:o.token_b,P.value="",S.value=""},se=$(()=>L.value.assets&&_.value&&L.value.assets[_.value.address]?At(L.value.assets[_.value.address].balance,_.value.decimals):"0"),f=$(()=>L.value.assets&&h.value&&L.value.assets[h.value.address]?At(L.value.assets[h.value.address].balance,h.value.decimals):"0"),n=o=>{o==="fromCoin"?(Le.value=!0,M.value==="Aptos"?P.value=Number(se.value)>0?_.value.symbol=="APT"?new a(Number(se.value)).sub(new a(.1)).lt(new a(0))?"0":new a(Number(se.value)).sub(new a(.1)).toString():String(se.value):"":P.value=Number(se.value)>0?_.value.symbol=="SUI"?new a(Number(se.value)).sub(new a(.05)).lt(new a(0))?"0":new a(Number(se.value)).sub(new a(.05)).toString():String(se.value):""):(Le.value=!1,M.value==="Aptos"?S.value=Number(f.value)>0?h.value.symbol=="APT"?new a(Number(f.value)).sub(new a(.1)).lt(new a(0))?"0":new a(Number(f.value)).sub(new a(.1)).toString():String(f.value):"":S.value=Number(f.value)>0?h.value.symbol=="SUI"?new a(Number(f.value)).sub(new a(.05)).lt(new a(0))?"0":new a(Number(f.value)).sub(new a(.05)).toString():String(f.value):"")},T=o=>{o==="fromCoin"?(Le.value=!0,P.value=Number(se.value)>0?pt(new a(Number(se.value)).div(2).toString(),_.value.decimals).toString():""):(Le.value=!1,S.value=Number(f.value)>0?pt(new a(Number(f.value)).div(2).toString(),h.value.decimals).toString():"")},m=F(),v=F(),B=F(),ee=F(!1),ke=o=>{var d,p,pe,E;m.value=o,o==="fromCoin"?(v.value=((d=h.value)==null?void 0:d.address)||"",B.value=oe.query.actions=="new-position"?(p=_.value)==null?void 0:p.address:i.value.needReverse?i.value.token_b.address:i.value.token_a.address):(v.value=((pe=_.value)==null?void 0:pe.address)||"",B.value=oe.query.actions=="new-position"?(E=h.value)==null?void 0:E.address:i.value.needReverse?i.value.token_a.address:i.value.token_b.address),ee.value=!0,console.log(ee.value,"==>showCoinSelect.value ")},Ie=o=>{var pe,E,ve,be,ie,Y,J,Pe;const d=i.value.needReverse?i.value.token_b:i.value.token_a,p=i.value.needReverse?i.value.token_a:i.value.token_b;m.value==="fromCoin"?(((pe=_.value)==null?void 0:pe.address)===(d==null?void 0:d.address)||!((E=_.value)!=null&&E.address)?(h.value&&o.address.toLowerCase()===((ve=h)==null?void 0:ve.value.address.toLowerCase())&&(h.value=null),_.value=o):(_.value&&o.address.toLowerCase()===((be=_)==null?void 0:be.value.address.toLowerCase())&&(_.value=null),h.value=o),oe.query.action||(oe.query.fee="")):((ie=h.value)==null?void 0:ie.address)===(p==null?void 0:p.address)||!((Y=h.value)!=null&&Y.address)?(_.value&&o.address.toLowerCase()===((J=_)==null?void 0:J.value.address.toLowerCase())&&(_.value=null),h.value=o):(h.value&&o.address.toLowerCase()===((Pe=h)==null?void 0:Pe.value.address.toLowerCase())&&(h.value=null),_.value=o),ee.value=!1},b=$(()=>re.value.chainName?wt(re.value.chainName):{}),N=$(()=>re.value.slippage),H=F(),Ce=async()=>{var Oe,qe,Be,Re;if(Ee.value)return console.log("跳出"),!1;if(!I.value&&!k.value)return!1;if(!P.value&&!S.value&&!I.value&&!k.value)return;const o=i.value||{};if(ce(o))return;const{TickUtil:d,TickMath:p,getNearestTickByTick:pe}=b.value,E=o==null?void 0:o.token_a.decimals,ve=o==null?void 0:o.token_b.decimals;let be,ie,Y,J,Pe,$e,Xe,De,ye=o==null?void 0:o.current_tick_index,Z;if(o.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===h.value.address.toLowerCase()?Z=!0:Z=!1,I.value==="0"&&k.value==="∞")Y=d.getMinIndex(Number(o.tickSpacing)),J=d.getMaxIndex(Number(o.tickSpacing)),Pe=p.tickIndexToSqrtPriceX64(Y),$e=p.tickIndexToSqrtPriceX64(J),console.log(Y,J,"#######updateAmounts 513");else if(D.value=="custom"){console.log(Z,"===>directs1866"),Z?(be=I.value,ie=k.value):(be=k.value!=="∞"?new a(1).div(k.value).toString():1/0,ie=new a(1).div(I.value).toString());try{Xe=new a(be).equals(new a(0))?-443636:p.priceToTickIndex(new a(be),E,ve)}catch{Xe=-443636}try{De=p.priceToTickIndex(new a(ie),E,ve)}catch{De=443636}console.log("1113###updateAmounts###min###",be),console.log("1113###updateAmounts###max###",ie),console.log("1113###updateAmounts###minTick###",Xe),console.log("1113###updateAmounts###maxTick###",De),Y=pe(Xe,Number(o.tickSpacing),!0),J=pe(De,Number(o.tickSpacing),!0),console.log("1113###updateAmounts###tick_lower###",Y),console.log("1113###updateAmounts###tick_upper###",J);try{Pe=p.priceToSqrtPriceX64(new a(be),E,ve)}catch{(ie===1/0||ie==="∞")&&(Pe=p.tickIndexToSqrtPriceX64(d.getMinIndex(Number(o.tickSpacing))))}try{$e=p.priceToSqrtPriceX64(new a(ie),E,ve)}catch{console.log("0523###test###max###",ie),(ie===1/0||ie==="∞")&&(console.log("0523###test###max###11111"),$e=p.tickIndexToSqrtPriceX64(d.getMaxIndex(Number(o.tickSpacing))))}console.log("0518###pre###tick_lower###",Y,J,ye),console.log("0518###pre###tick_upper###",J)}else Y=(Oe=Qe.value[D.value])==null?void 0:Oe.lower,J=(qe=Qe.value[D.value])==null?void 0:qe.upper,Pe=p.tickIndexToSqrtPriceX64(Y),$e=p.tickIndexToSqrtPriceX64(J);if(console.log("1116###updateAmounts###tick_lower####",Y),console.log("1116###updateAmounts###tick_upper####",J),console.log("1116###updateAmounts###currentTickIndex####",ye),k.value!=="∞"&&Y>=J){w.value=!0,P.value="",V.value=!0,S.value="";return}if(console.log(J,ye,Y,"1922"),k.value==="∞"||ye>=Y&&ye<J){w.value=!1,V.value=!1;let Te;if(P.value||S.value){if(Le.value){const dt=new a(P.value).mul(Math.pow(10,_.value.decimals)).toString();Te=new ze(dt)}else{const dt=new a(S.value).mul(Math.pow(10,h.value.decimals)).toString();Te=new ze(dt)}console.log(Z,"======>directs"),p.tickIndexToSqrtPriceX64(i.value.current_tick_index);const{liquidityAmount:Ae,tokenMaxA:Ge,tokenMaxB:rt,tokenMaxAOrigin:Yt,tokenMaxBOrigin:Vt}=b.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:o.token_a,tokenB:o.token_b,lowerTick:Y,upperTick:J,coinAmount:Te,iscoinA:Z?Le.value:!Le.value,roundUp:!0,slippage:Number(N.value)/100,curSqrtPrice:new ze(i.value.current_sqrt_price)});H.value={liquidityAmount:Ae,tokenMaxA:Ge,tokenMaxB:rt,tokenMaxAOrigin:Yt,tokenMaxBOrigin:Vt},console.log(Ge,rt,"preAdd"),Z?Le.value?S.value=Number(rt)>0?rt:"":P.value=Number(Ge)>0?Ge:"":Le.value?S.value=Ge:P.value=rt}}else if(ye>=J){if(Z?P.value="":S.value="",w.value=Z,V.value=!Z,P.value||S.value){let Te;if(Z){const Ae=new a(S.value).mul(Math.pow(10,(Be=h.value)==null?void 0:Be.decimals)).toString();Te=new ze(Ae),H.value={liquidityAmount:b.value.estimateLiquidityForCoinB(Pe,$e,Te),tokenMaxA:0,tokenMaxB:S.value}}else{const Ae=new a(P.value).mul(Math.pow(10,(Re=_.value)==null?void 0:Re.decimals)).toString();Te=new ze(Ae),H.value={liquidityAmount:b.value.estimateLiquidityForCoinB(Pe,$e,Te),tokenMaxA:0,tokenMaxB:P.value}}}}else if(ye<Y){if(w.value=!Z,V.value=Z,Z?S.value="":P.value="",P.value||S.value){let Te;if(Z){const Ae=new a(P.value).mul(Math.pow(10,_.value.decimals)).toString();Te=new ze(Ae),H.value={liquidityAmount:b.value.estimateLiquidityForCoinA(Pe,$e,Te),tokenMaxA:P.value,tokenMaxB:0}}else{const Ae=new a(S.value).mul(Math.pow(10,h.value.decimals)).toString();Te=new ze(Ae),H.value={liquidityAmount:b.value.estimateLiquidityForCoinA(Pe,$e,Te),tokenMaxA:S.value,tokenMaxB:0}}}}else w.value=!0,P.value="",V.value=!0,S.value=""};Se(()=>i.value,(o,d)=>{console.log(d,"===>oldVal"),console.log(o,"===>newVal"),(!d&&o&&!ce(o)||d&&o&&d.address!==o.address)&&(console.log("池子信息"),Ne(o,!d||o.address!==d.address)),o&&!ce(o)&&Ce()},{immediate:!0}),Se(P,(o,d)=>{console.log(P,"===>fromCoinAmount"),o==""&&Le.value&&(S.value=""),o&&Le.value&&!Ee.value&&Ce()}),Se(S,(o,d)=>{console.log(o,"===>>>>newValsda"),o==""&&!Le.value&&(P.value=""),o&&!Le.value&&!Ee.value&&Ce()}),Se(()=>ae.value,(o,d)=>{Ce()}),Se(()=>[_.value,h.value],([o,d])=>{o&&d&&(w.value=!1,V.value=!1)});const y=F("--"),R=$(()=>j.value.RATES),G=()=>{const o=R.value&&R.value[_.value.address]&&R.value[_.value.address].price,d=R.value&&R.value[h.value.address]&&R.value[h.value.address].price;if(o&&d){const p=new a(P.value>0?P.value:0).mul(o),pe=new a(S.value>0?S.value:0).mul(d),E=p.add(pe).toNumber();y.value=E>0&&E<.01?"<$0.01":"$"+Fe(E,2)}else y.value="--"};Se(()=>[P.value,S.value,Ee.value],([o,d,p])=>{(o||d)&&!p?G():(!o||!d)&&!p&&(y.value="--")},{immediate:!0}),Se(()=>y,o=>{console.log(o,"71911111")},{immediate:!0});const K=F(),O=async()=>{var Z,Oe;if(!I.value&&!k.value)return!1;if(!P.value&&!S.value&&!I.value&&!k.value)return;const o=i.value;if(ce(o))return;const{TickUtil:d,TickMath:p,getNearestTickByTick:pe}=b.value,E=o==null?void 0:o.token_a.decimals,ve=o==null?void 0:o.token_b.decimals;let be,ie,Y,J,Pe,$e,Xe;if(o.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===h.value.address.toLowerCase()?Xe=!0:Xe=!1,I.value==="0"&&k.value==="∞")Y=d.getMinIndex(Number(o.tickSpacing)),J=d.getMaxIndex(Number(o.tickSpacing));else if(D.value=="custom"){Xe?(be=Number(I.value),ie=Number(k.value)):(be=new a(1).div(k.value).toString(),ie=new a(1).div(I.value).toString());try{Pe=be==0?-443636:p.priceToTickIndex(new a(be),E,ve)}catch{Pe=-443636}try{$e=p.priceToTickIndex(new a(ie),E,ve)}catch{$e=443636}Y=pe(Pe,Number(o.tickSpacing),!0),J=pe($e,Number(o.tickSpacing),!0)}else Y=(Z=Qe.value[D.value])==null?void 0:Z.lower,J=(Oe=Qe.value[D.value])==null?void 0:Oe.upper;const De=R.value[o==null?void 0:o.token_a.address].price,ye=R.value[o==null?void 0:o.token_b.address].price;ae.value?new ze(o.current_sqrt_price):new ze(1/o.current_sqrt_price),console.log(ae.value,"===>direction.value"),console.log(o,"poolInfos===>"),console.log(Y,J,"####tick_lower tick_upper 889"),console.log(y.value,"liquidityTotalAmount.value");try{const{amountA:qe,amountB:Be,tokenAmountsInfo:Re}=await b.value.estCoinAmountsFromTotalAmount({lowerTick:Y,upperTick:J,decimalsA:E,decimalsB:ve,curSqrtPrice:new ze(o.current_sqrt_price),totalAmount:y.value.replace(/[^\d.]/g,""),tokenPriceA:De,tokenPriceB:ye});console.log(qe,Be,"###estCoinAmountsFromTotalAmount 844"),console.log(o.needReverse,ae.value,"===>849"),K.value=Re,o.needReverse?ae.value?(P.value=qe,S.value=Be):(P.value=Be,S.value=qe):(P.value=qe,S.value=Be)}catch(qe){console.log(qe,"e===>")}};Se([I,k],([o,d])=>{console.log(o,d,"==>minPrice,maxPrice"),Ee.value?Ee.value&&O():Ce(),d!=="∞"&&Number(o)!==0&&Number(d)!==0&&Number(o)>=Number(d)?et.value=!0:et.value=!1,Number(o)==0&&Number(d)==0&&tt.value&&(et.value=!0,console.log("价格区间错误"))},{deep:!0,immediate:!0});const je=o=>{console.log(o,"e");const d=o.replace(/[^\d.]/g,""),p="$"+Fe(d);Ee.value=!0,y.value=p,d>0?O():(P.value="",S.value="")},A=F(!1),{setTransactionTxid:de,setTransactionDesc:Ke,setIsShowWaiting:Me,setIsShowSuccess:nt,setPositiomNum:Ye,setIsShowRejected:Je}=ge,Ze=ko(),X=$(()=>j.value.currentPositionInfo),at=F(!1),t=F(!0),r=F(),g=o=>{console.log(o,"getFarmsPoolInfo:"),r.value=o,o||(t.value=!1)},C=async o=>{var Pe,$e,Xe,De;console.log(i.value,"===> poolInfo.value"),console.log(r.value,"##farmPoolInfo"),A.value=!1,j.value.currentPositionInfo={},de(""),Ke(e("tips.increaseLiquiditySuccess",{from:w.value?"":`${Fe(P.value)} ${(Pe=_.value)==null?void 0:Pe.symbol}`,and:!w.value&&!V.value?"and":"",to:V.value?"":`${Fe(S.value)} ${($e=h.value)==null?void 0:$e.symbol}`})),Me(!0);const d=ae.value?Le.value:!Le.value;let p,pe,E,ve,be,ie;const Y=i.value.token_a.decimals,J=i.value.token_b.decimals;if(I.value==="0"&&k.value==="∞")E=b.value.TickUtil.getMinIndex(Number(i.value.tickSpacing)),ve=b.value.TickUtil.getMaxIndex(Number(i.value.tickSpacing));else if(D.value=="custom"){ae.value?(p=I.value,pe=k.value):(p=new a(1).div(k.value).toString(),pe=new a(1).div(I.value).toString()),console.log("0519###toAdd###min###",p),console.log("0519###toAdd###max###",pe),console.log("0519###toAdd###minPrice.value###",I.value),console.log("0519###toAdd###maxPrice.value###",k.value);try{be=p==0?b.value.TickUtil.getMinIndex(Number(i.value.tickSpacing)):b.value.TickMath.priceToTickIndex(new a(p),Y,J)}catch{be=b.value.TickUtil.getMinIndex(Number(i.value.tickSpacing))}try{ie=b.value.TickMath.priceToTickIndex(new a(pe),Y,J)}catch{ie=b.value.TickUtil.getMaxIndex(Number(i.value.tickSpacing))}E=b.value.getNearestTickByTick(be,Number(i.value.tickSpacing),!0),ve=b.value.getNearestTickByTick(ie,Number(i.value.tickSpacing),!0)}else E=Qe.value[D.value].lower,ve=Qe.value[D.value].upper;console.log(E,ve,"####tick_lower tick_upper 889"),console.log(i.value,"==>poolInfo.value.curSqrtPrice"),console.log("1202###Add###tick_lower####",E),console.log("1202###Add###tick_upper####",ve),console.log("1202###Add###poolInfo.value####",i.value);try{let ye;Ee.value?ye=await b.value.getCreateAddLiquidityPayload({pool:i.value,curSqrtPrice:new ze(i.value.current_sqrt_price),tickLower:E,tickUpper:ve,slippage:Number(N.value)/100,tokenAmounts:K.value}):ye=await b.value.getAddLiquidityTransactionPayload({pool:{poolAddress:i.value.poolAddress,token_a:i.value.token_a,token_b:i.value.token_b},amount:Le.value?P.value:S.value,fix_amount_a:d,tick_lower:E,tick_upper:ve,index:0,slippage:Number(N.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new ze(i.value.current_sqrt_price),farmPoolInfo:r.value}),console.log(ye,"payload===?");let Z;if(M.value==="Aptos")Z=await L.value.currentWallet.signAndSubmitTransaction(ye);else{const Oe=await L.value.currentWallet.signAndExecuteTransactionBlock(ye);Z=b.value.handleTx(Oe)}if(console.log("0410###tx###",Z),Z&&Z.hash){de(Z.hash),Me(!1),nt(!0);let Oe;i.value.needReverse?i.value.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&i.value.token_b.address.toLowerCase()===h.value.address.toLowerCase()?Oe=!1:Oe=!0:i.value.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&i.value.token_b.address.toLowerCase()===h.value.address.toLowerCase()?Oe=!0:Oe=!1,console.log(Oe,"===>directs");const qe={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:w.value?"":`${Fe(P.value)} ${(Xe=_.value)==null?void 0:Xe.symbol}`,and:!w.value&&!V.value?"and":"",to:V.value?"":`${Fe(S.value)} ${(De=h.value)==null?void 0:De.symbol}`}),hash:Z.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};M.value!=="Aptos"&&(qe.res=Z.res),b.value.showTransitionPending(qe),console.log(qe,"toAdd params###");const Be=await b.value.watchTransaction(qe,!0);if(Be.status){if(nt(!1),j.value.setCurrentPositionLoading(!0),at.value=!0,console.log(Be.nftInfo,"===> watchInfo.nftInfo"),M.value==="Aptos"){if(await j.value.setCurrentPositionInfo(Be.nftInfo[0].data.id.creator,Be.nftInfo[0].data.id.collection,Be.nftInfo[0].data.name,M.value),o)try{await Ze.subscribePosition({pool_address:X.value.poolAddress,position_index:X.value.index},X.value.nftHash)}catch(Re){console.log(Re,"e")}}else{const Re=Be.nftInfo,Te=await It(2e3);if(t.value){let Ae;Z.res.events.forEach(Ge=>{Ge.type.indexOf("::pool::DepositEvent")>-1&&(Ae=Ge.parsedJson.wrapped_position_id)}),console.log(Ae,"###farmPositionId"),await j.value.setCurrentPositionInfo("","","","Sui",Ae,"farming")}else await j.value.setCurrentPositionInfo(Re==null?void 0:Re.pool,"","",M.value,Re==null?void 0:Re.position);if(await It(1e3),console.log("0529###nftInfo###",Re),console.log("0529###currentPositionInfo.value.index###",X.value),o&&!t.value)try{await Ze.subscribePosition({pool_address:X.value.poolAddress,position_index:X.value.index},X.value.nftHash)}catch(Ae){console.log(Ae)}else if(o&&t.value)try{await Ze.subscribePosition({pool_address:X.value.clmm_pool_id,position_index:X.value.name.split("-")[1]},X.value.clmm_position_id)}catch(Ae){console.log(Ae)}}setTimeout(()=>{le.updateCurrentPools(i.value.poolAddress,M.value),b.value.getAccount(L.value.address)},3e3),setTimeout(async()=>{Nt(b,i)},3e3)}Ye()}else Me(!1),Je(!0);P.value="",S.value=""}catch(ye){P.value="",S.value="",console.log("0330###Add liquidity Error###",ye),Me(!1),Je(!0)}},U=$(()=>!P.value&&!S.value?(console.log("addLiquidityBtnDisabled11111"),!0):Number(P.value)>Number(se.value)||Number(S.value)>Number(f.value)?(console.log("addLiquidityBtnDisabled22222"),!0):ue.value!==e("button.addLiquidity")&&ue.value!==e("newAdd.preview")?(console.log("addLiquidityBtnDisabled33333###",ue.value),!0):i.value&&i.value&&i.value.is_pause?(console.log("addLiquidityBtnDisabled44444"),!0):Number(P.value)<=0&&Number(S.value)<=0||!w.value&&Number(P.value)==0||!V.value&&Number(S.value)==0),x=$(()=>!_.value||!h.value),ue=$(()=>i.value&&i.value.is_pause?"Pool Closed":!_.value||!h.value||x.value?e("modal.selectTokenModalTitle"):Number(P.value)>Number(se.value)?e("button.insufficientBalance",{name:_.value.symbol}):Number(S.value)>Number(f.value)?e("button.insufficientBalance",{name:h.value.symbol}):!Number(P.value)&&!Number(S.value)?e("button.enterAmount"):k.value!=="∞"&&Number(I.value)>=Number(k.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),xe=F({}),u=F({}),l=F(!1),me=(o,d)=>{console.log(m.value,"===>currentCoinKey.value"),console.log(o);const p=localStorage.getItem(o.address);console.log(j.value.tokensObj,"===>pools.value.tokensObj"),console.log(p,"===>coinLocak"),j.value.tokensObj&&j.value.tokensObj[o.address]&&j.value.tokensObj[o.address].isSelfBuilt&&!p&&(d=="fromCoin"&&(xe.value=o),d=="toCoin"&&(u.value=o),l.value=!0)};Se(()=>[_.value,h.value],([o,d])=>{o&&!ce(o)&&me(o,"fromCoin"),d&&!ce(d)&&me(d,"toCoin")},{immediate:!0});const te=ao(),we=()=>{M.value!=="Aptos"?te.push("/pool/list"):te.push("/pools")},Kt=o=>{Ee.value,C(o)},Jt=()=>{oe.query.action!=="create-pool"&&oe.query.actions!=="new-position"&&(Nt(b,i),Ce(),le.updateCurrentPools(i.value.poolAddress,M.value)),le.setPoolConfigList(M.value,re.value.filterCoinsObj)},Qt=$(()=>{var p,pe,E,ve,be,ie;const o=(E=R.value[(pe=(p=_)==null?void 0:p.value)==null?void 0:pe.address])==null?void 0:E.price,d=(ie=R.value[(be=(ve=h)==null?void 0:ve.value)==null?void 0:be.address])==null?void 0:ie.price;return!!(o&&d)});return Se(()=>[oe,j.value.tokensObj],([o,d])=>{var p;d&&!ce(d)&&(h.value||(h.value=j.value.tokensObj[(p=o==null?void 0:o.query)==null?void 0:p.toCoin]))},{immediate:!0,deep:!0}),{positionError:et,decimalUi:he,poolInfo:i,fromCoinAmount:P,toCoinAmount:S,fromCoin:_,toCoin:h,theme:_e,showFromCoinLock:w,showToCoinLock:V,fromCoinBlance:se,toCoinBlance:f,maxBtnSelect:n,halfBtnSelect:T,fixedFromCoin:Le,openCoinSelect:ke,currentCoinKey:m,existingCoins:v,lastSelectCoin:B,showCoinSelect:ee,onCoinSelect:Ie,liquidityTotalAmount:y,toggle:Xt,onInput:je,isInputTotalAmount:Ee,isViewDetail:at,addLiquidityBtnDisabled:U,addLiquidityBtnText:ue,isShowTokenWarning:l,chainName:M,closeTokenWarning:we,warningFromCoin:xe,warningToCoin:u,isShowLiquidityModal:A,currentPrice:tt,currentPriceReverse:st,currentPriceTab:D,minPrice:I,maxPrice:k,toAdd:C,direction:ae,wallet:L,getAddLiquidityType:Kt,clickRefresh:Jt,isShowtotalAmount:Qt,isAutoStakeFarming:t,farmPoolInfo:r,getFarmsPoolInfo:g}}});const zi={class:"new-liquidity-right"},Hi={class:"deposit-title"},xi={class:"card-container"},Xi={key:0,class:"lock"},Ei={class:"card-item"},Di={class:"card-item"},Wi={key:0,class:"total-amount"},Zi=s("span",null,"Total Amount",-1);function Gi(e,c,ge,re,M,le){const j=zt,z=vo,L=Ht,oe=go,i=xt,w=ro,V=po,_e=bo,Ne=ho,se=Ui;return q(),W("div",zi,[s("div",Hi,[He(j,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),s("div",xi,[e.positionError?(q(),W("div",Xi,[He(z)])):Q("",!0),s("div",Ei,[He(L,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":c[0]||(c[0]=f=>e.fromCoinAmount=f),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:c[1]||(c[1]=f=>e.maxBtnSelect("fromCoin")),onOnHalf:c[2]||(c[2]=f=>e.halfBtnSelect("fromCoin")),onOnInput:c[3]||(c[3]=f=>{e.fromCoinAmount=f,e.fixedFromCoin=!0,e.isInputTotalAmount=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock&&!e.positionError?(q(),We(oe,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):Q("",!0)]),s("div",Di,[He(L,{modelValue:e.toCoinAmount,"onUpdate:modelValue":c[4]||(c[4]=f=>e.toCoinAmount=f),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:c[5]||(c[5]=f=>e.maxBtnSelect("toCoin")),onOnHalf:c[6]||(c[6]=f=>e.halfBtnSelect("toCoin")),onOnInput:c[7]||(c[7]=f=>{e.toCoinAmount=f,e.fixedFromCoin=!1,e.isInputTotalAmount=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock&&!e.positionError?(q(),We(oe,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):Q("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(q(),W("img",{key:1,class:"add",src:wo,alt:"",onClick:c[8]||(c[8]=(...f)=>e.toggle&&e.toggle(...f))})):Q("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(q(),W("img",{key:2,class:"add",src:yo,alt:"",onClick:c[9]||(c[9]=(...f)=>e.toggle&&e.toggle(...f))})):Q("",!0)]),e.isShowtotalAmount?(q(),W("div",Wi,[Zi,s("span",null,ne(e.liquidityTotalAmount)+" ",1)])):Q("",!0),He(i,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),He(w,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:c[10]||(c[10]=f=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:ut(()=>[Pt(ne(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(q(),We(V,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:c[11]||(c[11]=f=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):Q("",!0),e.isViewDetail?(q(),We(_e,{key:2,"pool-info":e.poolInfo,"farm-pool-info":e.farmPoolInfo,"is-auto-stake-farming":e.isAutoStakeFarming,onOnClose:c[12]||(c[12]=f=>e.isViewDetail=!1)},null,8,["pool-info","farm-pool-info","is-auto-stake-farming"])):Q("",!0),e.isShowLiquidityModal?(q(),We(Ne,{key:3,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:c[13]||(c[13]=f=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):Q("",!0),e.chainName=="Sui"?(q(),We(se,{key:4,"pool-info":e.poolInfo,"is-active":!e.showFromCoinLock&&!e.showToCoinLock,"is-auto-stake-farming":e.isAutoStakeFarming,onSendFarmsPoolInfo:e.getFarmsPoolInfo},null,8,["pool-info","is-active","is-auto-stake-farming","onSendFarmsPoolInfo"])):Q("",!0)])}const Gt=it(ji,[["render",Gi]]),Ki=ot({components:{NewLiquidityLeft:Zt,NewLiquidityRight:Gt},setup(){Ot(()=>{fo()});const e=Ct();return{tickList:Ve,route:e}}});const Ji={key:0,class:"loading-spin-liquidity loading-global"},Qi={class:"privide-liquidity"};function Yi(e,c,ge,re,M,le){var oe,i;const j=Bt,z=Zt,L=Gt;return q(),W(ht,null,[!e.tickList&&((i=(oe=e.route)==null?void 0:oe.query)!=null&&i.poolAddress)?(q(),W("div",Ji,[He(j)])):Q("",!0),s("div",Qi,[He(z),He(L)])],64)}const Mn=it(Ki,[["render",Yi],["__scopeId","data-v-fc58011a"]]);export{Mn as default};
