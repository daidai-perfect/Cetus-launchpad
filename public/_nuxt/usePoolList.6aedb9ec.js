import{a as j,u as E,P as u}from"./useToken.28679674.js";import{u as N}from"./useSDK.e92294a6.js";import{u as x}from"./pool.4c0bddd9.js";import{h as $,O as B}from"./common.26bee659.js";import{c as K,h as M}from"./index.bdee7b42.js";import"./decimal.a2826370.js";import{f as v}from"./fetchFun.ff4aae28.js";import{D as C}from"./decimal.765d8738.js";function X(){const{setLocalForage:A,getLocalForage:T}=j();N(),E();const{poolList:i,setPoolList:D,setPoolListLoading:G}=x(),I=async()=>{const o=await v("/data/pools_info.json");console.log("ðŸš€ ~ file: usePoolList.ts:10 ~ getPoolListFromLocalJSON ~ res:",o);const e=o==null?void 0:o.lp_list;if(e){const s=[];for(let r=0;r<(e==null?void 0:e.length);r++){const n=e[r];if(!e[r].object.is_pause&&!e[r].is_closed){const c=await t(n);s.push(c)}}return console.log("ðŸš€ ~ file: usePoolList.ts:61 ~ getPoolListFromLocalJSON ~ result:",s),s}},t=async o=>{var p,g,L,h;const e=(o==null?void 0:o.is_forward)===!1,s=(o==null?void 0:o.is_display_rewarder)&&((o==null?void 0:o.rewarder_display1)||(o==null?void 0:o.rewarder_display2)||(o==null?void 0:o.rewarder_display3)),r=[],n=[];if(s){const f=(L=(g=(p=o==null?void 0:o.object)==null?void 0:p.rewarder_manager)==null?void 0:g.fields)==null?void 0:L.rewarders;f==null||f.forEach((l,O)=>{var m,y,S,b,F,k;const P=$((m=l==null?void 0:l.fields)==null?void 0:m.emissions_per_second).mul(C.pow(2,-64)),w={coinType:M((b=(S=(y=l==null?void 0:l.fields)==null?void 0:y.reward_coin)==null?void 0:S.fields)==null?void 0:b.name).source_address,emissionsEveryDay:B(P.mul(60*60*24).toString(),0),emissions_per_second:(F=l==null?void 0:l.fields)==null?void 0:F.emissions_per_second,growth_global:(k=l==null?void 0:l.fields)==null?void 0:k.growth_global};o!=null&&o[`rewarder_display${O+1}`]&&P.gt(0)&&r.push(w),n.push(w)})}let c;return(h=o==null?void 0:o.stable_farming)!=null&&h.stable_farming_pool&&(c=!0),{...o,poolAddress:o==null?void 0:o.address,tokenAAddress:o==null?void 0:o.coin_a_address,tokenBAddress:o==null?void 0:o.coin_b_address,displayTokenAAddress:e?o==null?void 0:o.coin_b_address:o==null?void 0:o.coin_a_address,displayTokenBAddress:e?o==null?void 0:o.coin_a_address:o==null?void 0:o.coin_b_address,isReverse:e,tickSpacing:Number(o==null?void 0:o.tick_spacing),isClosed:o==null?void 0:o.is_closed,haveMining:s&&(r==null?void 0:r.length)>0,miningRewardList:r,isFarmingPool:c,rewarder_infos:n}},J=async o=>{console.log("ðŸš€ ~ fetchPoolList ~ poolList:",i);try{if(!o&&i&&(i==null?void 0:i.length)>0)return i;const e=await v(`${K.Sui.api}/v2/sui/pools_info/v3`);console.log("ðŸš€ ~ file: usePoolList.ts:10 ~ fetchPoolList ~ res:",e);const s=e==null?void 0:e.lp_list;if(s){const r=[];for(let n=0;n<(s==null?void 0:s.length);n++){const c=s[n];if(!s[n].object.is_pause&&!s[n].is_closed){const _=await t(c);r.push(_)}}return console.log("ðŸš€ ~ file: usePoolList.ts:61 ~ result ~ result:",r),r}}catch(e){if(console.error("ðŸš€ ~ file: usePoolList.ts:130 ~ fetchPoolList ~ error:",e),console.log("ðŸš€ ~ file: usePoolList.ts:130 ~ fetchPoolList ~ poolList:",i),(i==null?void 0:i.length)>0)return i;try{const s=await T(u);if(console.log("ðŸš€ ~ file: usePoolList.ts:148 ~ fetchPoolList ~ list:",s),(s==null?void 0:s.length)>0)return s;throw new Error(`LocalForage have not ${u} data`)}catch{try{const s=await I();return console.log("ðŸš€ ~ file: usePoolList.ts:201 ~ fetchPoolList ~ poolListFromLocalJson:",s),s||[]}catch{return[]}}}};return{getPoolList:async()=>{const o=await J();console.log("ðŸš€ ~ getPoolList ~ pools:",o),o&&(D(o),A(u,o))}}}export{X as u};
