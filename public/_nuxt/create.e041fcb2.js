import{_ as ra}from"./upgrade-creat-pool-lock.d0038d53.js";import{_ as wa,a as sa,b as ya,c as Sa}from"./new-liquidity-title.a7771fa1.js";import{i as Qe}from"./import-icon.de3e6c66.js";import{a as ca,m as U,r as B,L as va,z as Pa,A as x,a1 as Na,a2 as Ke,e as da,l as ma,o as y,f as j,i as Ce,h as t,G as D,x as Ie,c as je,w as xo,B as Ta,j as $e,p as pa,k as fa,b as _a,s as Aa,C as $a,N as Ra,y as Te,I as Ia,u as La,K as qa}from"./entry.77c88c5a.js";/* empty css              */import{u as ga,a as ka,b as Ca}from"./index.e09e6140.js";import{_ as Ba}from"./new-add-or-create.4fa5e149.js";import{_ as Fa,a as Ma,s as Oa}from"./poolFee.596d4d87.js";import{u as Ua,b as Je,c as ba}from"./index.56bf34fb.js";import{b as ea,a as Re,c as oa,p as aa,g as Da,d as Va,y as ta}from"./common.84762dba.js";import"./decimal.a2826370.js";import{amountLock as ja,fromCoinAmount as u,toCoinAmount as i,fromCoin as b,toCoin as h,showFromCoinLock as te,showToCoinLock as ne,fixedFromCoin as $,createPoolInfo as g,minPrice as _,maxPrice as k,currentPriceReverse as Ea,currentPrice as _e,initPrice as na,direction as R,createPoolFromCoin as la,createPoolToCoin as ua,isFullRange as Wa}from"./create-pool-data.1ed8a580.js";import{D as n}from"./decimal.765d8738.js";import{_ as za,a as Ha}from"./icon-Add-Liquidity_2x.0acb06cb.js";import{resetData as Xa,amountLock as Fe,fromCoin as pe,toCoin as ie,initPrice as Me,minPrice as Ae,maxPrice as we,defaultMinPrice as to,defaultMaxPrice as no,createPoolInfo as fe,isFullRange as ge,fromCoinAmount as Oe,showFromCoinLock as Ga,showToCoinLock as Ka,currentPrice as lo,currentPriceReverse as ia,createPoolFromCoin as ye,createPoolToCoin as Se,direction as ke,fixedFromCoin as Ja,toCoinAmount as Ee}from"./create-pool-data.0f0a9f82.js";import{u as Qa}from"./useDebounceFunction.bf6b8467.js";import"./img-lock_2x.a28135f4.js";import"./lock.35e1d915.js";import"./index.c3f9a5df.js";import"./token-warning.35edd8d4.js";/* empty css              *//* empty css              */import"./swap-setting.71bf9c26.js";import"./icon-error_2x.7a817926.js";import"./status-block.db8aa345.js";import"./deposit-ratio.ce1761ea.js";/* empty css              */import"./notifi.113fcab6.js";import"./useWhale.3738eb9c.js";const Ya=ca({components:{NewLiquidityTile:wa,NewLiquidityDepositRatio:sa},setup(e,l){const le=Ua(),ee=ga(),se=U(()=>ee),G=U(()=>se.value.chainName),S=U(()=>le),X=B(!1);B(),B(),B(),B(!1);const P=va(),{t:m,locale:J}=Pa(),N=U(()=>G.value?Ca(G.value):{}),Q=ka(),r=U(()=>Q),Pe=U(()=>se.value.theme),F=U(()=>S.value.assets&&b.value&&S.value.assets[b.value.address]?aa(S.value.assets[b.value.address].balance,b.value.decimals):"0"),w=U(()=>S.value.assets&&h.value&&S.value.assets[h.value.address]?aa(S.value.assets[h.value.address].balance,h.value.decimals):"0"),Ue=o=>{o==="fromCoin"?($.value=!0,G.value==="Aptos"?u.value=Number(F.value)>0?b.value.symbol=="APT"?new n(Number(F.value)).sub(new n(.1)).lt(new n(0))?"0":new n(Number(F.value)).sub(new n(.1)).toString():String(F.value):"":u.value=Number(F.value)>0?b.value.symbol=="SUI"?new n(Number(F.value)).sub(new n(.05)).lt(new n(0))?"0":new n(Number(F.value)).sub(new n(.05)).toString():String(F.value):""):($.value=!1,G.value==="Aptos"?i.value=Number(w.value)>0?h.value.symbol=="APT"?new n(Number(w.value)).sub(new n(.1)).lt(new n(0))?"0":new n(Number(w.value)).sub(new n(.1)).toString():String(w.value):"":i.value=Number(w.value)>0?h.value.symbol=="SUI"?new n(Number(w.value)).sub(new n(.05)).lt(new n(0))?"0":new n(Number(w.value)).sub(new n(.05)).toString():String(w.value):"")},Ye=o=>{o==="fromCoin"?($.value=!0,u.value=Number(F.value)>0?ea(new n(Number(F.value)).div(2).toString(),b.value.decimals).toString():""):($.value=!1,i.value=Number(w.value)>0?ea(new n(Number(w.value)).div(2).toString(),h.value.decimals).toString():"")};x(()=>[r.value.tokensObj,P.query],async([o])=>{if(o){const s=o;if(P&&P.query&&P.query.fromCoin&&P.query.fromCoin){const p=s[P.query.fromCoin]||await N.value.getTokenBySymbol(s,P.query.fromCoin);b.value=p,la.value=p}if(P&&P.query&&P.query.toCoin&&P.query.toCoin){const p=s[P.query.toCoin]||await N.value.getTokenBySymbol(s,P.query.toCoin);h.value=p,ua.value=p}}},{immediate:!0,deep:!0});const be=B("--"),ue=U(()=>se.value.slippage),Ze=B(),ce=async()=>{if(!_.value&&!k.value)return!1;if(!u.value&&!i.value&&!_.value&&!k.value)return;const o=g.value||{};if(oa(o))return;const{TickUtil:s,TickMath:p,getNearestTickByTick:M}=N.value,T=o==null?void 0:o.token_a.decimals,V=o==null?void 0:o.token_b.decimals;let f,c,A,L,O,E,q=o.current_tick_index,W;if(o.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===h.value.address.toLowerCase()?W=!0:W=!1,_.value==="0"&&k.value==="∞")A=s.getMinIndex(Number(o.tickSpacing)),L=s.getMaxIndex(Number(o.tickSpacing));else{W?(f=Number(_.value),c=Number(k.value)):(f=new n(1).div(k.value).toString(),c=new n(1).div(_.value).toString());try{O=f==0?-443636:p.priceToTickIndex(new n(f),T,V)}catch{O=-443636}try{E=p.priceToTickIndex(new n(c),T,V)}catch{E=443636}A=M(O,Number(o.tickSpacing)),L=M(E,Number(o.tickSpacing))}if(k.value!=="∞"&&A>=L){te.value=!0,u.value="",ne.value=!0,i.value="";return}if(q==L||q==A){te.value=!0,ne.value=!0;return}if(k.value==="∞"||q>=A&&q<=L){te.value=!1,ne.value=!1;let z;if(u.value||i.value){if($.value){const Be=new n(u.value).mul(Math.pow(10,b.value.decimals)).toString();z=new Je(Be)}else{const Be=new n(i.value).mul(Math.pow(10,h.value.decimals)).toString();z=new Je(Be)}const{liquidityAmount:H,tokenMaxA:ae,tokenMaxB:de,tokenMaxAOrigin:Xe,tokenMaxBOrigin:Ge}=N.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:o.token_a,tokenB:o.token_b,lowerTick:A,upperTick:L,coinAmount:z,iscoinA:W?$.value:!$.value,roundUp:!0,slippage:Number(ue.value)/100,curSqrtPrice:new Je(o.current_sqrt_price)});Ze.value={liquidityAmount:H,tokenMaxA:ae,tokenMaxB:de,tokenMaxAOrigin:Xe,tokenMaxBOrigin:Ge},W?$.value?i.value=Number(de)>0?de:"":u.value=Number(ae)>0?ae:"":$.value?i.value=ae:u.value=de}}else q>L?(te.value=!0,ne.value=!0):q<A?(te.value=!0,ne.value=!0):(te.value=!0,u.value="",ne.value=!0,i.value="")};x(()=>na.value,o=>{o&&ce()},{immediate:!0}),x(u,(o,s)=>{o==""&&$.value&&(i.value=""),o&&$.value&&!X.value&&ce()}),x(i,(o,s)=>{o==""&&!$.value&&(u.value=""),o&&!$.value&&!X.value&&ce()}),x(()=>Wa.value,o=>{ce()},{immediate:!0});const xe=o=>{const s=o.replace(/[^\d.]/g,""),p="$"+Re(s);X.value=!0,be.value=p,o>0?We():(u.value="",i.value="")};x([_,k],([o,s])=>{Number(o)!==0&&Number(s)!==0&&!X.value?ce():Number(o)!==0&&Number(s)!==0&&X.value?We():ce()},{immediate:!0}),x(()=>{var o;return(o=g)==null?void 0:o.value},o=>{ce()},{deep:!0});const eo=()=>{const o=Y.value&&Y.value[b.value.address]&&Y.value[b.value.address].price,s=Y.value&&Y.value[h.value.address]&&Y.value[h.value.address].price;if(o&&s){const p=new n(u.value>0?u.value:0).mul(o),M=new n(i.value>0?i.value:0).mul(s),T=p.add(M).toNumber();be.value=T>0&&T<.01?"$<0.01":"$"+Re(T,2)}else be.value="--"};x(()=>[u.value,i.value,X.value],([o,s,p])=>{(o||s)&&!p?eo():(!o||!s)&&!p&&(be.value="--")},{immediate:!0});const Y=U(()=>r.value.RATES),Le=B(),We=async()=>{if(!_.value&&!k.value)return!1;if(!u.value&&!i.value&&!_.value&&!k.value)return;const o=g.value||{};if(oa(o))return;const{TickUtil:s,TickMath:p,getNearestTickByTick:M}=N.value,T=o==null?void 0:o.token_a.decimals,V=o==null?void 0:o.token_b.decimals;let f,c,A,L,O,E,q;if(o.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===h.value.address.toLowerCase()?q=!0:q=!1,_.value==="0"&&k.value==="∞")A=s.getMinIndex(Number(o.tickSpacing)),L=s.getMaxIndex(Number(o.tickSpacing));else{q?(f=Number(_.value),c=Number(k.value)):(f=new n(1).div(k.value).toString(),c=new n(1).div(_.value).toString());try{O=f==0?-443636:p.priceToTickIndex(new n(f),T,V)}catch{O=-443636}try{E=p.priceToTickIndex(new n(c),T,V)}catch{E=443636}A=M(O,Number(o.tickSpacing)),L=M(E,Number(o.tickSpacing))}const W=Y.value[o==null?void 0:o.token_a.address].price,z=Y.value[o==null?void 0:o.token_b.address].price;try{const{amountA:H,amountB:ae,tokenAmountsInfo:de}=await N.value.estCoinAmountsFromTotalAmount({lowerTick:A,upperTick:L,decimalsA:T,decimalsB:V,curSqrtPrice:new Je(o.current_sqrt_price),totalAmount:be.value,tokenPriceA:W,tokenPriceB:z});Le.value=de,o.needReverse?R.value?(u.value=H,i.value=ae):(u.value=ae,i.value=H):(u.value=H,i.value=ae)}catch(H){console.log(H,"e===>")}},oo=U(()=>{var p,M,T,V,f,c;const o=(T=Y.value[(M=(p=b)==null?void 0:p.value)==null?void 0:M.address])==null?void 0:T.price,s=(c=Y.value[(f=(V=h)==null?void 0:V.value)==null?void 0:f.address])==null?void 0:c.price;return!!(o&&s)}),a=()=>{l.emit("toggle")},v=B(!1),d=U(()=>{var o;return!b.value||!h.value?m("modal.selectTokenModalTitle"):!((o=P.query)!=null&&o.fee)&&ba[G.value].hasCreatePool?"Select fee tier":!Number(u.value)&&!Number(i.value)?m("button.enterAmount"):Number(u.value)>Number(F.value)?m("button.insufficientBalance",{name:b.value.symbol}):Number(i.value)>Number(w.value)?m("button.insufficientBalance",{name:h.value.symbol}):k.value!=="∞"&&Number(_.value)>=Number(k.value)?m("newAdd.invalidRange"):m("newAdd.preview")}),K=o=>{const s=new RegExp("[^\\d-]*(\\d*(?:\\.\\d{0,2})?).*$");o.target.value=o.target.value.replace(s,"$1")},C=U(()=>{var o;return!!(!u.value&&!i.value||Number(u.value)>Number(F.value)||Number(i.value)>Number(w.value)||d.value!==m("newAdd.preview")||!g.value&&!((o=g.value)!=null&&o.currentPrice)||Number(u.value)<=0&&Number(i.value)<=0||te.value||ne.value)}),{setTransactionTxid:I,setTransactionDesc:ve,setIsShowWaiting:oe,setIsShowSuccess:he,setIsShowRejected:Z,setPositiomNum:Ne}=ee,qe=()=>{G.value=="Sui"&&He()},{$notify:ze}=Na(),De=B(!1),He=async()=>{var W,z,H,ae,de,Xe,Ge,Be,uo,io,ro,so,co,vo,mo,po,fo,go,ko,Co,bo,ho,wo,yo,So,Po,No,To,_o,Ao,$o,Ro,Io,Lo,qo,Bo,Fo,Mo,Oo,Uo,Do,Vo,jo,Eo,Wo,zo,Ho,Xo,Go,Ko,Jo,Qo,Yo,Zo;v.value=!1;let o=!1;N.value.getIsSortedSymbols(la.value.address,ua.value.address)&&(o=!0),I("");const s=te.value?"":`${u.value} ${(W=b.value)==null?void 0:W.symbol}`,p=ne.value?"":`${i.value} ${(z=h.value)==null?void 0:z.symbol}`;ve(m("tips.increaseLiquiditySuccess",{from:!o&&!((ae=(H=g)==null?void 0:H.value)!=null&&ae.needReverse)||o&&((Xe=(de=g)==null?void 0:de.value)!=null&&Xe.needReverse)?s:p,and:!te.value&&!ne.value?"and":"",to:!o&&!((Be=(Ge=g)==null?void 0:Ge.value)!=null&&Be.needReverse)||o&&((io=(uo=g)==null?void 0:uo.value)!=null&&io.needReverse)?p:s})),oe(!0);let M="",T="",V="",f="",c="",A="",L=0,O=0,E=!1,q;if(o||(so=(ro=g)==null?void 0:ro.value)!=null&&so.needReverse){const me=o&&!((vo=(co=g)==null?void 0:co.value)!=null&&vo.needReverse);M=me?(Co=(ko=(go=g)==null?void 0:go.value)==null?void 0:ko.token_b)==null?void 0:Co.address:(fo=(po=(mo=g)==null?void 0:mo.value)==null?void 0:po.token_a)==null?void 0:fo.address,T=me?(Po=(So=(yo=g)==null?void 0:yo.value)==null?void 0:So.token_a)==null?void 0:Po.address:(wo=(ho=(bo=g)==null?void 0:bo.value)==null?void 0:ho.token_b)==null?void 0:wo.address,V=me?(Ro=($o=(Ao=g)==null?void 0:Ao.value)==null?void 0:$o.token_b)==null?void 0:Ro.decimals:(_o=(To=(No=g)==null?void 0:No.value)==null?void 0:To.token_a)==null?void 0:_o.decimals,f=me?(Mo=(Fo=(Bo=g)==null?void 0:Bo.value)==null?void 0:Fo.token_a)==null?void 0:Mo.decimals:(qo=(Lo=(Io=g)==null?void 0:Io.value)==null?void 0:Lo.token_b)==null?void 0:qo.decimals,(Uo=(Oo=g)==null?void 0:Oo.value)!=null&&Uo.needReverse?(c=R.value?u.value:i.value,A=R.value?i.value:u.value,L=R.value?Number(_.value):1/Number(k.value),O=R.value?Number(k.value):1/Number(_.value),E=R.value?$.value:!$.value,q=R.value?_e.value:1/Number(_e.value)):(c=R.value?i.value:u.value,A=R.value?u.value:i.value,L=R.value?1/Number(k.value):Number(_.value),O=R.value?1/Number(_.value):Number(k.value),E=R.value?!$.value:$.value,q=R.value?1/Number(_e.value):_e.value)}else M=(jo=(Vo=(Do=g)==null?void 0:Do.value)==null?void 0:Vo.token_a)==null?void 0:jo.address,T=(zo=(Wo=(Eo=g)==null?void 0:Eo.value)==null?void 0:Wo.token_b)==null?void 0:zo.address,V=(Go=(Xo=(Ho=g)==null?void 0:Ho.value)==null?void 0:Xo.token_a)==null?void 0:Go.decimals,f=(Qo=(Jo=(Ko=g)==null?void 0:Ko.value)==null?void 0:Jo.token_b)==null?void 0:Qo.decimals,c=R.value?u.value:i.value,A=R.value?i.value:u.value,L=R.value?Number(_.value):1/Number(k.value),O=R.value?Number(k.value):1/Number(_.value),E=R.value?$.value:!$.value,q=R.value?_e.value:1/Number(_e.value);try{console.log("0501###toCreatePool###params###",{coinTypeA:M,coinTypeB:T,decimalsA:V,decimalsB:f,amountA:c,amountB:A,minPrice:L,maxPrice:O,fix_amount_a:E,tick_spacing:Number(g.value.tickSpacing),slippage:Number(ue.value)/100,price:q});const me=await N.value.getCreatPoolTransactionPayload({coinTypeA:M,coinTypeB:T,decimalsA:V,decimalsB:f,amountA:c,amountB:A,minPrice:_.value=="0"&&k.value=="∞"?"0":L,maxPrice:_.value=="0"&&k.value=="∞"?"∞":O,fix_amount_a:E,tick_spacing:Number(g.value.tickSpacing),slippage:Number(ue.value)/100,price:q}),ha=await N.value.signAndExecuteTransactionBlock(S.value.currentWallet,me),Ve=N.value.handleTx(ha);if(Ve&&Ve.hash){I(Ve.hash),oe(!1),he(!0);const ao={title:"Created pool",desc:"Pool created successfully ",hash:Ve.hash,tit:"Pool Created",icon:"icon-icon-Position-Created",tokenInfo:{tokena:`${(Yo=b.value)==null?void 0:Yo.address}`,numa:te.value?"":`- ${u.value}`,logoa:r.value.tokensObj&&b.value&&b.value.address&&r.value.tokensObj[b.value.address]&&r.value.tokensObj[b.value.address].logoURI,tokenb:`${(Zo=h.value)==null?void 0:Zo.address}`,numb:ne.value?"":`- ${i.value}`,logob:r.value.tokensObj&&h.value&&h.value.address&&r.value.tokensObj[h.value.address]&&r.value.tokensObj[h.value.address].logoURI},text:"Pool created successfully"};G.value!=="Aptos"&&(ao.res=Ve.res),N.value.showTransitionPending(ao),(await N.value.watchTransaction(ao,!0)).status&&(he(!1),De.value=!0,setTimeout(()=>{Q.setPoolConfigList(G.value,se.value.filterCoinsObj),N.value.getAccount(S.value.address)},1e3)),Ne()}else oe(!1),Z(!0);u.value="",i.value=""}catch(me){console.log("0407###createPool###error##",String(me)),String(me).indexOf('Some("create_pool_internal") }, 1')>-1&&ze.error({icon:Ke("svg",{class:{icon:!0},"aria-hidden":!0},[Ke("use",{"xlink:href":"#icon-a-icon-Shutdown"})]),message:Ke("div",{class:"notification-title"},[Ke("span",{innerHTML:"Pool already exists"},null)]),duration:4.5,description:"Something went wrong",class:"ant-notification-copy ant-notification-error"}),v.value=!1,Q.setPoolConfigList(G.value,se.value.filterCoinsObj),u.value="",i.value="",oe(!1),Z(!0)}};return{amountLock:ja,wallet:S,inputChange:K,fromCoinAmount:u,toCoinAmount:i,fromCoin:b,toCoin:h,maxBtnSelect:Ue,halfBtnSelect:Ye,showFromCoinLock:te,showToCoinLock:ne,fromCoinBlance:F,toCoinBlance:w,fixedFromCoin:$,isInputTotalAmount:X,toggle:a,theme:Pe,liquidityTotalAmount:be,createPoolInfo:g,minPrice:_,maxPrice:k,currentPriceReverse:Ea,currentPrice:_e,onInput:xe,initPrice:na,isShowtotalAmount:oo,direction:R,isShowLiquidityModal:v,createPoolBtnText:d,createPoolBtnDisabled:C,toCreatePool:qe,isCreateSuccess:De}}});const Za=e=>(pa("data-v-53922171"),e=e(),fa(),e),xa={class:"create-pool-right"},et={class:"card-container"},ot={key:0,class:"lock"},at={class:"card-item"},tt={class:"card-item"},nt={key:0,class:"total-amount"},lt=Za(()=>t("span",null,"Total Amount",-1));function ut(e,l,le,ee,se,G){const S=ma("NewLiquidityTile"),X=ra,P=ya,m=sa,J=Ba,N=Ta,Q=Fa;return y(),j("div",xa,[Ce(S),t("div",et,[e.amountLock||e.showFromCoinLock||e.showToCoinLock?(y(),j("div",ot,[Ce(X)])):D("",!0),t("div",at,[Ce(P,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":l[0]||(l[0]=r=>e.fromCoinAmount=r),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:l[1]||(l[1]=r=>e.maxBtnSelect("fromCoin")),onOnHalf:l[2]||(l[2]=r=>e.halfBtnSelect("fromCoin")),onOnInput:l[3]||(l[3]=r=>{e.fromCoinAmount=r,e.fixedFromCoin=!0,e.isInputTotalAmount=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"])]),t("div",tt,[Ce(P,{modelValue:e.toCoinAmount,"onUpdate:modelValue":l[4]||(l[4]=r=>e.toCoinAmount=r),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:l[5]||(l[5]=r=>e.maxBtnSelect("toCoin")),onOnHalf:l[6]||(l[6]=r=>e.halfBtnSelect("toCoin")),onOnInput:l[7]||(l[7]=r=>{e.toCoinAmount=r,e.fixedFromCoin=!1,e.isInputTotalAmount=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"])]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(y(),j("img",{key:1,class:"add",src:za,alt:"",onClick:l[8]||(l[8]=(...r)=>e.toggle&&e.toggle(...r))})):D("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(y(),j("img",{key:2,class:"add",src:Ha,alt:"",onClick:l[9]||(l[9]=(...r)=>e.toggle&&e.toggle(...r))})):D("",!0)]),e.isShowtotalAmount?(y(),j("div",nt,[lt,t("span",null,Ie(e.liquidityTotalAmount),1)])):D("",!0),e.initPrice?(y(),je(m,{key:1,"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"create-pool-info":e.createPoolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":"custom","current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","create-pool-info","min-price","max-price","current-price","current-price-reverse"])):D("",!0),e.isShowLiquidityModal?(y(),je(J,{key:2,"pool-info":e.createPoolInfo,title:e.$t("newAdd.preview"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":"custom","min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,"is-create":!0,onCreatePool:e.toCreatePool,onOnClose:l[10]||(l[10]=r=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onCreatePool"])):D("",!0),e.wallet.connected?(y(),je(N,{key:4,class:"add-liquidity-btn",disabled:e.wallet.connected?e.createPoolBtnDisabled:!1,onClick:l[12]||(l[12]=r=>e.isShowLiquidityModal=!0)},{default:xo(()=>[$e(Ie(e.createPoolBtnText),1)]),_:1},8,["disabled"])):(y(),je(N,{key:3,class:"add-liquidity-btn",onClick:l[11]||(l[11]=r=>e.wallet.setIsShowWalletModal(!0))},{default:xo(()=>[$e(Ie(e.$t("button.connectWallet")),1)]),_:1})),e.isCreateSuccess?(y(),je(Q,{key:5,onOnClose:l[13]||(l[13]=r=>e.isCreateSuccess=!1)})):D("",!0)])}const it=da(Ya,[["render",ut],["__scopeId","data-v-53922171"]]),rt=ca({components:{CreatePoolRight:it},setup(e,l){const le=B(!0),ee=B(!0),se=B(!0),G=B(!1),S=B("1"),X=B(!0),P=B(""),m=va(),J=_a(),N=ga(),Q=U(()=>N),r=ka(),Pe=U(()=>r),F=U(()=>Q.value.chainName),w=U(()=>F.value?Ca(F.value):{}),Ue=B("");x(()=>[J,Pe.value.tokensObj],async([a,v])=>{var d,K,C;((d=J==null?void 0:J.currentRoute)==null?void 0:d.value.name)=="liquidity-create"&&v&&(pe.value=Pe.value.tokensObj[m.query.fromCoin]||await w.value.getTokenBySymbol(v,m.query.fromCoin),ie.value=Pe.value.tokensObj[m.query.toCoin]||await w.value.getTokenBySymbol(v,m.query.toCoin),Ue.value=m.query.fee!=="null"&&m.query.fee?m.query.fee:""),((K=J==null?void 0:J.currentRoute)==null?void 0:K.value.name)=="liquidity-create"&&((C=m==null?void 0:m.query)!=null&&C.fee)&&(Me.value="",Oe.value="",Ee.value="",ge.value=!0)},{immediate:!0,deep:!0}),x(()=>[pe.value,ie.value,Me.value,Ue.value,Ae.value,we.value,Oe.value,Ee.value],([a,v,d,K,C,I,ve])=>{!a||!v?(S.value="1",le.value=!0,ee.value=!0,Fe.value=!0):K?d?!C||!I?(S.value="4",le.value=!1,ee.value=!1,Fe.value=!0):ve||(S.value="5",le.value=!1,ee.value=!1,Fe.value=!1):(S.value="3",le.value=!1,ee.value=!0,Fe.value=!0):(S.value="2",le.value=!0,ee.value=!0,Fe.value=!0)},{immediate:!0}),x(()=>S.value,a=>{Number(a)<5&&(Oe.value="",Ee.value="")});const Ye=a=>{var v;return(a==null?void 0:a.logoURI)||(a==null?void 0:a.logo_url)||((v=Pe.value.tokensObj[a==null?void 0:a.address])==null?void 0:v.logo_url)||(Q.value.theme==="default"?Qe("/image/coins/unknown.png"):Qe("/image/coins/sui-unknown.png"))},be=a=>{switch(a){case"1":return{top:"10%"};case"2":return{top:"29%"};case"3":return{top:"48%"};case"4":return{top:"67%"};case"5":return{top:"87%"}}};U(()=>ba[F.value].hasCreatePool);const ue=async a=>{var oe,he,Z,Ne,qe,ze,De,He,o,s,p,M,T,V;console.log("#####emitCurrentPrice",a),a?(Me.value=a,lo.value=a,ia.value=new n(1).div(new n(a)).toString()):(Me.value="",lo.value="",ia.value="");let v,d;const K=Pe.value.poolConfigList;for(let f=0;f<K.length;f++){const c=K[f];if(c.token_a.address.toUpperCase()===((Z=(he=(oe=ye)==null?void 0:oe.value)==null?void 0:he.address)==null?void 0:Z.toUpperCase())&&c.token_b.address.toUpperCase()===((ze=(qe=(Ne=Se)==null?void 0:Ne.value)==null?void 0:qe.address)==null?void 0:ze.toUpperCase())){v=c.needReverse,d=c;break}else if(c.token_b.address.toUpperCase()===((o=(He=(De=ye)==null?void 0:De.value)==null?void 0:He.address)==null?void 0:o.toUpperCase())&&c.token_a.address.toUpperCase()===((M=(p=(s=Se)==null?void 0:s.value)==null?void 0:p.address)==null?void 0:M.toUpperCase())){v=c.needReverse,d=c;break}}let C=!1;await w.value.getIsSortedSymbols((T=ye.value)==null?void 0:T.address,(V=Se.value)==null?void 0:V.address)&&(C=!0);let I;console.log(C,"###changeCurrentPrice createPoolNeedReverse 289"),console.log(ke.value,"####changeCurrentPrice direction.value 290"),C&&!ke.value?I=!0:C&&ke.value||!C&&ke.value?I=!1:I=!0,console.log(I,"###changeCurrentPrice newDirect 298");const ve=F.value=="Aptos"?Ma:Oa;if(pe.value&&ie.value&&a){const f=d?d==null?void 0:d.token_a.decimals:C?Se.value.decimals:ye.value.decimals,c=d?d==null?void 0:d.token_b.decimals:C?ye.value.decimals:Se.value.decimals,A=a&&w.value.TickMath.priceToSqrtPriceX64(I?new n(1/a):new n(a),f,c);console.log(A.toString(),"===>current_sqrt_price"),console.log(a&&a>0,"## emitCurrentPrice &&emitCurrentPrice>0");const L=a&&a>0&&w.value.TickMath.priceToSqrtPriceX64(new n(1).div(a),pe.value.decimals,ie.value.decimals);console.log(!I,a,"===>!newDirect"),console.log(f,c,"decimalsA,decimalsB===>");const O=a&&a>0&&w.value.TickMath.priceToTickIndex(I?new n(1).div(a):new n(a),f,c);console.log(O,"==>currentTickIndex");const E=O-ve[m.query.fee]*5,q=O+ve[m.query.fee]*5,W=w.value.TickMath.tickIndexToPrice(E,f,c).toString(),z=w.value.TickMath.tickIndexToPrice(q,f,c).toString();ge.value?(Ae.value="0",we.value="∞"):I?(Ae.value=String(1/z),we.value=String(1/W),to.value=String(1/z),no.value=String(1/W)):(Ae.value=W,we.value=z,to.value=W,no.value=z),console.log("0518###c####createPoolFromCoin.value####",ye.value),console.log("0518###c####createPoolToCoin.value####",Se.value),console.log("0518###c####createPoolNeedReverse####",C);const H={token_a:d?d.token_a:C?Se.value:ye.value,token_b:d?d.token_b:C?ye.value:Se.value,isCreate:!0,tickSpacing:ve[m.query.fee],currentPrice:a,current_sqrt_price:A,tick_lower:E,tick_upper:q,current_tick_index:O,currentPriceReverse:Da(String(1/a),6),reverse_current_sqrt_price:L,needReverse:v,fee:m.query.fee};fe.value=H,console.log("0518###c####poolInfos####",H)}else fe.value=null,Ae.value="",we.value=""},Ze=()=>{ge.value=!ge.value,ue(fe.value.currentPrice)},ce=a=>{console.log(a,"####0731 priceRangeChangeMin"),ge.value?(ge.value=!1,ue(fe.value.currentPrice)):Ae.value=a},xe=a=>{ge.value?(ge.value=!1,ue(fe.value.currentPrice)):a=="0"?we.value="∞":we.value=a},eo=()=>{var v,d;console.log(fe.value,"==>createPoolInfo.value"),ke.value=!ke.value;const a=pe.value;pe.value=ie.value,ie.value=a,fe.value&&(ue(Va(new n(1).div(fe.value.currentPrice).toString(),(d=(v=ie)==null?void 0:v.value)==null?void 0:d.decimals)),Ja.value?Oe.value=Ee.value:Ee.value=Oe.value),console.log(ke.value,"####toggle direction.value")};Aa(()=>{Xa()});const Y=Qa(a=>{console.log("🚀 ~ file: create.vue:514 ~ updateDebouncedValue ~ value:",a),ue(a)},500),Le=B(""),We=a=>{const v=ke.value?ie.value.decimals:pe.value.decimals,d=new RegExp(`[^\\d-]*(\\d*(?:\\.\\d{0,${v}})?).*$`),K=a.target.value.replace(/,/g,"").replace(d,"$1");Y(K)},oo=a=>{var Ne;const v=a.target.selectionStart,d=ke.value?ie.value.decimals:pe.value.decimals,K=new RegExp(`[^\\d-]*(\\d*(?:\\.\\d{0,${d}})?).*$`);console.log("🚀 ~ file: assets-card.vue:287 ~ handleInput ~ event.target.value:",a.target.value);let C=a.target.value.replace(/,/g,"").replace(K,"$1");console.log("🚀 ~ file: assets-card.vue:287 ~ handleInput ~ value:",C);let I=C.includes(".")&&String(Re(C))==="0"?C:String(Re(C));const ve=ta(a.target.value),oe=ta(I),he=oe.length-ve.length;let Z=v+he;if((Ne=a==null?void 0:a.inputType)!=null&&Ne.includes("delete")&&he>0&&v===oe[oe.length-1]){const qe=a.target.value.slice(0,v-1)+a.target.value.slice(v);I=String(Re(qe.replace(/,/g,""))),Z=Z-2}console.log("🚀 ~ file: assets-card.vue:287 ~ handleInput ~ fValue:",I),Le.value=I,setTimeout(()=>{a.target.setSelectionRange(Z<0?0:Z,Z<0?0:Z)},0)};return x(()=>Me.value,a=>{console.log("🚀 ~ file: assets-card.vue:287 ~ setup ~ newValue:",a);const v=a!=null&&a.includes(".")&&String(Re(a))==="0"?a:String(Re(a));console.log("🚀 ~ file: assets-card.vue:287 ~ setup ~ fValue:",v),v!==Le.value&&(Le.value=v)},{immediate:!0}),{amountLock:Fe,currentStep:S,sliderStyle:be,coinAmount:G,pricerange:P,fromCoin:pe,toCoin:ie,fee:Ue,direct:X,getCoinIcon:Ye,isSelectFullRange:se,store:Q,initPrice:Me,inputPriceLock:le,specifyPriceLock:ee,changeCurrentPrice:ue,minPrice:Ae,maxPrice:we,defaultMinPrice:to,defaultMaxPrice:no,clickFullRange:Ze,createPoolInfo:fe,isFullRange:ge,priceRangeChangeMin:ce,priceRangeChangeMax:xe,fromCoinAmount:Oe,toggle:eo,showFromCoinLock:Ga,showToCoinLock:Ka,inputChange:We,currentPrice:lo,importIcon:Qe,formattedValue:Le,handleInput:oo}}});const re=e=>(pa("data-v-6cd865c5"),e=e(),fa(),e),st={class:"creat-pool-container"},ct={class:"creat-pool-left"},vt={class:"progress"},dt=re(()=>t("div",{class:"slider-ratio-content"},null,-1)),mt=[dt],pt={class:"progress-text"},ft={key:0},gt={key:0},kt={key:0},Ct={key:0},bt={key:0},ht={class:"creat-pool-center"},wt={class:"title"},yt=re(()=>t("div",{class:"left"},"Set Initial Price",-1)),St={class:"right"},Pt={key:0,class:"token-box"},Nt=re(()=>t("div",null,[t("svg",{class:"icon icon-up","aria-hidden":"true"},[t("use",{"xlink:href":"#icon-exchange_up1"})])],-1)),Tt=re(()=>t("div",null,[t("svg",{class:"icon icon-down","aria-hidden":"true"},[t("use",{"xlink:href":"#icon-exchange_down1"})])],-1)),_t=[Nt,Tt],At={class:"content top-content"},$t=re(()=>t("div",{class:"top"},[t("span",null,"💡"),t("span",null,"Please set an initial price for this new pool to start.")],-1)),Rt={class:"bottom"},It={class:"input-div"},Lt={key:0,class:"lock"},qt={class:"title"},Bt=re(()=>t("div",{class:"left"},"Set Price Range",-1)),Ft={class:"right"},Mt={key:0,"aria-hidden":"true"},Ot=re(()=>t("use",{"xlink:href":"#icon-icon_sel"},null,-1)),Ut=[Ot],Dt=re(()=>t("span",null,"Full Range",-1)),Vt={class:"content bottom-content"},jt=re(()=>t("span",null,"💡",-1)),Et=re(()=>t("span",null,"Please specify a price range that you want to provide your liquidity within.",-1)),Wt=[jt,Et],zt={class:"bottom"},Ht={class:"set-price-box"},Xt={key:0,class:"lock"},Gt={key:1,class:"create-pool-warning"},Kt={key:2,class:"position-tips"},Jt=["src"],Qt={class:"error"},Yt={class:"creat-pool-right-container"};function Zt(e,l,le,ee,se,G){var N,Q;const S=qa,X=ra,P=Sa,m=ma("CreatePoolRight"),J=$a("image");return y(),j("div",st,[t("div",ct,[t("div",vt,[t("div",{class:"slider-ratio",style:Ra(e.sliderStyle(e.currentStep))},mt,4)]),t("div",pt,[t("div",{class:Te(["row",Number(e.currentStep)>=1?"":"color-text"])},[Number(e.currentStep)>=1&&e.fromCoin&&e.toCoin?(y(),j("span",ft,"✓")):D("",!0),$e(" Select Tokens ")],2),t("div",{class:Te(["row",Number(e.currentStep)>=2?"":"color-text"])},[Number(e.currentStep)>=2&&e.fee?(y(),j("span",gt,"✓")):D("",!0),$e(" Select Fee Tier ")],2),t("div",{class:Te(["row",Number(e.currentStep)>=3?"":"color-text"])},[Number(e.currentStep)>=3&&e.initPrice?(y(),j("span",kt,"✓")):D("",!0),$e(" Set Initial Price ")],2),t("div",{class:Te(["row",Number(e.currentStep)>=4?"":"color-text"])},[Number(e.currentStep)>=4&&e.minPrice&&e.maxPrice?(y(),j("span",Ct,"✓")):D("",!0),$e(" Select Price Range ")],2),t("div",{class:Te(["row",Number(e.currentStep)>=5?"":"color-text"])},[Number(e.currentStep)>=5&&e.fromCoinAmount?(y(),j("span",bt,"✓")):D("",!0),$e(" Confirm Liquidity ")],2)])]),t("div",ht,[t("div",wt,[yt,t("div",St,[e.fromCoin&&e.toCoin?(y(),j("div",Pt,[Ia(t("img",null,null,512),[[J,(N=e.fromCoin)==null?void 0:N.logo_url]]),t("span",null,Ie((Q=e.fromCoin)==null?void 0:Q.symbol),1),t("div",{class:"icon-change",onClick:l[0]||(l[0]=(...r)=>e.toggle&&e.toggle(...r))},_t)])):D("",!0)])]),t("div",At,[$t,t("div",Rt,[t("div",It,[Ce(S,{value:e.formattedValue,type:"text",placeholder:"0.0",onChange:e.inputChange,onInput:e.handleInput},null,8,["value","onChange","onInput"]),t("span",null,Ie(e.toCoin&&e.toCoin.symbol)+" per "+Ie(e.fromCoin&&e.fromCoin.symbol),1)]),e.inputPriceLock?(y(),j("div",Lt,[Ce(X)])):D("",!0)])]),t("div",qt,[Bt,t("div",Ft,[t("div",{class:Te(["radio",e.isFullRange?"active-radio":""]),onClick:l[1]||(l[1]=(...r)=>e.clickFullRange&&e.clickFullRange(...r))},[e.isFullRange?(y(),j("svg",Mt,Ut)):D("",!0)],2),Dt])]),t("div",Vt,[t("div",{class:Te(["top",e.specifyPriceLock?"":"no-border"])},Wt,2),t("div",zt,[t("div",Ht,[Ce(P,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direct,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.createPoolInfo,loading:!1,"current-price-tab":"custom",onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","onOnChangeMinPrice","onOnChangeMaxPrice"])]),e.specifyPriceLock?(y(),j("div",Xt,[Ce(X)])):D("",!0),Number(e.currentStep)>=4&&(e.showFromCoinLock||e.showToCoinLock)&&Number(e.maxPrice)>Number(e.minPrice)?(y(),j("div",Gt," To create a new pool, the initial price you set must be within your price range. ")):D("",!0),Number(e.currentStep)>=4&&Number(e.minPrice)>Number(e.maxPrice)?(y(),j("div",Kt,[t("img",{src:("importIcon"in e?e.importIcon:La(Qe))("/image/icon-tips-error@2x.png"),alt:""},null,8,Jt),t("p",Qt,Ie(e.$t("tips.positionError")),1)])):D("",!0)])])]),t("div",Yt,[Ce(m,{"create-pool-info":e.createPoolInfo,onToggle:e.toggle},null,8,["create-pool-info","onToggle"])])])}const Rn=da(rt,[["render",Zt],["__scopeId","data-v-6cd865c5"]]);export{Rn as default};
