import{m as x,af as xe}from"./entry.1afe32c4.js";import{d as ve,r as Ve,A as Le,E as Ae}from"./index.08ca7d22.js";import{u as Ne,c as I,Y as Be,m as Re,X as Me,d as b,k as je,a4 as fe}from"./index.c41a185a.js";import{a as De,b as _e,j as qe,c as Je}from"./pool.83f6439f.js";import{D as We}from"./decimal.0bdeb344.js";var g=[];for(var L=0;L<256;++L)g.push((L+256).toString(16).slice(1));function Xe(a,o=0){return(g[a[o+0]]+g[a[o+1]]+g[a[o+2]]+g[a[o+3]]+"-"+g[a[o+4]]+g[a[o+5]]+"-"+g[a[o+6]]+g[a[o+7]]+"-"+g[a[o+8]]+g[a[o+9]]+"-"+g[a[o+10]]+g[a[o+11]]+g[a[o+12]]+g[a[o+13]]+g[a[o+14]]+g[a[o+15]]).toLowerCase()}var V,Ke=new Uint8Array(16);function Ge(){if(!V&&(V=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!V))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return V(Ke)}var Ye=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const ye={randomUUID:Ye};function ze(a,o,k){if(ye.randomUUID&&!o&&!a)return ye.randomUUID();a=a||{};var f=a.random||(a.rng||Ge)();if(f[6]=f[6]&15|64,f[8]=f[8]&63|128,o){k=k||0;for(var h=0;h<16;++h)o[k+h]=f[h];return o}return Xe(f)}function He(){return ze()}const Qe=xe(),we=Qe.public.appEnv;console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:14 ~ env:",we);function tr(){const{tokensObj:a,setTokensObj:o}=De(),k=Ne(),f=x(()=>k),h=_e(),d=x(()=>h),Ie=I.Sui.aggregatorv2Url,he=localStorage.getItem("Sui-currentRpclocal6")||I.Sui.fullRpcUrl,Fe=I.Sui.simulationAccount;I.Sui.aggregatorV2.package_id,I.Sui.aggregatorV2.published_at,I.Sui.integrate.package_id,I.Sui.integrate.published_at;const Oe=new Be({url:he}),T=x(()=>new Le(Ie,f.value.address||Fe,Oe,we=="test"?Ae.Testnet:Ae.Mainnet)),Ue=qe(),F=x(()=>Ue),ke=e=>({transactionBlock:e,options:{showEffects:!0,showEvents:!0,showInput:!0,showRawInput:!0,showObjectChanges:!0,showBalanceChanges:!0}}),Pe=(e,r)=>r.minus(e).div(r).mul(100),N=(e,r,c)=>{console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:71 ~ getPriceImpact ~ routerData:",e);const{routes:u}=e;let A=b(0);return u==null||u.forEach(l=>{const p=b(l.amountOut).div(Math.pow(10,c)),i=b(l.amountIn).div(Math.pow(10,r)),S=p.div(i),y=b(l==null?void 0:l.amountIn).div(e==null?void 0:e.amountIn),w=Pe(S,b(l.initialPrice.toString())).mul(new We(y));A=A.add(w)}),Number(je(A.toNumber(),2))},v=e=>fe(e)==="0x2::sui::SUI"?"0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI":fe(e),B=(e,r,c)=>{var A,l,p;const u=e.filter(i=>{const S=v(r),y=v(c),w=v(i==null?void 0:i.base),P=v(i==null?void 0:i.quote);return S===w&&y===P||y===w&&S===P});return(u==null?void 0:u.length)>0?(Object.values((A=u==null?void 0:u[0])==null?void 0:A.addressMap),Array.from((p=(l=u==null?void 0:u[0])==null?void 0:l.addressMap)==null?void 0:p.values())):null},M=e=>e==null?void 0:e.map(r=>{var c,u;return{...r,amountIn:(c=r==null?void 0:r.amountIn)==null?void 0:c.toString(),amountOut:(u=r==null?void 0:r.amountOut)==null?void 0:u.toString(),initialPrice:(r==null?void 0:r.initial_price)||(r==null?void 0:r.initialPrice)}}),Ee=async(e,r,c,u,A,l,p,i)=>{var S,y,w,P,j,D,_,q,J,W,X,K,G,Y,z,H,Q,Z,$,m,C,ee,re,te,se,ae,ue,oe,ne,ge,le,ce,ie;console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:131 ~ getFindRouter ~ index?.value?.liquiditySourceList:",(S=d==null?void 0:d.value)==null?void 0:S.liquiditySourceList),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:131 ~ getFindRouter ~ index?.value?.includeRoutes:",(y=d==null?void 0:d.value)==null?void 0:y.includeRoutes);try{const O=(P=(w=d==null?void 0:d.value)==null?void 0:w.liquiditySourceList)==null?void 0:P.filter(s=>(s==null?void 0:s.status)==="open");console.log("ðŸš€ ~ file: useSuiAggregator.ts:154 ~ function ~ liquiditySources:",O);const R=(j=O==null?void 0:O.filter(s=>{var E;return((E=s==null?void 0:s.name)==null?void 0:E.toUpperCase())!=="CETUS"}))==null?void 0:j.map(s=>{var E,pe,Se;if(((E=s==null?void 0:s.name)==null?void 0:E.indexOf("Kriya"))>-1){if((s==null?void 0:s.name)==="Kriya V2")return"KRIYA";if((s==null?void 0:s.name)==="Kriya V3")return"KRIYAV3"}else{if((s==null?void 0:s.name)==="Aftermath LSD")return"AFSUI";if(((pe=s==null?void 0:s.name)==null?void 0:pe.indexOf("FlowX"))>-1){if((s==null?void 0:s.name)==="FlowX V2")return"FLOWX";if((s==null?void 0:s.name)==="FlowX V3")return"FLOWXV3"}else return(Se=s==null?void 0:s.name)==null?void 0:Se.toUpperCase()}});console.log("ðŸš€ ~ file: useSuiAggregator.ts:155 ~ providers ~ providers:",R);const n={from:v((D=e==null?void 0:e.value)==null?void 0:D.address),target:v((_=r==null?void 0:r.value)==null?void 0:_.address),amount:new Re(c),byAmountIn:u,depth:3,providers:["CETUS",...R],liquidityChanges:i};((q=d==null?void 0:d.value)==null?void 0:q.includeRoutes)!=="open"&&(n.splitCount=1),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:145 ~ getFindRouter ~ findRouterParams:",n),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:193 ~ providers ~ client.value:",T.value);const t=await T.value.findRouters(n);if(console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:163 ~ function ~ res:",t),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:163 ~ function ~ res test:",JSON.parse(JSON.stringify(t))),((J=t==null?void 0:t.error)==null?void 0:J.code)==10001)return{...t,id:p};if(t!=null&&t.insufficientLiquidity)return{...t,id:p};if(!(t!=null&&t.routes)||((W=t==null?void 0:t.routes)==null?void 0:W.length)===0)throw Error("Aggregator no router");console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:156 ~ getFindRouter ~ findRouter res Before formatting:",JSON.stringify(t,null,2));const U={...t,amountIn:(X=t==null?void 0:t.amountIn)==null?void 0:X.toString(),amountOut:(K=t==null?void 0:t.amountOut)==null?void 0:K.toString(),routes:M(t==null?void 0:t.routes),originRes:t};console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:159 ~ getFindRouter ~ findRouter formatRes:",JSON.stringify(U,null,2));const de=N(U,(G=e==null?void 0:e.value)==null?void 0:G.decimals,(Y=r==null?void 0:r.value)==null?void 0:Y.decimals);return console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:170 ~ getFindRouter ~ priceImpact:",de),{...U,priceImpact:de,fromCoinAddress:(z=e==null?void 0:e.value)==null?void 0:z.address,toCoinAddress:(H=r==null?void 0:r.value)==null?void 0:H.address,id:p,uuid:He()}}catch(O){try{console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ error:",O),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ swapRouterStore?.value?.poolListGroupByTokenAB:",(Q=F==null?void 0:F.value)==null?void 0:Q.poolListGroupByTokenAB);const R=B((Z=F==null?void 0:F.value)==null?void 0:Z.poolListGroupByTokenAB,($=e==null?void 0:e.value)==null?void 0:$.address,(m=r==null?void 0:r.value)==null?void 0:m.address);if(console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ pools:",R),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ params:",{from:v((C=e==null?void 0:e.value)==null?void 0:C.address),target:v((ee=r==null?void 0:r.value)==null?void 0:ee.address),amount:c,byAmountIn:u,pools:R}),R){const n=await T.value.swapInPools({from:v((re=e==null?void 0:e.value)==null?void 0:re.address),target:v((te=r==null?void 0:r.value)==null?void 0:te.address),amount:new Re(c),byAmountIn:u,pools:R});if(console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ res:",n),n){const t={isExceed:n==null?void 0:n.isExceed,amountIn:(ae=(se=n==null?void 0:n.routeData)==null?void 0:se.amountIn)==null?void 0:ae.toString(),amountOut:(oe=(ue=n==null?void 0:n.routeData)==null?void 0:ue.amountOut)==null?void 0:oe.toString(),routes:M((ne=n==null?void 0:n.routeData)==null?void 0:ne.routes)};console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ forMatRes:",t);const U=N(t,(ge=e==null?void 0:e.value)==null?void 0:ge.decimals,(le=r==null?void 0:r.value)==null?void 0:le.decimals);return console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ priceImpact:",U),{...t,priceImpact:U,fromCoinAddress:(ce=e==null?void 0:e.value)==null?void 0:ce.address,toCoinAddress:(ie=r==null?void 0:r.value)==null?void 0:ie.address,id:p,originRes:n==null?void 0:n.routeData}}return null}return null}catch(R){return console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:179 ~ getFindRouter Error ~ e:",R),null}}},be=async(e,r,c,u,A)=>{try{console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:246 ~ getRouterSwapPayload ~ router:",e),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:246 ~ getRouterSwapPayload ~ router.originRes:",e.originRes);const l=new Me;console.log("ðŸš€ ~ file: useSuiAggregator.ts:362 ~ router.originRes.routes:",e.originRes.routes);const p=ve(e.originRes.routes);console.log("ðŸš€ ~ file: useSuiAggregator.ts:362 ~ stringify:",p);const i=Ve(p);console.log("ðŸš€ ~ file: useSuiAggregator.ts:362 ~ parse:",i);const S={routers:e.originRes.routes,byAmountIn:r,txb:l,slippage:c,isMergeTragetCoin:!0,refreshAllCoins:!0};console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:258 ~ getRouterSwapPayload ~ routerParams JSON:",JSON.stringify(S,null,2)),console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:258 ~ getRouterSwapPayload ~ routerParams:",S);const y=await T.value.fastRouterSwap(S);return console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:122 ~ function ~ res:",l),{txb:ke(l),payloadParams:{action:"AggregatorSwap",txbParams:{...S,routers:ve(e.originRes.routes)}}}}catch(l){console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:49 ~ function ~ error:",l)}},{getTokenBySymbol:Te}=Je("Sui");return{getFindRouter:Ee,getRouterSwapPayload:be,getTokenInfo:async e=>{if(console.log("ðŸš€ðŸš€ðŸš€ ~ file: useSuiAggregator.ts:288 ~ getTokenInfo ~ address:",e),a[e])return a[e];{const r=await Te(a,e),c={[e]:r},u={...a,...c};o(u);try{localStorage.setItem("SuiTokenObj",JSON.stringify(u))}catch(A){console.log("ðŸš€ ~ file: useSuiAggregator.ts:295 ~ getTokenInfo ~ err:",A)}return r}},getFilterPoolsWithCoinAB:B}}export{tr as u};
